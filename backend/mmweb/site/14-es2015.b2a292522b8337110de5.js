(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"7H8U":function(t,e,n){"use strict";n.r(e);var s=n("ofXK"),r=n("tyNb"),a=n("fXoL");let o=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=a["\u0275\u0275defineComponent"]({type:t,selectors:[["ngx-solar"]],decls:1,vars:0,template:function(t,e){1&t&&a["\u0275\u0275element"](0,"router-outlet")},directives:[r.h],encapsulation:2}),t})();var i=n("tk/3"),l=n("LRne"),c=n("lJxs"),d=n("JIr8"),h=n("aceb");const u={headers:new i.d({"Content-Type":"application/json"})},p="https://solmm01.fmg.local/api/solar/";let g=(()=>{class t{constructor(t,e){this.http=t,this.toastrService=e}extractData(t){return t||{}}handleError(t="operation",e){return t=>(this.dangerToast("top-right","danger",t.statusText,t.status),Object(l.a)(e))}returnFalse(t="operation",e){return Object(l.a)(e)}createSolarController(t){return this.http.post(p+"create",JSON.stringify(t),u).pipe(Object(c.a)(this.extractData),Object(d.a)(this.handleError("error")))}updateSolarController(t){return this.http.post(p+"update",JSON.stringify(t),u).pipe(Object(c.a)(this.extractData),Object(d.a)(this.handleError("error")))}deleteSolarController(t){return this.http.delete(p+"delete/"+t).pipe(Object(c.a)(this.extractData),Object(d.a)(this.handleError("failed")))}getSolarControllers(){return this.http.get(p+"controllers").pipe(Object(c.a)(this.extractData),Object(d.a)(this.handleError("failed")))}getSolarData(){return this.http.get(p+"data").pipe(Object(c.a)(this.extractData),Object(d.a)(this.handleError("failed")))}dangerToast(t,e,n,s){this.toastRef=this.toastrService.show("API call error - "+s+": "+n,"Failed",{position:t,status:e,preventDuplicates:!0,duration:0}),this.toastRef&&(this.tempToast=this.toastRef),this.delay&&clearTimeout(this.delay),this.delay=setTimeout(()=>{this.clearToast(this.tempToast)},5500)}successToast(t,e,n,s){this.toastrService.show("API call error - "+s+": "+n,"Failed",{position:t,status:e,preventDuplicates:!0})}clearToast(t){t&&t.close()}}return t.\u0275fac=function(e){return new(e||t)(a["\u0275\u0275inject"](i.a),a["\u0275\u0275inject"](h.ob))},t.\u0275prov=a["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var m=n("eGx+");function f(t,e){if(1&t&&(a["\u0275\u0275elementStart"](0,"div",2),a["\u0275\u0275elementStart"](1,"nb-card"),a["\u0275\u0275elementStart"](2,"nb-card-header"),a["\u0275\u0275text"](3),a["\u0275\u0275elementEnd"](),a["\u0275\u0275elementStart"](4,"nb-card-body"),a["\u0275\u0275element"](5,"ngx-solar-doughnut",3),a["\u0275\u0275elementEnd"](),a["\u0275\u0275elementEnd"](),a["\u0275\u0275elementEnd"]()),2&t){const t=e.$implicit;a["\u0275\u0275advance"](3),a["\u0275\u0275textInterpolate1"](" ",t.name," "),a["\u0275\u0275advance"](2),a["\u0275\u0275property"]("chartValue",t.live.batt_volts)("targetVoltage",t.live.batt_target)("pieColor",t.live.color)}}let b=(()=>{class t{constructor(t){this.solar=t}ngOnInit(){this.refreshData(),this.interval=setInterval(()=>{this.refreshData()},1e4)}ngOnDestroy(){clearInterval(this.interval)}refreshData(){this.solar.getSolarData().subscribe(t=>{this.solar_datas=t})}}return t.\u0275fac=function(e){return new(e||t)(a["\u0275\u0275directiveInject"](g))},t.\u0275cmp=a["\u0275\u0275defineComponent"]({type:t,selectors:[["solar-controllers"]],decls:2,vars:1,consts:[[1,"row"],["class","col-xl-2 col-lg-3 col-md-4 col-sm-6",4,"ngFor","ngForOf"],[1,"col-xl-2","col-lg-3","col-md-4","col-sm-6"],[3,"chartValue","targetVoltage","pieColor"]],template:function(t,e){1&t&&(a["\u0275\u0275elementStart"](0,"div",0),a["\u0275\u0275template"](1,f,6,4,"div",1),a["\u0275\u0275elementEnd"]()),2&t&&(a["\u0275\u0275advance"](1),a["\u0275\u0275property"]("ngForOf",e.solar_datas))},directives:[s.l,h.n,h.p,h.m,m.a],styles:["nb-card[_ngcontent-%COMP%]{height:200px}"]}),t})();var v=n("RS3s");function C(t,e){if(1&t){const t=a["\u0275\u0275getCurrentView"]();a["\u0275\u0275elementStart"](0,"nb-card",2),a["\u0275\u0275elementStart"](1,"nb-card-header"),a["\u0275\u0275text"](2,"Warning"),a["\u0275\u0275elementEnd"](),a["\u0275\u0275elementStart"](3,"nb-card-body"),a["\u0275\u0275text"](4),a["\u0275\u0275elementEnd"](),a["\u0275\u0275elementStart"](5,"nb-card-footer"),a["\u0275\u0275elementStart"](6,"div",3),a["\u0275\u0275elementStart"](7,"button",4),a["\u0275\u0275listener"]("click",(function(){a["\u0275\u0275restoreView"](t);const n=e.dialogRef;return a["\u0275\u0275nextContext"]().onModifyConfirm(!0),n.close()})),a["\u0275\u0275text"](8,"Yes"),a["\u0275\u0275elementEnd"](),a["\u0275\u0275text"](9," \xa0\xa0 "),a["\u0275\u0275elementStart"](10,"button",4),a["\u0275\u0275listener"]("click",(function(){a["\u0275\u0275restoreView"](t);const n=e.dialogRef;return a["\u0275\u0275nextContext"]().onModifyConfirm(!1),n.close()})),a["\u0275\u0275text"](11,"No"),a["\u0275\u0275elementEnd"](),a["\u0275\u0275elementEnd"](),a["\u0275\u0275elementEnd"](),a["\u0275\u0275elementEnd"]()}if(2&t){const t=e.$implicit;a["\u0275\u0275advance"](4),a["\u0275\u0275textInterpolate"](t)}}const y=[{path:"",component:o,children:[{path:"controllers",component:b},{path:"edit",component:(()=>{class t{constructor(t,e,n){this.solar=t,this.dialogService=e,this.toastrService=n,this.submitted=!1,this.models=[{title:"Tristar-60 MPPT",value:"Tristar-60 MPPT"},{title:"Tristar MPPT 600V",value:"Tristar MPPT 600V"}],this.controllerSettings={add:{addButtonContent:'<i class="nb-plus"></i>',createButtonContent:'<i class="nb-checkmark"></i>',cancelButtonContent:'<i class="nb-close"></i>',confirmCreate:!0}},this.index=0,this.ipPattern=new RegExp("(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)"),this.whiteSpace=new RegExp("([^\\s]*)")}loadModuleTableSettings(){return{add:{addButtonContent:'<i class="nb-plus"></i>',createButtonContent:'<i class="nb-checkmark"></i>',cancelButtonContent:'<i class="nb-close"></i>',confirmCreate:!0},edit:{editButtonContent:'<i class="nb-edit"></i>',saveButtonContent:'<i class="nb-checkmark"></i>',cancelButtonContent:'<i class="nb-close"></i>',confirmSave:!0},delete:{deleteButtonContent:'<i class="nb-trash"></i>',confirmDelete:!0},columns:{name:{title:"Name",type:"string"},location:{title:"Location",type:"string"},ip:{title:"IP",type:"string"},model:{title:"Model",type:"string",editor:{type:"list",config:{list:this.models}}},uid:{title:"UID",type:"text",editable:!1,editor:{type:"list",config:{list:[{value:"",title:"(auto)"}]}}}}}}refreshData(){this.solar.getSolarControllers().subscribe(t=>{this.controllerSource=t,this.controllerSettings=this.loadModuleTableSettings()})}ngOnDestroy(){}ngOnInit(){this.refreshData()}onDialog(t,e,n){this.tableEvent=n,this.modifyType=e,this.dialogMessage="create"==e?"Are you sure you want to "+e+" "+this.tableEvent.newData.name+"?":"Are you sure you want to "+e+" "+this.tableEvent.data.name+"?",this.dialogService.open(t,{context:this.dialogMessage})}onModifyConfirm(t){var e=!1;t?"delete"==this.modifyType?this.solar.deleteSolarController(this.tableEvent.data.uid).subscribe(t=>{this.postResult=t,this.postResult.success?(this.successToast("top-right","success",this.postResult.message),this.tableEvent.confirm.resolve(),this.refreshData()):(this.dangerToast("top-right","danger",this.postResult.message),this.tableEvent.confirm.reject())}):"edit"==this.modifyType?(0==this.ipPattern.test(this.tableEvent.newData.ip)&&(this.dangerToast("top-right","danger","IP Address invalid."),e=!0),""===this.tableEvent.newData.name&&(this.dangerToast("top-right","danger","Name invalid."),e=!0),""===this.tableEvent.newData.location&&(this.dangerToast("top-right","danger","Location invalid."),e=!0),""===this.tableEvent.newData.model&&(this.dangerToast("top-right","danger","Model invalid."),e=!0),0==e&&this.solar.updateSolarController(this.tableEvent.newData).subscribe(t=>{this.postResult=t,this.postResult.success?(this.successToast("top-right","success",this.postResult.message),this.tableEvent.confirm.resolve(),this.refreshData()):(this.dangerToast("top-right","danger",this.postResult.message),this.tableEvent.confirm.reject())})):"create"==this.modifyType&&(0==this.ipPattern.test(this.tableEvent.newData.ip)&&(this.dangerToast("top-right","danger","IP Address invalid."),e=!0),""===this.tableEvent.newData.name&&(this.dangerToast("top-right","danger","Name invalid."),e=!0),""===this.tableEvent.newData.location&&(this.dangerToast("top-right","danger","Location invalid."),e=!0),""===this.tableEvent.newData.model&&(this.dangerToast("top-right","danger","Model invalid."),e=!0),0==e&&this.solar.createSolarController(this.tableEvent.newData).subscribe(t=>{this.postResult=t,this.postResult.success?(this.successToast("top-right","success",this.postResult.message),this.tableEvent.confirm.resolve(),this.refreshData()):(this.dangerToast("top-right","danger",this.postResult.message),this.tableEvent.confirm.reject())})):this.tableEvent.confirm.reject()}successToast(t,e,n){"delete"==this.modifyType?this.toastrService.show(n,"Success",{position:t,status:e}):"edit"==this.modifyType?this.toastrService.show(n,"Success",{position:t,status:e}):"create"==this.modifyType&&this.toastrService.show("Created  "+this.tableEvent.newData.name,"Success",{position:t,status:e})}dangerToast(t,e,n){this.toastrService.show(n,"Error",{position:t,status:e})}}return t.\u0275fac=function(e){return new(e||t)(a["\u0275\u0275directiveInject"](g),a["\u0275\u0275directiveInject"](h.z),a["\u0275\u0275directiveInject"](h.ob))},t.\u0275cmp=a["\u0275\u0275defineComponent"]({type:t,selectors:[["solar-edit"]],decls:3,vars:2,consts:[[3,"settings","source","deleteConfirm","editConfirm","createConfirm"],["dialog",""],["status","danger"],[1,"wrapper"],["nbButton","",3,"click"]],template:function(t,e){if(1&t){const t=a["\u0275\u0275getCurrentView"]();a["\u0275\u0275elementStart"](0,"ng2-smart-table",0),a["\u0275\u0275listener"]("deleteConfirm",(function(n){a["\u0275\u0275restoreView"](t);const s=a["\u0275\u0275reference"](2);return e.onDialog(s,"delete",n)}))("editConfirm",(function(n){a["\u0275\u0275restoreView"](t);const s=a["\u0275\u0275reference"](2);return e.onDialog(s,"edit",n)}))("createConfirm",(function(n){a["\u0275\u0275restoreView"](t);const s=a["\u0275\u0275reference"](2);return e.onDialog(s,"create",n)})),a["\u0275\u0275elementEnd"](),a["\u0275\u0275template"](1,C,12,1,"ng-template",null,1,a["\u0275\u0275templateRefExtractor"])}2&t&&a["\u0275\u0275property"]("settings",e.controllerSettings)("source",e.controllerSource)},directives:[v.a,h.n,h.p,h.m,h.o,h.k],styles:[".nb-theme-corporate   [_nghost-%COMP%]   nb-card[_ngcontent-%COMP%], .nb-theme-cosmic   [_nghost-%COMP%]   nb-card[_ngcontent-%COMP%], .nb-theme-dark   [_nghost-%COMP%]   nb-card[_ngcontent-%COMP%], .nb-theme-default   [_nghost-%COMP%]   nb-card[_ngcontent-%COMP%]{transform:translateZ(0)}.wrapper[_ngcontent-%COMP%]{text-align:center}[_nghost-%COMP%]     .ng-valid{color:#000}"]}),t})()}]}];let S=(()=>{class t{}return t.\u0275mod=a["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=a["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},imports:[[r.g.forChild(y)],r.g]}),t})();var w=n("h+2I");n.d(e,"SolarModule",(function(){return E}));let E=(()=>{class t{}return t.\u0275mod=a["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=a["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},imports:[[s.c,S,w.a,h.q,h.l,h.C,v.b]]}),t})()}}]);