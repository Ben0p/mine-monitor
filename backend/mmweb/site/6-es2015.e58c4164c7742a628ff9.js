(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"1CWa":function(t,e,i){"use strict";if(t.exports)var r=i("wiYu");function n(t,e){if(!(this instanceof n))return new n(t,e);this.lat=Number(t),this.lon=Number(e)}n.prototype.distanceTo=function(t,e){if(!(t instanceof n))throw new TypeError("point is not LatLon object");var i=e=void 0===e?6371e3:Number(e),r=this.lat.toRadians(),s=this.lon.toRadians(),o=t.lat.toRadians(),a=o-r,c=t.lon.toRadians()-s,h=Math.sin(a/2)*Math.sin(a/2)+Math.cos(r)*Math.cos(o)*Math.sin(c/2)*Math.sin(c/2);return i*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))},n.prototype.bearingTo=function(t){if(!(t instanceof n))throw new TypeError("point is not LatLon object");var e=this.lat.toRadians(),i=t.lat.toRadians(),r=(t.lon-this.lon).toRadians(),s=Math.sin(r)*Math.cos(i),o=Math.cos(e)*Math.sin(i)-Math.sin(e)*Math.cos(i)*Math.cos(r);return(Math.atan2(s,o).toDegrees()+360)%360},n.prototype.finalBearingTo=function(t){if(!(t instanceof n))throw new TypeError("point is not LatLon object");return(t.bearingTo(this)+180)%360},n.prototype.midpointTo=function(t){if(!(t instanceof n))throw new TypeError("point is not LatLon object");var e=this.lat.toRadians(),i=this.lon.toRadians(),r=t.lat.toRadians(),s=(t.lon-this.lon).toRadians(),o=Math.cos(r)*Math.cos(s),a=Math.cos(r)*Math.sin(s),c=Math.sqrt((Math.cos(e)+o)*(Math.cos(e)+o)+a*a),h=Math.sin(e)+Math.sin(r),l=Math.atan2(h,c),u=i+Math.atan2(a,Math.cos(e)+o);return new n(l.toDegrees(),(u.toDegrees()+540)%360-180)},n.prototype.intermediatePointTo=function(t,e){if(!(t instanceof n))throw new TypeError("point is not LatLon object");var i=this.lat.toRadians(),r=this.lon.toRadians(),s=t.lat.toRadians(),o=t.lon.toRadians(),a=Math.sin(i),c=Math.cos(i),h=Math.sin(r),l=Math.cos(r),u=Math.sin(s),p=Math.cos(s),d=Math.sin(o),f=Math.cos(o),v=s-i,m=o-r,y=Math.sin(v/2)*Math.sin(v/2)+Math.cos(i)*Math.cos(s)*Math.sin(m/2)*Math.sin(m/2),g=2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y)),C=Math.sin((1-e)*g)/Math.sin(g),w=Math.sin(e*g)/Math.sin(g),b=C*c*l+w*p*f,M=C*c*h+w*p*d,x=Math.atan2(C*a+w*u,Math.sqrt(b*b+M*M)),_=Math.atan2(M,b);return new n(x.toDegrees(),(_.toDegrees()+540)%360-180)},n.prototype.destinationPoint=function(t,e,i){i=void 0===i?6371e3:i;var r=Number(t)/Number(i),s=Number(e).toRadians(),o=this.lat.toRadians(),a=this.lon.toRadians(),c=Math.sin(o),h=Math.cos(o),l=Math.sin(r),u=Math.cos(r),p=Math.sin(s),d=c*u+h*l*Math.cos(s),f=Math.asin(d),v=a+Math.atan2(p*l*h,u-c*d);return new n(f.toDegrees(),(v.toDegrees()+540)%360-180)},n.intersection=function(t,e,i,r){if(!(t instanceof n))throw new TypeError("p1 is not LatLon object");if(!(i instanceof n))throw new TypeError("p2 is not LatLon object");var s=t.lat.toRadians(),o=t.lon.toRadians(),a=i.lat.toRadians(),c=i.lon.toRadians(),h=Number(e).toRadians(),l=Number(r).toRadians(),u=a-s,p=c-o,d=2*Math.asin(Math.sqrt(Math.sin(u/2)*Math.sin(u/2)+Math.cos(s)*Math.cos(a)*Math.sin(p/2)*Math.sin(p/2)));if(0==d)return null;var f=Math.acos((Math.sin(a)-Math.sin(s)*Math.cos(d))/(Math.sin(d)*Math.cos(s)));isNaN(f)&&(f=0);var v=Math.acos((Math.sin(s)-Math.sin(a)*Math.cos(d))/(Math.sin(d)*Math.cos(a))),m=h-(Math.sin(c-o)>0?f:2*Math.PI-f),y=(Math.sin(c-o)>0?2*Math.PI-v:v)-l;if(0==Math.sin(m)&&0==Math.sin(y))return null;if(Math.sin(m)*Math.sin(y)<0)return null;var g=-Math.cos(m)*Math.cos(y)+Math.sin(m)*Math.sin(y)*Math.cos(d),C=Math.atan2(Math.sin(d)*Math.sin(m)*Math.sin(y),Math.cos(y)+Math.cos(m)*g),w=Math.asin(Math.sin(s)*Math.cos(C)+Math.cos(s)*Math.sin(C)*Math.cos(h)),b=o+Math.atan2(Math.sin(h)*Math.sin(C)*Math.cos(s),Math.cos(C)-Math.sin(s)*Math.sin(w));return new n(w.toDegrees(),(b.toDegrees()+540)%360-180)},n.prototype.crossTrackDistanceTo=function(t,e,i){if(!(t instanceof n))throw new TypeError("\u2018pathStart\u2019 is not LatLon object");if(!(e instanceof n))throw new TypeError("\u2018pathEnd\u2019 is not LatLon object");var r=void 0===i?6371e3:Number(i),s=t.distanceTo(this,r)/r,o=t.bearingTo(this).toRadians(),a=t.bearingTo(e).toRadians();return Math.asin(Math.sin(s)*Math.sin(o-a))*r},n.prototype.alongTrackDistanceTo=function(t,e,i){if(!(t instanceof n))throw new TypeError("\u2018pathStart\u2019 is not LatLon object");if(!(e instanceof n))throw new TypeError("\u2018pathEnd\u2019 is not LatLon object");var r=void 0===i?6371e3:i,s=t.distanceTo(this,r)/r,o=t.bearingTo(this).toRadians(),a=t.bearingTo(e).toRadians(),c=Math.asin(Math.sin(s)*Math.sin(o-a));return Math.acos(Math.cos(s)/Math.abs(Math.cos(c)))*Math.sign(Math.cos(a-o))*r},n.prototype.maxLatitude=function(t){var e=Number(t).toRadians(),i=this.lat.toRadians();return Math.acos(Math.abs(Math.sin(e)*Math.cos(i))).toDegrees()},n.crossingParallels=function(t,e,i){var r=Number(i).toRadians(),n=t.lat.toRadians(),s=t.lon.toRadians(),o=e.lat.toRadians(),a=e.lon.toRadians()-s,c=Math.sin(n)*Math.cos(o)*Math.cos(r)*Math.sin(a),h=Math.sin(n)*Math.cos(o)*Math.cos(r)*Math.cos(a)-Math.cos(n)*Math.sin(o)*Math.cos(r),l=Math.cos(n)*Math.cos(o)*Math.sin(r)*Math.sin(a);if(l*l>c*c+h*h)return null;var u=Math.atan2(-h,c),p=Math.acos(l/Math.sqrt(c*c+h*h)),d=s+u+p;return{lon1:((s+u-p).toDegrees()+540)%360-180,lon2:(d.toDegrees()+540)%360-180}},n.prototype.rhumbDistanceTo=function(t,e){if(!(t instanceof n))throw new TypeError("point is not LatLon object");var i=e=void 0===e?6371e3:Number(e),r=this.lat.toRadians(),s=t.lat.toRadians(),o=s-r,a=Math.abs(t.lon-this.lon).toRadians();a>Math.PI&&(a-=2*Math.PI);var c=Math.log(Math.tan(s/2+Math.PI/4)/Math.tan(r/2+Math.PI/4)),h=Math.abs(c)>1e-11?o/c:Math.cos(r);return Math.sqrt(o*o+h*h*a*a)*i},n.prototype.rhumbBearingTo=function(t){if(!(t instanceof n))throw new TypeError("point is not LatLon object");var e=this.lat.toRadians(),i=t.lat.toRadians(),r=(t.lon-this.lon).toRadians();r>Math.PI&&(r-=2*Math.PI),r<-Math.PI&&(r+=2*Math.PI);var s=Math.log(Math.tan(i/2+Math.PI/4)/Math.tan(e/2+Math.PI/4));return(Math.atan2(r,s).toDegrees()+360)%360},n.prototype.rhumbDestinationPoint=function(t,e,i){i=void 0===i?6371e3:i;var r=this.lat.toRadians(),s=this.lon.toRadians(),o=Number(e).toRadians(),a=t/i,c=a*Math.cos(o),h=r+c;Math.abs(h)>Math.PI/2&&(h=h>0?Math.PI-h:-Math.PI-h);var l=Math.log(Math.tan(h/2+Math.PI/4)/Math.tan(r/2+Math.PI/4)),u=Math.abs(l)>1e-11?c/l:Math.cos(r),p=s+a*Math.sin(o)/u;return new n(h.toDegrees(),(p.toDegrees()+540)%360-180)},n.prototype.rhumbMidpointTo=function(t){if(!(t instanceof n))throw new TypeError("point is not LatLon object");var e=this.lat.toRadians(),i=this.lon.toRadians(),r=t.lat.toRadians(),s=t.lon.toRadians();Math.abs(s-i)>Math.PI&&(i+=2*Math.PI);var o=(e+r)/2,a=Math.tan(Math.PI/4+e/2),c=Math.tan(Math.PI/4+r/2),h=Math.tan(Math.PI/4+o/2),l=((s-i)*Math.log(h)+i*Math.log(c)-s*Math.log(a))/Math.log(c/a);return isFinite(l)||(l=(i+s)/2),n(o.toDegrees(),(l.toDegrees()+540)%360-180)},n.areaOf=function(t,e){var i=void 0===e?6371e3:Number(e),r=t[0].equals(t[t.length-1]);r||t.push(t[0]);for(var n=t.length-1,s=0,o=0;o<n;o++){var a=t[o].lat.toRadians(),c=t[o+1].lat.toRadians(),h=(t[o+1].lon-t[o].lon).toRadians();s+=2*Math.atan2(Math.tan(h/2)*(Math.tan(a/2)+Math.tan(c/2)),1+Math.tan(a/2)*Math.tan(c/2))}(function(t){for(var e=0,i=t[0].bearingTo(t[1]),r=0;r<t.length-1;r++){var n=t[r].bearingTo(t[r+1]),s=t[r].finalBearingTo(t[r+1]);e+=(n-i+540)%360-180,e+=(s-n+540)%360-180,i=s}return e+=((n=t[0].bearingTo(t[1]))-i+540)%360-180,Math.abs(e)<90})(t)&&(s=Math.abs(s)-2*Math.PI);var l=Math.abs(s*i*i);return r||t.pop(),l},n.prototype.equals=function(t){if(!(t instanceof n))throw new TypeError("point is not LatLon object");return this.lat==t.lat&&this.lon==t.lon},n.prototype.toString=function(t,e){return r.toLat(this.lat,t,e)+", "+r.toLon(this.lon,t,e)},void 0===Number.prototype.toRadians&&(Number.prototype.toRadians=function(){return this*Math.PI/180}),void 0===Number.prototype.toDegrees&&(Number.prototype.toDegrees=function(){return 180*this/Math.PI}),t.exports&&(t.exports=n)},"1gqn":function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},"862v":function(t,e,i){"use strict";i.r(e);var r=i("ofXK"),n=i("tyNb"),s=i("fXoL"),o=i("Vws6"),a=i("MCLT"),c=i("XNiG"),h=i("oB13");function l(t){return t?Object(h.a)(()=>new c.a,t):Object(h.a)(new c.a)}var u=i("5+tZ"),p=i("3E0/"),d=i("1G5W"),f=i("pLZG"),v=i("lJxs"),m=i("eIep"),y=i("vkgz"),g=i("VRyK"),C=i("HDdC"),w=i("LRne"),b=i("Cfvw"),M=(i("2Vo4"),i("xgIS")),x=i("mVnp"),_=i("8USJ");function E(t){return null!=t}function S(t){return null==t}function I(t){return t.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}class O{constructor(t,e,i,r){this.input=e,this.errLocation=i,this.ctxLocation=r,this.message=`Parser Error: ${t} ${i} [${e}] in ${r}`}}class P{constructor(t,e){this.start=t,this.end=e}}class T{constructor(t){this.span=t}visit(t,e=null){return null}toString(){return"AST"}}class R extends T{constructor(t,e,i,r){super(t),this.prefix=e,this.uninterpretedExpression=i,this.location=r}visit(t,e=null){return t.visitQuote(this,e)}toString(){return"Quote"}}class A extends T{visit(t,e=null){}}class k extends T{visit(t,e=null){return t.visitImplicitReceiver(this,e)}}class L extends T{constructor(t,e){super(t),this.expressions=e}visit(t,e=null){return t.visitChain(this,e)}}class D extends T{constructor(t,e,i,r){super(t),this.condition=e,this.trueExp=i,this.falseExp=r}visit(t,e=null){return t.visitConditional(this,e)}}class j extends T{constructor(t,e,i){super(t),this.receiver=e,this.name=i}visit(t,e=null){return t.visitPropertyRead(this,e)}}class N extends T{constructor(t,e,i,r){super(t),this.receiver=e,this.name=i,this.value=r}visit(t,e=null){return t.visitPropertyWrite(this,e)}}class F extends T{constructor(t,e,i){super(t),this.receiver=e,this.name=i}visit(t,e=null){return t.visitSafePropertyRead(this,e)}}class V extends T{constructor(t,e,i){super(t),this.obj=e,this.key=i}visit(t,e=null){return t.visitKeyedRead(this,e)}}class B extends T{constructor(t,e,i,r){super(t),this.obj=e,this.key=i,this.value=r}visit(t,e=null){return t.visitKeyedWrite(this,e)}}class K extends T{constructor(t,e,i,r){super(t),this.exp=e,this.name=i,this.args=r}visit(t,e=null){return t.visitPipe(this,e)}}class z extends T{constructor(t,e){super(t),this.value=e}visit(t,e=null){return t.visitLiteralPrimitive(this,e)}}class G extends T{constructor(t,e){super(t),this.expressions=e}visit(t,e=null){return t.visitLiteralArray(this,e)}}class U extends T{constructor(t,e,i){super(t),this.keys=e,this.values=i}visit(t,e=null){return t.visitLiteralMap(this,e)}}class W extends T{constructor(t,e,i){super(t),this.strings=e,this.expressions=i}visit(t,e=null){return t.visitInterpolation(this,e)}}class $ extends T{constructor(t,e,i,r){super(t),this.operation=e,this.left=i,this.right=r}visit(t,e=null){return t.visitBinary(this,e)}}class H extends T{constructor(t,e){super(t),this.expression=e}visit(t,e=null){return t.visitPrefixNot(this,e)}}class q extends T{constructor(t,e,i,r){super(t),this.receiver=e,this.name=i,this.args=r}visit(t,e=null){return t.visitMethodCall(this,e)}}class X extends T{constructor(t,e,i,r){super(t),this.receiver=e,this.name=i,this.args=r}visit(t,e=null){return t.visitSafeMethodCall(this,e)}}class Z extends T{constructor(t,e,i){super(t),this.target=e,this.args=i}visit(t,e=null){return t.visitFunctionCall(this,e)}}class Y extends T{constructor(t,e,i,r){super(new P(0,S(e)?0:e.length)),this.ast=t,this.source=e,this.location=i,this.errors=r}visit(t,e=null){return this.ast.visit(t,e)}toString(){return`${this.source} in ${this.location}`}}class J{constructor(t,e,i,r,n){this.span=t,this.key=e,this.keyIsVar=i,this.name=r,this.expression=n}}class Q{visitBinary(t,e){return t.left.visit(this),t.right.visit(this),null}visitChain(t,e){return this.visitAll(t.expressions,e)}visitConditional(t,e){return t.condition.visit(this),t.trueExp.visit(this),t.falseExp.visit(this),null}visitPipe(t,e){return t.exp.visit(this),this.visitAll(t.args,e),null}visitFunctionCall(t,e){return t.target.visit(this),this.visitAll(t.args,e),null}visitImplicitReceiver(t,e){return null}visitInterpolation(t,e){return this.visitAll(t.expressions,e)}visitKeyedRead(t,e){return t.obj.visit(this),t.key.visit(this),null}visitKeyedWrite(t,e){return t.obj.visit(this),t.key.visit(this),t.value.visit(this),null}visitLiteralArray(t,e){return this.visitAll(t.expressions,e)}visitLiteralMap(t,e){return this.visitAll(t.values,e)}visitLiteralPrimitive(t,e){return null}visitMethodCall(t,e){return t.receiver.visit(this),this.visitAll(t.args,e)}visitPrefixNot(t,e){return t.expression.visit(this),null}visitPropertyRead(t,e){return t.receiver.visit(this),null}visitPropertyWrite(t,e){return t.receiver.visit(this),t.value.visit(this),null}visitSafePropertyRead(t,e){return t.receiver.visit(this),null}visitSafeMethodCall(t,e){return t.receiver.visit(this),this.visitAll(t.args,e)}visitAll(t,e){return t.forEach(t=>t.visit(this,e)),null}visitQuote(t,e){return null}}function tt(t){return 48<=t&&t<=57}class et{constructor(t,e){this.start=t,this.end=e}static fromArray(t){return t?(function(t,e){if(E(e)&&(!Array.isArray(e)||2!=e.length))throw new Error("Expected 'interpolation' to be an array, [start, end].")}(0,t),new et(t[0],t[1])):it}}const it=new et("{{","}}");var rt=function(t){return t[t.Character=0]="Character",t[t.Identifier=1]="Identifier",t[t.Keyword=2]="Keyword",t[t.String=3]="String",t[t.Operator=4]="Operator",t[t.Number=5]="Number",t[t.Error=6]="Error",t}({});const nt=["var","let","null","undefined","true","false","if","else","this"];class st{tokenize(t){const e=new lt(t),i=[];let r=e.scanToken();for(;null!=r;)i.push(r),r=e.scanToken();return i}}class ot{constructor(t,e,i,r){this.index=t,this.type=e,this.numValue=i,this.strValue=r}isCharacter(t){return this.type==rt.Character&&this.numValue==t}isNumber(){return this.type==rt.Number}isString(){return this.type==rt.String}isOperator(t){return this.type==rt.Operator&&this.strValue==t}isIdentifier(){return this.type==rt.Identifier}isKeyword(){return this.type==rt.Keyword}isKeywordLet(){return this.type==rt.Keyword&&"let"==this.strValue}isKeywordNull(){return this.type==rt.Keyword&&"null"==this.strValue}isKeywordUndefined(){return this.type==rt.Keyword&&"undefined"==this.strValue}isKeywordTrue(){return this.type==rt.Keyword&&"true"==this.strValue}isKeywordFalse(){return this.type==rt.Keyword&&"false"==this.strValue}isKeywordThis(){return this.type==rt.Keyword&&"this"==this.strValue}isError(){return this.type==rt.Error}toNumber(){return this.type==rt.Number?this.numValue:-1}toString(){switch(this.type){case rt.Character:case rt.Identifier:case rt.Keyword:case rt.Operator:case rt.String:case rt.Error:return this.strValue;case rt.Number:return this.numValue.toString();default:return null}}}function at(t,e){return new ot(t,rt.Character,e,String.fromCharCode(e))}function ct(t,e){return new ot(t,rt.Operator,0,e)}const ht=new ot(-1,rt.Character,0,"");class lt{constructor(t){this.input=t,this.peek=0,this.index=-1,this.length=t.length,this.advance()}advance(){this.peek=++this.index>=this.length?0:this.input.charCodeAt(this.index)}scanToken(){const t=this.input,e=this.length;let i=this.peek,r=this.index;for(;i<=32;){if(++r>=e){i=0;break}i=t.charCodeAt(r)}if(this.peek=i,this.index=r,r>=e)return null;if(ut(i))return this.scanIdentifier();if(tt(i))return this.scanNumber(r);const n=r;switch(i){case 46:return this.advance(),tt(this.peek)?this.scanNumber(n):at(n,46);case 40:case 41:case 123:case 125:case 91:case 93:case 44:case 58:case 59:return this.scanCharacter(n,i);case 39:case 34:return this.scanString();case 35:case 43:case 45:case 42:case 47:case 37:case 94:return this.scanOperator(n,String.fromCharCode(i));case 63:return this.scanComplexOperator(n,"?",46,".");case 60:case 62:return this.scanComplexOperator(n,String.fromCharCode(i),61,"=");case 33:case 61:return this.scanComplexOperator(n,String.fromCharCode(i),61,"=",61,"=");case 38:return this.scanComplexOperator(n,"&",38,"&");case 124:return this.scanComplexOperator(n,"|",124,"|");case 160:for(;(s=this.peek)>=9&&s<=32||160==s;)this.advance();return this.scanToken()}var s;return this.advance(),this.error(`Unexpected character [${String.fromCharCode(i)}]`,0)}scanCharacter(t,e){return this.advance(),at(t,e)}scanOperator(t,e){return this.advance(),ct(t,e)}scanComplexOperator(t,e,i,r,n,s){this.advance();let o=e;return this.peek==i&&(this.advance(),o+=r),null!=n&&this.peek==n&&(this.advance(),o+=s),ct(t,o)}scanIdentifier(){const t=this.index;for(this.advance();pt(this.peek);)this.advance();const e=this.input.substring(t,this.index);return nt.indexOf(e)>-1?new ot(t,rt.Keyword,0,e):function(t,e){return new ot(t,rt.Identifier,0,e)}(t,e)}scanNumber(t){let e=this.index===t;for(this.advance();;){if(tt(this.peek));else if(46==this.peek)e=!1;else{if(101!=(i=this.peek)&&69!=i)break;if(this.advance(),dt(this.peek)&&this.advance(),!tt(this.peek))return this.error("Invalid exponent",-1);e=!1}this.advance()}var i;const r=this.input.substring(t,this.index),n=e?class{static parseIntAutoRadix(t){const e=parseInt(t);if(isNaN(e))throw new Error("Invalid integer literal when parsing "+t);return e}static isNumeric(t){return!isNaN(t-parseFloat(t))}}.parseIntAutoRadix(r):parseFloat(r);return new ot(t,rt.Number,n,"")}scanString(){const t=this.index,e=this.peek;this.advance();let i="",r=this.index;const n=this.input;for(;this.peek!=e;)if(92==this.peek){let t;if(i+=n.substring(r,this.index),this.advance(),this.peek=this.peek,117==this.peek){const e=n.substring(this.index+1,this.index+5);if(!/^[0-9a-f]+$/i.test(e))return this.error(`Invalid unicode escape [\\u${e}]`,0);t=parseInt(e,16);for(let t=0;t<5;t++)this.advance()}else t=ft(this.peek),this.advance();i+=String.fromCharCode(t),r=this.index}else{if(0==this.peek)return this.error("Unterminated quote",0);this.advance()}const s=n.substring(r,this.index);return this.advance(),new ot(t,rt.String,0,i+s)}error(t,e){const i=this.index+e;return function(t,e){return new ot(t,rt.Error,0,e)}(i,`Lexer Error: ${t} at column ${i} in expression [${this.input}]`)}}function ut(t){return 97<=t&&t<=122||65<=t&&t<=90||95==t||36==t}function pt(t){return function(t){return t>=97&&t<=122||t>=65&&t<=90}(t)||tt(t)||95==t||36==t}function dt(t){return 45==t||43==t}function ft(t){switch(t){case 110:return 10;case 102:return 12;case 114:return 13;case 116:return 9;case 118:return 11;default:return t}}class vt{constructor(t,e,i){this.strings=t,this.expressions=e,this.offsets=i}}class mt{constructor(t,e,i){this.templateBindings=t,this.warnings=e,this.errors=i}}function yt(t){const e=I(t.start)+"([\\s\\S]*?)"+I(t.end);return new RegExp(e,"g")}class gt{constructor(t){this._lexer=t,this.errors=[]}parseAction(t,e,i=it){this._checkNoInterpolation(t,e,i);const r=this._stripComments(t),n=this._lexer.tokenize(this._stripComments(t)),s=new Ct(t,e,n,r.length,!0,this.errors,t.length-r.length).parseChain();return new Y(s,t,e,this.errors)}parseBinding(t,e,i=it){const r=this._parseBindingAst(t,e,i);return new Y(r,t,e,this.errors)}parseSimpleBinding(t,e,i=it){const r=this._parseBindingAst(t,e,i),n=wt.check(r);return n.length>0&&this._reportError(`Host binding expression cannot contain ${n.join(" ")}`,t,e),new Y(r,t,e,this.errors)}_reportError(t,e,i,r){this.errors.push(new O(t,e,i,r))}_parseBindingAst(t,e,i){const r=this._parseQuote(t,e);if(E(r))return r;this._checkNoInterpolation(t,e,i);const n=this._stripComments(t),s=this._lexer.tokenize(n);return new Ct(t,e,s,n.length,!1,this.errors,t.length-n.length).parseChain()}_parseQuote(t,e){if(S(t))return null;const i=t.indexOf(":");if(-1==i)return null;const r=t.substring(0,i).trim();if(!function(t){if(0==t.length)return!1;const e=new lt(t);if(!ut(e.peek))return!1;for(e.advance();0!==e.peek;){if(!pt(e.peek))return!1;e.advance()}return!0}(r))return null;const n=t.substring(i+1);return new R(new P(0,t.length),r,n,e)}parseTemplateBindings(t,e,i){const r=this._lexer.tokenize(e);if(t){const e=this._lexer.tokenize(t).map(t=>(t.index=0,t));r.unshift(...e)}return new Ct(e,i,r,e.length,!1,this.errors,0).parseTemplateBindings()}parseInterpolation(t,e,i=it){const r=this.splitInterpolation(t,e,i);if(null==r)return null;const n=[];for(let s=0;s<r.expressions.length;++s){const i=r.expressions[s],o=this._stripComments(i),a=this._lexer.tokenize(this._stripComments(r.expressions[s])),c=new Ct(t,e,a,o.length,!1,this.errors,r.offsets[s]+(i.length-o.length)).parseChain();n.push(c)}return new Y(new W(new P(0,S(t)?0:t.length),r.strings,n),t,e,this.errors)}splitInterpolation(t,e,i=it){const r=yt(i),n=t.split(r);if(n.length<=1)return null;const s=[],o=[],a=[];let c=0;for(let h=0;h<n.length;h++){const r=n[h];h%2==0?(s.push(r),c+=r.length):r.trim().length>0?(c+=i.start.length,o.push(r),a.push(c),c+=r.length+i.end.length):(this._reportError("Blank expressions are not allowed in interpolated strings",t,`at column ${this._findInterpolationErrorColumn(n,h,i)} in`,e),o.push("$implict"),a.push(c))}return new vt(s,o,a)}wrapLiteralPrimitive(t,e){return new Y(new z(new P(0,S(t)?0:t.length),t),t,e,this.errors)}_stripComments(t){const e=this._commentStart(t);return E(e)?t.substring(0,e).trim():t}_commentStart(t){let e=null;for(let r=0;r<t.length-1;r++){const n=t.charCodeAt(r),s=t.charCodeAt(r+1);if(47===n&&47==s&&S(e))return r;e===n?e=null:S(e)&&(39===(i=n)||34===i||96===i)&&(e=n)}var i;return null}_checkNoInterpolation(t,e,i){const r=yt(i),n=t.split(r);n.length>1&&this._reportError(`Got interpolation (${i.start}${i.end}) where expression was expected`,t,`at column ${this._findInterpolationErrorColumn(n,1,i)} in`,e)}_findInterpolationErrorColumn(t,e,i){let r="";for(let n=0;n<e;n++)r+=n%2==0?t[n]:`${i.start}${t[n]}${i.end}`;return r.length}}class Ct{constructor(t,e,i,r,n,s,o){this.input=t,this.location=e,this.tokens=i,this.inputLength=r,this.parseAction=n,this.errors=s,this.offset=o,this.rparensExpected=0,this.rbracketsExpected=0,this.rbracesExpected=0,this.index=0}peek(t){const e=this.index+t;return e<this.tokens.length?this.tokens[e]:ht}get next(){return this.peek(0)}get inputIndex(){return this.index<this.tokens.length?this.next.index+this.offset:this.inputLength+this.offset}span(t){return new P(t,this.inputIndex)}advance(){this.index++}optionalCharacter(t){return!!this.next.isCharacter(t)&&(this.advance(),!0)}peekKeywordLet(){return this.next.isKeywordLet()}expectCharacter(t){this.optionalCharacter(t)||this.error(`Missing expected ${String.fromCharCode(t)}`)}optionalOperator(t){return!!this.next.isOperator(t)&&(this.advance(),!0)}expectOperator(t){this.optionalOperator(t)||this.error(`Missing expected operator ${t}`)}expectIdentifierOrKeyword(){const t=this.next;return t.isIdentifier()||t.isKeyword()?(this.advance(),t.toString()):(this.error(`Unexpected token ${t}, expected identifier or keyword`),"")}expectIdentifierOrKeywordOrString(){const t=this.next;return t.isIdentifier()||t.isKeyword()||t.isString()?(this.advance(),t.toString()):(this.error(`Unexpected token ${t}, expected identifier, keyword, or string`),"")}parseChain(){const t=[],e=this.inputIndex;for(;this.index<this.tokens.length;){const e=this.parsePipe();if(t.push(e),this.optionalCharacter(59))for(this.parseAction||this.error("Binding expression cannot contain chained expression");this.optionalCharacter(59););else this.index<this.tokens.length&&this.error(`Unexpected token '${this.next}'`)}return 0==t.length?new A(this.span(e)):1==t.length?t[0]:new L(this.span(e),t)}parsePipe(){let t=this.parseExpression();if(this.optionalOperator("|")){this.parseAction&&this.error("Cannot have a pipe in an action expression");do{const e=this.expectIdentifierOrKeyword(),i=[];for(;this.optionalCharacter(58);)i.push(this.parseExpression());t=new K(this.span(t.span.start),t,e,i)}while(this.optionalOperator("|"))}return t}parseExpression(){return this.parseConditional()}parseConditional(){const t=this.inputIndex,e=this.parseLogicalOr();if(this.optionalOperator("?")){const i=this.parsePipe();let r;if(this.optionalCharacter(58))r=this.parsePipe();else{const e=this.input.substring(t,this.inputIndex);this.error(`Conditional expression ${e} requires all 3 expressions`),r=new A(this.span(t))}return new D(this.span(t),e,i,r)}return e}parseLogicalOr(){let t=this.parseLogicalAnd();for(;this.optionalOperator("||");){const e=this.parseLogicalAnd();t=new $(this.span(t.span.start),"||",t,e)}return t}parseLogicalAnd(){let t=this.parseEquality();for(;this.optionalOperator("&&");){const e=this.parseEquality();t=new $(this.span(t.span.start),"&&",t,e)}return t}parseEquality(){let t=this.parseRelational();for(;this.next.type==rt.Operator;){const e=this.next.strValue;switch(e){case"==":case"===":case"!=":case"!==":this.advance();const i=this.parseRelational();t=new $(this.span(t.span.start),e,t,i);continue}break}return t}parseRelational(){let t=this.parseAdditive();for(;this.next.type==rt.Operator;){const e=this.next.strValue;switch(e){case"<":case">":case"<=":case">=":this.advance();const i=this.parseAdditive();t=new $(this.span(t.span.start),e,t,i);continue}break}return t}parseAdditive(){let t=this.parseMultiplicative();for(;this.next.type==rt.Operator;){const e=this.next.strValue;switch(e){case"+":case"-":this.advance();let i=this.parseMultiplicative();t=new $(this.span(t.span.start),e,t,i);continue}break}return t}parseMultiplicative(){let t=this.parsePrefix();for(;this.next.type==rt.Operator;){const e=this.next.strValue;switch(e){case"*":case"%":case"/":this.advance();let i=this.parsePrefix();t=new $(this.span(t.span.start),e,t,i);continue}break}return t}parsePrefix(){if(this.next.type==rt.Operator){const t=this.inputIndex,e=this.next.strValue;let i;switch(e){case"+":return this.advance(),this.parsePrefix();case"-":return this.advance(),i=this.parsePrefix(),new $(this.span(t),e,new z(new P(t,t),0),i);case"!":return this.advance(),i=this.parsePrefix(),new H(this.span(t),i)}}return this.parseCallChain()}parseCallChain(){let t=this.parsePrimary();for(;;)if(this.optionalCharacter(46))t=this.parseAccessMemberOrMethodCall(t,!1);else if(this.optionalOperator("?."))t=this.parseAccessMemberOrMethodCall(t,!0);else if(this.optionalCharacter(91)){this.rbracketsExpected++;const e=this.parsePipe();if(this.rbracketsExpected--,this.expectCharacter(93),this.optionalOperator("=")){const i=this.parseConditional();t=new B(this.span(t.span.start),t,e,i)}else t=new V(this.span(t.span.start),t,e)}else{if(!this.optionalCharacter(40))return t;{this.rparensExpected++;const e=this.parseCallArguments();this.rparensExpected--,this.expectCharacter(41),t=new Z(this.span(t.span.start),t,e)}}}parsePrimary(){const t=this.inputIndex;if(this.optionalCharacter(40)){this.rparensExpected++;const t=this.parsePipe();return this.rparensExpected--,this.expectCharacter(41),t}if(this.next.isKeywordNull())return this.advance(),new z(this.span(t),null);if(this.next.isKeywordUndefined())return this.advance(),new z(this.span(t),void 0);if(this.next.isKeywordTrue())return this.advance(),new z(this.span(t),!0);if(this.next.isKeywordFalse())return this.advance(),new z(this.span(t),!1);if(this.next.isKeywordThis())return this.advance(),new k(this.span(t));if(this.optionalCharacter(91)){this.rbracketsExpected++;const e=this.parseExpressionList(93);return this.rbracketsExpected--,this.expectCharacter(93),new G(this.span(t),e)}if(this.next.isCharacter(123))return this.parseLiteralMap();if(this.next.isIdentifier())return this.parseAccessMemberOrMethodCall(new k(this.span(t)),!1);if(this.next.isNumber()){const e=this.next.toNumber();return this.advance(),new z(this.span(t),e)}if(this.next.isString()){const e=this.next.toString();return this.advance(),new z(this.span(t),e)}return this.index>=this.tokens.length?(this.error(`Unexpected end of expression: ${this.input}`),new A(this.span(t))):(this.error(`Unexpected token ${this.next}`),new A(this.span(t)))}parseExpressionList(t){const e=[];if(!this.next.isCharacter(t))do{e.push(this.parsePipe())}while(this.optionalCharacter(44));return e}parseLiteralMap(){const t=[],e=[],i=this.inputIndex;if(this.expectCharacter(123),!this.optionalCharacter(125)){this.rbracesExpected++;do{const i=this.expectIdentifierOrKeywordOrString();t.push(i),this.expectCharacter(58),e.push(this.parsePipe())}while(this.optionalCharacter(44));this.rbracesExpected--,this.expectCharacter(125)}return new U(this.span(i),t,e)}parseAccessMemberOrMethodCall(t,e=!1){const i=t.span.start,r=this.expectIdentifierOrKeyword();if(this.optionalCharacter(40)){this.rparensExpected++;const n=this.parseCallArguments();this.expectCharacter(41),this.rparensExpected--;const s=this.span(i);return e?new X(s,t,r,n):new q(s,t,r,n)}if(e)return this.optionalOperator("=")?(this.error("The '?.' operator cannot be used in the assignment"),new A(this.span(i))):new F(this.span(i),t,r);if(this.optionalOperator("=")){if(!this.parseAction)return this.error("Bindings cannot contain assignments"),new A(this.span(i));const e=this.parseConditional();return new N(this.span(i),t,r,e)}return new j(this.span(i),t,r)}parseCallArguments(){if(this.next.isCharacter(41))return[];const t=[];do{t.push(this.parsePipe())}while(this.optionalCharacter(44));return t}expectTemplateBindingKey(){let t="",e=!1;do{t+=this.expectIdentifierOrKeywordOrString(),e=this.optionalOperator("-"),e&&(t+="-")}while(e);return t.toString()}parseTemplateBindings(){const t=[];let e=null;for(;this.index<this.tokens.length;){const i=this.inputIndex,r=this.peekKeywordLet();r&&this.advance();let n=this.expectTemplateBindingKey();r||(null==e?e=n:n=e+n[0].toUpperCase()+n.substring(1)),this.optionalCharacter(58);let s=null,o=null;if(r)s=this.optionalOperator("=")?this.expectTemplateBindingKey():"$implicit";else if(this.next!==ht&&!this.peekKeywordLet()){const t=this.inputIndex,e=this.parsePipe(),i=this.input.substring(t-this.offset,this.inputIndex-this.offset);o=new Y(e,i,this.location,this.errors)}t.push(new J(this.span(i),n,r,s,o)),this.optionalCharacter(59)||this.optionalCharacter(44)}return new mt(t,[],this.errors)}error(t,e=null){this.errors.push(new O(t,this.input,this.locationText(e),this.location)),this.skip()}locationText(t=null){return S(t)&&(t=this.index),t<this.tokens.length?`at column ${this.tokens[t].index+1} in`:"at the end of the expression"}skip(){let t=this.next;for(;this.index<this.tokens.length&&!t.isCharacter(59)&&(this.rparensExpected<=0||!t.isCharacter(41))&&(this.rbracesExpected<=0||!t.isCharacter(125))&&(this.rbracketsExpected<=0||!t.isCharacter(93));)this.next.isError()&&this.errors.push(new O(this.next.toString(),this.input,this.locationText(),this.location)),this.advance(),t=this.next}}class wt{constructor(){this.errors=[]}static check(t){const e=new wt;return t.visit(e),e.errors}visitImplicitReceiver(t,e){}visitInterpolation(t,e){}visitLiteralPrimitive(t,e){}visitPropertyRead(t,e){}visitPropertyWrite(t,e){}visitSafePropertyRead(t,e){}visitMethodCall(t,e){}visitSafeMethodCall(t,e){}visitFunctionCall(t,e){}visitLiteralArray(t,e){this.visitAll(t.expressions)}visitLiteralMap(t,e){this.visitAll(t.values)}visitBinary(t,e){}visitPrefixNot(t,e){}visitConditional(t,e){}visitPipe(t,e){this.errors.push("pipes")}visitKeyedRead(t,e){}visitKeyedWrite(t,e){}visitAll(t){return t.map(t=>t.visit(this))}visitChain(t,e){}visitQuote(t,e){}}const bt=new Map([["==",(t,e)=>t==e],["===",(t,e)=>t===e],["!=",(t,e)=>t!=e],["!==",(t,e)=>t!==e],["&&",(t,e)=>t&&e],["||",(t,e)=>t||e],["+",(t,e)=>t+e],["-",(t,e)=>t-e],["/",(t,e)=>t/e],["*",(t,e)=>t*e],["%",(t,e)=>t%e],["<",(t,e)=>t<e],["<=",(t,e)=>t<=e],[">",(t,e)=>t>e],[">=",(t,e)=>t>=e]]);function Mt(t){return JSON.stringify(t).replace(/"/g,"")}function xt(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function _t(t){return"function"==typeof t}class Et extends Q{visitBinary(t){const e=t.left.visit(this),i=t.right.visit(this);return`${e} ${t.operation} ${i}`}visitChain(t){return Mt(this.visitAll(t.expressions))}visitConditional(t){return`${t.condition.visit(this)} ? ${t.trueExp.visit(this)} : ${t.falseExp.visit(this)}`}visitPipe(t){const e=t.name,i=this.visitAll(t.args),r=t.exp.visit(this);return i.unshift(r),`pipesCache.get('${e}').transform.apply(null, ${Mt(i)})`}visitFunctionCall(t){const e=t.target.visit(this);return`${e}.apply(${e}, ${Mt(this.visitAll(t.args))})`}visitImplicitReceiver(t){return"context"}visitInterpolation(t){return this.visitAll(t.expressions)[0]}visitKeyedRead(t){return`${t.obj.visit(this)}[${t.key.visit(this)}]`}visitKeyedWrite(t){return null}visitLiteralArray(t){return Mt(this.visitAll(t.expressions))}visitLiteralMap(t){const e={},i=t.keys,r=this.visitAll(t.values);for(let n=0,s=i.length;n<s;n++)e[i[n]]=r[n];return Mt(e)}visitLiteralPrimitive(t){return"string"==typeof t.value?`'${t.value}'`:t.value}visitMethodCall(t){const e=t.name,i=t.receiver.visit(this);return`${i}['${e}'].apply(${i}, ${Mt(this.visitAll(t.args))})`}visitPrefixNot(t){return t.expression.visit(this)}visitPropertyRead(t){const e=t.name;return`${t.receiver.visit(this)}['${e}']`}visitPropertyWrite(t){return null}visitSafePropertyRead(t){const e=t.name;return`${t.receiver.visit(this)}['${e}']`}visitSafeMethodCall(t){const e=t.name,i=t.receiver.visit(this);return`${i}['${e}'].apply(${i}, ${Mt(this.visitAll(t.args))})`}visitAll(t){return t.map(t=>t.visit(this))}visitQuote(t){return null}}class St extends Q{constructor(t){super(),this.pipes=t}visitBinary(t,e){const i=bt.get(t.operation);if(!i)throw new Error(`Parse ERROR: on visitBinary, unknown operator ${t.operation}`);return i(t.left.visit(this,e),t.right.visit(this,e))}visitChain(t,e){return this.visitAll(t.expressions,e)}visitConditional(t,e){return t.condition.visit(this,e)?t.trueExp.visit(this,e):null!=t.falseExp?t.falseExp.visit(this,e):null}visitPipe(t,e){const i=this.pipes.get(t.name);if(!i)throw new Error(`pipe ${t.name} not found.`);if(!i.transform)throw new Error(`Parse ERROR: on visitPipe, transform method doesn't exist on pipe ${t.name}.`);const r=t.exp.visit(this,e),n=this.visitAll(t.args,e);return n.unshift(r),i.transform.apply(null,n)}visitFunctionCall(t,e){const i=t.target.visit(this,e);if(!_t(i))throw new Error("Parse ERROR: on visitFunctionCall, target is not a function.");const r=this.visitAll(t.args,e);return i.apply(i,r)}visitImplicitReceiver(t,e){return e}visitInterpolation(t,e){return this.visitAll(t.expressions,e)[0]}visitKeyedRead(t,e){return t.obj.visit(this,e)[t.key.visit(this,e)]}visitKeyedWrite(t,e){const i=t.obj.visit(this,e),r=t.key.visit(this,e),n=t.value.visit(this,e);return i[r]=n,null}visitLiteralArray(t,e){return this.visitAll(t.expressions,e)}visitLiteralMap(t,e){const i={},r=t.keys,n=this.visitAll(t.values,e);for(let s=0,o=r.length;s<o;s++)i[r[s]]=n[s];return i}visitLiteralPrimitive(t,e){return t.value}visitMethodCall(t,e){const i=t.receiver.visit(this,e);if(!xt(i))throw new Error("Parse ERROR: on visitMethodCall, invalid method receiver.");const r=i[t.name];if(!_t(r))throw new Error(`Parse ERROR: on visitMethodCall, method ${t.name} doesn't exist on receiver.`);const n=this.visitAll(t.args,e);return r.apply(i,n)}visitPrefixNot(t,e){return t.expression.visit(this,e)}visitPropertyRead(t,e){const i=t.receiver.visit(this,e);if(!xt(i))throw new Error("Parse ERROR: on visitPropertyRead, invalid property receiver.");return i[t.name]}visitPropertyWrite(t,e){const i=t.receiver.visit(this,e);if(!xt(i))throw new Error("Parse ERROR: on visitPropertyRead, invalid property receiver.");return i[t.name]=t.value.visit(this,e),null}visitSafePropertyRead(t,e){const i=t.receiver.visit(this,e);if(!xt(i))throw new Error("Parse ERROR: on visitSafePropertyRead, invalid property receiver.");return i[t.name]}visitSafeMethodCall(t,e){const i=t.receiver.visit(this,e);if(!xt(i))throw new Error("Parse ERROR: on visitSafeMethodCall, invalid method receiver.");const r=i[t.name];if(!_t(r))throw new Error(`Parse ERROR: on visitSafeMethodCall, method ${t.name} doesn't exist on receiver.`);const n=this.visitAll(t.args,e);return r.apply(i,n)}visitAll(t,e){return t.map(t=>t.visit(this,e))}visitQuote(t,e){throw new Error("Parse ERROR: on visitQuote, quote expression not allowed.")}}const It=new s.InjectionToken("PipesConfig");let Ot=(()=>{let t=class{constructor(t){this._parser=new gt(new st),this._pipesCache=new Map,this._evalCache=new Map,this._calcCache=new Map,t&&t.length&&t.filter(t=>t&&t.length).forEach(t=>t.forEach(t=>this._pipesCache.set(t.pipeName,t.pipeInstance)))}eval(t){if(this._evalCache.has(t))return this._evalCache.get(t);const e=new Et;let i=this._parser.parseInterpolation(t,"Parse");i||(i=this._parser.parseBinding(t,"Parse"));const r=i.visit(e),n=this._pipesCache,s=new Function("context","pipesCache",`return ${r};`),o=function(t){return s(t,n)};return this._evalCache.set(t,o),o}calc(t){if(this._calcCache.has(t))return this._calcCache.get(t);const e=new St(this._pipesCache);let i=this._parser.parseInterpolation(t,"Parse");i||(i=this._parser.parseBinding(t,"Parse"));const r=function(t){return i.visit(e,t)};return this._calcCache.set(t,r),r}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](It,8))},t.\u0275prov=Object(s["\u0275\u0275defineInjectable"])({factory:function(){return new t(Object(s["\u0275\u0275inject"])(It,8))},token:t,providedIn:"root"}),t})();var Pt;let Tt=(()=>{let t=Pt=class{static forRoot(t){return{ngModule:Pt,providers:[{provide:It,multi:!0,useValue:t||[]}]}}};return t.\u0275mod=s["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=s["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)}}),t})();function Rt(t,e){1&t&&s["\u0275\u0275element"](0,"ac-default-plonter")}i("yDJ3");const At=["*"];function kt(t,e){if(1&t){const t=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"div"),s["\u0275\u0275elementStart"](1,"div",4),s["\u0275\u0275listener"]("click",(function(){s["\u0275\u0275restoreView"](t);const i=e.$implicit;return s["\u0275\u0275nextContext"](2).chooseEntity(i)})),s["\u0275\u0275text"](2),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()}if(2&t){const t=e.$implicit;s["\u0275\u0275advance"](2),s["\u0275\u0275textInterpolate1"]("",(null==t?null:t.name)||(null==t?null:t.id)," ")}}const Lt=function(t){return{position:t}};function Dt(t,e){if(1&t&&(s["\u0275\u0275elementStart"](0,"ac-html",1),s["\u0275\u0275elementStart"](1,"div",2),s["\u0275\u0275template"](2,kt,3,1,"div",3),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&t){const t=s["\u0275\u0275nextContext"]();s["\u0275\u0275property"]("props",s["\u0275\u0275pureFunction1"](2,Lt,t.plonterPosition)),s["\u0275\u0275advance"](2),s["\u0275\u0275property"]("ngForOf",t.plonterService.entitesToPlonter)}}const jt=["contextMenuContainer"];function Nt(t,e){}function Ft(t,e){if(1&t&&(s["\u0275\u0275elementStart"](0,"ac-html",1),s["\u0275\u0275template"](1,Nt,0,0,"ng-template",null,2,s["\u0275\u0275templateRefExtractor"]),s["\u0275\u0275elementEnd"]()),2&t){const t=s["\u0275\u0275nextContext"]();s["\u0275\u0275property"]("props",s["\u0275\u0275pureFunction1"](1,Lt,t.contextMenuService.position))}}let Vt=(()=>{let t=class{constructor(){this.cesium=Cesium}createViewer(t,e){let i=null;return i=new this.cesium.Viewer(t,e?Object.assign({contextOptions:{webgl:{preserveDrawingBuffer:!0}}},e):{contextOptions:{webgl:{preserveDrawingBuffer:!0}}}),i}};return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),Bt=(()=>{let t=class{constructor(){this.nextViewerOptionsIndex=0,this.nextViewerModifierIndex=0}get viewerOptions(){return this._viewerOptions}getNextViewerOptions(){return this._viewerOptions instanceof Array?this._viewerOptions[this.nextViewerOptionsIndex++]:this._viewerOptions}set viewerOptions(t){this._viewerOptions=t}get viewerModifier(){return this._viewerModifier}getNextViewerModifier(){return this._viewerModifier instanceof Array?this._viewerModifier[this.nextViewerModifierIndex++]:this._viewerModifier}set viewerModifier(t){this._viewerModifier=t}};return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),Kt=(()=>{let t=class{constructor(t,e,i){this.ngZone=t,this.viewerFactory=e,this.viewerConfiguration=i}init(t,e){this.map=e,this.ngZone.runOutsideAngular(()=>{const e=this.viewerConfiguration?this.viewerConfiguration.getNextViewerOptions():void 0;this.cesiumViewer=this.viewerFactory.createViewer(t,e);const i=this.viewerConfiguration&&this.viewerConfiguration.getNextViewerModifier();"function"==typeof i&&i(this.cesiumViewer)})}getViewer(){return this.cesiumViewer}getScene(){return this.cesiumViewer.scene}getCanvas(){return this.cesiumViewer.canvas}getMap(){return this.map}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](s.NgZone),s["\u0275\u0275inject"](Vt),s["\u0275\u0275inject"](Bt,8))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})();const zt=Cesium.AssociativeArray,Gt=Cesium.Color,Ut=Cesium.ColorGeometryInstanceAttribute,Wt=Cesium.defined,$t=Cesium.DistanceDisplayCondition,Ht=Cesium.DistanceDisplayConditionGeometryInstanceAttribute,qt=Cesium.ShowGeometryInstanceAttribute,Xt=Cesium.Primitive,Zt=Cesium.ShadowMode,Yt=Cesium.BoundingSphereState,Jt=Cesium.ColorMaterialProperty,Qt=Cesium.MaterialProperty,te=Cesium.Property;var ee=new Gt,ie=new $t,re=new $t;function ne(t,e,i,r,n,s,o){var a;this.translucent=e,this.appearanceType=i,this.depthFailAppearanceType=r,this.depthFailMaterialProperty=n,this.depthFailMaterial=void 0,this.closed=s,this.shadows=o,this.primitives=t,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new zt,this.updaters=new zt,this.updatersWithAttributes=new zt,this.attributes=new zt,this.subscriptions=new zt,this.showsUpdated=new zt,this.itemsToRemove=[],this.invalidated=!1,Wt(n)&&(a=n.definitionChanged.addEventListener(ne.prototype.onMaterialChanged,this)),this.removeMaterialSubscription=a}ne.prototype.onMaterialChanged=function(){this.invalidated=!0},ne.prototype.isMaterial=function(t){var e=this.depthFailMaterialProperty,i=t.depthFailMaterialProperty;return i===e||!!Wt(e)&&e.equals(i)},ne.prototype.add=function(t,e){var i=t.id;if(this.createPrimitive=!0,this.geometry.set(i,e),this.updaters.set(i,t),t.hasConstantFill&&t.fillMaterialProperty.isConstant&&te.isConstant(t.distanceDisplayConditionProperty)){var r=this;this.subscriptions.set(i,t.entity.definitionChanged.addEventListener((function(e,i,n,s){"isShowing"===i&&r.showsUpdated.set(t.id,t)})))}else this.updatersWithAttributes.set(i,t)},ne.prototype.remove=function(t){var e=t.id;if(this.createPrimitive=this.geometry.remove(e)||this.createPrimitive,this.updaters.remove(e)){this.updatersWithAttributes.remove(e);var i=this.subscriptions.get(e);Wt(i)&&(i(),this.subscriptions.remove(e))}},ne.prototype.update=function(t){var e,i,r=!0,n=0,s=this.primitive,o=this.primitives;if(this.createPrimitive){var a=this.geometry.values,c=a.length;if(c>0){for(Wt(s)&&(Wt(this.oldPrimitive)?o.remove(s):this.oldPrimitive=s),i=0;i<c;i++){var h=a[i],l=h.attributes;e=this.attributes.get(h.id.id),Wt(e)&&(Wt(l.show)&&(l.show.value=e.show),Wt(l.color)&&(l.color.value=e.color),Wt(l.depthFailColor)&&(l.depthFailColor.value=e.depthFailColor))}var u;Wt(this.depthFailAppearanceType)&&(Wt(this.depthFailMaterialProperty)&&(this.depthFailMaterial=Qt.getValue(t,this.depthFailMaterialProperty,this.depthFailMaterial)),u=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.translucent,closed:this.closed})),s=new Xt({show:!1,asynchronous:!0,geometryInstances:a,appearance:new this.appearanceType({flat:this.shadows===Zt.DISABLED||this.shadows===Zt.CAST_ONLY,translucent:this.translucent,closed:this.closed}),depthFailAppearance:u,shadows:this.shadows}),o.add(s),r=!1}else{Wt(s)&&(o.remove(s),s=void 0);var p=this.oldPrimitive;Wt(p)&&(o.remove(p),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=s,this.createPrimitive=!1,this.waitingOnCreate=!0}else if(Wt(s)&&s.ready){s.show=!0,Wt(this.oldPrimitive)&&(o.remove(this.oldPrimitive),this.oldPrimitive=void 0),!Wt(this.depthFailAppearanceType)||this.depthFailMaterialProperty instanceof Jt||(this.depthFailMaterial=Qt.getValue(t,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);var d=this.updatersWithAttributes.values,f=d.length,v=this.waitingOnCreate;for(i=0;i<f;i++){var m=d[i],y=this.geometry.get(m.id);if(e=this.attributes.get(y.id.id),Wt(e)||(e=s.getGeometryInstanceAttributes(y.id),this.attributes.set(y.id.id,e)),!m.fillMaterialProperty.isConstant||v){var g=te.getValueOrDefault(m.fillMaterialProperty.color,t,Gt.WHITE,ee);Gt.equals(e._lastColor,g)||(e._lastColor=Gt.clone(g,e._lastColor),e.color=Ut.toValue(g,e.color),(this.translucent&&255===e.color[3]||!this.translucent&&255!==e.color[3])&&(this.itemsToRemove[n++]=m))}if(Wt(this.depthFailAppearanceType)&&m.depthFailMaterialProperty instanceof Jt&&(!m.depthFailMaterialProperty.isConstant||v)){var C=te.getValueOrDefault(m.depthFailMaterialProperty.color,t,Gt.WHITE,ee);Gt.equals(e._lastDepthFailColor,C)||(e._lastDepthFailColor=Gt.clone(C,e._lastDepthFailColor),e.depthFailColor=Ut.toValue(C,e.depthFailColor))}var w=m.entity.isShowing&&(m.hasConstantFill||m.isFilled(t));w!==(1===e.show[0])&&(e.show=qt.toValue(w,e.show));var b=m.distanceDisplayConditionProperty;if(!te.isConstant(b)){var M=te.getValueOrDefault(b,t,re,ie);$t.equals(M,e._lastDistanceDisplayCondition)||(e._lastDistanceDisplayCondition=$t.clone(M,e._lastDistanceDisplayCondition),e.distanceDisplayCondition=Ht.toValue(M,e.distanceDisplayCondition))}}this.updateShows(s),this.waitingOnCreate=!1}else Wt(s)&&!s.ready&&(r=!1);return this.itemsToRemove.length=n,r},ne.prototype.updateShows=function(t){for(var e=this.showsUpdated.values,i=e.length,r=0;r<i;r++){var n=e[r],s=this.geometry.get(n.id),o=this.attributes.get(s.id.id);Wt(o)||(o=t.getGeometryInstanceAttributes(s.id),this.attributes.set(s.id.id,o));var a=n.entity.isShowing;a!==(1===o.show[0])&&(o.show=qt.toValue(a,o.show))}this.showsUpdated.removeAll()},ne.prototype.contains=function(t){return this.updaters.contains(t.id)},ne.prototype.getBoundingSphere=function(t,e){var i=this.primitive;if(!i.ready)return Yt.PENDING;var r=i.getGeometryInstanceAttributes(t.entity);return!Wt(r)||!Wt(r.boundingSphere)||Wt(r.show)&&0===r.show[0]?Yt.FAILED:(r.boundingSphere.clone(e),Yt.DONE)},ne.prototype.removeAllPrimitives=function(){var t=this.primitives,e=this.primitive;Wt(e)&&(t.remove(e),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());var i=this.oldPrimitive;Wt(i)&&(t.remove(i),this.oldPrimitive=void 0)},ne.prototype.destroy=function(){var t=this.primitive,e=this.primitives;Wt(t)&&e.remove(t);var i=this.oldPrimitive;Wt(i)&&e.remove(i),Wt(this.removeMaterialSubscription)&&this.removeMaterialSubscription()};let se=!1;const oe=new s.InjectionToken("ANGULAR_CESIUM_CONFIG");let ae=(()=>{let t=class{constructor(t){this.config=t,!1!==(!t||t.fixEntitiesShadows)&&(se||(Cesium.StaticGeometryColorBatch.prototype.add=function(t,e){var i,r,n=e.createFillGeometryInstance(t);255===n.attributes.color.value[3]?(i=this._solidItems,r=!1):(i=this._translucentItems,r=!0);for(var s=i.length,o=0;o<s;o++){var a=i[o];if(a.isMaterial(e))return void a.add(e,n)}var c=new ne(this._primitives,r,this._appearanceType,this._depthFailAppearanceType,e.depthFailMaterialProperty,this._closed,this._shadows);c.add(e,n),i.push(c)},se=!0))}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](oe,8))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})();var ce,he=function(t){return t[t.SCENE3D=0]="SCENE3D",t[t.COLUMBUS_VIEW=1]="COLUMBUS_VIEW",t[t.SCENE2D=2]="SCENE2D",t[t.PERFORMANCE_SCENE2D=3]="PERFORMANCE_SCENE2D",t}({});let le=(()=>{let t=ce=class{constructor(){this.isSceneModePerformance2D=!1}init(t){this.viewer=t.getViewer(),this.scene=t.getScene(),this.screenSpaceCameraController=this.scene.screenSpaceCameraController,this.camera=this.scene.camera,this.lastRotate=this.screenSpaceCameraController.enableRotate,this.lastTilt=this.screenSpaceCameraController.enableTilt,this.lastLook=this.screenSpaceCameraController.enableLook}_listenToSceneModeMorph(t){this.morphListenerCancelFn=this.scene.morphStart.addEventListener(t)}_revertCameraProperties(){this.isSceneModePerformance2D=!1,this.enableTilt(this.lastTilt),this.enableRotate(this.lastRotate),this.enableLook(this.lastLook)}getCamera(){return this.camera}getScreenSpaceCameraController(){return this.screenSpaceCameraController}getMinimumZoom(){return this.screenSpaceCameraController.minimumZoomDistance}setMinimumZoom(t){this.screenSpaceCameraController.minimumZoomDistance=t}getMaximumZoom(){return this.screenSpaceCameraController.maximumZoomDistance}setMaximumZoom(t){this.screenSpaceCameraController.maximumZoomDistance=t}enableTilt(t){this.screenSpaceCameraController.enableTilt=t}enableRotate(t){this.screenSpaceCameraController.enableRotate=t}enableLook(t){this.screenSpaceCameraController.enableLook=t}enableTranslate(t){this.screenSpaceCameraController.enableTranslate=t}enableZoom(t){this.screenSpaceCameraController.enableZoom=t}enableInputs(t){this.screenSpaceCameraController.enableInputs=t}setSceneMode(t,e){switch(t){case he.SCENE3D:this.isSceneModePerformance2D&&this._revertCameraProperties(),this.scene.morphTo3D(e);break;case he.COLUMBUS_VIEW:this.isSceneModePerformance2D&&this._revertCameraProperties(),this.scene.morphToColumbusView(e);break;case he.SCENE2D:this.isSceneModePerformance2D&&this._revertCameraProperties(),this.scene.morphTo2D(e);break;case he.PERFORMANCE_SCENE2D:{this.isSceneModePerformance2D=!0,this.lastLook=this.screenSpaceCameraController.enableLook,this.lastTilt=this.screenSpaceCameraController.enableTilt,this.lastRotate=this.screenSpaceCameraController.enableRotate,this.screenSpaceCameraController.enableTilt=!1,this.screenSpaceCameraController.enableRotate=!1,this.screenSpaceCameraController.enableLook=!1,this.morphListenerCancelFn&&this.morphListenerCancelFn(),this.scene.morphToColumbusView(e);const t=this.scene.morphComplete.addEventListener(()=>{this.camera.setView({destination:Cesium.Cartesian3.fromDegrees(0,0,Math.min(ce.PERFORMANCE_2D_ALTITUDE,this.getMaximumZoom())),orientation:{pitch:Cesium.Math.toRadians(-90)}}),t(),this._listenToSceneModeMorph(this._revertCameraProperties.bind(this))});break}}}cameraFlyTo(t){return this.camera.flyTo(t)}flyTo(t,e){return this.viewer.flyTo(t,e)}zoomIn(t){return this.camera.zoomIn(t||this.camera.defaultZoomAmount)}zoomOut(t){return this.camera.zoomOut(t||this.camera.defaultZoomAmount)}zoomTo(t,e){return this.viewer.zoomTo(t,e)}setView(t){this.camera.setView(t)}setRotation(t){this.setView({orientation:{heading:t}})}lockRotation(t){this.scene.screenSpaceCameraController.enableRotate=!t}trackEntity(t,e){const i=e&&e.flyTo||!1;return this.viewer.trackedEntity=void 0,new Promise(r=>{if(i){const i=e&&e.flyToDuration||1,n=e&&e.altitude||1e4,s=t.position.getValue(Cesium.JulianDate.now()),o=Cesium.Cartographic.fromCartesian(s),a=n-o.height;o.height=n;const c=Cesium.Cartesian3.fromRadians(o.longitude,o.latitude,o.height);this.cameraFlyTo({duration:i,destination:c,complete:()=>{this.viewer.trackedEntity=t,setTimeout(()=>{a>0?this.camera.zoomOut(a):this.camera.zoomIn(a)},0),r()}})}else this.viewer.trackedEntity=t,r()})}untrackEntity(){this.trackEntity()}};return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t.PERFORMANCE_2D_ALTITUDE=25e6,t})();var ue=function(t){return t[t.MOUSE_MOVE=Cesium.ScreenSpaceEventType.MOUSE_MOVE]="MOUSE_MOVE",t[t.LEFT_CLICK=Cesium.ScreenSpaceEventType.LEFT_CLICK]="LEFT_CLICK",t[t.LEFT_DOUBLE_CLICK=Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK]="LEFT_DOUBLE_CLICK",t[t.LEFT_DOWN=Cesium.ScreenSpaceEventType.LEFT_DOWN]="LEFT_DOWN",t[t.LEFT_UP=Cesium.ScreenSpaceEventType.LEFT_UP]="LEFT_UP",t[t.MIDDLE_CLICK=Cesium.ScreenSpaceEventType.MIDDLE_CLICK]="MIDDLE_CLICK",t[t.MIDDLE_DOUBLE_CLICK=Cesium.ScreenSpaceEventType.MIDDLE_DOUBLE_CLICK]="MIDDLE_DOUBLE_CLICK",t[t.MIDDLE_DOWN=Cesium.ScreenSpaceEventType.MIDDLE_DOWN]="MIDDLE_DOWN",t[t.MIDDLE_UP=Cesium.ScreenSpaceEventType.MIDDLE_UP]="MIDDLE_UP",t[t.PINCH_START=Cesium.ScreenSpaceEventType.PINCH_START]="PINCH_START",t[t.PINCH_END=Cesium.ScreenSpaceEventType.PINCH_END]="PINCH_END",t[t.PINCH_MOVE=Cesium.ScreenSpaceEventType.PINCH_MOVE]="PINCH_MOVE",t[t.RIGHT_CLICK=Cesium.ScreenSpaceEventType.RIGHT_CLICK]="RIGHT_CLICK",t[t.RIGHT_DOUBLE_CLICK=Cesium.ScreenSpaceEventType.RIGHT_DOUBLE_CLICK]="RIGHT_DOUBLE_CLICK",t[t.RIGHT_DOWN=Cesium.ScreenSpaceEventType.RIGHT_DOWN]="RIGHT_DOWN",t[t.RIGHT_UP=Cesium.ScreenSpaceEventType.RIGHT_UP]="RIGHT_UP",t[t.WHEEL=Cesium.ScreenSpaceEventType.WHEEL]="WHEEL",t[t.LONG_LEFT_PRESS=110]="LONG_LEFT_PRESS",t[t.LONG_RIGHT_PRESS=111]="LONG_RIGHT_PRESS",t[t.LONG_MIDDLE_PRESS=112]="LONG_MIDDLE_PRESS",t[t.LEFT_CLICK_DRAG=113]="LEFT_CLICK_DRAG",t[t.RIGHT_CLICK_DRAG=114]="RIGHT_CLICK_DRAG",t[t.MIDDLE_CLICK_DRAG=115]="MIDDLE_CLICK_DRAG",t}({}),pe=function(t){return t[t.NO_PICK=0]="NO_PICK",t[t.PICK_FIRST=1]="PICK_FIRST",t[t.PICK_ONE=2]="PICK_ONE",t[t.PICK_ALL=3]="PICK_ALL",t}({});let de=(()=>{let t=class{constructor(){this._showContextMenu=!1,this._contextMenuChangeNotifier=new s.EventEmitter,this._onOpen=new s.EventEmitter,this._onClose=new s.EventEmitter,this._defaultContextMenuOptions={closeOnLeftCLick:!0,closeOnLeftClickPriority:10}}get contextMenuChangeNotifier(){return this._contextMenuChangeNotifier}get showContextMenu(){return this._showContextMenu}get options(){return this._options}get position(){return this._position}get content(){return this._content}get onOpen(){return this._onOpen}get onClose(){return this._onClose}init(t){this.mapEventsManager=t}open(t,e,i={}){this.close(),this._content=t,this._position=e,this._options=Object.assign({},this._defaultContextMenuOptions,i),this._showContextMenu=!0,this.mapEventsManager&&this._options.closeOnLeftCLick&&(this.leftClickRegistration=this.mapEventsManager.register({event:ue.LEFT_CLICK,pick:pe.NO_PICK,priority:this._options.closeOnLeftClickPriority}),this.leftClickSubscription=this.leftClickRegistration.subscribe(()=>{this.leftClickSubscription.unsubscribe(),this.close()})),this._contextMenuChangeNotifier.emit(),this._onOpen.emit()}close(){this._content=void 0,this._position=void 0,this._options=void 0,this._showContextMenu=!1,this.leftClickRegistration&&(this.leftClickRegistration.dispose(),this.leftClickRegistration=void 0),this.leftClickSubscription&&(this.leftClickSubscription.unsubscribe(),this.leftClickSubscription=void 0),this._contextMenuChangeNotifier.emit(),this._onClose.emit()}};return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})();const fe=o.LatLonVectors;window.geodesy=o;let ve=(()=>{let t=class{constructor(t){this.cesiumService=t}static cartesian3ToLatLon(t,e){const i=Cesium.Cartographic.fromCartesian(t,e);return{lon:Cesium.Math.toDegrees(i.longitude),lat:Cesium.Math.toDegrees(i.latitude),height:i.height}}screenToCartesian3(t,e){if(this.cesiumService){const i=Object.assign({},t);if(e){const t=this.cesiumService.getViewer().canvas.getBoundingClientRect();i.x+=t.left,i.y+=t.top}return this.cesiumService.getViewer().camera.pickEllipsoid(i)}throw new Error("ANGULAR2-CESIUM - Cesium service should be provided in order to do screen position calculations")}screenToCartographic(t,e){return this.cartesian3ToCartographic(this.screenToCartesian3(t),e)}cartesian3ToCartographic(t,e){return Cesium.Cartographic.fromCartesian(t,e)}degreesToCartographic(t,e,i){return Cesium.Cartographic.fromDegrees(t,e,i)}radiansToCartographic(t,e,i){return Cesium.Cartographic.fromRadians(t,e,i)}degreesToUTM(t,e){return new o.LatLonEllipsoidal(e,t).toUtm()}UTMToDegrees(t,e,i,r){return this.geodesyToCesiumObject(new o.Utm(t,e,i,r).toLatLonE())}geodesyToCesiumObject(t){return{longitude:t.lon,latitude:t.lat,height:t.height?t.height:0}}midPointToCartesian3(t,e){const i=t=>Cesium.Math.toDegrees(t),r=new fe(i(t.latitude),i(t.longitude)),n=new fe(i(e.latitude),i(e.longitude)),s=r.midpointTo(n);return Cesium.Cartesian3.fromDegrees(s.lon,s.lat)}middlePointByScreen(t,e){const i=this.cesiumService.getScene(),r=Cesium.SceneTransforms.wgs84ToWindowCoordinates(i,t),n=Cesium.SceneTransforms.wgs84ToWindowCoordinates(i,e),s=new Cesium.Cartesian2((n.x+r.x)/2,(n.y+r.y)/2);return i.pickPosition(s)}bearingTo(t,e){const i=t=>Cesium.Math.toDegrees(t),r=new fe(i(t.latitude),i(t.longitude)),n=new fe(i(e.latitude),i(e.longitude));return r.bearingTo(n)}bearingToCartesian(t,e){const i=Cesium.Cartographic.fromCartesian(t),r=Cesium.Cartographic.fromCartesian(e);return this.bearingTo(i,r)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt,8))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})();class me{constructor(){}setPropsAssigner(t){this._propsAssigner=t}}class ye extends me{constructor(t,e){super(),this.drawerType=t,this.cesiumService=e,this._show=!0}init(){this._cesiumCollection=new this.drawerType,this._primitiveCollectionWrap=new Cesium.PrimitiveCollection,this._primitiveCollectionWrap.add(this._cesiumCollection),this.cesiumService.getScene().primitives.add(this._primitiveCollectionWrap)}add(t,...e){return this._cesiumCollection.add(t)}update(t,e,...i){this._propsAssigner?this._propsAssigner(t,e):Object.assign(t,e)}remove(t){this._cesiumCollection.remove(t)}removeAll(){this._cesiumCollection.removeAll()}setShow(t){this._show=t,this._primitiveCollectionWrap.show=t}getShow(){return this._show}}var ge;let Ce=(()=>{let t=ge=class{constructor(t){this.cesiumService=t}static pointByLocationDistanceAndAzimuth(t,e,i,r){const n=e/Cesium.Ellipsoid.WGS84.maximumRadius,s=t instanceof Cesium.Cartesian3?Cesium.Cartographic.fromCartesian(t):t,o=t instanceof Cesium.Cartesian3?t:Cesium.Cartesian3.fromRadians(t.longitude,t.latitude,t.height);let a,c,h=0,l=.1,u=-.1;for(;0===h||h<16&&Math.max(c,e)/Math.min(c,e)>1.000001;)a=ge._pointByLocationDistanceAndAzimuth(s,n*(1+(u+(l-u)/2)),i),c=this.distance(o,a),c>e?l=u+(l-u)/2:u+=(l-u)/2,h++;return a}static _pointByLocationDistanceAndAzimuth(t,e,i){const r=t.latitude,n=t.longitude,s=Math.asin(Math.sin(r)*Math.cos(e)+Math.cos(r)*Math.sin(e)*Math.cos(i));let o=n+Math.atan2(Math.sin(i)*Math.sin(e)*Math.cos(r),Math.cos(e)-Math.sin(r)*Math.sin(s));return o=(o+3*Math.PI)%(2*Math.PI)-Math.PI,Cesium.Cartesian3.fromRadians(o,s)}static distance(t,e){return Cesium.Cartesian3.distance(t,e)}static getPositionsDelta(t,e){return{x:e.x-t.x,y:e.y-t.y,z:e.z-t.z}}static addDeltaToPosition(t,e,i=!1){if(i){t.x+=e.x,t.y+=e.y,t.z+=e.z;const i=Cesium.Cartographic.fromCartesian(t);i.height=0;const r=Cesium.Cartesian3.fromRadians(i.longitude,i.latitude,i.height);return t.x=r.x,t.y=r.y,t.z=r.z,t}{const i=new Cesium.Cartesian3(t.x+e.x,t.y+e.y,t.z+e.z),r=Cesium.Cartographic.fromCartesian(i);return r.height=0,Cesium.Cartesian3.fromRadians(r.longitude,r.latitude,r.height)}}static middleCartesian3Point(t,e){return new Cesium.Cartesian3(e.x-t.x/2,e.y-t.y/2,e.z-t.z/2)}screenPositionToCartesian3(t){return this.cesiumService.getViewer().camera.pickEllipsoid(t)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),we=(()=>{let t=class extends ye{constructor(t){super(Cesium.PolylineCollection,t)}_calculateArcPositions(t){const e=t.quality||18,i=t.delta/e,r=[];for(let n=0;n<e+1;++n){const e=Ce.pointByLocationDistanceAndAzimuth(t.center,t.radius,t.angle+i*n,!0);r.push(e)}return r}_calculateTriangle(t){return[t.center,Ce.pointByLocationDistanceAndAzimuth(t.center,t.radius,t.angle,!0)]}_calculateArc(t){const e=this._calculateArcPositions(t);return t.drawEdges?e.concat(this._calculateTriangle(t)):e}add(t){if(t.positions=this._calculateArc(t),t.color){const e=Cesium.Material.fromType("Color");e.uniforms.color=t.color,t.material=e}return this._cesiumCollection.add(t)}update(t,e){return e.constantColor||!e.color||t.material.uniforms.color.equals(e.color)||(t.material.uniforms.color=e.color),t.width=void 0!==e.width?e.width:t.width,t.show=void 0!==e.show?e.show:t.show,t.distanceDisplayCondition=void 0!==e.distanceDisplayCondition?e.distanceDisplayCondition:t.distanceDisplayCondition,t.positions=this._calculateArc(e),t}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})();var be=function(t){return t[t.ellipse=Cesium.EllipseGraphics]="ellipse",t[t.ellipsoid=Cesium.EllipsoidGraphics]="ellipsoid",t[t.polygon=Cesium.PolygonGraphics]="polygon",t[t.polyline=Cesium.PolylineGraphics]="polyline",t[t.polylineVolume=Cesium.PolylineVolumeGraphics]="polylineVolume",t[t.box=Cesium.BoxGraphics]="box",t[t.corridor=Cesium.CorridorGraphics]="corridor",t[t.cylinder=Cesium.CylinderGraphics]="cylinder",t[t.label=Cesium.LabelGraphics]="label",t[t.billboard=Cesium.BillboardGraphics]="billboard",t[t.model=Cesium.ModelGraphics]="model",t[t.path=Cesium.PathGraphics]="path",t[t.point=Cesium.PointGraphics]="point",t[t.rectangle=Cesium.RectangleGraphics]="rectangle",t[t.wall=Cesium.WallGraphics]="wall",t}({});class Me{constructor(t,e=-1,i=-1){this.entityCollection=t,this._isSuspended=!1,this._isHardSuspend=!1,this._updateRate=i,this._collectionSize=e}setShow(t){this.entityCollection.show=t}get isSuspended(){return this._isSuspended}get updateRate(){return this._updateRate}set updateRate(t){this._updateRate=t}get collectionSize(){return this._collectionSize}set collectionSize(t){this._collectionSize=t}collection(){return this.entityCollection}isFree(){return this._collectionSize<1||this.entityCollection.values.length<this._collectionSize}add(t){return this.suspend(),this.entityCollection.add(t)}remove(t){return this.suspend(),this.entityCollection.remove(t)}removeNoSuspend(t){this.entityCollection.remove(t)}removeAll(){this.suspend(),this.entityCollection.removeAll()}onEventSuspension(t,e=!1){return this._onEventSuspensionCallback={callback:t,once:e},()=>{this._onEventSuspensionCallback=void 0}}onEventResume(t,e=!1){return this._onEventResumeCallback={callback:t,once:e},this._isSuspended||this.triggerEventResume(),()=>{this._onEventResumeCallback=void 0}}triggerEventSuspension(){if(void 0!==this._onEventSuspensionCallback){const t=this._onEventSuspensionCallback.callback;this._onEventSuspensionCallback.once&&(this._onEventSuspensionCallback=void 0),t()}}triggerEventResume(){if(void 0!==this._onEventResumeCallback){const t=this._onEventResumeCallback.callback;this._onEventResumeCallback.once&&(this._onEventResumeCallback=void 0),t()}}suspend(){this._updateRate<0||this._isHardSuspend||this._isSuspended||(this._isSuspended=!0,this.entityCollection.suspendEvents(),this.triggerEventSuspension(),this._suspensionTimeout=setTimeout(()=>{this.entityCollection.resumeEvents(),this.triggerEventResume(),this._isSuspended=!1,this._suspensionTimeout=void 0},this._updateRate))}hardSuspend(){this.entityCollection.suspendEvents(),this._isHardSuspend=!0}hardResume(){this.entityCollection.resumeEvents(),this._isHardSuspend=!1}}class xe extends me{constructor(t,e,i={collectionMaxSize:-1,collectionSuspensionTime:-1,collectionsNumber:1}){super(),this.cesiumService=t,this.graphicsType=e,this.defaultOptions=i,this.entityCollections=new Map,this.graphicsTypeName=be[this.graphicsType];for(const r in be)be[r]===this.graphicsType&&(this.graphicsTypeName=r)}getFreeEntitiesCollection(){let t=null;return this.entityCollections.forEach(e=>{e.isFree()&&(t=e)}),t}init(t){const e=t||this.defaultOptions,i=[];for(let r=0;r<e.collectionsNumber;r++){const t=new Cesium.CustomDataSource(this.graphicsTypeName);i.push(t),this.cesiumService.getViewer().dataSources.add(t),this.entityCollections.set(t.entities,new Me(t.entities,e.collectionMaxSize,e.collectionSuspensionTime))}return i}add(t){const e=this.getFreeEntitiesCollection();if(null===e)throw new Error("No more free entity collections");const i={position:void 0!==t.position?t.position:void 0,description:void 0!==t.description?t.description:void 0,orientation:void 0!==t.orientation?t.orientation:void 0,viewFrom:void 0!==t.viewFrom?t.viewFrom:void 0,[this.graphicsTypeName]:t};return void 0!==t.name&&(i.name=t.name),void 0!==t.availability&&(i.availability=t.availability),e.add(i)}update(t,e){this.suspendEntityCollection(t),t.position instanceof Cesium.CallbackProperty&&t.position._isConstant&&(t.position=e.position),t.position=void 0!==e.position?e.position:void 0,t.name=void 0!==e.name?e.name:t.name,t.description=void 0!==e.description?e.description:t.description,t.orientation=void 0!==e.orientation?e.orientation:t.orientation,t.viewFrom=void 0!==e.viewFrom?e.viewFrom:t.viewFrom,t.availability=e.availability,this._propsAssigner?this._propsAssigner(t[this.graphicsTypeName],e):Object.assign(t[this.graphicsTypeName],e)}remove(t){this.entityCollections.get(t.entityCollection).remove(t)}removeAll(){this.entityCollections.forEach(t=>{t.removeAll()})}setShow(t){this.entityCollections.forEach(e=>{e.setShow(t)})}suspendEntityCollection(t){const e=t.entityCollection;if(!this.entityCollections.has(e))throw new Error("No EntityCollection for entity.entityCollection");this.entityCollections.get(e).suspend()}}let _e=(()=>{let t=class extends xe{constructor(t){super(t,be.billboard)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),Ee=(()=>{let t=class extends me{constructor(t){super(),this.cesiumService=t}init(t){const e=[];return this.czmlStream=new Cesium.CzmlDataSource("czml"),e.push(this.czmlStream),this.cesiumService.getViewer().dataSources.add(this.czmlStream),e}add(t){return this.czmlStream.process(t.czmlPacket),t}update(t,e){this.czmlStream.process(e.czmlPacket)}remove(t){this.czmlStream.entities.removeById(t.acEntity.id)}removeAll(){this.czmlStream.entities.removeAll()}setShow(t){this.czmlStream.entities.show=t}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),Se=(()=>{let t=class extends xe{constructor(t){super(t,be.ellipse)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),Ie=(()=>{let t=class extends xe{constructor(t){super(t,be.label)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),Oe=(()=>{let t=class extends xe{constructor(t){super(t,be.point)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),Pe=(()=>{let t=class extends xe{constructor(t){super(t,be.polygon)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),Te=(()=>{let t=class extends xe{constructor(t){super(t,be.polyline)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),Re=(()=>{let t=class extends ye{constructor(t){super(Cesium.PolylineCollection,t)}add(t){return this._cesiumCollection.add(this.withColorMaterial(t))}update(t,e){e.material instanceof Cesium.Color&&(t.material&&t.material.uniforms&&t.material.uniforms.color instanceof Cesium.Color?this.withColorMaterial(e):t.material.uniforms.color.equals(e.material)||(t.material.uniforms.color=e.material)),super.update(t,e)}withColorMaterial(t){if(t.material instanceof Cesium.Color){const e=Cesium.Material.fromType("Color");e.uniforms.color=t.material,t.material=e}return t}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})();var Ae=function(t){return t[t.CAMERA_FORWARD=0]="CAMERA_FORWARD",t[t.CAMERA_BACKWARD=1]="CAMERA_BACKWARD",t[t.CAMERA_RIGHT=2]="CAMERA_RIGHT",t[t.CAMERA_LEFT=3]="CAMERA_LEFT",t[t.CAMERA_UP=4]="CAMERA_UP",t[t.CAMERA_DOWN=5]="CAMERA_DOWN",t[t.CAMERA_LOOK_RIGHT=6]="CAMERA_LOOK_RIGHT",t[t.CAMERA_LOOK_LEFT=7]="CAMERA_LOOK_LEFT",t[t.CAMERA_LOOK_UP=8]="CAMERA_LOOK_UP",t[t.CAMERA_LOOK_DOWN=9]="CAMERA_LOOK_DOWN",t[t.CAMERA_TWIST_RIGHT=10]="CAMERA_TWIST_RIGHT",t[t.CAMERA_TWIST_LEFT=11]="CAMERA_TWIST_LEFT",t[t.CAMERA_ROTATE_RIGHT=12]="CAMERA_ROTATE_RIGHT",t[t.CAMERA_ROTATE_LEFT=13]="CAMERA_ROTATE_LEFT",t[t.CAMERA_ROTATE_UP=14]="CAMERA_ROTATE_UP",t[t.CAMERA_ROTATE_DOWN=15]="CAMERA_ROTATE_DOWN",t[t.CAMERA_ZOOM_IN=16]="CAMERA_ZOOM_IN",t[t.CAMERA_ZOOM_OUT=17]="CAMERA_ZOOM_OUT",t}({});const ke={[Ae.CAMERA_FORWARD]:(t,e)=>{const i=t.getViewer().camera,r=t.getScene().globe.ellipsoid.cartesianToCartographic(i.position).height;i.moveForward(r/(e.moveRate||100))},[Ae.CAMERA_BACKWARD]:(t,e)=>{const i=t.getViewer().camera,r=t.getScene().globe.ellipsoid.cartesianToCartographic(i.position).height;i.moveBackward(r/(e.moveRate||100))},[Ae.CAMERA_UP]:(t,e)=>{const i=t.getViewer().camera,r=t.getScene().globe.ellipsoid.cartesianToCartographic(i.position).height;i.moveUp(r/(e.moveRate||100))},[Ae.CAMERA_DOWN]:(t,e)=>{const i=t.getViewer().camera,r=t.getScene().globe.ellipsoid.cartesianToCartographic(i.position).height;i.moveDown(r/(e.moveRate||100))},[Ae.CAMERA_RIGHT]:(t,e)=>{const i=t.getViewer().camera,r=t.getScene().globe.ellipsoid.cartesianToCartographic(i.position).height;i.moveRight(r/(e.moveRate||100))},[Ae.CAMERA_LEFT]:(t,e)=>{const i=t.getViewer().camera,r=t.getScene().globe.ellipsoid.cartesianToCartographic(i.position).height;i.moveLeft(r/(e.moveRate||100))},[Ae.CAMERA_LOOK_RIGHT]:(t,e)=>{const i=t.getViewer().camera;i.lookRight(i.positionCartographic.latitude*(e.lookFactor||.01))},[Ae.CAMERA_LOOK_LEFT]:(t,e)=>{const i=t.getViewer().camera;i.lookLeft(i.positionCartographic.latitude*(e.lookFactor||.01))},[Ae.CAMERA_LOOK_UP]:(t,e)=>{const i=t.getViewer().camera;i.lookUp(i.positionCartographic.longitude*(-1*(e.lookFactor||.01)))},[Ae.CAMERA_LOOK_DOWN]:(t,e)=>{const i=t.getViewer().camera;i.lookDown(i.positionCartographic.longitude*(-1*(e.lookFactor||.01)))},[Ae.CAMERA_TWIST_RIGHT]:(t,e)=>{t.getViewer().camera.twistRight(e.amount||.01)},[Ae.CAMERA_TWIST_LEFT]:(t,e)=>{t.getViewer().camera.twistLeft(e.amount||.01)},[Ae.CAMERA_ROTATE_RIGHT]:(t,e)=>{t.getViewer().camera.rotateRight(e.angle||.01)},[Ae.CAMERA_ROTATE_LEFT]:(t,e)=>{t.getViewer().camera.rotateLeft(e.angle||.01)},[Ae.CAMERA_ROTATE_UP]:(t,e)=>{t.getViewer().camera.rotateUp(e.angle||.01)},[Ae.CAMERA_ROTATE_DOWN]:(t,e)=>{t.getViewer().camera.rotateDown(e.angle||.01)},[Ae.CAMERA_ZOOM_IN]:(t,e)=>{t.getViewer().camera.zoomIn(e.amount)},[Ae.CAMERA_ZOOM_OUT]:(t,e)=>{t.getViewer().camera.zoomOut(e.amount)}};var Le=function(t){return t[t.IGNORED=0]="IGNORED",t[t.NOT_PRESSED=1]="NOT_PRESSED",t[t.PRESSED=2]="PRESSED",t}({});let De=(()=>{let t=class{constructor(t,e,i){this.ngZone=t,this.cesiumService=e,this.document=i,this._currentDefinitions=null,this._activeDefinitions={},this._keyMappingFn=this.defaultKeyMappingFn}init(){const t=this.cesiumService.getCanvas();t.addEventListener("click",()=>{t.focus()}),this.handleKeydown=this.handleKeydown.bind(this),this.handleKeyup=this.handleKeyup.bind(this),this.handleTick=this.handleTick.bind(this)}setKeyboardControls(t,e,i=!1){if(!t)return this.removeKeyboardControls();this._currentDefinitions||this.registerEvents(i),this._currentDefinitions=t,this._keyMappingFn=e||this.defaultKeyMappingFn,Object.keys(this._currentDefinitions).forEach(t=>{this._activeDefinitions[t]={state:Le.NOT_PRESSED,action:null,keyboardEvent:null}})}removeKeyboardControls(){this.unregisterEvents(),this._currentDefinitions=null}getAction(t){return this._currentDefinitions[t]||null}defaultKeyMappingFn(t){return String.fromCharCode(t.keyCode)}handleKeydown(t){const e=this._keyMappingFn(t),i=this.getAction(e);if(i&&this._activeDefinitions[e].state!==Le.IGNORED){let r=!0;const n=this.getParams(i.params,t);i.validation&&(r=i.validation(this.cesiumService,n,t)),!0===r&&(this._activeDefinitions[e]={state:Le.PRESSED,action:i,keyboardEvent:t})}}handleKeyup(t){const e=this._keyMappingFn(t),i=this.getAction(e);i&&(this._activeDefinitions[e]={state:Le.NOT_PRESSED,action:null,keyboardEvent:t},i.done&&"function"==typeof i.done&&i.done(this.cesiumService,t))}handleTick(){Object.keys(this._activeDefinitions).forEach(t=>{const e=this._activeDefinitions[t];null!==e&&null!==e.action&&e.state===Le.PRESSED&&this.executeAction(e.action,t,e.keyboardEvent)})}getParams(t,e){return t?"function"==typeof t?t(this.cesiumService,e):t:{}}executeAction(t,e,i){if(!this._currentDefinitions)return;const r=this.getParams(t.params,i);if(Object(a.isNumber)(t.action)){const e=ke[t.action];e&&e(this.cesiumService,r,i)}else"function"==typeof t.action&&!1===t.action(this.cesiumService,r,i)&&(this._activeDefinitions[e]={state:Le.IGNORED,action:null,keyboardEvent:null})}registerEvents(t){const e=()=>{this.document.addEventListener("keydown",this.handleKeydown),this.document.addEventListener("keyup",this.handleKeyup),this.cesiumService.getViewer().clock.onTick.addEventListener(this.handleTick)};t?this.ngZone.runOutsideAngular(e):e()}unregisterEvents(){this.document.removeEventListener("keydown",this.handleKeydown),this.document.removeEventListener("keyup",this.handleKeyup),this.cesiumService.getViewer().clock.onTick.removeEventListener(this.handleTick)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](s.NgZone),s["\u0275\u0275inject"](Kt),s["\u0275\u0275inject"](r.d))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})();class je{constructor(t,e){this.event=t,this.modifier=e}init(t){return this.observer=C.a.create(e=>{t.setInputAction(t=>{t.position&&(t.startPosition=t.position,t.endPosition=t.position),e.next(t)},this.event,this.modifier)}),this.observer}}let Ne=(()=>{class t extends je{constructor(t,e,i){super(t,e),this.event=t,this.modifier=e,this.eventFactory=i}init(){let e,i;this.event===ue.LONG_LEFT_PRESS?(e=ue.LEFT_DOWN,i=ue.LEFT_UP):this.event===ue.LONG_RIGHT_PRESS?(e=ue.RIGHT_DOWN,i=ue.RIGHT_UP):this.event===ue.LONG_MIDDLE_PRESS&&(e=ue.MIDDLE_DOWN,i=ue.MIDDLE_UP);const r=this.eventFactory.get(e,this.modifier),n=this.eventFactory.get(i,this.modifier);return l()(r.pipe(Object(u.a)(e=>Object(w.a)(e).pipe(Object(p.a)(t.LONG_PRESS_EVENTS_DURATION),Object(d.a)(n)))))}}return t.LONG_PRESS_EVENTS_DURATION=250,t})();var Fe;let Ve=(()=>{let t=Fe=class{constructor(t){this.cesiumService=t,this.cesiumEventsObservables=new Map}static getEventFullName(t,e){return e?`${t}_${e}`:t.toString()}init(){this.eventsHandler=this.cesiumService.getViewer().screenSpaceEventHandler}get(t,e){const i=Fe.getEventFullName(t,e);if(this.cesiumEventsObservables.has(i))return this.cesiumEventsObservables.get(i);{const r=this.createCesiumEventObservable(t,e);return this.cesiumEventsObservables.set(i,r),r}}createCesiumEventObservable(t,e){let i;return i=Fe.longPressEvents.has(t)?this.createSpecialCesiumEventObservable(t,e):l()(new je(t,e).init(this.eventsHandler)),i.connect(),i}createSpecialCesiumEventObservable(t,e){return new Ne(t,e,this).init()}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t.longPressEvents=new Set([ue.LONG_LEFT_PRESS,ue.LONG_RIGHT_PRESS,ue.LONG_MIDDLE_PRESS]),t})(),Be=(()=>{let t=class{constructor(){this._entitesToPlonter=[],this._plonterChangeNotifier=new s.EventEmitter,this._plonterObserver=new c.a}get plonterChangeNotifier(){return this._plonterChangeNotifier}get plonterShown(){return this._plonterShown}get entitesToPlonter(){return this._entitesToPlonter}get plonterClickPosition(){return this._eventResult.movement}plonterIt(t){return this._eventResult=t,this._entitesToPlonter=t.entities,this._plonterShown=!0,this._plonterChangeNotifier.emit(),this._plonterObserver}resolvePlonter(t){this._plonterShown=!1,this._eventResult.entities=[t],this._plonterChangeNotifier.emit(),this._plonterObserver.next(this._eventResult)}};return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),Ke=(()=>{class t{static getDragEventTypes(t){let e,i;return t===ue.LEFT_CLICK_DRAG?(e=ue.LEFT_DOWN,i=ue.LEFT_UP):t===ue.RIGHT_CLICK_DRAG?(e=ue.RIGHT_DOWN,i=ue.RIGHT_UP):t===ue.MIDDLE_CLICK_DRAG&&(e=ue.MIDDLE_DOWN,i=ue.MIDDLE_UP),{mouseDownEvent:e,mouseUpEvent:i}}}return t.dragEvents=new Set([ue.LEFT_CLICK_DRAG,ue.RIGHT_CLICK_DRAG,ue.MIDDLE_CLICK_DRAG]),t})();class ze{constructor(t,e,i,r){this.observable=t,this.stopper=e,this.priority=i,this.isPaused=r}}let Ge=(()=>{let t=class{constructor(t,e,i){this.cesiumService=t,this.eventBuilder=e,this.plonterService=i,this.eventRegistrations=new Map}init(){this.eventBuilder.init(),this.scene=this.cesiumService.getScene()}register(t){if(void 0===this.scene)throw new Error("CesiumService has not been initialized yet - MapEventsManagerService must be injected  under ac-map");if(t.pick=t.pick||pe.NO_PICK,t.priority=t.priority||0,t.pickConfig=t.pickConfig||{},t.entityType&&t.pick===pe.NO_PICK)throw new Error("MapEventsManagerService: can't register an event with entityType and PickOptions.NO_PICK - It doesn't make sense ");const e=Ve.getEventFullName(t.event,t.modifier);this.eventRegistrations.has(e)||this.eventRegistrations.set(e,[]);const i=this.createEventRegistration(t),r=i.observable;return r.dispose=()=>this.disposeObservable(i,e),this.eventRegistrations.get(e).push(i),this.sortRegistrationsByPriority(e),r}disposeObservable(t,e){t.stopper.next(1);const i=this.eventRegistrations.get(e),r=i.indexOf(t);-1!==r&&i.splice(r,1),this.sortRegistrationsByPriority(e)}sortRegistrationsByPriority(t){const e=this.eventRegistrations.get(t);if(e.sort((t,e)=>e.priority-t.priority),0===e.length)return;const i=e[0].priority;e.forEach(t=>{t.isPaused=t.priority<i})}createEventRegistration({event:t,modifier:e,entityType:i,pick:r,priority:n,pickFilter:s,pickConfig:o}){const a=this.eventBuilder.get(t,e),h=new c.a,l=new ze(void 0,h,n,!1);let u;return u=Ke.dragEvents.has(t)?this.createDragEvent({event:t,modifier:e,entityType:i,pick:r,priority:n,pickFilter:s,pickConfig:o}).pipe(Object(d.a)(h)):a.pipe(Object(f.a)(()=>!l.isPaused),Object(v.a)(t=>this.triggerPick(t,r,o)),Object(f.a)(t=>null!==t.cesiumEntities||void 0===i),Object(v.a)(t=>this.addEntities(t,i,r,s)),Object(f.a)(t=>null!==t.entities||void 0===i&&!s),Object(m.a)(t=>this.plonter(t,r)),Object(d.a)(h)),l.observable=u,l}createDragEvent({event:t,modifier:e,entityType:i,pick:r,priority:n,pickFilter:s,pickConfig:o}){const{mouseDownEvent:a,mouseUpEvent:h}=Ke.getDragEventTypes(t),l=this.eventBuilder.get(h),p=this.eventBuilder.get(ue.MOUSE_MOVE),f=this.createEventRegistration({event:a,modifier:e,entityType:i,pick:r,priority:n,pickFilter:s,pickConfig:o}),m=new c.a,C=f.observable.pipe(Object(u.a)(t=>{let e=null;const i=t.movement.startPosition.x,r=t.movement.startPosition.y;return p.pipe(Object(v.a)(n=>(e={movement:{drop:!1,startPosition:{x:i,y:r},endPosition:n.endPosition},entities:t.entities,cesiumEntities:t.cesiumEntities},e)),Object(d.a)(l),Object(y.a)({complete:()=>{if(e){const t=Object.assign({},e);t.movement.drop=!0,m.next(t)}}}))}));return Object(g.a)(C,m)}triggerPick(t,e,i){let r=[];switch(e){case pe.PICK_ONE:case pe.PICK_ALL:r=this.scene.drillPick(t.endPosition,i.drillPickLimit,i.pickWidth,i.pickHeight),r=0===r.length?null:r;break;case pe.PICK_FIRST:const e=this.scene.pick(t.endPosition,i.pickWidth,i.pickHeight);r=void 0===e?null:[e]}return r&&(r=r.map(t=>t.id&&t.id instanceof Cesium.Entity?t.id:t.primitive)),{movement:t,cesiumEntities:r}}addEntities(t,e,i,r){if(null===t.cesiumEntities)return t.entities=null,t;let n=[];return i!==pe.NO_PICK&&(n=e?t.cesiumEntities.map(t=>t.acEntity).filter(t=>t&&t instanceof e):t.cesiumEntities.map(t=>t.acEntity),n=n.reduce((t,e)=>(t.indexOf(e)<0&&t.push(e),t),[]),n=r&&n?n.filter(r):n,0===n.length&&(n=null)),t.entities=n,t}plonter(t,e){return e===pe.PICK_ONE&&null!==t.entities&&t.entities.length>1?this.plonterService.plonterIt(t):Object(w.a)(t)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt),s["\u0275\u0275inject"](Ve),s["\u0275\u0275inject"](Be))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),Ue=(()=>{let t=class{constructor(t){this.cesiumService=t,this.layersDataSources=[]}registerLayerDataSources(t,e){t.forEach(t=>{t.zIndex=e,this.layersDataSources.push(t)})}drawAllLayers(){this.layersDataSources.sort((t,e)=>t.zIndex-e.zIndex),this.layersDataSources.forEach(t=>{this.cesiumService.getViewer().dataSources.add(t)})}updateAndRefresh(t,e){t&&t.length&&(t.forEach(t=>{const i=this.layersDataSources.indexOf(t);-1!==i&&(this.layersDataSources[i].zIndex=e)}),this.cesiumService.getViewer().dataSources.removeAll(),this.drawAllLayers())}removeDataSources(t){t.forEach(t=>{const e=this.layersDataSources.indexOf(t);-1!==e&&(this.layersDataSources.splice(e,1),this.cesiumService.getViewer().dataSources.remove(t,!0))})}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),We=(()=>{let t=class{constructor(){this.defaultIdCounter=0,this._Maps=new Map,this.eventRemoveCallbacks=[]}getMap(t){return t?this._Maps.get(t):this.firstMap}_registerMap(t,e){this.firstMap||(this.firstMap=e);const i=t||this.generateDefaultId();if(this._Maps.has(i))throw new Error(`Map with id: ${i} already exist`);return this._Maps.set(i,e),i}_removeMapById(t){return this._Maps.delete(t)}generateDefaultId(){return this.defaultIdCounter++,"default-map-id-"+this.defaultIdCounter}sync2DMapsCameras(t){this.unsyncMapsCameras();const e=t.map(t=>{const e=this.getMap(t.id);if(!e)throw new Error(`Couldn't find map with id: ${t.id}`);return{map:e,options:{sensitivity:t.sensitivity,bindZoom:t.bindZoom}}});e.forEach(t=>{const i=t.map,r=t.options,n=i.getCameraService().getCamera(),s=n.positionCartographic;n.percentageChanged=r.sensitivity||.01;const o=n.changed.addEventListener(()=>{e.forEach(t=>{const e=t.map,r=t.options;if(e===i)return;const n=e.getCameraService().getCamera(),o=Cesium.Ellipsoid.WGS84.cartographicToCartesian({longitude:s.longitude,latitude:s.latitude,height:r.bindZoom?s.height:n.positionCartographic.height});e.getCesiumViewer().scene.mode!==Cesium.SceneMode.MORPHING&&n.setView({destination:o,orientation:{heading:n.heading,pitch:n.pitch}})})});this.eventRemoveCallbacks.push(o)})}unsyncMapsCameras(){this.eventRemoveCallbacks.forEach(t=>t()),this.eventRemoveCallbacks=[]}};return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),$e=(()=>{let t=class{constructor(t){this.cesiumService=t}getMapScreenshotDataUrlBase64(){return this.cesiumService.getCanvas().toDataURL()}downloadMapScreenshot(t="map.png"){const e=this.getMapScreenshotDataUrlBase64();this.downloadURI(e,t)}downloadURI(t,e){const i=document.createElement("a");i.download=e,i.href=t,document.body.appendChild(i),i.click(),document.body.removeChild(i)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),He=(()=>{let t=class{constructor(t,e,i,r,n,s,o,a,c,h,l,u,p,d,f,v,m,y,g,C){this._cesiumService=t,this._cameraService=e,this._elemRef=i,this.document=r,this.mapsManagerService=n,this.billboardDrawerService=s,this.labelDrawerService=o,this.ellipseDrawerService=a,this.polylineDrawerService=c,this.polygonDrawerService=h,this.arcDrawerService=l,this.pointDrawerService=u,this.czmlDrawerService=p,this.mapEventsManager=d,this.keyboardControlService=f,this.mapLayersService=v,this.configurationService=m,this.screenshotService=y,this.contextMenuService=g,this.coordinateConverter=C,this.disableDefaultPlonter=!1,this.mapContainer=this.document.createElement("div"),this.mapContainer.style.width="100%",this.mapContainer.style.height="100%",this.mapContainer.className="map-container",this._cesiumService.init(this.mapContainer,this),this._cameraService.init(this._cesiumService),this.mapEventsManager.init(),this.billboardDrawerService.init(),this.labelDrawerService.init(),this.ellipseDrawerService.init(),this.polylineDrawerService.init(),this.polygonDrawerService.init(),this.arcDrawerService.init(),this.pointDrawerService.init(),this.czmlDrawerService.init(),this.keyboardControlService.init(),this.contextMenuService.init(this.mapEventsManager)}ngOnInit(){this.mapId=this.mapsManagerService._registerMap(this.mapId,this),this.containerId||this._elemRef.nativeElement.appendChild(this.mapContainer)}ngOnChanges(t){if(t.sceneMode&&this._cameraService.setSceneMode(t.sceneMode.currentValue),t.flyTo&&this._cameraService.cameraFlyTo(t.flyTo.currentValue),t.containerId&&!t.containerId.firstChange){const e=this.document.getElementById(t.containerId.currentValue);if(!e)throw new Error(`No element found with id: ${t.containerId.currentValue}`);e.appendChild(this.mapContainer)}}ngAfterViewInit(){this.mapLayersService.drawAllLayers(),this.containerId&&setTimeout(()=>{const t=this.document.getElementById(this.containerId);if(!t)throw new Error(`No element found with id: ${this.containerId}`);t.appendChild(this.mapContainer)},0)}ngOnDestroy(){this.mapContainer.remove(),this.mapsManagerService._removeMapById(this.mapId)}getCesiumService(){return this._cesiumService}getCesiumViewer(){return this._cesiumService.getViewer()}getCameraService(){return this._cameraService}getId(){return this.mapId}getMapContainer(){return this.mapContainer}getMapEventsManager(){return this.mapEventsManager}getContextMenuService(){return this.contextMenuService}getScreenshotService(){return this.screenshotService}getKeyboardControlService(){return this.keyboardControlService}getCoordinateConverter(){return this.coordinateConverter}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275directiveInject"](Kt),s["\u0275\u0275directiveInject"](le),s["\u0275\u0275directiveInject"](s.ElementRef),s["\u0275\u0275directiveInject"](r.d),s["\u0275\u0275directiveInject"](We),s["\u0275\u0275directiveInject"](_e),s["\u0275\u0275directiveInject"](Ie),s["\u0275\u0275directiveInject"](Se),s["\u0275\u0275directiveInject"](Te),s["\u0275\u0275directiveInject"](Pe),s["\u0275\u0275directiveInject"](we),s["\u0275\u0275directiveInject"](Oe),s["\u0275\u0275directiveInject"](Ee),s["\u0275\u0275directiveInject"](Ge),s["\u0275\u0275directiveInject"](De),s["\u0275\u0275directiveInject"](Ue),s["\u0275\u0275directiveInject"](ae),s["\u0275\u0275directiveInject"]($e),s["\u0275\u0275directiveInject"](de),s["\u0275\u0275directiveInject"](ve))},t.\u0275cmp=s["\u0275\u0275defineComponent"]({type:t,selectors:[["ac-map"]],inputs:{disableDefaultPlonter:"disableDefaultPlonter",mapId:"mapId",flyTo:"flyTo",sceneMode:"sceneMode",containerId:"containerId"},features:[s["\u0275\u0275ProvidersFeature"]([Kt,_e,Ve,De,Ge,Be,Ie,Te,Re,Se,Oe,we,Ee,Pe,Ue,le,$e,de,ve]),s["\u0275\u0275NgOnChangesFeature"]],ngContentSelectors:At,decls:3,vars:1,consts:[[4,"ngIf"]],template:function(t,e){1&t&&(s["\u0275\u0275projectionDef"](),s["\u0275\u0275template"](0,Rt,1,0,"ac-default-plonter",0),s["\u0275\u0275element"](1,"ac-context-menu-wrapper"),s["\u0275\u0275projection"](2)),2&t&&s["\u0275\u0275property"]("ngIf",!e.disableDefaultPlonter)},directives:function(){return[r.m,Ti,Ii]},encapsulation:2}),t})(),qe=(()=>{let t=class{constructor(){this._cache=!0,this.descriptions=[],this.layerUpdate=new s.EventEmitter}get cache(){return this._cache}set cache(t){this._cache=t}get zIndex(){return this._zIndex}set zIndex(t){t!==this._zIndex&&this.layerUpdate.emit(),this._zIndex=t}get show(){return this._show}set show(t){t!==this._show&&this.layerUpdate.emit(),this._show=t}get options(){return this._options}set options(t){this._options=t,this.layerUpdate.emit()}get context(){return this._context}set context(t){this._context=t,this.layerUpdate.emit()}setEntityName(t){this._entityName=t}getEntityName(){return this._entityName}registerDescription(t){this.descriptions.indexOf(t)<0&&this.descriptions.push(t)}unregisterDescription(t){const e=this.descriptions.indexOf(t);e>-1&&this.descriptions.splice(e,1)}getDescriptions(){return this.descriptions}layerUpdates(){return this.layerUpdate}};return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})();var Xe=function(t){return t[t.ADD_UPDATE=0]="ADD_UPDATE",t[t.DELETE=1]="DELETE",t}({});let Ze=(()=>{let t=class{constructor(){this._cache=new Map}get(t,e){if(this._cache.has(t))return this._cache.get(t);const i=e();return this._cache.set(t,i),i}clear(){this._cache.clear()}};return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})();class Ye{static throwIfAnyNotPresent(t,e){e.forEach(e=>Ye.throwIfNotPresent(t,e))}static throwIfNotPresent(t,e){if(!Ye.present(t[e]))throw new Error(`Error: ${e} was not given.`)}static present(t){return null!=t}}let Je=(()=>{let t=class extends ye{constructor(t){super(Cesium.PrimitiveCollection,t)}add(t){return Ye.throwIfAnyNotPresent(t,["center","semiMajorAxis","semiMinorAxis"]),super.add(new x.EllipsePrimitive(t))}update(t,e){return t.updateLocationData(e),t}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),Qe=(()=>{let t=class extends ye{constructor(t){super(Cesium.PolylineCollection,t)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})();class ti extends ye{constructor(t,e){super(Cesium.PrimitiveCollection,e),this.geometryType=t}add(t,e,i){e.geometry=new this.geometryType(t),i.geometryInstances=new Cesium.GeometryInstance(e),i.asynchronous=!1;const r=new Cesium.Primitive(i);return super.add(r)}update(t,e,i,r){return i.geometry=new this.geometryType(e),r.geometryInstances=new Cesium.GeometryInstance(i),this._cesiumCollection.remove(t),super.add(new Cesium.Primitive(r))}}let ei=(()=>{let t=class extends ti{constructor(t){super(Cesium.CircleGeometry,t)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),ii=(()=>{let t=class extends ti{constructor(t){super(Cesium.PolylineGeometry,t)}update(t,e,i,r){const n=i.attributes.color.value;return t.ready?t.getGeometryInstanceAttributes().color=n:Cesium.when(t.readyPromise).then(t=>{t.getGeometryInstanceAttributes().color.value=n}),t}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),ri=(()=>{let t=class extends ti{constructor(t){super(Cesium.PolygonGeometry,t)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),ni=(()=>{let t=class extends ti{constructor(t){super(Cesium.EllipseGeometry,t)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),si=(()=>{let t=class extends xe{constructor(t){super(t,be.model)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),oi=(()=>{let t=class extends xe{constructor(t){super(t,be.box)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),ai=(()=>{let t=class extends xe{constructor(t){super(t,be.corridor)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),ci=(()=>{let t=class extends xe{constructor(t){super(t,be.cylinder)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),hi=(()=>{let t=class extends xe{constructor(t){super(t,be.ellipsoid)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),li=(()=>{let t=class extends xe{constructor(t){super(t,be.polylineVolume)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),ui=(()=>{let t=class extends xe{constructor(t){super(t,be.wall)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),pi=(()=>{let t=class extends xe{constructor(t){super(t,be.rectangle)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),di=(()=>{let t=class extends ye{constructor(t){super(Cesium.LabelCollection,t)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),fi=(()=>{let t=class extends ye{constructor(t){super(Cesium.BillboardCollection,t)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),vi=(()=>{let t=class extends ye{constructor(t){super(Cesium.PointPrimitiveCollection,t)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),mi=(()=>{let t=class extends ye{constructor(t){super(Cesium.HtmlCollection,t),this._cesiumService=t}add(t){return t.scene=this._cesiumService.getScene(),t.mapContainer=this._cesiumService.getMap().getMapContainer(),super.add(t)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Kt))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),yi=(()=>{let t=class{constructor(t,e,i,r,n,s,o,a,h,l,u,p,d,f,v,m,y,g,C,w,b,M,x,_,E,S,I,O,P,T){this.layerService=t,this._computationCache=e,this.mapLayersService=i,this.show=!0,this.store=!1,this.zIndex=0,this.debug=!1,this.acForRgx=/^let\s+.+\s+of\s+.+$/,this.stopObservable=new c.a,this._updateStream=new c.a,this.entitiesStore=new Map,this.layerDrawerDataSources=[],this._drawerList=new Map([["billboard",r],["label",n],["ellipse",s],["polyline",o],["polygon",a],["arc",h],["point",l],["model",u],["box",p],["corridor",d],["cylinder",f],["ellipsoid",v],["polylineVolume",m],["rectangle",g],["wall",y],["polylinePrimitive",E],["labelPrimitive",S],["billboardPrimitive",I],["pointPrimitive",O],["html",P],["czml",T],["dynamicEllipse",C],["dynamicPolyline",w],["staticCircle",b],["staticPolyline",M],["staticPolygon",x],["staticEllipse",_]])}init(){this.initValidParams(),Object(g.a)(this._updateStream,this.observable).pipe(Object(d.a)(this.stopObservable)).subscribe(t=>{this._computationCache.clear(),this.debug&&console.log("AcLayer received notification:",t);let e=t.entity;this.store&&(e=this.updateStore(t)),this.context[this.entityName]=e,this.layerService.getDescriptions().forEach(i=>{switch(t.actionType){case Xe.ADD_UPDATE:i.draw(this.context,t.id,e);break;case Xe.DELETE:i.remove(t.id);break;default:console.error("[ac-layer] unknown AcNotification.actionType for notification: "+t)}})})}updateStore(t){if(t.actionType!==Xe.DELETE){if(this.entitiesStore.has(t.id)){const e=this.entitiesStore.get(t.id);return Object.assign(e,t.entity),e}return this.entitiesStore.set(t.id,t.entity),t.entity}this.entitiesStore.delete(t.id)}initValidParams(){if(!this.context)throw new Error("ac-layer: must initialize [context] ");if(!this.acForRgx.test(this.acFor))throw new Error(`ac-layer: Invalid [acFor] syntax. Expected: [acFor]="let item of observable" .Instead received: ${this.acFor}`);const t=this.acFor.split(" ");if(this.observable=this.context[t[3]],this.entityName=t[1],!this.isObservable(this.observable))throw new Error("ac-layer: must initailize [acFor] with rx observable, instead received: "+this.observable);this.layerService.context=this.context,this.layerService.setEntityName(this.entityName)}isObservable(t){return t&&"function"==typeof t.subscribe}ngAfterContentInit(){this.init()}ngOnInit(){this.layerService.context=this.context,this.layerService.options=this.options,this.layerService.show=this.show,this.layerService.zIndex=this.zIndex,this._drawerList.forEach((t,e)=>{const i=t.init(this.options?this.options[e]:void 0);i&&this.layerDrawerDataSources.push(...i),t.setShow(this.show)})}ngOnChanges(t){if(t.show&&!t.show.firstChange){const e=t.show.currentValue;this.layerService.show=e,this._drawerList.forEach(t=>t.setShow(e))}if(t.zIndex&&!t.zIndex.firstChange){const e=t.zIndex.currentValue;this.layerService.zIndex=e,this.mapLayersService.updateAndRefresh(this.layerDrawerDataSources,e)}}ngOnDestroy(){this.mapLayersService.removeDataSources(this.layerDrawerDataSources),this.stopObservable.next(!0),this.removeAll()}getLayerService(){return this.layerService}getLayerDrawerDataSources(){return this.layerDrawerDataSources}getDrawerDataSourcesByName(t){return this.layerDrawerDataSources.filter(e=>e.name===t)}getStore(){return this.entitiesStore}removeAll(){this.layerService.getDescriptions().forEach(t=>t.removeAll()),this.entitiesStore.clear()}remove(t){this._updateStream.next({id:t,actionType:Xe.DELETE}),this.entitiesStore.delete(t)}updateNotification(t){this._updateStream.next(t)}update(t,e){this._updateStream.next({entity:t,id:e,actionType:Xe.ADD_UPDATE})}refreshAll(t){Object(b.a)(t).subscribe(t=>this._updateStream.next(t))}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275directiveInject"](qe),s["\u0275\u0275directiveInject"](Ze),s["\u0275\u0275directiveInject"](Ue),s["\u0275\u0275directiveInject"](_e),s["\u0275\u0275directiveInject"](Ie),s["\u0275\u0275directiveInject"](Se),s["\u0275\u0275directiveInject"](Te),s["\u0275\u0275directiveInject"](Pe),s["\u0275\u0275directiveInject"](we),s["\u0275\u0275directiveInject"](Oe),s["\u0275\u0275directiveInject"](si),s["\u0275\u0275directiveInject"](oi),s["\u0275\u0275directiveInject"](ai),s["\u0275\u0275directiveInject"](ci),s["\u0275\u0275directiveInject"](hi),s["\u0275\u0275directiveInject"](li),s["\u0275\u0275directiveInject"](ui),s["\u0275\u0275directiveInject"](pi),s["\u0275\u0275directiveInject"](Je),s["\u0275\u0275directiveInject"](Qe),s["\u0275\u0275directiveInject"](ei),s["\u0275\u0275directiveInject"](ii),s["\u0275\u0275directiveInject"](ri),s["\u0275\u0275directiveInject"](ni),s["\u0275\u0275directiveInject"](Re),s["\u0275\u0275directiveInject"](di),s["\u0275\u0275directiveInject"](fi),s["\u0275\u0275directiveInject"](vi),s["\u0275\u0275directiveInject"](mi),s["\u0275\u0275directiveInject"](Ee))},t.\u0275cmp=s["\u0275\u0275defineComponent"]({type:t,selectors:[["ac-layer"]],inputs:{show:"show",store:"store",zIndex:"zIndex",debug:"debug",acFor:"acFor",context:"context",options:"options"},features:[s["\u0275\u0275ProvidersFeature"]([qe,Ze,_e,Ie,Se,Te,we,Oe,Pe,si,oi,ai,ci,hi,li,ui,pi,Re,di,fi,vi,mi,Ee,Je,Qe,ei,ii,ri,ni]),s["\u0275\u0275NgOnChangesFeature"]],ngContentSelectors:At,decls:1,vars:0,template:function(t,e){1&t&&(s["\u0275\u0275projectionDef"](),s["\u0275\u0275projection"](0))},encapsulation:2,changeDetection:0}),t})(),gi=(()=>{let t=class{constructor(){this._mapper=new _.JsonStringMapper}map(t){return this._mapper.map(t)}};return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),Ci=(()=>{let t=class{constructor(t,e){this._parser=t,this._jsonMapper=e,this._assignersCache=new Map,this._evaluatorsCache=new Map}_compile(t,e=!0){const i={},r=new Map;this._jsonMapper.map(t).forEach((t,e)=>r.set(e,{expression:t,get:this._parser.eval(t)})),r.forEach((t,r)=>{i[r||"undefined"]=e?`cache.get(\`${t.expression}\`, () => propsMap.get('${r}').get(context))`:`propsMap.get('${r}').get(context)`});const n=`return ${JSON.stringify(i).replace(/"/g,"")};`,s=new Function("propsMap","cache","context",n);return function(t,e){return s(r,t,e)}}_build(t){const e=Array.from(this._jsonMapper.map(t).keys()),i=class{static create(t=[],e=!0){let i="";t.forEach(t=>{i+=e?`if(!(obj1['${t}'] instanceof Cesium.CallbackProperty))obj1['${t}'] = obj2['${t}']; `:`if (!(obj1['${t}'] instanceof Cesium.CallbackProperty) && obj2['${t}'] !== undefined) { obj1['${t}'] = obj2['${t}']; } `}),i+="return obj1";const r=new Function("obj1","obj2",i);return function(t,e){return r(t,e)}}}.create(e);return function(t,e){return i(t,e)}}createEvaluator(t,e=!0,i=!1){if(!i&&this._evaluatorsCache.has(t))return this._evaluatorsCache.get(t);const r=this._compile(t,e);return this._evaluatorsCache.set(t,r),r}createAssigner(t){if(this._assignersCache.has(t))return this._assignersCache.get(t);const e=this._build(t);return this._assignersCache.set(t,e),e}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Ot),s["\u0275\u0275inject"](gi))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})(),wi=(()=>{let t=class{constructor(t,e,i,r){this._drawer=t,this._layerService=e,this._computationCache=i,this._cesiumProperties=r,this.onDraw=new s.EventEmitter,this.onRemove=new s.EventEmitter,this._cesiumObjectsMap=new Map}_propsEvaluator(t){return this._propsEvaluateFn(this._computationCache,t)}_getPropsAssigner(){return(t,e)=>this._propsAssignerFn(t,e)}getLayerService(){return this._layerService}setLayerService(t){this._layerService.unregisterDescription(this),this._layerService=t,this._layerService.registerDescription(this),this._propsEvaluateFn=this._cesiumProperties.createEvaluator(this.props,this._layerService.cache,!0),this._propsAssignerFn=this._cesiumProperties.createAssigner(this.props)}ngOnInit(){this.props||console.error("ac-desc components error: [props] input is mandatory"),this._layerService.registerDescription(this),this._propsEvaluateFn=this._cesiumProperties.createEvaluator(this.props,this._layerService.cache),this._propsAssignerFn=this._cesiumProperties.createAssigner(this.props)}getCesiumObjectsMap(){return this._cesiumObjectsMap}draw(t,e,i){const r=this._propsEvaluator(t);if(this._cesiumObjectsMap.has(e)){const t=this._cesiumObjectsMap.get(e);this.onDraw.emit({acEntity:i,cesiumEntity:t,entityId:e}),t.acEntity=i,this._drawer.setPropsAssigner(this._getPropsAssigner()),this._drawer.update(t,r)}else{const t=this._drawer.add(r);this.onDraw.emit({acEntity:i,cesiumEntity:t,entityId:e}),t.acEntity=i,this._cesiumObjectsMap.set(e,t)}}remove(t){const e=this._cesiumObjectsMap.get(t);e&&(this.onRemove.emit({acEntity:e.acEntity,cesiumEntity:e,entityId:t}),this._drawer.remove(e),this._cesiumObjectsMap.delete(t))}removeAll(){this._cesiumObjectsMap.clear(),this._drawer.removeAll()}ngOnDestroy(){this._layerService.unregisterDescription(this),this.removeAll()}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275directiveInject"](me),s["\u0275\u0275directiveInject"](qe),s["\u0275\u0275directiveInject"](Ze),s["\u0275\u0275directiveInject"](Ci))},t.\u0275dir=s["\u0275\u0275defineDirective"]({type:t,inputs:{props:"props"},outputs:{onDraw:"onDraw",onRemove:"onRemove"}}),t})(),bi=(()=>{let t=class{transform(t,e){return new Cesium.Cartesian2(t[0],t[1])}};return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=s["\u0275\u0275definePipe"]({name:"pixelOffset",type:t,pure:!0}),t})(),Mi=(()=>{let t=class{transform(t,e){return(360-Math.round(180*t/Math.PI))%360}};return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=s["\u0275\u0275definePipe"]({name:"radiansToDegrees",type:t,pure:!0}),t})(),xi=(()=>{let t=class{};return t.\u0275mod=s["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=s["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},providers:[],imports:[[r.c]]}),t})();var _i=function(t){return t[t.ArcGisMapServer=Cesium.ArcGisMapServerImageryProvider]="ArcGisMapServer",t[t.WebMapTileService=Cesium.WebMapTileServiceImageryProvider]="WebMapTileService",t[t.MapTileService=Cesium.TileMapServiceImageryProvider]="MapTileService",t[t.WebMapService=Cesium.WebMapServiceImageryProvider]="WebMapService",t[t.SingleTileImagery=Cesium.SingleTileImageryProvider]="SingleTileImagery",t[t.OpenStreetMap=Cesium.OpenStreetMapImageryProvider]="OpenStreetMap",t[t.BingMaps=Cesium.BingMapsImageryProvider]="BingMaps",t[t.GoogleEarthEnterpriseMaps=Cesium.GoogleEarthEnterpriseMapsProvider]="GoogleEarthEnterpriseMaps",t[t.MapBox=Cesium.MapboxImageryProvider]="MapBox",t[t.UrlTemplateImagery=Cesium.UrlTemplateImageryProvider]="UrlTemplateImagery",t[t.OFFLINE=null]="OFFLINE",t}({});let Ei=(()=>{let t=class{constructor(t){this.cesiumService=t,this.options={},this.provider=_i.OFFLINE,this.show=!0,this.alpha=1,this.brightness=1,this.contrast=1,this.imageryLayersCollection=this.cesiumService.getScene().imageryLayers}createOfflineMapProvider(){return Cesium.createTileMapServiceImageryProvider({url:Cesium.buildModuleUrl("Assets/Textures/NaturalEarthII")})}ngOnInit(){if(!Ye.present(this.options.url)&&this.provider!==_i.OFFLINE)throw new Error("options must have a url");switch(this.provider){case _i.WebMapService:case _i.WebMapTileService:case _i.ArcGisMapServer:case _i.SingleTileImagery:case _i.BingMaps:case _i.GoogleEarthEnterpriseMaps:case _i.MapBox:case _i.UrlTemplateImagery:case _i.MapTileService:case _i.OpenStreetMap:this.layerProvider=new this.provider(this.options);break;case _i.OFFLINE:this.layerProvider=this.createOfflineMapProvider();break;default:console.log("ac-map-layer-provider: [provider] wasn't found. setting OFFLINE provider as default"),this.layerProvider=this.createOfflineMapProvider()}this.show&&(this.imageryLayer=this.imageryLayersCollection.addImageryProvider(this.layerProvider,this.index),this.imageryLayer.alpha=this.alpha,this.imageryLayer.contrast=this.contrast,this.imageryLayer.brightness=this.brightness)}ngOnChanges(t){t.show&&!t.show.isFirstChange()&&(t.show.currentValue?this.imageryLayer?this.imageryLayersCollection.add(this.imageryLayer,this.index):(this.imageryLayer=this.imageryLayersCollection.addImageryProvider(this.layerProvider,this.index),this.imageryLayer.alpha=this.alpha,this.imageryLayer.contrast=this.contrast,this.imageryLayer.brightness=this.brightness):this.imageryLayer&&this.imageryLayersCollection.remove(this.imageryLayer,!1)),t.alpha&&!t.alpha.isFirstChange()&&this.imageryLayer&&(this.imageryLayer.alpha=this.alpha),t.contrast&&!t.contrast.isFirstChange()&&this.imageryLayer&&(this.imageryLayer.contrast=this.contrast),t.brightness&&!t.brightness.isFirstChange()&&this.imageryLayer&&(this.imageryLayer.brightness=this.brightness)}ngOnDestroy(){this.imageryLayer&&this.imageryLayersCollection.remove(this.imageryLayer,!0)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275directiveInject"](Kt))},t.\u0275cmp=s["\u0275\u0275defineComponent"]({type:t,selectors:[["ac-map-layer-provider"]],inputs:{options:"options",provider:"provider",show:"show",alpha:"alpha",brightness:"brightness",contrast:"contrast",index:"index"},features:[s["\u0275\u0275NgOnChangesFeature"]],decls:0,vars:0,template:function(t,e){},encapsulation:2}),t})(),Si=(()=>{let t=class{constructor(t,e,i){this.cesiumService=t,this.elementRef=e,this.renderer=i,this.isDraw=!1}setScreenPosition(t){t&&(this.renderer.setStyle(this.elementRef.nativeElement,"top",`${t.y}px`),this.renderer.setStyle(this.elementRef.nativeElement,"left",`${t.x}px`))}ngOnInit(){this.cesiumService.getMap().getMapContainer().appendChild(this.elementRef.nativeElement),!1===this.props.show&&this.hideElement()}remove(){this.isDraw&&(this.isDraw=!1,this.cesiumService.getScene().preRender.removeEventListener(this.preRenderEventListener),this.hideElement())}hideElement(){this.renderer.setStyle(this.elementRef.nativeElement,"display","none")}add(){this.isDraw||(this.isDraw=!0,this.preRenderEventListener=()=>{const t=Cesium.SceneTransforms.wgs84ToWindowCoordinates(this.cesiumService.getScene(),this.props.position);this.setScreenPosition(t)},this.renderer.setStyle(this.elementRef.nativeElement,"display","block"),this.cesiumService.getScene().preRender.addEventListener(this.preRenderEventListener))}ngDoCheck(){void 0===this.props.show||this.props.show?this.add():this.remove()}ngOnDestroy(){this.remove()}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275directiveInject"](Kt),s["\u0275\u0275directiveInject"](s.ElementRef),s["\u0275\u0275directiveInject"](s.Renderer2))},t.\u0275cmp=s["\u0275\u0275defineComponent"]({type:t,selectors:[["ac-html"]],inputs:{props:"props"},ngContentSelectors:At,decls:1,vars:0,template:function(t,e){1&t&&(s["\u0275\u0275projectionDef"](),s["\u0275\u0275projection"](0))},styles:["[_nghost-%COMP%] {\n                position: absolute;\n                z-index: 100;\n\t\t\t\t}"]}),t})(),Ii=(()=>{let t=class{constructor(t,e,i){this.plonterService=t,this.cd=e,this.geoConverter=i}ngOnInit(){this.plonterService.plonterChangeNotifier.subscribe(()=>this.cd.detectChanges())}get plonterPosition(){if(this.plonterService.plonterShown)return this.geoConverter.screenToCartesian3(this.plonterService.plonterClickPosition.endPosition)}chooseEntity(t){this.plonterService.resolvePlonter(t)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275directiveInject"](Be),s["\u0275\u0275directiveInject"](s.ChangeDetectorRef),s["\u0275\u0275directiveInject"](ve))},t.\u0275cmp=s["\u0275\u0275defineComponent"]({type:t,selectors:[["ac-default-plonter"]],features:[s["\u0275\u0275ProvidersFeature"]([ve])],decls:1,vars:1,consts:[[3,"props",4,"ngIf"],[3,"props"],[1,"plonter-context-menu"],[4,"ngFor","ngForOf"],[1,"plonter-item",3,"click"]],template:function(t,e){1&t&&s["\u0275\u0275template"](0,Dt,3,4,"ac-html",0),2&t&&s["\u0275\u0275property"]("ngIf",e.plonterService.plonterShown)},directives:[r.m,Si,r.l],styles:[".plonter-context-menu[_ngcontent-%COMP%] {\n            background-color: rgba(250, 250, 250, 0.8);\n            box-shadow: 1px 1px 5px 0px rgba(0, 0, 0, 0.15);\n        }\n\n        .plonter-item[_ngcontent-%COMP%] {\n            cursor: pointer;\n            padding: 2px 15px;\n            text-align: start;\n        }\n\n        .plonter-item[_ngcontent-%COMP%]:hover {\n            background-color: rgba(0, 0, 0, 0.15);\n        }"],changeDetection:0}),t})();class Oi{constructor(t,e=null){if("object"!=typeof t)throw new Error("HtmlPrimitive ERROR: invalid html options!");this.scene=t.scene,this._mapContainer=t.mapContainer,this.show=t.show||!0,this.position=t.position,this.pixelOffset=t.pixelOffset,this.element=t.element,this.collection=e}set scene(t){this._scene=t}set show(t){this._show=t,Cesium.defined(this.element)&&(this._element.style.display=t?"block":"none")}get show(){return this._show}set position(t){this._position=t}get position(){return this._position}set pixelOffset(t){this._pixelOffset=t}get pixelOffset(){return this._pixelOffset}set element(t){this._element=t,Cesium.defined(t)&&(this._mapContainer.appendChild(t),this._element.style.position="absolute",this._element.style.zIndex=Number.MAX_VALUE.toString())}get element(){return this._element}set collection(t){this._collection=t}get collection(){return this._collection}update(){if(!Cesium.defined(this._show)||!Cesium.defined(this._element))return;let t=Cesium.SceneTransforms.wgs84ToWindowCoordinates(this._scene,this._position);Cesium.defined(t)?Cesium.defined(this._pixelOffset)&&Cesium.defined(this._pixelOffset.x)&&Cesium.defined(this._pixelOffset.y)&&(t.y+=this._pixelOffset.y,t.x+=this._pixelOffset.x):t=new Cesium.Cartesian2(-1e3,-1e3),this._lastPosition&&this._lastPosition.equals(t)||(this._element.style.top=`${t.y}px`,this._element.style.left=`${t.x}px`,this._lastPosition=t)}remove(){this._element&&this._element.remove()}}class Pi{constructor(){this._collection=[]}get length(){return this._collection.length}get(t){return this._collection[t]}add(t){const e=new Oi(t,this);return this._collection.push(e),e}remove(t){const e=this._collection.indexOf(t);return-1!==e&&(this._collection[e].remove(),this._collection.splice(e,1),!0)}update(){for(let t=0,e=this._collection.length;t<e;t++)this._collection[t].update()}removeAll(){for(;this._collection.length>0;)this._collection.pop().remove()}contains(t){return Cesium.defined(t)&&t.collection===this}destroy(){this.removeAll()}}let Ti=(()=>{let t=class{constructor(t,e,i){this.contextMenuService=t,this.cd=e,this.componentFactoryResolver=i}ngOnInit(){this.contextMenuChangeSubscription=this.contextMenuService.contextMenuChangeNotifier.subscribe(()=>this.cd.detectChanges()),this.contextMenuOpenSubscription=this.contextMenuService.onOpen.subscribe(()=>{const t=this.componentFactoryResolver.resolveComponentFactory(this.contextMenuService.content);this.viewContainerRef.clear(),this.viewContainerRef.createComponent(t).instance.data=this.contextMenuService.options.data,this.cd.detectChanges()})}ngOnDestroy(){this.contextMenuChangeSubscription&&this.contextMenuChangeSubscription.unsubscribe(),this.contextMenuOpenSubscription&&this.contextMenuOpenSubscription.unsubscribe()}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275directiveInject"](de),s["\u0275\u0275directiveInject"](s.ChangeDetectorRef),s["\u0275\u0275directiveInject"](s.ComponentFactoryResolver))},t.\u0275cmp=s["\u0275\u0275defineComponent"]({type:t,selectors:[["ac-context-menu-wrapper"]],viewQuery:function(t,e){var i;1&t&&s["\u0275\u0275viewQuery"](jt,!0,s.ViewContainerRef),2&t&&s["\u0275\u0275queryRefresh"](i=s["\u0275\u0275loadQuery"]())&&(e.viewContainerRef=i.first)},decls:1,vars:1,consts:[[3,"props",4,"ngIf"],[3,"props"],["contextMenuContainer",""]],template:function(t,e){1&t&&s["\u0275\u0275template"](0,Ft,3,3,"ac-html",0),2&t&&s["\u0275\u0275property"]("ngIf",e.contextMenuService.showContextMenu)},directives:[r.m,Si],encapsulation:2,changeDetection:0}),t})();var Ri=[{pipeName:"pixelOffset",pipeInstance:new bi},{pipeName:"radiansToDegrees",pipeInstance:new Mi}];let Ai=(()=>{let t=class extends wi{constructor(t,e,i,r){super(t,e,i,r)}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275directiveInject"](Ee),s["\u0275\u0275directiveInject"](qe),s["\u0275\u0275directiveInject"](Ze),s["\u0275\u0275directiveInject"](Ci))},t.\u0275cmp=s["\u0275\u0275defineComponent"]({type:t,selectors:[["ac-czml-desc"]],features:[s["\u0275\u0275InheritDefinitionFeature"]],decls:0,vars:0,template:function(t,e){},encapsulation:2}),t})();var ki;let Li=(()=>{let t=ki=class{static forRoot(t){return{ngModule:ki,providers:[gi,Ci,Ce,Vt,We,ae,{provide:oe,useValue:t},{provide:It,multi:!0,useValue:t&&t.customPipes||[]},{provide:It,multi:!0,useValue:Ri}]}}constructor(){(class{static extend(){Cesium.HtmlPrimitive=Oi,Cesium.HtmlCollection=Pi}}).extend()}};return t.\u0275mod=s["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=s["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},imports:[[r.c,Tt,xi]]}),t})();Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium;let Di=(()=>{let t=class{constructor(t,e){this.document=t,this.mapsManager=e,this.mainSubject=new c.a}setCoordinateConverter(t){this.coordinateConverter=t}drag(t,e){if(!this.coordinateConverter){const t=this.mapsManager.getMap();t&&(this.coordinateConverter=t.getCoordinateConverter())}this.cancel();const i=document.createElement("img");i.src=t,i.style.position="fixed",i.style.visibility="hidden",i.style.width="30px",i.style.height="30px",i.style["user-drag"]="none",i.style["user-select"]="none",i.style["-moz-user-select"]="none",i.style["-webkit-user-drag"]="none",i.style["-webkit-user-select"]="none",i.style["-ms-user-select"]="none",Object.assign(i.style,e),document.body.appendChild(i),this.createDragObservable(),this.dragObservable.subscribe(t=>{i.style.visibility="visible",i.style.left=t.screenPosition.x-i.clientWidth/2+"px",i.style.top=t.screenPosition.y-i.clientHeight/2+"px",this.mainSubject.next(t),t.drop&&i.remove()},t=>{i.remove()},()=>{i.remove()})}dragUpdates(){return this.mainSubject}cancel(){this.stopper&&(this.stopper.next(!0),this.stopper=void 0,this.dragObservable=void 0)}createDragObservable(){const t=new c.a,e=new c.a,i=Object(M.a)(document,"pointerup");let r,n,s;const o=Object(M.a)(document,"pointermove").pipe(Object(v.a)(t=>(r=r||t.x,n=n||t.y,s={drop:!1,initialScreenPosition:{x:r,y:n},screenPosition:{x:t.x,y:t.y},mapPosition:this.coordinateConverter?this.coordinateConverter.screenToCartesian3({x:t.x,y:t.y}):void 0},s)),Object(d.a)(i),Object(y.a)(void 0,void 0,()=>{if(s){const t=Object.assign({},s);t.drop=!0,e.next(t)}}));this.dragObservable=o.pipe(function(...t){return e=>e.lift.call(Object(g.a)(e,...t))}(e),Object(d.a)(t)),this.stopper=t}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](r.d),s["\u0275\u0275inject"](We))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})();var ji=function(t){return t[t.LEFT=0]="LEFT",t[t.MIDDLE=1]="MIDDLE",t[t.RIGHT=2]="RIGHT",t}({});let Ni=(()=>{let t=class{constructor(t,e,i){this.mapsManager=t,this.mapsZoomElements=new Map,this.defaultOptions={animationDurationInSeconds:.5,resetKeyCode:27,borderStyle:"2px solid rgba(0,0,0,0.5)",backgroundColor:"rgba(0,0,0,0.2)",autoDisableOnZoom:!0,threshold:9,keepRotation:!0,mouseButton:ji.LEFT}}init(t,e){this.cameraService=e,this.cesiumService=t}activate(t={},e){if(!(this.cameraService&&this.cesiumService||e))throw new Error("The function must receive a mapId if the service wasn't initialized");const i=Object.assign({},this.defaultOptions,t);let r,n,s=this.cameraService;if(this.cesiumService&&(r=this.cesiumService.getViewer().container,n=this.cesiumService.getMap()),e){if(n=this.mapsManager.getMap(e),!n)throw new Error(`Map not found with id: ${e}`);s=n.getCameraService(),r=n.getCesiumViewer().container}if(!s||!r)throw new Error("The function must receive a mapId if the service wasn't initialized");this.disable(e);const o=document.createElement("div");r.style.position="relative",o.style.position="absolute",o.style.width="100%",o.style.height="100%",o.style.top="0",o.style.left="0",r.appendChild(o);const a={container:o};this.mapsZoomElements.set(e||this.cesiumService.getMap().getId(),a);let c,h={endX:0,endY:0,startX:0,startY:0};o.onmousedown=e=>{if(e.button===i.mouseButton&&!c){t&&t.onStart&&t.onStart(n);const r=e.currentTarget.getBoundingClientRect(),s=e.clientY-r.top;h.startX=e.clientX-r.left,h.startY=s,c=document.createElement("div"),c.className="zoom-to-rectangle-border",c.style.position="absolute",c.style.border=i.borderStyle,c.style.backgroundColor=i.backgroundColor,c.style.left=h.startX+"px",c.style.top=h.startY+"px",o.appendChild(c),a.borderElement=c}},o.onmouseup=t=>{if(c){let t;h&&Math.abs(h.endX-h.startX)*Math.abs(h.endY-h.startY)>i.threshold&&(t=this.zoomCameraToRectangle(s,h,i.animationDurationInSeconds,i)),c.remove(),c=void 0,a.borderElement=void 0,h={endX:0,endY:0,startX:0,startY:0},i.onComplete&&i.onComplete(n),i.autoDisableOnZoom&&t&&this.disable(e)}},o.onmousemove=t=>{if(c){const e=t.currentTarget.getBoundingClientRect(),i=t.clientY-e.top;h.endX=t.clientX-e.left,h.endY=i,c.style.width=Math.abs(h.endX-h.startX)+"px",c.style.height=Math.abs(h.endY-h.startY)+"px",c.style.left=Math.min(h.startX,h.endX)+"px",c.style.top=Math.min(h.startY,h.endY)+"px"}};const l=t=>{t.keyCode===i.resetKeyCode&&c&&(c.remove(),c=void 0,a.borderElement=void 0,h={endX:0,endY:0,startX:0,startY:0})};document.addEventListener("keydown",l),a.resetOnEscapePressFunc=l}disable(t){if(!this.cesiumService&&!t)throw new Error("If the service was not initialized with CesiumService, mapId must be provided");const e=this.mapsZoomElements.get(t||this.cesiumService.getMap().getId());e&&(e.container.remove(),e.borderElement&&e.borderElement.remove(),e.resetOnEscapePressFunc&&document.removeEventListener("keydown",e.resetOnEscapePressFunc)),this.mapsZoomElements.delete(t)}zoomCameraToRectangle(t,e,i,r){const n=t.getCamera(),s=n.pickEllipsoid({x:e.startX,y:e.startY}),o=n.pickEllipsoid({x:e.endX,y:e.endY});if(!s||!o)return!1;const a=Cesium.Cartographic.fromCartesian(s),c=Cesium.Cartographic.fromCartesian(o);return t.cameraFlyTo({destination:new Cesium.Rectangle(Math.min(a.longitude,c.longitude),Math.min(a.latitude,c.latitude),Math.max(a.longitude,c.longitude),Math.max(a.latitude,c.latitude)),orientation:r.keepRotation?{heading:n.heading}:void 0,duration:i}),!0}};return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](We),s["\u0275\u0275inject"](le,8),s["\u0275\u0275inject"](Kt,8))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac}),t})();Cesium,Cesium,Cesium;let Fi=(()=>{let t=class{};return t.\u0275mod=s["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=s["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},providers:[Di,Ni],imports:[[r.c,Li]]}),t})();var Vi=i("tk/3"),Bi=i("JIr8"),Ki=i("aceb");new Vi.d({"Content-Type":"application/json"});let zi=(()=>{class t{constructor(t,e){this.http=t,this.toastrService=e}extractData(t){return t||{}}handleError(t="operation",e){return t=>(this.dangerToast("top-right","danger",t.statusText,t.status),Object(w.a)(e))}returnFalse(t="operation",e){return Object(w.a)(e)}getMapLayers(){return this.http.get("https://solmm01.fmg.local/api/map/layers").pipe(Object(v.a)(this.extractData),Object(Bi.a)(this.handleError("failed")))}dangerToast(t,e,i,r){this.toastRef=this.toastrService.show("API call error - "+r+": "+i,"Failed",{position:t,status:e,preventDuplicates:!0,duration:0}),this.toastRef&&(this.tempToast=this.toastRef),this.delay&&clearTimeout(this.delay),this.delay=setTimeout(()=>{this.clearToast(this.tempToast)},5500)}successToast(t,e,i,r){this.toastrService.show("API call error - "+r+": "+i,"Failed",{position:t,status:e,preventDuplicates:!0})}clearToast(t){t&&t.close()}}return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Vi.a),s["\u0275\u0275inject"](Ki.ob))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Gi=i("lWTH");function Ui(t,e){if(1&t){const t=s["\u0275\u0275getCurrentView"]();s["\u0275\u0275elementStart"](0,"nb-card"),s["\u0275\u0275elementStart"](1,"nb-card-body"),s["\u0275\u0275elementStart"](2,"div",4),s["\u0275\u0275elementStart"](3,"nb-checkbox",5),s["\u0275\u0275listener"]("checkedChange",(function(e){return s["\u0275\u0275restoreView"](t),s["\u0275\u0275nextContext"]().toggle("sky",e)})),s["\u0275\u0275text"](4,"Sky Base Globe"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](5,"div",4),s["\u0275\u0275elementStart"](6,"nb-checkbox",5),s["\u0275\u0275listener"]("checkedChange",(function(e){return s["\u0275\u0275restoreView"](t),s["\u0275\u0275nextContext"]().toggle("tetra",e)})),s["\u0275\u0275text"](7,"Tetra Positions"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](8,"div",4),s["\u0275\u0275elementStart"](9,"nb-checkbox",5),s["\u0275\u0275listener"]("checkedChange",(function(e){return s["\u0275\u0275restoreView"](t),s["\u0275\u0275nextContext"]().toggle("nams",e)})),s["\u0275\u0275text"](10,"Minestar NAMs"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](11,"div",4),s["\u0275\u0275elementStart"](12,"nb-checkbox",5),s["\u0275\u0275listener"]("checkedChange",(function(e){return s["\u0275\u0275restoreView"](t),s["\u0275\u0275nextContext"]().toggle("lanes",e)})),s["\u0275\u0275text"](13,"Minestar Lanes"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](14,"div",4),s["\u0275\u0275elementStart"](15,"nb-checkbox",5),s["\u0275\u0275listener"]("checkedChange",(function(e){return s["\u0275\u0275restoreView"](t),s["\u0275\u0275nextContext"]().toggle("zones",e)})),s["\u0275\u0275text"](16,"Minestar Zones"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementStart"](17,"div",4),s["\u0275\u0275elementStart"](18,"nb-checkbox",5),s["\u0275\u0275listener"]("checkedChange",(function(e){return s["\u0275\u0275restoreView"](t),s["\u0275\u0275nextContext"]().toggle("blocks",e)})),s["\u0275\u0275text"](19,"Minestar Grade Blocks"),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()}if(2&t){const t=s["\u0275\u0275nextContext"]();s["\u0275\u0275advance"](3),s["\u0275\u0275property"]("checked",t.sky),s["\u0275\u0275advance"](3),s["\u0275\u0275property"]("checked",t.tetra),s["\u0275\u0275advance"](3),s["\u0275\u0275property"]("checked",t.nams),s["\u0275\u0275advance"](3),s["\u0275\u0275property"]("checked",t.lanes),s["\u0275\u0275advance"](3),s["\u0275\u0275property"]("checked",t.zones),s["\u0275\u0275advance"](3),s["\u0275\u0275property"]("checked",t.blocks)}}let Wi=(()=>{class t{constructor(t){this.mapsManagerService=t,this.tetra=!0,this.nams=!0,this.lanes=!0,this.zones=!0,this.blocks=!0,this.sky=!0}ngOnInit(){this.viewer=this.mapsManagerService.getMap().getCesiumViewer(),this.layers=this.viewer.imageryLayers}toggle(t,e){console.log(t+" "+e),"tetra"==t&&(this.tetra=e,this.viewer.dataSources.getByName("Tetra CZML data")[0].show=e),"nams"==t&&(this.nams=e,this.layers._layers[5].show=e),"lanes"==t&&(this.lanes=e,this.layers._layers[3].show=e),"zones"==t&&(this.zones=e,this.layers._layers[4].show=e),"blocks"==t&&(this.blocks=e,this.layers._layers[2].show=e),"sky"==t&&(this.sky=e,this.layers._layers[1].show=e)}}return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275directiveInject"](We))},t.\u0275cmp=s["\u0275\u0275defineComponent"]({type:t,selectors:[["map-options"]],decls:5,vars:2,consts:[[1,"options"],["nbButton","","nbPopoverPlacement","end","nbPopoverAdjustment","noop",3,"nbPopover","status"],["icon","layers-outline"],["optionsRef",""],[1,"row"],[3,"checked","checkedChange"]],template:function(t,e){if(1&t&&(s["\u0275\u0275elementStart"](0,"div",0),s["\u0275\u0275elementStart"](1,"button",1),s["\u0275\u0275element"](2,"nb-icon",2),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"](),s["\u0275\u0275template"](3,Ui,20,6,"ng-template",null,3,s["\u0275\u0275templateRefExtractor"])),2&t){const t=s["\u0275\u0275reference"](4);s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("nbPopover",t)("status","primary")}},directives:[Ki.k,Ki.U,Ki.A,Ki.n,Ki.m,Ki.s],styles:[".options[_ngcontent-%COMP%]{position:absolute;margin:5px;z-index:10}"]}),t})();var $i=i("l5mm"),Hi=i("JX91");let qi=(()=>{class t{constructor(t){this.http=t}extractData(t){return t||{}}getSdsCzml(){return this.http.get("https://solmm01.fmg.local/api/map/sds").pipe(Object(v.a)(this.extractData))}getSdsRange(t,e){return this.http.get("https://solmm01.fmg.local/api/map/sds/range/get?start="+t+"&end="+e).pipe(Object(v.a)(this.extractData))}getSdsRange$(t,e){const i=this.getSdsRange(t,e);return console.log(i),Object($i.a)(99999999999).pipe(Object(Hi.a)(0),Object(v.a)(t=>i),Object(u.a)(t=>t))}getDataSteam$(t){const e=this.getSdsCzml();return Object($i.a)(t).pipe(Object(Hi.a)(0),Object(v.a)(t=>e),Object(u.a)(t=>t))}}return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275inject"](Vi.a))},t.\u0275prov=s["\u0275\u0275defineInjectable"]({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),Xi=(()=>{class t{constructor(t,e){this.sdsData=t,this.mapsManagerService=e,this.Cesium=Cesium}ngOnInit(){Date.now();const t=this.mapsManagerService.getMap().getCesiumViewer();Cesium.knockout.getObservable(t.clockViewModel,"currentTime"),Object($i.a)(1e3),this.entities$=this.sdsData.getDataSteam$(6e4).pipe(Object(v.a)(t=>({id:"Subscribers",actionType:Xe.ADD_UPDATE,entity:t})))}}return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275directiveInject"](qi),s["\u0275\u0275directiveInject"](We))},t.\u0275cmp=s["\u0275\u0275defineComponent"]({type:t,selectors:[["map-sds"]],decls:2,vars:2,consts:[["acFor","let entity of entities$",3,"context","debug"],["props","{\n      czmlPacket: entity\n    }"]],template:function(t,e){1&t&&(s["\u0275\u0275elementStart"](0,"ac-layer",0),s["\u0275\u0275element"](1,"ac-czml-desc",1),s["\u0275\u0275elementEnd"]()),2&t&&s["\u0275\u0275property"]("context",e)("debug",!0)},directives:[yi,Ai],styles:[""]}),t})();const Zi=function(t,e,i){return{format:t,transparent:e,version:i}},Yi=function(t,e,i,r){return{url:t,parameters:e,layers:i,enablePickFeatures:r}};function Ji(t,e){if(1&t&&s["\u0275\u0275element"](0,"ac-map-layer-provider",4),2&t){const t=e.$implicit,i=s["\u0275\u0275nextContext"](3);s["\u0275\u0275property"]("provider",i.MapLayerProviderOptions.WebMapService)("index",t.index)("options",s["\u0275\u0275pureFunction4"](7,Yi,t.url,s["\u0275\u0275pureFunction3"](3,Zi,t.format,t.transparent,t.version),t.layers,t.pick_features))}}function Qi(t,e){if(1&t&&(s["\u0275\u0275elementStart"](0,"div",2),s["\u0275\u0275elementStart"](1,"ac-map"),s["\u0275\u0275element"](2,"map-options"),s["\u0275\u0275element"](3,"map-sds"),s["\u0275\u0275template"](4,Ji,1,12,"ac-map-layer-provider",3),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&t){const t=s["\u0275\u0275nextContext"](2);s["\u0275\u0275advance"](4),s["\u0275\u0275property"]("ngForOf",t.layers$)}}function tr(t,e){if(1&t&&(s["\u0275\u0275elementStart"](0,"div"),s["\u0275\u0275template"](1,Qi,5,1,"div",1),s["\u0275\u0275elementEnd"]()),2&t){const t=s["\u0275\u0275nextContext"]();s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf",t.dataLoaded)}}const er=function(){return["view","map"]},ir=[{path:"",component:(()=>{class t{constructor(t,e){this.viewerConf=t,this.map=e,this.MapLayerProviderOptions=_i,this.dataLoaded=!1;const i=Cesium.Rectangle.fromDegrees(117.702242,-22.260914,117.981473,-22.089772);Cesium.Camera.DEFAULT_VIEW_RECTANGLE=i,Cesium.Camera.DEFAULT_VIEW_FACTOR=0,Cesium.Ion.defaultAccessToken="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIyZWZjZjk2OS03MTY4LTQzNTUtODE4Yy1lMGI0MWVjYmFjNDgiLCJpZCI6Mzc3ODYsImlhdCI6MTYwNTU4NTYxN30.KFh3DgwvUdP1v8O6q4SPJ92uz3G-4kvSm6EK3E-YBqQ",t.viewerOptions={selectionIndicator:!0,timeline:!0,infoBox:!0,fullscreenButton:!0,baseLayerPicker:!0,animation:!0,shouldAnimate:!0,homeButton:!0,geocoder:!1,navigationHelpButton:!0,navigationInstructionsInitiallyVisible:!1,mapMode2D:Cesium.MapMode2D.ROTATE,automaticallyTrackDataSourceClocks:!0,vrButton:!0}}ngOnInit(){this.map.getMapLayers().subscribe(t=>{this.layers$=t,this.dataLoaded=!0})}ngOnDestroy(){clearInterval(this.interval)}refreshData(){}}return t.\u0275fac=function(e){return new(e||t)(s["\u0275\u0275directiveInject"](Bt),s["\u0275\u0275directiveInject"](zi))},t.\u0275cmp=s["\u0275\u0275defineComponent"]({type:t,selectors:[["ngx-map"]],features:[s["\u0275\u0275ProvidersFeature"]([Bt])],decls:1,vars:2,consts:[[4,"nbIsGranted"],["class","row",4,"ngIf"],[1,"row"],[3,"provider","index","options",4,"ngFor","ngForOf"],[3,"provider","index","options"]],template:function(t,e){1&t&&s["\u0275\u0275template"](0,tr,2,1,"div",0),2&t&&s["\u0275\u0275property"]("nbIsGranted",s["\u0275\u0275pureFunction0"](1,er))},directives:[Gi.b,r.m,He,Wi,Xi,r.l,Ei],styles:["[_nghost-%COMP%]     nb-layout-column, ac-map[_ngcontent-%COMP%]{padding:0}ac-map[_ngcontent-%COMP%]{width:100vw;height:88vh;margin:0;overflow:hidden;position:relative}"]}),t})()}];let rr=(()=>{class t{}return t.\u0275mod=s["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=s["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},imports:[[n.g.forChild(ir)],n.g]}),t})();var nr=i("h+2I");i.d(e,"MapModule",(function(){return sr}));let sr=(()=>{class t{}return t.\u0275mod=s["\u0275\u0275defineNgModule"]({type:t}),t.\u0275inj=s["\u0275\u0275defineInjector"]({factory:function(e){return new(e||t)},imports:[[r.c,rr,Fi,nr.a,Ki.l,Ki.C,Ki.V,Ki.q,Ki.t,Gi.d,Li.forRoot({fixEntitiesShadows:!1,customPipes:[]})]]}),t})()},"8USJ":function(t,e,i){!function(t){"use strict";function e(t){return null!=t}function i(t){return null==t}var r=function(){function t(){}return t.parseIntAutoRadix=function(t){var e=parseInt(t);if(isNaN(e))throw new Error("Invalid integer literal when parsing "+t);return e},t.isNumeric=function(t){return!isNaN(t-parseFloat(t))},t}();function n(t){return t.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}var s,o=(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),a=function(t,e,i,r){this.input=e,this.errLocation=i,this.ctxLocation=r,this.message="Parser Error: "+t+" "+i+" ["+e+"] in "+r},c=function(t,e){this.start=t,this.end=e},h=function(){function t(t){this.span=t}return t.prototype.visit=function(t,e){return void 0===e&&(e=null),null},t.prototype.toString=function(){return"AST"},t}(),l=function(t){function e(e,i,r,n){var s=t.call(this,e)||this;return s.prefix=i,s.uninterpretedExpression=r,s.location=n,s}return o(e,t),e.prototype.visit=function(t,e){return void 0===e&&(e=null),t.visitQuote(this,e)},e.prototype.toString=function(){return"Quote"},e}(h),u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.visit=function(t,e){void 0===e&&(e=null)},e}(h),p=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.visit=function(t,e){return void 0===e&&(e=null),t.visitImplicitReceiver(this,e)},e}(h),d=function(t){function e(e,i){var r=t.call(this,e)||this;return r.expressions=i,r}return o(e,t),e.prototype.visit=function(t,e){return void 0===e&&(e=null),t.visitChain(this,e)},e}(h),f=function(t){function e(e,i,r,n){var s=t.call(this,e)||this;return s.condition=i,s.trueExp=r,s.falseExp=n,s}return o(e,t),e.prototype.visit=function(t,e){return void 0===e&&(e=null),t.visitConditional(this,e)},e}(h),v=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n.receiver=i,n.name=r,n}return o(e,t),e.prototype.visit=function(t,e){return void 0===e&&(e=null),t.visitPropertyRead(this,e)},e}(h),m=function(t){function e(e,i,r,n){var s=t.call(this,e)||this;return s.receiver=i,s.name=r,s.value=n,s}return o(e,t),e.prototype.visit=function(t,e){return void 0===e&&(e=null),t.visitPropertyWrite(this,e)},e}(h),y=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n.receiver=i,n.name=r,n}return o(e,t),e.prototype.visit=function(t,e){return void 0===e&&(e=null),t.visitSafePropertyRead(this,e)},e}(h),g=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n.obj=i,n.key=r,n}return o(e,t),e.prototype.visit=function(t,e){return void 0===e&&(e=null),t.visitKeyedRead(this,e)},e}(h),C=function(t){function e(e,i,r,n){var s=t.call(this,e)||this;return s.obj=i,s.key=r,s.value=n,s}return o(e,t),e.prototype.visit=function(t,e){return void 0===e&&(e=null),t.visitKeyedWrite(this,e)},e}(h),w=function(t){function e(e,i,r,n){var s=t.call(this,e)||this;return s.exp=i,s.name=r,s.args=n,s}return o(e,t),e.prototype.visit=function(t,e){return void 0===e&&(e=null),t.visitPipe(this,e)},e}(h),b=function(t){function e(e,i){var r=t.call(this,e)||this;return r.value=i,r}return o(e,t),e.prototype.visit=function(t,e){return void 0===e&&(e=null),t.visitLiteralPrimitive(this,e)},e}(h),M=function(t){function e(e,i){var r=t.call(this,e)||this;return r.expressions=i,r}return o(e,t),e.prototype.visit=function(t,e){return void 0===e&&(e=null),t.visitLiteralArray(this,e)},e}(h),x=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n.keys=i,n.values=r,n}return o(e,t),e.prototype.visit=function(t,e){return void 0===e&&(e=null),t.visitLiteralMap(this,e)},e}(h),_=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n.strings=i,n.expressions=r,n}return o(e,t),e.prototype.visit=function(t,e){return void 0===e&&(e=null),t.visitInterpolation(this,e)},e}(h),E=function(t){function e(e,i,r,n){var s=t.call(this,e)||this;return s.operation=i,s.left=r,s.right=n,s}return o(e,t),e.prototype.visit=function(t,e){return void 0===e&&(e=null),t.visitBinary(this,e)},e}(h),S=function(t){function e(e,i){var r=t.call(this,e)||this;return r.expression=i,r}return o(e,t),e.prototype.visit=function(t,e){return void 0===e&&(e=null),t.visitPrefixNot(this,e)},e}(h),I=function(t){function e(e,i,r,n){var s=t.call(this,e)||this;return s.receiver=i,s.name=r,s.args=n,s}return o(e,t),e.prototype.visit=function(t,e){return void 0===e&&(e=null),t.visitMethodCall(this,e)},e}(h),O=function(t){function e(e,i,r,n){var s=t.call(this,e)||this;return s.receiver=i,s.name=r,s.args=n,s}return o(e,t),e.prototype.visit=function(t,e){return void 0===e&&(e=null),t.visitSafeMethodCall(this,e)},e}(h),P=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n.target=i,n.args=r,n}return o(e,t),e.prototype.visit=function(t,e){return void 0===e&&(e=null),t.visitFunctionCall(this,e)},e}(h),T=function(t){function e(e,r,n,s){var o=t.call(this,new c(0,i(r)?0:r.length))||this;return o.ast=e,o.source=r,o.location=n,o.errors=s,o}return o(e,t),e.prototype.visit=function(t,e){return void 0===e&&(e=null),this.ast.visit(t,e)},e.prototype.toString=function(){return this.source+" in "+this.location},e}(h),R=function(t,e,i,r,n){this.span=t,this.key=e,this.keyIsVar=i,this.name=r,this.expression=n},A=function(){function t(){}return t.prototype.visitBinary=function(t,e){return t.left.visit(this),t.right.visit(this),null},t.prototype.visitChain=function(t,e){return this.visitAll(t.expressions,e)},t.prototype.visitConditional=function(t,e){return t.condition.visit(this),t.trueExp.visit(this),t.falseExp.visit(this),null},t.prototype.visitPipe=function(t,e){return t.exp.visit(this),this.visitAll(t.args,e),null},t.prototype.visitFunctionCall=function(t,e){return t.target.visit(this),this.visitAll(t.args,e),null},t.prototype.visitImplicitReceiver=function(t,e){return null},t.prototype.visitInterpolation=function(t,e){return this.visitAll(t.expressions,e)},t.prototype.visitKeyedRead=function(t,e){return t.obj.visit(this),t.key.visit(this),null},t.prototype.visitKeyedWrite=function(t,e){return t.obj.visit(this),t.key.visit(this),t.value.visit(this),null},t.prototype.visitLiteralArray=function(t,e){return this.visitAll(t.expressions,e)},t.prototype.visitLiteralMap=function(t,e){return this.visitAll(t.values,e)},t.prototype.visitLiteralPrimitive=function(t,e){return null},t.prototype.visitMethodCall=function(t,e){return t.receiver.visit(this),this.visitAll(t.args,e)},t.prototype.visitPrefixNot=function(t,e){return t.expression.visit(this),null},t.prototype.visitPropertyRead=function(t,e){return t.receiver.visit(this),null},t.prototype.visitPropertyWrite=function(t,e){return t.receiver.visit(this),t.value.visit(this),null},t.prototype.visitSafePropertyRead=function(t,e){return t.receiver.visit(this),null},t.prototype.visitSafeMethodCall=function(t,e){return t.receiver.visit(this),this.visitAll(t.args,e)},t.prototype.visitAll=function(t,e){var i=this;return t.forEach((function(t){return t.visit(i,e)})),null},t.prototype.visitQuote=function(t,e){return null},t}();function k(t){return 48<=t&&t<=57}var L,D=new(function(){function t(t,e){this.start=t,this.end=e}return t.fromArray=function(i){return i?(function(t,i){if(e(i)&&(!Array.isArray(i)||2!=i.length))throw new Error("Expected 'interpolation' to be an array, [start, end].")}(0,i),new t(i[0],i[1])):D},t}())("{{","}}");!function(t){t[t.Character=0]="Character",t[t.Identifier=1]="Identifier",t[t.Keyword=2]="Keyword",t[t.String=3]="String",t[t.Operator=4]="Operator",t[t.Number=5]="Number",t[t.Error=6]="Error"}(L||(L={}));var j=["var","let","null","undefined","true","false","if","else","this"],N=function(){function t(){}return t.prototype.tokenize=function(t){for(var e=new z(t),i=[],r=e.scanToken();null!=r;)i.push(r),r=e.scanToken();return i},t}(),F=function(){function t(t,e,i,r){this.index=t,this.type=e,this.numValue=i,this.strValue=r}return t.prototype.isCharacter=function(t){return this.type==L.Character&&this.numValue==t},t.prototype.isNumber=function(){return this.type==L.Number},t.prototype.isString=function(){return this.type==L.String},t.prototype.isOperator=function(t){return this.type==L.Operator&&this.strValue==t},t.prototype.isIdentifier=function(){return this.type==L.Identifier},t.prototype.isKeyword=function(){return this.type==L.Keyword},t.prototype.isKeywordLet=function(){return this.type==L.Keyword&&"let"==this.strValue},t.prototype.isKeywordNull=function(){return this.type==L.Keyword&&"null"==this.strValue},t.prototype.isKeywordUndefined=function(){return this.type==L.Keyword&&"undefined"==this.strValue},t.prototype.isKeywordTrue=function(){return this.type==L.Keyword&&"true"==this.strValue},t.prototype.isKeywordFalse=function(){return this.type==L.Keyword&&"false"==this.strValue},t.prototype.isKeywordThis=function(){return this.type==L.Keyword&&"this"==this.strValue},t.prototype.isError=function(){return this.type==L.Error},t.prototype.toNumber=function(){return this.type==L.Number?this.numValue:-1},t.prototype.toString=function(){switch(this.type){case L.Character:case L.Identifier:case L.Keyword:case L.Operator:case L.String:case L.Error:return this.strValue;case L.Number:return this.numValue.toString();default:return null}},t}();function V(t,e){return new F(t,L.Character,e,String.fromCharCode(e))}function B(t,e){return new F(t,L.Operator,0,e)}var K=new F(-1,L.Character,0,""),z=function(){function t(t){this.input=t,this.peek=0,this.index=-1,this.length=t.length,this.advance()}return t.prototype.advance=function(){this.peek=++this.index>=this.length?0:this.input.charCodeAt(this.index)},t.prototype.scanToken=function(){for(var t=this.input,e=this.length,i=this.peek,r=this.index;i<=32;){if(++r>=e){i=0;break}i=t.charCodeAt(r)}if(this.peek=i,this.index=r,r>=e)return null;if(G(i))return this.scanIdentifier();if(k(i))return this.scanNumber(r);var n,s=r;switch(i){case 46:return this.advance(),k(this.peek)?this.scanNumber(s):V(s,46);case 40:case 41:case 123:case 125:case 91:case 93:case 44:case 58:case 59:return this.scanCharacter(s,i);case 39:case 34:return this.scanString();case 35:case 43:case 45:case 42:case 47:case 37:case 94:return this.scanOperator(s,String.fromCharCode(i));case 63:return this.scanComplexOperator(s,"?",46,".");case 60:case 62:return this.scanComplexOperator(s,String.fromCharCode(i),61,"=");case 33:case 61:return this.scanComplexOperator(s,String.fromCharCode(i),61,"=",61,"=");case 38:return this.scanComplexOperator(s,"&",38,"&");case 124:return this.scanComplexOperator(s,"|",124,"|");case 160:for(;(n=this.peek)>=9&&n<=32||160==n;)this.advance();return this.scanToken()}return this.advance(),this.error("Unexpected character ["+String.fromCharCode(i)+"]",0)},t.prototype.scanCharacter=function(t,e){return this.advance(),V(t,e)},t.prototype.scanOperator=function(t,e){return this.advance(),B(t,e)},t.prototype.scanComplexOperator=function(t,e,i,r,n,s){this.advance();var o=e;return this.peek==i&&(this.advance(),o+=r),null!=n&&this.peek==n&&(this.advance(),o+=s),B(t,o)},t.prototype.scanIdentifier=function(){var t=this.index;for(this.advance();U(this.peek);)this.advance();var e=this.input.substring(t,this.index);return j.indexOf(e)>-1?new F(t,L.Keyword,0,e):new F(t,L.Identifier,0,e)},t.prototype.scanNumber=function(t){var e,i=this.index===t;for(this.advance();;){if(k(this.peek));else if(46==this.peek)i=!1;else{if(101!=(e=this.peek)&&69!=e)break;if(this.advance(),W(this.peek)&&this.advance(),!k(this.peek))return this.error("Invalid exponent",-1);i=!1}this.advance()}var n=this.input.substring(t,this.index),s=i?r.parseIntAutoRadix(n):parseFloat(n);return new F(t,L.Number,s,"")},t.prototype.scanString=function(){var t=this.index,e=this.peek;this.advance();for(var i="",r=this.index,n=this.input;this.peek!=e;)if(92==this.peek){i+=n.substring(r,this.index),this.advance();var s=void 0;if(this.peek=this.peek,117==this.peek){var o=n.substring(this.index+1,this.index+5);if(!/^[0-9a-f]+$/i.test(o))return this.error("Invalid unicode escape [\\u"+o+"]",0);s=parseInt(o,16);for(var a=0;a<5;a++)this.advance()}else s=$(this.peek),this.advance();i+=String.fromCharCode(s),r=this.index}else{if(0==this.peek)return this.error("Unterminated quote",0);this.advance()}var c=n.substring(r,this.index);return this.advance(),new F(t,L.String,0,i+c)},t.prototype.error=function(t,e){var i=this.index+e;return function(t,e){return new F(t,L.Error,0,e)}(i,"Lexer Error: "+t+" at column "+i+" in expression ["+this.input+"]")},t}();function G(t){return 97<=t&&t<=122||65<=t&&t<=90||95==t||36==t}function U(t){return function(t){return t>=97&&t<=122||t>=65&&t<=90}(t)||k(t)||95==t||36==t}function W(t){return 45==t||43==t}function $(t){switch(t){case 110:return 10;case 102:return 12;case 114:return 13;case 116:return 9;case 118:return 11;default:return t}}var H=function(t,e,i){this.strings=t,this.expressions=e,this.offsets=i},q=function(t,e,i){this.templateBindings=t,this.warnings=e,this.errors=i};function X(t){var e=n(t.start)+"([\\s\\S]*?)"+n(t.end);return new RegExp(e,"g")}var Z=function(){function t(t){this._lexer=t,this.errors=[]}return t.prototype.parseAction=function(t,e,i){void 0===i&&(i=D),this._checkNoInterpolation(t,e,i);var r=this._stripComments(t),n=this._lexer.tokenize(this._stripComments(t)),s=new Y(t,e,n,r.length,!0,this.errors,t.length-r.length).parseChain();return new T(s,t,e,this.errors)},t.prototype.parseBinding=function(t,e,i){void 0===i&&(i=D);var r=this._parseBindingAst(t,e,i);return new T(r,t,e,this.errors)},t.prototype.parseSimpleBinding=function(t,e,i){void 0===i&&(i=D);var r=this._parseBindingAst(t,e,i),n=J.check(r);return n.length>0&&this._reportError("Host binding expression cannot contain "+n.join(" "),t,e),new T(r,t,e,this.errors)},t.prototype._reportError=function(t,e,i,r){this.errors.push(new a(t,e,i,r))},t.prototype._parseBindingAst=function(t,i,r){var n=this._parseQuote(t,i);if(e(n))return n;this._checkNoInterpolation(t,i,r);var s=this._stripComments(t),o=this._lexer.tokenize(s);return new Y(t,i,o,s.length,!1,this.errors,t.length-s.length).parseChain()},t.prototype._parseQuote=function(t,e){if(i(t))return null;var r=t.indexOf(":");if(-1==r)return null;var n=t.substring(0,r).trim();if(!function(t){if(0==t.length)return!1;var e=new z(t);if(!G(e.peek))return!1;for(e.advance();0!==e.peek;){if(!U(e.peek))return!1;e.advance()}return!0}(n))return null;var s=t.substring(r+1);return new l(new c(0,t.length),n,s,e)},t.prototype.parseTemplateBindings=function(t,e,i){var r=this._lexer.tokenize(e);if(t){var n=this._lexer.tokenize(t).map((function(t){return t.index=0,t}));r.unshift.apply(r,n)}return new Y(e,i,r,e.length,!1,this.errors,0).parseTemplateBindings()},t.prototype.parseInterpolation=function(t,e,r){void 0===r&&(r=D);var n=this.splitInterpolation(t,e,r);if(null==n)return null;for(var s=[],o=0;o<n.expressions.length;++o){var a=n.expressions[o],h=this._stripComments(a),l=this._lexer.tokenize(this._stripComments(n.expressions[o])),u=new Y(t,e,l,h.length,!1,this.errors,n.offsets[o]+(a.length-h.length)).parseChain();s.push(u)}return new T(new _(new c(0,i(t)?0:t.length),n.strings,s),t,e,this.errors)},t.prototype.splitInterpolation=function(t,e,i){void 0===i&&(i=D);var r=X(i),n=t.split(r);if(n.length<=1)return null;for(var s=[],o=[],a=[],c=0,h=0;h<n.length;h++){var l=n[h];h%2==0?(s.push(l),c+=l.length):l.trim().length>0?(c+=i.start.length,o.push(l),a.push(c),c+=l.length+i.end.length):(this._reportError("Blank expressions are not allowed in interpolated strings",t,"at column "+this._findInterpolationErrorColumn(n,h,i)+" in",e),o.push("$implict"),a.push(c))}return new H(s,o,a)},t.prototype.wrapLiteralPrimitive=function(t,e){return new T(new b(new c(0,i(t)?0:t.length),t),t,e,this.errors)},t.prototype._stripComments=function(t){var i=this._commentStart(t);return e(i)?t.substring(0,i).trim():t},t.prototype._commentStart=function(t){for(var e,r=null,n=0;n<t.length-1;n++){var s=t.charCodeAt(n),o=t.charCodeAt(n+1);if(47===s&&47==o&&i(r))return n;r===s?r=null:i(r)&&(39===(e=s)||34===e||96===e)&&(r=s)}return null},t.prototype._checkNoInterpolation=function(t,e,i){var r=X(i),n=t.split(r);n.length>1&&this._reportError("Got interpolation ("+i.start+i.end+") where expression was expected",t,"at column "+this._findInterpolationErrorColumn(n,1,i)+" in",e)},t.prototype._findInterpolationErrorColumn=function(t,e,i){for(var r="",n=0;n<e;n++)r+=n%2==0?t[n]:""+i.start+t[n]+i.end;return r.length},t}(),Y=function(){function t(t,e,i,r,n,s,o){this.input=t,this.location=e,this.tokens=i,this.inputLength=r,this.parseAction=n,this.errors=s,this.offset=o,this.rparensExpected=0,this.rbracketsExpected=0,this.rbracesExpected=0,this.index=0}return t.prototype.peek=function(t){var e=this.index+t;return e<this.tokens.length?this.tokens[e]:K},Object.defineProperty(t.prototype,"next",{get:function(){return this.peek(0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputIndex",{get:function(){return this.index<this.tokens.length?this.next.index+this.offset:this.inputLength+this.offset},enumerable:!0,configurable:!0}),t.prototype.span=function(t){return new c(t,this.inputIndex)},t.prototype.advance=function(){this.index++},t.prototype.optionalCharacter=function(t){return!!this.next.isCharacter(t)&&(this.advance(),!0)},t.prototype.peekKeywordLet=function(){return this.next.isKeywordLet()},t.prototype.expectCharacter=function(t){this.optionalCharacter(t)||this.error("Missing expected "+String.fromCharCode(t))},t.prototype.optionalOperator=function(t){return!!this.next.isOperator(t)&&(this.advance(),!0)},t.prototype.expectOperator=function(t){this.optionalOperator(t)||this.error("Missing expected operator "+t)},t.prototype.expectIdentifierOrKeyword=function(){var t=this.next;return t.isIdentifier()||t.isKeyword()?(this.advance(),t.toString()):(this.error("Unexpected token "+t+", expected identifier or keyword"),"")},t.prototype.expectIdentifierOrKeywordOrString=function(){var t=this.next;return t.isIdentifier()||t.isKeyword()||t.isString()?(this.advance(),t.toString()):(this.error("Unexpected token "+t+", expected identifier, keyword, or string"),"")},t.prototype.parseChain=function(){for(var t=[],e=this.inputIndex;this.index<this.tokens.length;){var i=this.parsePipe();if(t.push(i),this.optionalCharacter(59))for(this.parseAction||this.error("Binding expression cannot contain chained expression");this.optionalCharacter(59););else this.index<this.tokens.length&&this.error("Unexpected token '"+this.next+"'")}return 0==t.length?new u(this.span(e)):1==t.length?t[0]:new d(this.span(e),t)},t.prototype.parsePipe=function(){var t=this.parseExpression();if(this.optionalOperator("|")){this.parseAction&&this.error("Cannot have a pipe in an action expression");do{for(var e=this.expectIdentifierOrKeyword(),i=[];this.optionalCharacter(58);)i.push(this.parseExpression());t=new w(this.span(t.span.start),t,e,i)}while(this.optionalOperator("|"))}return t},t.prototype.parseExpression=function(){return this.parseConditional()},t.prototype.parseConditional=function(){var t=this.inputIndex,e=this.parseLogicalOr();if(this.optionalOperator("?")){var i=this.parsePipe(),r=void 0;if(this.optionalCharacter(58))r=this.parsePipe();else{var n=this.input.substring(t,this.inputIndex);this.error("Conditional expression "+n+" requires all 3 expressions"),r=new u(this.span(t))}return new f(this.span(t),e,i,r)}return e},t.prototype.parseLogicalOr=function(){for(var t=this.parseLogicalAnd();this.optionalOperator("||");){var e=this.parseLogicalAnd();t=new E(this.span(t.span.start),"||",t,e)}return t},t.prototype.parseLogicalAnd=function(){for(var t=this.parseEquality();this.optionalOperator("&&");){var e=this.parseEquality();t=new E(this.span(t.span.start),"&&",t,e)}return t},t.prototype.parseEquality=function(){for(var t=this.parseRelational();this.next.type==L.Operator;){var e=this.next.strValue;switch(e){case"==":case"===":case"!=":case"!==":this.advance();var i=this.parseRelational();t=new E(this.span(t.span.start),e,t,i);continue}break}return t},t.prototype.parseRelational=function(){for(var t=this.parseAdditive();this.next.type==L.Operator;){var e=this.next.strValue;switch(e){case"<":case">":case"<=":case">=":this.advance();var i=this.parseAdditive();t=new E(this.span(t.span.start),e,t,i);continue}break}return t},t.prototype.parseAdditive=function(){for(var t=this.parseMultiplicative();this.next.type==L.Operator;){var e=this.next.strValue;switch(e){case"+":case"-":this.advance();var i=this.parseMultiplicative();t=new E(this.span(t.span.start),e,t,i);continue}break}return t},t.prototype.parseMultiplicative=function(){for(var t=this.parsePrefix();this.next.type==L.Operator;){var e=this.next.strValue;switch(e){case"*":case"%":case"/":this.advance();var i=this.parsePrefix();t=new E(this.span(t.span.start),e,t,i);continue}break}return t},t.prototype.parsePrefix=function(){if(this.next.type==L.Operator){var t=this.inputIndex,e=this.next.strValue,i=void 0;switch(e){case"+":return this.advance(),this.parsePrefix();case"-":return this.advance(),i=this.parsePrefix(),new E(this.span(t),e,new b(new c(t,t),0),i);case"!":return this.advance(),i=this.parsePrefix(),new S(this.span(t),i)}}return this.parseCallChain()},t.prototype.parseCallChain=function(){for(var t=this.parsePrimary();;)if(this.optionalCharacter(46))t=this.parseAccessMemberOrMethodCall(t,!1);else if(this.optionalOperator("?."))t=this.parseAccessMemberOrMethodCall(t,!0);else if(this.optionalCharacter(91)){this.rbracketsExpected++;var e=this.parsePipe();if(this.rbracketsExpected--,this.expectCharacter(93),this.optionalOperator("=")){var i=this.parseConditional();t=new C(this.span(t.span.start),t,e,i)}else t=new g(this.span(t.span.start),t,e)}else{if(!this.optionalCharacter(40))return t;this.rparensExpected++;var r=this.parseCallArguments();this.rparensExpected--,this.expectCharacter(41),t=new P(this.span(t.span.start),t,r)}},t.prototype.parsePrimary=function(){var t=this.inputIndex;if(this.optionalCharacter(40)){this.rparensExpected++;var e=this.parsePipe();return this.rparensExpected--,this.expectCharacter(41),e}if(this.next.isKeywordNull())return this.advance(),new b(this.span(t),null);if(this.next.isKeywordUndefined())return this.advance(),new b(this.span(t),void 0);if(this.next.isKeywordTrue())return this.advance(),new b(this.span(t),!0);if(this.next.isKeywordFalse())return this.advance(),new b(this.span(t),!1);if(this.next.isKeywordThis())return this.advance(),new p(this.span(t));if(this.optionalCharacter(91)){this.rbracketsExpected++;var i=this.parseExpressionList(93);return this.rbracketsExpected--,this.expectCharacter(93),new M(this.span(t),i)}if(this.next.isCharacter(123))return this.parseLiteralMap();if(this.next.isIdentifier())return this.parseAccessMemberOrMethodCall(new p(this.span(t)),!1);if(this.next.isNumber()){var r=this.next.toNumber();return this.advance(),new b(this.span(t),r)}if(this.next.isString()){var n=this.next.toString();return this.advance(),new b(this.span(t),n)}return this.index>=this.tokens.length?(this.error("Unexpected end of expression: "+this.input),new u(this.span(t))):(this.error("Unexpected token "+this.next),new u(this.span(t)))},t.prototype.parseExpressionList=function(t){var e=[];if(!this.next.isCharacter(t))do{e.push(this.parsePipe())}while(this.optionalCharacter(44));return e},t.prototype.parseLiteralMap=function(){var t=[],e=[],i=this.inputIndex;if(this.expectCharacter(123),!this.optionalCharacter(125)){this.rbracesExpected++;do{var r=this.expectIdentifierOrKeywordOrString();t.push(r),this.expectCharacter(58),e.push(this.parsePipe())}while(this.optionalCharacter(44));this.rbracesExpected--,this.expectCharacter(125)}return new x(this.span(i),t,e)},t.prototype.parseAccessMemberOrMethodCall=function(t,e){void 0===e&&(e=!1);var i=t.span.start,r=this.expectIdentifierOrKeyword();if(this.optionalCharacter(40)){this.rparensExpected++;var n=this.parseCallArguments();this.expectCharacter(41),this.rparensExpected--;var s=this.span(i);return e?new O(s,t,r,n):new I(s,t,r,n)}if(e)return this.optionalOperator("=")?(this.error("The '?.' operator cannot be used in the assignment"),new u(this.span(i))):new y(this.span(i),t,r);if(this.optionalOperator("=")){if(!this.parseAction)return this.error("Bindings cannot contain assignments"),new u(this.span(i));var o=this.parseConditional();return new m(this.span(i),t,r,o)}return new v(this.span(i),t,r)},t.prototype.parseCallArguments=function(){if(this.next.isCharacter(41))return[];var t=[];do{t.push(this.parsePipe())}while(this.optionalCharacter(44));return t},t.prototype.expectTemplateBindingKey=function(){var t="",e=!1;do{t+=this.expectIdentifierOrKeywordOrString(),(e=this.optionalOperator("-"))&&(t+="-")}while(e);return t.toString()},t.prototype.parseTemplateBindings=function(){for(var t=[],e=null;this.index<this.tokens.length;){var i=this.inputIndex,r=this.peekKeywordLet();r&&this.advance();var n=this.expectTemplateBindingKey();r||(null==e?e=n:n=e+n[0].toUpperCase()+n.substring(1)),this.optionalCharacter(58);var s=null,o=null;if(r)s=this.optionalOperator("=")?this.expectTemplateBindingKey():"$implicit";else if(this.next!==K&&!this.peekKeywordLet()){var a=this.inputIndex,c=this.parsePipe(),h=this.input.substring(a-this.offset,this.inputIndex-this.offset);o=new T(c,h,this.location,this.errors)}t.push(new R(this.span(i),n,r,s,o)),this.optionalCharacter(59)||this.optionalCharacter(44)}return new q(t,[],this.errors)},t.prototype.error=function(t,e){void 0===e&&(e=null),this.errors.push(new a(t,this.input,this.locationText(e),this.location)),this.skip()},t.prototype.locationText=function(t){return void 0===t&&(t=null),i(t)&&(t=this.index),t<this.tokens.length?"at column "+(this.tokens[t].index+1)+" in":"at the end of the expression"},t.prototype.skip=function(){for(var t=this.next;this.index<this.tokens.length&&!t.isCharacter(59)&&(this.rparensExpected<=0||!t.isCharacter(41))&&(this.rbracesExpected<=0||!t.isCharacter(125))&&(this.rbracketsExpected<=0||!t.isCharacter(93));)this.next.isError()&&this.errors.push(new a(this.next.toString(),this.input,this.locationText(),this.location)),this.advance(),t=this.next},t}(),J=function(){function t(){this.errors=[]}return t.check=function(e){var i=new t;return e.visit(i),i.errors},t.prototype.visitImplicitReceiver=function(t,e){},t.prototype.visitInterpolation=function(t,e){},t.prototype.visitLiteralPrimitive=function(t,e){},t.prototype.visitPropertyRead=function(t,e){},t.prototype.visitPropertyWrite=function(t,e){},t.prototype.visitSafePropertyRead=function(t,e){},t.prototype.visitMethodCall=function(t,e){},t.prototype.visitSafeMethodCall=function(t,e){},t.prototype.visitFunctionCall=function(t,e){},t.prototype.visitLiteralArray=function(t,e){this.visitAll(t.expressions)},t.prototype.visitLiteralMap=function(t,e){this.visitAll(t.values)},t.prototype.visitBinary=function(t,e){},t.prototype.visitPrefixNot=function(t,e){},t.prototype.visitConditional=function(t,e){},t.prototype.visitPipe=function(t,e){this.errors.push("pipes")},t.prototype.visitKeyedRead=function(t,e){},t.prototype.visitKeyedWrite=function(t,e){},t.prototype.visitAll=function(t){var e=this;return t.map((function(t){return t.visit(e)}))},t.prototype.visitChain=function(t,e){},t.prototype.visitQuote=function(t,e){},t}();function Q(t){return JSON.stringify(t).replace(/"/g,"")}var tt=function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),et=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return tt(e,t),e.prototype._handleMethodArgs=function(t){if(!t)return"";for(var e="",i=0,r=t.length;i<r;i++)e+=i===r-1?""+t[i]:t[i]+", ";return e},e.prototype._handlePipeArgs=function(t){if(!t)return"";for(var e="",i=0,r=t;i<r.length;i++)e+=" : "+r[i];return e},e.prototype.visitBinary=function(t){var e=t.left.visit(this),i=t.right.visit(this);return e+" "+t.operation+" "+i},e.prototype.visitChain=function(t){return Q(this.visitAll(t.expressions))},e.prototype.visitConditional=function(t){return t.condition.visit(this)+" ? "+t.trueExp.visit(this)+" : "+t.falseExp.visit(this)},e.prototype.visitPipe=function(t){var e=t.name;return t.exp.visit(this)+" | "+e+this._handlePipeArgs(this.visitAll(t.args))},e.prototype.visitFunctionCall=function(t){return t.target.visit(this)+"("+this._handleMethodArgs(this.visitAll(t.args))+")"},e.prototype.visitImplicitReceiver=function(t){return""},e.prototype.visitInterpolation=function(t){return"{{"+this.visitAll(t.expressions)[0]+"}}"},e.prototype.visitKeyedRead=function(t){return t.obj.visit(this)+"["+t.key.visit(this)+"]"},e.prototype.visitKeyedWrite=function(t){return null},e.prototype.visitLiteralArray=function(t){return Q(this.visitAll(t.expressions))},e.prototype.visitLiteralMap=function(t,e){for(var i={},r=t.keys,n=this.visitAll(t.values),s=0,o=r.length;s<o;s++){var a=n[s];"string"!=typeof a&&e&&(a=""+a),i[r[s]]=a}return e?i:Q(i)},e.prototype.visitLiteralPrimitive=function(t){return"string"==typeof t.value?"'"+t.value+"'":t.value},e.prototype.visitMethodCall=function(t){var e=t.name,i=t.receiver.visit(this);return""+(i?i+".":i)+e+"("+this._handleMethodArgs(this.visitAll(t.args))+")"},e.prototype.visitPrefixNot=function(t){return t.expression.visit(this)},e.prototype.visitPropertyRead=function(t){var e=t.name,i=t.receiver.visit(this);return""+(i?i+".":i)+e},e.prototype.visitPropertyWrite=function(t){return null},e.prototype.visitSafePropertyRead=function(t){var e=t.name,i=t.receiver.visit(this);return""+(i?i+".":i)+e},e.prototype.visitSafeMethodCall=function(t){var e=t.name,i=t.receiver.visit(this);return""+(i?i+".":i)+e+"("+this._handleMethodArgs(this.visitAll(t.args))+")"},e.prototype.visitAll=function(t){var e=this;return t.map((function(t){return t.visit(e)}))},e.prototype.visitQuote=function(t){return null},e}(A),it=function(){function t(){this._parser=new Z(new N),this._cache=new Map}return t.prototype.map=function(t){var e=null,i=new et;if(this._cache.has(t))e=this._cache.get(t);else{if(e=this._parser.parseInterpolation(t,"JsonMapper"))throw new Error("JsonMapperVisitor ERROR: given expression must be json expression.");if(!((e=this._parser.parseBinding(t,"Parse")).ast instanceof x))throw new Error("JsonMapper ERROR: given expression must be json expression.");this._cache.set(t,e)}for(var r=new Map,n=e.visit(i,!0),s=Object.keys(n),o=0,a=s.length;o<a;o++)r.set(s[o],n[s[o]]);return r},t}();t.JsonStringMapper=it,Object.defineProperty(t,"__esModule",{value:!0})}(e)},Cg5X:function(t,e,i){"use strict";if(t.exports)var r=i("Y1mi");function n(t,e){if(!(this instanceof n))return new n(t,e);this.easting=Number(t),this.northing=Number(e)}n.latLonToOsGrid=function(t){if(!(t instanceof r))throw new TypeError("point is not LatLon object");t.datum!=r.datum.OSGB36&&(t=t.convertDatum(r.datum.OSGB36));var e=t.lat.toRadians(),i=t.lon.toRadians(),s=6377563.396,o=6356256.909,a=.9996012717,c=49..toRadians(),h=(-2).toRadians(),l=1-o*o/(s*s),u=(s-o)/(s+o),p=u*u,d=u*u*u,f=Math.cos(e),v=Math.sin(e),m=s*a/Math.sqrt(1-l*v*v),y=s*a*(1-l)/Math.pow(1-l*v*v,1.5),g=m/y-1,C=o*a*((1+u+5/4*p+5/4*d)*(e-c)-(3*u+3*u*u+21/8*d)*Math.sin(e-c)*Math.cos(e+c)+(15/8*p+15/8*d)*Math.sin(2*(e-c))*Math.cos(2*(e+c))-35/24*d*Math.sin(3*(e-c))*Math.cos(3*(e+c))),w=f*f*f,b=w*f*f,M=Math.tan(e)*Math.tan(e),x=M*M,_=i-h,E=_*_,S=E*_,I=S*_,O=I*_,P=C+-1e5+m/2*v*f*E+m/24*v*w*(5-M+9*g)*I+m/720*v*b*(61-58*M+x)*(O*_),T=4e5+m*f*_+m/6*w*(m/y-M)*S+m/120*b*(5-18*M+x+14*g-58*M*g)*O;return P=Number(P.toFixed(3)),new n(T=Number(T.toFixed(3)),P)},n.osGridToLatLon=function(t,e){if(!(t instanceof n))throw new TypeError("gridref is not OsGridRef object");void 0===e&&(e=r.datum.WGS84);var i=t.easting,s=t.northing,o=6377563.396,a=6356256.909,c=.9996012717,h=49..toRadians(),l=(-2).toRadians(),u=1-a*a/(o*o),p=(o-a)/(o+a),d=p*p,f=p*p*p,v=h,m=0;do{m=a*c*((1+p+5/4*d+5/4*f)*((v=(s- -1e5-m)/(o*c)+v)-h)-(3*p+3*p*p+21/8*f)*Math.sin(v-h)*Math.cos(v+h)+(15/8*d+15/8*f)*Math.sin(2*(v-h))*Math.cos(2*(v+h))-35/24*f*Math.sin(3*(v-h))*Math.cos(3*(v+h)))}while(s- -1e5-m>=1e-5);var y=Math.cos(v),g=Math.sin(v),C=o*c/Math.sqrt(1-u*g*g),w=o*c*(1-u)/Math.pow(1-u*g*g,1.5),b=C/w-1,M=Math.tan(v),x=M*M,_=x*x,E=1/y,S=C*C*C,I=S*C*C,O=i-4e5,P=O*O,T=P*O,R=P*P,A=T*P,k=l+E/C*O-E/(6*S)*(C/w+2*x)*T+E/(120*I)*(5+28*x+24*_)*A-E/(I*C*C*5040)*(61+662*x+1320*_+_*x*720)*(A*P),L=new r((v=v-M/(2*w*C)*P+M/(24*w*S)*(5+3*x+b-9*x*b)*R-M/(720*w*I)*(61+90*x+45*_)*(R*P)).toDegrees(),k.toDegrees(),r.datum.OSGB36);return e!=r.datum.OSGB36&&(L=L.convertDatum(e)),L},n.parse=function(t){var e=(t=String(t).trim()).match(/^(\d+),\s*(\d+)$/);if(e)return new n(e[1],e[2]);if(!(e=t.match(/^[A-Z]{2}\s*[0-9]+\s*[0-9]+$/i)))throw new Error("Invalid grid reference");var i=t.toUpperCase().charCodeAt(0)-"A".charCodeAt(0),r=t.toUpperCase().charCodeAt(1)-"A".charCodeAt(0);i>7&&i--,r>7&&r--;var s=(i-2)%5*5+r%5,o=19-5*Math.floor(i/5)-Math.floor(r/5),a=t.slice(2).trim().split(/\s+/);if(1==a.length&&(a=[a[0].slice(0,a[0].length/2),a[0].slice(a[0].length/2)]),s<0||s>6||o<0||o>12)throw new Error("Invalid grid reference");if(2!=a.length)throw new Error("Invalid grid reference");if(a[0].length!=a[1].length)throw new Error("Invalid grid reference");return a[0]=(a[0]+"00000").slice(0,5),a[1]=(a[1]+"00000").slice(0,5),new n(s+a[0],o+a[1])},n.prototype.toString=function(t){if(t=void 0===t?10:Number(t),isNaN(t)||t%2!=0||t>16)throw new RangeError("Invalid precision \u2018"+t+"\u2019");var e=this.easting,i=this.northing;if(isNaN(e)||isNaN(i))throw new Error("Invalid grid reference");if(0==t){var r=Math.floor(e),n=e-r,s=Math.floor(i),o=i-s;return("000000"+r).slice(-6)+(n>0?n.toFixed(3).slice(1):"")+","+((s<1e6?("000000"+s).slice(-6):s)+(o>0?o.toFixed(3).slice(1):""))}var a=Math.floor(e/1e5),c=Math.floor(i/1e5);if(a<0||a>6||c<0||c>12)return"";var h=19-c-(19-c)%5+Math.floor((a+10)/5),l=5*(19-c)%25+a%5;h>7&&h++,l>7&&l++;var u=String.fromCharCode(h+"A".charCodeAt(0),l+"A".charCodeAt(0));return e=Math.floor(e%1e5/Math.pow(10,5-t/2)),i=Math.floor(i%1e5/Math.pow(10,5-t/2)),u+" "+(e=("00000000"+e).slice(-t/2))+" "+("00000000"+i).slice(-t/2)},t.exports&&(t.exports=n)},EO7G:function(t,e,i){"use strict";if(t.exports)var r=i("nXlo");if(t.exports)var n=i("Y1mi");function s(t,e,i,r,o,a,c){if(!(this instanceof s))return new s(t,e,i,r,o,a,c);if(void 0===c&&(c=n.datum.WGS84),!(1<=t&&t<=60))throw new Error("Invalid MGRS grid reference (zone \u2018"+t+"\u2019)");if(1!=e.length)throw new Error("Invalid MGRS grid reference (band \u2018"+e+"\u2019)");if(-1==s.latBands.indexOf(e))throw new Error("Invalid MGRS grid reference (band \u2018"+e+"\u2019)");if(1!=i.length)throw new Error("Invalid MGRS grid reference (e100k \u2018"+i+"\u2019)");if(1!=r.length)throw new Error("Invalid MGRS grid reference (n100k \u2018"+r+"\u2019)");this.zone=Number(t),this.band=e,this.e100k=i,this.n100k=r,this.easting=Number(o),this.northing=Number(a),this.datum=c}s.latBands="CDEFGHJKLMNPQRSTUVWXX",s.e100kLetters=["ABCDEFGH","JKLMNPQR","STUVWXYZ"],s.n100kLetters=["ABCDEFGHJKLMNPQRSTUV","FGHJKLMNPQRSTUVABCDE"],r.prototype.toMgrs=function(){if(isNaN(this.zone+this.easting+this.northing))throw new Error("Invalid UTM coordinate \u2018"+this.toString()+"\u2019");var t=this.zone,e=this.toLatLonE(),i=s.latBands.charAt(Math.floor(e.lat/8+10)),r=Math.floor(this.easting/1e5),n=s.e100kLetters[(t-1)%3].charAt(r-1),o=Math.floor(this.northing/1e5)%20,a=s.n100kLetters[(t-1)%2].charAt(o),c=this.easting%1e5,h=this.northing%1e5;return new s(t,i,n,a,c=Number(c.toFixed(6)),h=Number(h.toFixed(6)))},s.prototype.toUtm=function(){for(var t=this.zone,e=this.band,i=this.n100k,o=this.easting,a=this.northing,c=e>="N"?"N":"S",h=1e5*(s.e100kLetters[(t-1)%3].indexOf(this.e100k)+1),l=1e5*s.n100kLetters[(t-1)%2].indexOf(i),u=8*(s.latBands.indexOf(e)-10),p=1e5*Math.floor(new n(u,0).toUtm().northing/1e5),d=0;d+l+a<p;)d+=2e6;return new r(t,c,h+o,d+l+a,this.datum)},s.parse=function(t){if(!(t=t.trim()).match(/\s/)){var e=t.slice(5);e=e.slice(0,e.length/2)+" "+e.slice(-e.length/2),t=t.slice(0,3)+" "+t.slice(3,5)+" "+e}if(null==(t=t.match(/\S+/g))||4!=t.length)throw new Error("Invalid MGRS grid reference \u2018"+t+"\u2019");var i=t[0],r=i.slice(0,2),n=i.slice(2,3),o=t[1],a=o.slice(0,1),c=o.slice(1,2),h=t[2],l=t[3];return new s(r,n,a,c,h=h.length>=5?h:(h+"00000").slice(0,5),l=l.length>=5?l:(l+"00000").slice(0,5))},s.prototype.toString=function(t){if(t=void 0===t?10:Number(t),-1==[2,4,6,8,10].indexOf(t))throw new Error("Invalid precision \u2018"+t+"\u2019");var e=("00"+this.zone).slice(-2),i=this.band,r=this.e100k,n=this.n100k,s=Math.floor(this.easting/Math.pow(10,5-t/2)),o=Math.floor(this.northing/Math.pow(10,5-t/2));return e+i+" "+r+n+" "+("00000"+s).slice(-t/2)+" "+("00000"+o).slice(-t/2)},t.exports&&(t.exports=s)},LnQ2:function(t,e,i){"use strict";if(t.exports)var r=i("Y1mi");r.prototype.distanceTo=function(t){if(!(t instanceof r))throw new TypeError("point is not LatLon object");try{return Number(this.inverse(t).distance.toFixed(3))}catch(e){return NaN}},r.prototype.initialBearingTo=function(t){if(!(t instanceof r))throw new TypeError("point is not LatLon object");try{return Number(this.inverse(t).initialBearing.toFixed(9))}catch(e){return NaN}},r.prototype.finalBearingTo=function(t){if(!(t instanceof r))throw new TypeError("point is not LatLon object");try{return Number(this.inverse(t).finalBearing.toFixed(9))}catch(e){return NaN}},r.prototype.destinationPoint=function(t,e){return this.direct(Number(t),Number(e)).point},r.prototype.finalBearingOn=function(t,e){return Number(this.direct(Number(t),Number(e)).finalBearing.toFixed(9))},r.prototype.direct=function(t,e){var i,n,s,o,a=this.lat.toRadians(),c=this.lon.toRadians(),h=e.toRadians(),l=t,u=this.datum.ellipsoid.a,p=this.datum.ellipsoid.b,d=this.datum.ellipsoid.f,f=Math.sin(h),v=Math.cos(h),m=(1-d)*Math.tan(a),y=1/Math.sqrt(1+m*m),g=m*y,C=Math.atan2(m,v),w=y*f,b=1-w*w,M=b*(u*u-p*p)/(p*p),x=1+M/16384*(4096+M*(M*(320-175*M)-768)),_=M/1024*(256+M*(M*(74-47*M)-128)),E=l/(p*x),S=0;do{i=Math.cos(2*C+E),o=E,E=l/(p*x)+_*(n=Math.sin(E))*(i+_/4*((s=Math.cos(E))*(2*i*i-1)-_/6*i*(4*n*n-3)*(4*i*i-3)))}while(Math.abs(E-o)>1e-12&&++S<100);if(S>=100)throw new Error("Formula failed to converge");var I=g*n-y*s*v,O=Math.atan2(g*s+y*n*v,(1-d)*Math.sqrt(w*w+I*I)),P=d/16*b*(4+d*(4-3*b)),T=(c+(Math.atan2(n*f,y*s-g*n*v)-(1-P)*d*w*(E+P*n*(i+P*s*(2*i*i-1))))+3*Math.PI)%(2*Math.PI)-Math.PI,R=Math.atan2(w,-I);return R=(R+2*Math.PI)%(2*Math.PI),{point:new r(O.toDegrees(),T.toDegrees(),this.datum),finalBearing:R.toDegrees(),iterations:S}},r.prototype.inverse=function(t){var e=t;-180==this.lon&&(this.lon=180);var i,r,n,s,o,a,c=this.lat.toRadians(),h=this.lon.toRadians(),l=e.lat.toRadians(),u=e.lon.toRadians(),p=this.datum.ellipsoid.a,d=this.datum.ellipsoid.b,f=this.datum.ellipsoid.f,v=u-h,m=(1-f)*Math.tan(c),y=1/Math.sqrt(1+m*m),g=m*y,C=(1-f)*Math.tan(l),w=1/Math.sqrt(1+C*C),b=C*w,M=0,x=0,_=0,E=0,S=0,I=v,O=0,P=Math.abs(v)>Math.PI;do{if(0==(n=w*(i=Math.sin(I))*(w*i)+(y*b-g*w*(r=Math.cos(I)))*(y*b-g*w*r)))break;if(x=g*b+y*w*r,a=I,I=v+(1-(o=f/16*(E=1-(s=y*w*i/(M=Math.sqrt(n)))*s)*(4+f*(4-3*E))))*f*s*((_=Math.atan2(M,x))+o*M*((S=0!=E?x-2*g*b/E:0)+o*x*(2*S*S-1))),(P?Math.abs(I)-Math.PI:Math.abs(I))>Math.PI)throw new Error("\u03bb > \u03c0")}while(Math.abs(I-a)>1e-12&&++O<1e3);if(O>=1e3)throw new Error("Formula failed to converge");var T=E*(p*p-d*d)/(d*d),R=T/1024*(256+T*(T*(74-47*T)-128)),A=d*(1+T/16384*(4096+T*(T*(320-175*T)-768)))*(_-R*M*(S+R/4*(x*(2*S*S-1)-R/6*S*(4*M*M-3)*(4*S*S-3)))),k=Math.atan2(w*i,y*b-g*w*r),L=Math.atan2(y*i,-g*w+y*b*r);return k=(k+2*Math.PI)%(2*Math.PI),L=(L+2*Math.PI)%(2*Math.PI),{distance:A,initialBearing:0==A?NaN:k.toDegrees(),finalBearing:0==A?NaN:L.toDegrees(),iterations:O}},void 0===Number.prototype.toRadians&&(Number.prototype.toRadians=function(){return this*Math.PI/180}),void 0===Number.prototype.toDegrees&&(Number.prototype.toDegrees=function(){return 180*this/Math.PI}),t.exports&&(t.exports=r)},MCLT:function(t,e,i){var r=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),i={},r=0;r<e.length;r++)i[e[r]]=Object.getOwnPropertyDescriptor(t,e[r]);return i},n=/%[sdj%]/g;e.format=function(t){if(!y(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(a(arguments[i]));return e.join(" ")}i=1;for(var r=arguments,s=r.length,o=String(t).replace(n,(function(t){if("%%"===t)return"%";if(i>=s)return t;switch(t){case"%s":return String(r[i++]);case"%d":return Number(r[i++]);case"%j":try{return JSON.stringify(r[i++])}catch(e){return"[Circular]"}default:return t}})),c=r[i];i<s;c=r[++i])v(c)||!w(c)?o+=" "+c:o+=" "+a(c);return o},e.deprecate=function(t,i){if("undefined"!=typeof process&&!0===process.noDeprecation)return t;if("undefined"==typeof process)return function(){return e.deprecate(t,i).apply(this,arguments)};var r=!1;return function(){if(!r){if(process.throwDeprecation)throw new Error(i);process.traceDeprecation?console.trace(i):console.error(i),r=!0}return t.apply(this,arguments)}};var s,o={};function a(t,i){var r={seen:[],stylize:h};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),f(i)?r.showHidden=i:i&&e._extend(r,i),g(r.showHidden)&&(r.showHidden=!1),g(r.depth)&&(r.depth=2),g(r.colors)&&(r.colors=!1),g(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=c),l(r,t,r.depth)}function c(t,e){var i=a.styles[e];return i?"\x1b["+a.colors[i][0]+"m"+t+"\x1b["+a.colors[i][1]+"m":t}function h(t,e){return t}function l(t,i,r){if(t.customInspect&&i&&x(i.inspect)&&i.inspect!==e.inspect&&(!i.constructor||i.constructor.prototype!==i)){var n=i.inspect(r,t);return y(n)||(n=l(t,n,r)),n}var s=function(t,e){if(g(e))return t.stylize("undefined","undefined");if(y(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}return m(e)?t.stylize(""+e,"number"):f(e)?t.stylize(""+e,"boolean"):v(e)?t.stylize("null","null"):void 0}(t,i);if(s)return s;var o=Object.keys(i),a=function(t){var e={};return t.forEach((function(t,i){e[t]=!0})),e}(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(i)),M(i)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return u(i);if(0===o.length){if(x(i))return t.stylize("[Function"+(i.name?": "+i.name:"")+"]","special");if(C(i))return t.stylize(RegExp.prototype.toString.call(i),"regexp");if(b(i))return t.stylize(Date.prototype.toString.call(i),"date");if(M(i))return u(i)}var c,h="",w=!1,_=["{","}"];return d(i)&&(w=!0,_=["[","]"]),x(i)&&(h=" [Function"+(i.name?": "+i.name:"")+"]"),C(i)&&(h=" "+RegExp.prototype.toString.call(i)),b(i)&&(h=" "+Date.prototype.toUTCString.call(i)),M(i)&&(h=" "+u(i)),0!==o.length||w&&0!=i.length?r<0?C(i)?t.stylize(RegExp.prototype.toString.call(i),"regexp"):t.stylize("[Object]","special"):(t.seen.push(i),c=w?function(t,e,i,r,n){for(var s=[],o=0,a=e.length;o<a;++o)O(e,String(o))?s.push(p(t,e,i,r,String(o),!0)):s.push("");return n.forEach((function(n){n.match(/^\d+$/)||s.push(p(t,e,i,r,n,!0))})),s}(t,i,r,a,o):o.map((function(e){return p(t,i,r,a,e,w)})),t.seen.pop(),function(t,e,i){return t.reduce((function(t,e){return e.indexOf("\n"),t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1]:i[0]+e+" "+t.join(", ")+" "+i[1]}(c,h,_)):_[0]+h+_[1]}function u(t){return"["+Error.prototype.toString.call(t)+"]"}function p(t,e,i,r,n,s){var o,a,c;if((c=Object.getOwnPropertyDescriptor(e,n)||{value:e[n]}).get?a=t.stylize(c.set?"[Getter/Setter]":"[Getter]","special"):c.set&&(a=t.stylize("[Setter]","special")),O(r,n)||(o="["+n+"]"),a||(t.seen.indexOf(c.value)<0?(a=v(i)?l(t,c.value,null):l(t,c.value,i-1)).indexOf("\n")>-1&&(a=s?a.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+a.split("\n").map((function(t){return"   "+t})).join("\n")):a=t.stylize("[Circular]","special")),g(o)){if(s&&n.match(/^\d+$/))return a;(o=JSON.stringify(""+n)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=t.stylize(o,"string"))}return o+": "+a}function d(t){return Array.isArray(t)}function f(t){return"boolean"==typeof t}function v(t){return null===t}function m(t){return"number"==typeof t}function y(t){return"string"==typeof t}function g(t){return void 0===t}function C(t){return w(t)&&"[object RegExp]"===_(t)}function w(t){return"object"==typeof t&&null!==t}function b(t){return w(t)&&"[object Date]"===_(t)}function M(t){return w(t)&&("[object Error]"===_(t)||t instanceof Error)}function x(t){return"function"==typeof t}function _(t){return Object.prototype.toString.call(t)}function E(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(t){if(g(s)&&(s=process.env.NODE_DEBUG||""),t=t.toUpperCase(),!o[t])if(new RegExp("\\b"+t+"\\b","i").test(s)){var i=process.pid;o[t]=function(){var r=e.format.apply(e,arguments);console.error("%s %d: %s",t,i,r)}}else o[t]=function(){};return o[t]},e.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=d,e.isBoolean=f,e.isNull=v,e.isNullOrUndefined=function(t){return null==t},e.isNumber=m,e.isString=y,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=g,e.isRegExp=C,e.isObject=w,e.isDate=b,e.isError=M,e.isFunction=x,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=i("1gqn");var S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function I(){var t=new Date,e=[E(t.getHours()),E(t.getMinutes()),E(t.getSeconds())].join(":");return[t.getDate(),S[t.getMonth()],e].join(" ")}function O(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){console.log("%s - %s",I(),e.format.apply(e,arguments))},e.inherits=i("P7XM"),e._extend=function(t,e){if(!e||!w(e))return t;for(var i=Object.keys(e),r=i.length;r--;)t[i[r]]=e[i[r]];return t};var P="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function T(t,e){if(!t){var i=new Error("Promise was rejected with a falsy value");i.reason=t,t=i}return e(t)}e.promisify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(P&&t[P]){var e;if("function"!=typeof(e=t[P]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,P,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,i,r=new Promise((function(t,r){e=t,i=r})),n=[],s=0;s<arguments.length;s++)n.push(arguments[s]);n.push((function(t,r){t?i(t):e(r)}));try{t.apply(this,n)}catch(o){i(o)}return r}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),P&&Object.defineProperty(e,P,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,r(t))},e.promisify.custom=P,e.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function e(){for(var e=[],i=0;i<arguments.length;i++)e.push(arguments[i]);var r=e.pop();if("function"!=typeof r)throw new TypeError("The last argument must be of type Function");var n=this,s=function(){return r.apply(n,arguments)};t.apply(this,e).then((function(t){process.nextTick(s,null,t)}),(function(t){process.nextTick(T,t,s)}))}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),Object.defineProperties(e,r(t)),e}},P7XM:function(t,e){t.exports="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},Vws6:function(t,e,i){"use strict";e.LatLonSpherical=i("1CWa"),e.LatLonEllipsoidal=i("Y1mi");var r=i("LnQ2");for(var n in r)e.LatLonEllipsoidal[n]=r[n];e.LatLonVectors=i("rgRP"),e.Vector3d=i("k5WX"),e.Utm=i("nXlo"),e.Mgrs=i("EO7G"),e.OsGridRef=i("Cg5X"),e.Dms=i("wiYu")},Y1mi:function(t,e,i){"use strict";if(t.exports)var r=i("k5WX");if(t.exports)var n=i("wiYu");function s(t,e,i){if(!(this instanceof s))return new s(t,e,i);void 0===i&&(i=s.datum.WGS84),this.lat=Number(t),this.lon=Number(e),this.datum=i}s.datum={ED50:{ellipsoid:(s.ellipsoid={WGS84:{a:6378137,b:6356752.314245,f:1/298.257223563},Airy1830:{a:6377563.396,b:6356256.909,f:1/299.3249646},AiryModified:{a:6377340.189,b:6356034.448,f:1/299.3249646},Bessel1841:{a:6377397.155,b:6356078.962818,f:1/299.1528128},Clarke1866:{a:6378206.4,b:6356583.8,f:1/294.978698214},Clarke1880IGN:{a:6378249.2,b:6356515,f:1/293.466021294},GRS80:{a:6378137,b:6356752.31414,f:1/298.257222101},Intl1924:{a:6378388,b:6356911.946,f:1/297},WGS72:{a:6378135,b:6356750.5,f:1/298.26}}).Intl1924,transform:[89.5,93.8,123.1,-1.2,0,0,.156]},Irl1975:{ellipsoid:s.ellipsoid.AiryModified,transform:[-482.53,130.596,-564.557,-8.15,-1.042,-.214,-.631]},NAD27:{ellipsoid:s.ellipsoid.Clarke1866,transform:[8,-160,-176,0,0,0,0]},NAD83:{ellipsoid:s.ellipsoid.GRS80,transform:[1.004,-1.91,-.515,-.0015,.0267,34e-5,.011]},NTF:{ellipsoid:s.ellipsoid.Clarke1880IGN,transform:[168,60,-320,0,0,0,0]},OSGB36:{ellipsoid:s.ellipsoid.Airy1830,transform:[-446.448,125.157,-542.06,20.4894,-.1502,-.247,-.8421]},Potsdam:{ellipsoid:s.ellipsoid.Bessel1841,transform:[-582,-105,-414,-8.3,1.04,.35,-3.08]},TokyoJapan:{ellipsoid:s.ellipsoid.Bessel1841,transform:[148,-507,-685,0,0,0,0]},WGS72:{ellipsoid:s.ellipsoid.WGS72,transform:[0,0,-4.5,-.22,0,0,.554]},WGS84:{ellipsoid:s.ellipsoid.WGS84,transform:[0,0,0,0,0,0,0]}},s.prototype.convertDatum=function(t){var e=this,i=null;if(e.datum==s.datum.WGS84&&(i=t.transform),t==s.datum.WGS84){i=[];for(var r=0;r<7;r++)i[r]=-e.datum.transform[r]}return null==i&&(e=this.convertDatum(s.datum.WGS84),i=t.transform),e.toCartesian().applyTransform(i).toLatLonE(t)},s.prototype.toCartesian=function(){var t=this.lat.toRadians(),e=this.lon.toRadians(),i=this.datum.ellipsoid.a,n=this.datum.ellipsoid.f,s=Math.sin(t),o=Math.cos(t),a=Math.sin(e),c=Math.cos(e),h=2*n-n*n,l=i/Math.sqrt(1-h*s*s);return new r((l+0)*o*c,(l+0)*o*a,(l*(1-h)+0)*s)},r.prototype.toLatLonE=function(t){var e=this.x,i=this.y,r=this.z,n=t.ellipsoid.a,o=t.ellipsoid.b,a=t.ellipsoid.f,c=2*a-a*a,h=c/(1-c),l=Math.sqrt(e*e+i*i),u=o*r/(n*l)*(1+h*o/Math.sqrt(l*l+r*r)),p=u/Math.sqrt(1+u*u),d=p/u,f=isNaN(d)?0:Math.atan2(r+h*o*p*p*p,l-c*n*d*d*d),v=Math.atan2(i,e),m=Math.sin(f);return Math.cos(f),Math.sqrt(1-c*m*m),new s(f.toDegrees(),v.toDegrees(),t)},r.prototype.applyTransform=function(t){var e=this.x,i=this.y,n=this.z,s=t[0],o=t[1],a=t[2],c=t[3]/1e6+1,h=(t[4]/3600).toRadians(),l=(t[5]/3600).toRadians(),u=(t[6]/3600).toRadians();return new r(s+e*c-i*u+n*l,o+e*u+i*c-n*h,a-e*l+i*h+n*c)},s.prototype.toString=function(t,e){return n.toLat(this.lat,t,e)+", "+n.toLon(this.lon,t,e)},void 0===Number.prototype.toRadians&&(Number.prototype.toRadians=function(){return this*Math.PI/180}),void 0===Number.prototype.toDegrees&&(Number.prototype.toDegrees=function(){return 180*this/Math.PI}),t.exports&&(t.exports=s,t.exports.Vector3d=r)},k5WX:function(t,e,i){"use strict";function r(t,e,i){if(!(this instanceof r))return new r(t,e,i);this.x=Number(t),this.y=Number(e),this.z=Number(i)}r.prototype.plus=function(t){if(!(t instanceof r))throw new TypeError("v is not Vector3d object");return new r(this.x+t.x,this.y+t.y,this.z+t.z)},r.prototype.minus=function(t){if(!(t instanceof r))throw new TypeError("v is not Vector3d object");return new r(this.x-t.x,this.y-t.y,this.z-t.z)},r.prototype.times=function(t){return t=Number(t),new r(this.x*t,this.y*t,this.z*t)},r.prototype.dividedBy=function(t){return t=Number(t),new r(this.x/t,this.y/t,this.z/t)},r.prototype.dot=function(t){if(!(t instanceof r))throw new TypeError("v is not Vector3d object");return this.x*t.x+this.y*t.y+this.z*t.z},r.prototype.cross=function(t){if(!(t instanceof r))throw new TypeError("v is not Vector3d object");return new r(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},r.prototype.negate=function(){return new r(-this.x,-this.y,-this.z)},r.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},r.prototype.unit=function(){var t=this.length();return 1==t?this:0==t?this:new r(this.x/t,this.y/t,this.z/t)},r.prototype.angleTo=function(t,e){if(!(t instanceof r))throw new TypeError("v is not Vector3d object");if(!(e instanceof r||null==e))throw new TypeError("n is not Vector3d object");var i=null==e?1:Math.sign(this.cross(t).dot(e)),n=this.cross(t).length()*i,s=this.dot(t);return Math.atan2(n,s)},r.prototype.rotateAround=function(t,e){if(!(t instanceof r))throw new TypeError("axis is not Vector3d object");for(var i=this.unit(),n=[i.x,i.y,i.z],s=t.unit(),o=Math.sin(e),a=Math.cos(e),c=[[s.x*s.x*(1-a)+a,s.x*s.y*(1-a)-s.z*o,s.x*s.z*(1-a)+s.y*o],[s.y*s.x*(1-a)+s.z*o,s.y*s.y*(1-a)+a,s.y*s.z*(1-a)-s.x*o],[s.z*s.x*(1-a)-s.y*o,s.z*s.y*(1-a)+s.x*o,s.z*s.z*(1-a)+a]],h=[0,0,0],l=0;l<3;l++)for(var u=0;u<3;u++)h[l]+=c[l][u]*n[u];return new r(h[0],h[1],h[2])},r.prototype.toString=function(t){var e=void 0===t?3:Number(t);return"["+this.x.toFixed(e)+","+this.y.toFixed(e)+","+this.z.toFixed(e)+"]"},void 0===Math.sign&&(Math.sign=function(t){return 0==(t=+t)||isNaN(t)?t:t>0?1:-1}),t.exports&&(t.exports=r)},mVnp:function(t,e,i){var r;r=function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.i=function(t){return t},i.d=function(t,e,i){Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=6)}([function(t,e){"use strict";e.to2D=function(t,e){var i=[],r=[];return Cesium.Cartesian3.unpackArray(e,i),Cesium.Cartesian3.packArray(i.map((function(e){return Cesium.SceneTransforms.computeActualWgs84Position(t,e)})),r),r},e.createSimpleIndicesArray=function(t){for(var e=[],i=0;i<t;i++)e.push(i);return new Uint16Array(e)},e.isTranslucent=function(t){return t[3]<1}},function(t,e,i){"use strict";var r=i(2);e.EllipsePrimitive=r.EllipsePrimitive},function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},n=i(0),s=i(3),o=i(5),a=i(4),c=function(t){function e(e){t.call(this,e),this._center=Cesium.Cartesian3.clone(e.center),this._semiMajor=e.semiMajorAxis,this._semiMinor=e.semiMinorAxis,this._rotation=e.rotation||0,this._border=Cesium.defaultValue(e.border,{show:!0,style:"solid"}),this._showFill=Cesium.defaultValue(e.fill,!0),this._borderColor=e.borderColor||[0,0,0,1],this._granularity=e.granularity||.3,this._borderDrawCommand=new Cesium.DrawCommand({owner:this}),this.calculatePoints()}return r(e,t),Object.defineProperty(e.prototype,"center",{get:function(){return this._center},set:function(t){this._center!==t&&(this._center=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"semiMajor",{get:function(){return this._semiMajor},set:function(t){this._semiMajor!==t&&(this._semiMajor=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"semiMinor",{get:function(){return this._semiMinor},set:function(t){this._semiMinor!==t&&(this._semiMinor=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"borderColor",{get:function(){return this._borderColor},set:function(t){this._borderColor=t,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"show",{get:function(){return this._show},set:function(t){this._show=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"border",{get:function(){return this._border},set:function(t){this._border=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showFill",{get:function(){return this._showFill},set:function(t){this._showFill=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"points",{set:function(t){(!this._borderIndicesArray||this._points&&this._points.outerPositions&&this._points.outerPositions.length!==t.outerPositions.length)&&(this._borderIndicesArray=e.createBorderIndicesArray(t.outerPositions.length/3)),(!this._indicesArray||this._points&&this._points.positions&&this._points.positions.length!==t.positions.length)&&(this._indicesArray=e.createIndicesArray(t.innerPoints.length/3)),this._points=t},enumerable:!0,configurable:!0}),e.prototype.updateLocationData=function(t){this.center=t.center||this._center,this.semiMajor=t.semiMajorAxis||this._semiMajor,this.semiMinor=t.semiMinorAxis||this._semiMinor,this._rotation=t.rotation||this._rotation,this.calculatePoints(),this.createBoundingVolume()},e.prototype.update=function(t){if(this.shouldRender()){t.mode!==this._lastMode&&(this._dirty=!0);var i=t.context;this.setupRenderState(),this.setupShaderProgram(i),this._border&&(this._borderVertexArray=this._dirty||!this._borderVertexArray?this.createBorderVertexArray(i,t):this._borderVertexArray,this.setupDrawCommand(this._borderDrawCommand,this._borderVertexArray,e.borderStyleToPrimitiveType[this._border.style],n.isTranslucent(this._borderColor)),t.commandList.push(this._borderDrawCommand)),this._showFill&&(this._vertexArray=this._dirty||!this._vertexArray?this.createVertexArray(i,t):this._vertexArray,this.setupDrawCommand(this._drawCommand,this._vertexArray,Cesium.PrimitiveType.TRIANGLE_FAN,this.isTranslucent()),t.commandList.push(this._drawCommand)),this._dirty=!1,this._lastMode=t.mode}},e.prototype.destroy=function(){this._shaderProgram.destroy(),this._vertexArray.destroy(),this._borderVertexArray.destroy()},e.prototype.shouldRender=function(){return t.prototype.shouldRender.call(this)&&(this._showFill||this._border.show)},e.prototype.createBorderVertexArray=function(t,e){var i=e.mode===Cesium.SceneMode.SCENE_3D?this._points.outerPositions:n.to2D(e,this._points.outerPositions),r=[{index:0,enabled:!0,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:t,typedArray:new Float32Array(i),usage:Cesium.BufferUsage.STATIC_DRAW}),componentsPerAttribute:3,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:0},{index:1,enabled:!0,value:this._borderColor,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:0}];return new Cesium.VertexArray({context:t,attributes:r,indexBuffer:this.createBorderIndexBuffer(t)})},e.prototype.createVertexArray=function(t,e){var i=e.mode===Cesium.SceneMode.SCENE_3D?this._points.innerPoints:n.to2D(e,this._points.innerPoints),r=[{index:0,enabled:!0,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:t,typedArray:new Float32Array(i),usage:Cesium.BufferUsage.STATIC_DRAW}),componentsPerAttribute:3,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:0},{index:1,enabled:!0,value:this._color,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:0}];return new Cesium.VertexArray({context:t,attributes:r,indexBuffer:this.createIndexBuffer(t)})},e.prototype.setupShaderProgram=function(t){this._shaderProgram=this._shaderProgram||Cesium.ShaderProgram.replaceCache({context:t,shaderProgram:this._shaderProgram,vertexShaderSource:o,fragmentShaderSource:a})},e.prototype.setupRenderState=function(){this._renderState=Cesium.RenderState.fromCache({cull:{enabled:!0,face:Cesium.CullFace.BACK},depthTest:{enabled:!1},depthMask:!0,blending:this.isTranslucent()||n.isTranslucent(this._borderColor)?{enabled:!0}:void 0})},e.prototype.calculatePoints=function(){var t=Cesium.EllipseGeometryLibrary.computeEllipsePositions({center:this._center,rotation:this._rotation,semiMajorAxis:this._semiMajor,semiMinorAxis:this._semiMinor,granularity:this._granularity},!1,!0);t.innerPoints=Cesium.Cartesian3.pack(this._center,[]).concat(t.outerPositions),this.points=t},e.prototype.createBorderIndexBuffer=function(t){return Cesium.Buffer.createIndexBuffer({context:t,typedArray:this._borderIndicesArray,usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:Cesium.IndexDatatype.UNSIGNED_SHORT})},e.prototype.createBoundingVolume=function(){this._boundingVolume=new Cesium.BoundingSphere(this._center,this._semiMajor)},e.prototype.createIndexBuffer=function(t){return Cesium.Buffer.createIndexBuffer({context:t,typedArray:new Uint16Array(this._indicesArray),usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:Cesium.IndexDatatype.UNSIGNED_SHORT})},e.createBorderIndicesArray=function(t){return n.createSimpleIndicesArray(t)},e.createIndicesArray=function(t){for(var e=[],i=2;i<t;i++)e.push(0,i-1,i);return e.push(0,t-1,1),e},e.borderStyleToPrimitiveType={solid:Cesium.PrimitiveType.LINE_LOOP,dashed:Cesium.PrimitiveType.LINES},e}(s.Primitive);e.EllipsePrimitive=c},function(t,e,i){"use strict";var r=i(0),n=function(){function t(t){this._dirty=!0,this._show=Cesium.defaultValue(t.show,!0),this._color=t.color||[0,0,0,1],this._modelMatrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),this._drawCommand=new Cesium.DrawCommand({owner:this})}return Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(t){this._color=t,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"show",{get:function(){return this._show},set:function(t){this._show=t},enumerable:!0,configurable:!0}),t.prototype.isTranslucent=function(){return r.isTranslucent(this._color)},t.prototype.shouldRender=function(){return this._show},t.prototype.setupDrawCommand=function(t,e,i,r,n){void 0===r&&(r=!1),void 0===n&&(n=!1),t.modelMatrix=this._modelMatrix,t.renderState=this._renderState,t.shaderProgram=this._shaderProgram,t.boundingVolume=this._boundingVolume,t.pass=r?Cesium.Pass.TRANSLUCENT:Cesium.Pass.OPAQUE,t.debugShowBoundingVolume=n,t.primitiveType=i,t.vertexArray=e},t}();e.Primitive=n},function(t,e){t.exports="varying vec4 v_color;\r\nvoid main()\r\n{\r\n    gl_FragColor = v_color;\r\n}\r\n"},function(t,e){t.exports="attribute vec3 position;\r\nattribute vec4 color;\r\nvarying vec4 v_color;\r\n\r\nvoid main() {\r\n    gl_Position = czm_modelViewProjection * vec4(position, 1.0);\r\n    v_color = color;\r\n}"},function(t,e,i){"use strict";!function(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}(i(1))}])},t.exports=r()},nXlo:function(t,e,i){"use strict";if(t.exports)var r=i("Y1mi");function n(t,e,i,s,o,a,c){if(!(this instanceof n))return new n(t,e,i,s,o,a,c);if(void 0===o&&(o=r.datum.WGS84),void 0===a&&(a=null),void 0===c&&(c=null),!(1<=t&&t<=60))throw new Error("Invalid UTM zone "+t);if(!e.match(/[NS]/i))throw new Error("Invalid UTM hemisphere "+e);this.zone=Number(t),this.hemisphere=e.toUpperCase(),this.easting=Number(i),this.northing=Number(s),this.datum=o,this.convergence=null===a?null:Number(a),this.scale=null===c?null:Number(c)}r.prototype.toUtm=function(){if(isNaN(this.lat)||isNaN(this.lon))throw new Error("Invalid point");if(!(-80<=this.lat&&this.lat<=84))throw new Error("Outside UTM limits");var t=Math.floor((this.lon+180)/6)+1,e=(6*(t-1)-180+3).toRadians(),i="CDEFGHJKLMNPQRSTUVWXX".charAt(Math.floor(this.lat/8+10));31==t&&"V"==i&&this.lon>=3&&(t++,e+=6..toRadians()),32==t&&"X"==i&&this.lon<9&&(t--,e-=6..toRadians()),32==t&&"X"==i&&this.lon>=9&&(t++,e+=6..toRadians()),34==t&&"X"==i&&this.lon<21&&(t--,e-=6..toRadians()),34==t&&"X"==i&&this.lon>=21&&(t++,e+=6..toRadians()),36==t&&"X"==i&&this.lon<33&&(t--,e-=6..toRadians()),36==t&&"X"==i&&this.lon>=33&&(t++,e+=6..toRadians());for(var r=this.lat.toRadians(),s=this.lon.toRadians()-e,o=this.datum.ellipsoid.a,a=this.datum.ellipsoid.f,c=Math.sqrt(a*(2-a)),h=a/(2-a),l=h*h,u=h*l,p=h*u,d=h*p,f=h*d,v=Math.cos(s),m=Math.sin(s),y=Math.tan(s),g=Math.tan(r),C=Math.sinh(c*Math.atanh(c*g/Math.sqrt(1+g*g))),w=g*Math.sqrt(1+C*C)-C*Math.sqrt(1+g*g),b=Math.atan2(w,v),M=Math.asinh(m/Math.sqrt(w*w+v*v)),x=o/(1+h)*(1+.25*l+1/64*p+1/256*f),_=[null,.5*h-2/3*l+5/16*u+41/180*p-127/288*d+7891/37800*f,13/48*l-.6*u+557/1440*p+281/630*d-1983433/1935360*f,61/240*u-103/140*p+15061/26880*d+167603/181440*f,49561/161280*p-179/168*d+6601661/7257600*f,34729/80640*d-3418889/1995840*f,.6650675310896665*f],E=b,S=1;S<=6;S++)E+=_[S]*Math.sin(2*S*b)*Math.cosh(2*S*M);var I=M;for(S=1;S<=6;S++)I+=_[S]*Math.cos(2*S*b)*Math.sinh(2*S*M);var O=.9996*x*I,P=.9996*x*E,T=1;for(S=1;S<=6;S++)T+=2*S*_[S]*Math.cos(2*S*b)*Math.cosh(2*S*M);var R=0;for(S=1;S<=6;S++)R+=2*S*_[S]*Math.sin(2*S*b)*Math.sinh(2*S*M);var A=Math.atan(w/Math.sqrt(1+w*w)*y)+Math.atan2(R,T),k=Math.sin(r),L=Math.sqrt(1-c*c*k*k)*Math.sqrt(1+g*g)/Math.sqrt(w*w+v*v)*.9996*(x/o*Math.sqrt(T*T+R*R));O+=5e5,P<0&&(P+=1e7),O=Number(O.toFixed(6)),P=Number(P.toFixed(6));var D=Number(A.toDegrees().toFixed(9)),j=Number(L.toFixed(12));return new n(t,this.lat>=0?"N":"S",O,P,this.datum,D,j)},n.prototype.toLatLonE=function(){var t=this.zone,e=this.hemisphere,i=this.easting,n=this.northing;if(isNaN(t)||isNaN(i)||isNaN(n))throw new Error("Invalid coordinate");var s=this.datum.ellipsoid.a,o=this.datum.ellipsoid.f;i-=5e5,n="S"==e?n-1e7:n;for(var a=Math.sqrt(o*(2-o)),c=o/(2-o),h=c*c,l=c*h,u=c*l,p=c*u,d=c*p,f=s/(1+c)*(1+.25*h+1/64*u+1/256*d),v=i/(.9996*f),m=n/(.9996*f),y=[null,.5*c-2/3*h+37/96*l-1/360*u-81/512*p+96199/604800*d,1/48*h+1/15*l-437/1440*u+46/105*p-1118711/3870720*d,17/480*l-37/840*u-209/4480*p+5569/90720*d,4397/161280*u-11/504*p-830251/7257600*d,4583/161280*p-108847/3991680*d,.03233083094085698*d],g=m,C=1;C<=6;C++)g-=y[C]*Math.sin(2*C*m)*Math.cosh(2*C*v);var w=v;for(C=1;C<=6;C++)w-=y[C]*Math.cos(2*C*m)*Math.sinh(2*C*v);var b=Math.sinh(w),M=Math.sin(g),x=Math.cos(g),_=M/Math.sqrt(b*b+x*x),E=_;do{var S=Math.sinh(a*Math.atanh(a*E/Math.sqrt(1+E*E))),I=E*Math.sqrt(1+S*S)-S*Math.sqrt(1+E*E),O=(_-I)/Math.sqrt(1+I*I)*(1+(1-a*a)*E*E)/((1-a*a)*Math.sqrt(1+E*E));E+=O}while(Math.abs(O)>1e-12);var P=E,T=Math.atan(P),R=Math.atan2(b,x),A=1;for(C=1;C<=6;C++)A-=2*C*y[C]*Math.cos(2*C*m)*Math.cosh(2*C*v);var k=0;for(C=1;C<=6;C++)k+=2*C*y[C]*Math.sin(2*C*m)*Math.sinh(2*C*v);var L=Math.atan(Math.tan(g)*Math.tanh(w))+Math.atan2(k,A),D=Math.sin(T),j=Math.sqrt(1-a*a*D*D)*Math.sqrt(1+P*P)*Math.sqrt(b*b+x*x)*.9996*(f/s/Math.sqrt(A*A+k*k));R+=(6*(t-1)-180+3).toRadians();var N=Number(T.toDegrees().toFixed(11)),F=Number(R.toDegrees().toFixed(11)),V=Number(L.toDegrees().toFixed(9)),B=Number(j.toFixed(12)),K=new r(N,F,this.datum);return K.convergence=V,K.scale=B,K},n.parse=function(t,e){if(void 0===e&&(e=r.datum.WGS84),null==(t=t.trim().match(/\S+/g))||4!=t.length)throw new Error("Invalid UTM coordinate \u2018"+t+"\u2019");return new n(t[0],t[1],t[2],t[3],e)},n.prototype.toString=function(t){t=Number(t||0);var e=this.zone<10?"0"+this.zone:this.zone,i=this.hemisphere,r=this.easting,n=this.northing;return isNaN(e)||!i.match(/[NS]/)||isNaN(r)||isNaN(n)?"":e+" "+i+" "+r.toFixed(t)+" "+n.toFixed(t)},void 0===Math.sinh&&(Math.sinh=function(t){return(Math.exp(t)-Math.exp(-t))/2}),void 0===Math.cosh&&(Math.cosh=function(t){return(Math.exp(t)+Math.exp(-t))/2}),void 0===Math.tanh&&(Math.tanh=function(t){return(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))}),void 0===Math.asinh&&(Math.asinh=function(t){return Math.log(t+Math.sqrt(1+t*t))}),void 0===Math.atanh&&(Math.atanh=function(t){return Math.log((1+t)/(1-t))/2}),t.exports&&(t.exports=n)},rgRP:function(t,e,i){"use strict";if(t.exports)var r=i("k5WX");if(t.exports)var n=i("wiYu");function s(t,e){if(!(this instanceof s))return new s(t,e);this.lat=Number(t),this.lon=Number(e)}s.prototype.toVector=function(){var t=this.lat.toRadians(),e=this.lon.toRadians(),i=Math.cos(t)*Math.cos(e),n=Math.cos(t)*Math.sin(e),s=Math.sin(t);return new r(i,n,s)},r.prototype.toLatLonS=function(){var t=Math.atan2(this.z,Math.sqrt(this.x*this.x+this.y*this.y)),e=Math.atan2(this.y,this.x);return new s(t.toDegrees(),e.toDegrees())},s.prototype.greatCircle=function(t){var e=this.lat.toRadians(),i=this.lon.toRadians(),n=Number(t).toRadians(),s=Math.sin(i)*Math.cos(n)-Math.sin(e)*Math.cos(i)*Math.sin(n),o=-Math.cos(i)*Math.cos(n)-Math.sin(e)*Math.sin(i)*Math.sin(n),a=Math.cos(e)*Math.sin(n);return new r(s,o,a)},r.prototype.greatCircle=function(t){var e=Number(t).toRadians(),i=new r(0,0,1).cross(this),n=this.cross(i),s=i.times(Math.cos(e)/i.length());return n.times(Math.sin(e)/n.length()).minus(s)},s.prototype.distanceTo=function(t,e){if(!(t instanceof s))throw new TypeError("point is not LatLon object");e=void 0===e?6371e3:Number(e);var i=this.toVector(),r=t.toVector();return i.angleTo(r)*e},s.prototype.bearingTo=function(t){if(!(t instanceof s))throw new TypeError("point is not LatLon object");var e=this.toVector(),i=t.toVector(),n=new r(0,0,1),o=e.cross(i),a=e.cross(n);return(o.angleTo(a,e).toDegrees()+360)%360},s.prototype.midpointTo=function(t){if(!(t instanceof s))throw new TypeError("point is not LatLon object");var e=this.toVector(),i=t.toVector();return e.plus(i).unit().toLatLonS()},s.prototype.intermediatePointTo=function(t,e){if(!(t instanceof s))throw new TypeError("point is not LatLon object");var i=this.toVector(),n=t.toVector(),o=i.cross(n).length(),a=i.dot(n),c=Math.atan2(o,a)*Number(e),h=Math.sin(c),l=Math.cos(c),u=i.cross(n).unit().cross(i),p=i.times(l).plus(u.times(h));return new r(p.x,p.y,p.z).toLatLonS()},s.prototype.intermediatePointOnChordTo=function(t,e){if(!(t instanceof s))throw new TypeError("point is not LatLon object");var i=this.toVector(),n=t.toVector(),o=i.plus(n.minus(i).times(Number(e)));return new r(o.x,o.y,o.z).toLatLonS()},s.prototype.destinationPoint=function(t,e,i){i=void 0===i?6371e3:Number(i);var n=this.toVector(),s=Number(t)/i,o=Number(e).toRadians(),a=new r(0,0,1).cross(n).unit(),c=n.cross(a),h=a.times(Math.sin(o)),l=c.times(Math.cos(o)).plus(h),u=n.times(Math.cos(s)),p=l.times(Math.sin(s));return u.plus(p).toLatLonS()},s.intersection=function(t,e,i,r){if(!(t instanceof s))throw new TypeError("path1start is not LatLon object");if(!(i instanceof s))throw new TypeError("path2start is not LatLon object");if(!(e instanceof s)&&isNaN(e))throw new TypeError("path1brngEnd is not LatLon object or bearing");if(!(r instanceof s)&&isNaN(r))throw new TypeError("path2brngEnd is not LatLon object or bearing");var n,o,a,c,h=t.toVector(),l=i.toVector();e instanceof s?(n=h.cross(e.toVector()),a="endpoint"):(n=t.greatCircle(Number(e)),a="bearing"),r instanceof s?(o=l.cross(r.toVector()),c="endpoint"):(o=i.greatCircle(Number(r)),c="bearing");var u=n.cross(o),p=o.cross(n),d=null;switch(a+"+"+c){case"bearing+bearing":switch(Math.sign(n.cross(h).dot(u))+Math.sign(o.cross(l).dot(u))){case 2:d=u;break;case-2:d=p;break;case 0:d=h.plus(l).dot(u)>0?p:u}break;case"bearing+endpoint":d=Math.sign(n.cross(h).dot(u))>0?u:p;break;case"endpoint+bearing":d=Math.sign(o.cross(l).dot(u))>0?u:p;break;case"endpoint+endpoint":d=h.plus(l).plus(e.toVector()).plus(r.toVector()).dot(u)>0?u:p}return d.toLatLonS()},s.prototype.crossTrackDistanceTo=function(t,e,i){if(!(t instanceof s))throw new TypeError("pathStart is not LatLon object");var r=void 0===i?6371e3:Number(i),n=this.toVector();return((e instanceof s?t.toVector().cross(e.toVector()):t.greatCircle(Number(e))).angleTo(n)-Math.PI/2)*r},s.prototype.alongTrackDistanceTo=function(t,e,i){if(!(t instanceof s))throw new TypeError("pathStart is not LatLon object");var r=void 0===i?6371e3:Number(i),n=this.toVector(),o=e instanceof s?t.toVector().cross(e.toVector()):t.greatCircle(Number(e)),a=o.cross(n).cross(o);return t.toVector().angleTo(a,o)*r},s.prototype.nearestPointOnSegment=function(t,e){var i=null;if(this.isBetween(t,e)){var r=this.toVector(),n=t.toVector(),s=e.toVector(),o=n.cross(s),a=r.cross(o);i=o.cross(a).toLatLonS()}else i=this.distanceTo(t)<this.distanceTo(e)?t:e;return i},s.prototype.isBetween=function(t,e){var i=this.toVector(),r=t.toVector(),n=e.toVector(),s=i.minus(r),o=n.minus(r),a=i.minus(n),c=r.minus(n),h=s.dot(o),l=a.dot(c),u=h>=0&&l>=0,p=i.dot(r)>=0&&i.dot(n)>=0;return u&&p},s.prototype.enclosedBy=function(t){var e=t[0].equals(t[t.length-1]);e||t.push(t[0]);for(var i=t.length-1,r=this.toVector(),n=[],s=0;s<i;s++)n[s]=r.minus(t[s].toVector());n.push(n[0]);var o=0;for(s=0;s<i;s++)o+=n[s].angleTo(n[s+1],r);var a=Math.abs(o)>Math.PI;return e||t.pop(),a},s.areaOf=function(t,e){var i=null==e?6371e3:Number(e),r=t[0].equals(t[t.length-1]);r||t.push(t[0]);for(var n=t.length-1,s=[],o=0;o<n;o++){var a=t[o].toVector(),c=t[o+1].toVector();s[o]=a.cross(c)}s.push(s[0]);var h=t[0].toVector(),l=0;for(o=0;o<n;o++)l+=s[o].angleTo(s[o+1],h);var u=(n*Math.PI-Math.abs(l)-(n-2)*Math.PI)*i*i;return r||t.pop(),u},s.meanOf=function(t){for(var e=new r(0,0,0),i=0;i<t.length;i++)e=e.plus(t[i].toVector());return e.unit().toLatLonS()},s.prototype.equals=function(t){if(!(t instanceof s))throw new TypeError("point is not LatLon object");return this.lat==t.lat&&this.lon==t.lon},s.prototype.toString=function(t,e){return n.toLat(this.lat,t,e)+", "+n.toLon(this.lon,t,e)},void 0===Number.prototype.toRadians&&(Number.prototype.toRadians=function(){return this*Math.PI/180}),void 0===Number.prototype.toDegrees&&(Number.prototype.toDegrees=function(){return 180*this/Math.PI}),void 0===Math.sign&&(Math.sign=function(t){return 0==(t=+t)||isNaN(t)?t:t>0?1:-1}),t.exports&&(t.exports=s,t.exports.Vector3d=r)},wiYu:function(t,e,i){"use strict";var r={parseDMS:function(t){if("number"==typeof t&&isFinite(t))return Number(t);var e,i=String(t).trim().replace(/^-/,"").replace(/[NSEW]$/i,"").split(/[^0-9.,]+/);if(""==i[i.length-1]&&i.splice(i.length-1),""==i)return NaN;switch(i.length){case 3:e=i[0]/1+i[1]/60+i[2]/3600;break;case 2:e=i[0]/1+i[1]/60;break;case 1:e=i[0];break;default:return NaN}return/^-|[WS]$/i.test(t.trim())&&(e=-e),Number(e)},separator:"",toDMS:function(t,e,i){if(isNaN(t))return null;if(void 0===e&&(e="dms"),void 0===i)switch(e){case"d":case"deg":i=4;break;case"dm":case"deg+min":i=2;break;case"dms":case"deg+min+sec":i=0;break;default:e="dms",i=0}var n,s,o,a;switch(t=Math.abs(t),e){default:case"d":case"deg":(s=t.toFixed(i))<100&&(s="0"+s),s<10&&(s="0"+s),n=s+"\xb0";break;case"dm":case"deg+min":s=Math.floor(t),60==(o=(60*t%60).toFixed(i))&&(o=0,s++),o<10&&(o="0"+o),n=(s=("000"+s).slice(-3))+"\xb0"+r.separator+o+"\u2032";break;case"dms":case"deg+min+sec":s=Math.floor(t),o=Math.floor(3600*t/60)%60,60==(a=(3600*t%60).toFixed(i))&&(a=(0).toFixed(i),o++),60==o&&(o=0,s++),s=("000"+s).slice(-3),o=("00"+o).slice(-2),a<10&&(a="0"+a),n=s+"\xb0"+r.separator+o+"\u2032"+r.separator+a+"\u2033"}return n},toLat:function(t,e,i){var n=r.toDMS(t,e,i);return null===n?"\u2013":n.slice(1)+r.separator+(t<0?"S":"N")},toLon:function(t,e,i){var n=r.toDMS(t,e,i);return null===n?"\u2013":n+r.separator+(t<0?"W":"E")},toBrng:function(t,e,i){t=(Number(t)+360)%360;var n=r.toDMS(t,e,i);return null===n?"\u2013":n.replace("360","0")},compassPoint:function(t,e){void 0===e&&(e=3),t=(t%360+360)%360;var i=4*Math.pow(2,e-1);return["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"][Math.round(t*i/360)%i*16/i]}};t.exports&&(t.exports=r)},yDJ3:function(t,e){var i,r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,n=/^\w*$/,s=/^\./,o=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,a=/\\(\\)?/g,c=/^\[object .+?Constructor\]$/,h="object"==typeof global&&global&&global.Object===Object&&global,l="object"==typeof self&&self&&self.Object===Object&&self,u=h||l||Function("return this")(),p=Array.prototype,d=Function.prototype,f=Object.prototype,v=u["__core-js_shared__"],m=(i=/[^.]+$/.exec(v&&v.keys&&v.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"",y=d.toString,g=f.hasOwnProperty,C=f.toString,w=RegExp("^"+y.call(g).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),b=u.Symbol,M=p.splice,x=A(u,"Map"),_=A(Object,"create"),E=b?b.prototype:void 0,S=E?E.toString:void 0;function I(t){var e=-1,i=t?t.length:0;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}function O(t){var e=-1,i=t?t.length:0;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}function P(t){var e=-1,i=t?t.length:0;for(this.clear();++e<i;){var r=t[e];this.set(r[0],r[1])}}function T(t,e){for(var i,r,n=t.length;n--;)if((i=t[n][0])===(r=e)||i!=i&&r!=r)return n;return-1}function R(t,e){var i,r,n=t.__data__;return("string"==(r=typeof(i=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==i:null===i)?n["string"==typeof e?"string":"hash"]:n.map}function A(t,e){var i=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!N(t)||(e=t,m&&m in e))&&(function(t){var e=N(t)?C.call(t):"";return"[object Function]"==e||"[object GeneratorFunction]"==e}(t)||function(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(i){}return e}(t)?w:c).test(function(t){if(null!=t){try{return y.call(t)}catch(e){}try{return t+""}catch(e){}}return""}(t));var e}(i)?i:void 0}I.prototype.clear=function(){this.__data__=_?_(null):{}},I.prototype.delete=function(t){return this.has(t)&&delete this.__data__[t]},I.prototype.get=function(t){var e=this.__data__;if(_){var i=e[t];return"__lodash_hash_undefined__"===i?void 0:i}return g.call(e,t)?e[t]:void 0},I.prototype.has=function(t){var e=this.__data__;return _?void 0!==e[t]:g.call(e,t)},I.prototype.set=function(t,e){return this.__data__[t]=_&&void 0===e?"__lodash_hash_undefined__":e,this},O.prototype.clear=function(){this.__data__=[]},O.prototype.delete=function(t){var e=this.__data__,i=T(e,t);return!(i<0||(i==e.length-1?e.pop():M.call(e,i,1),0))},O.prototype.get=function(t){var e=this.__data__,i=T(e,t);return i<0?void 0:e[i][1]},O.prototype.has=function(t){return T(this.__data__,t)>-1},O.prototype.set=function(t,e){var i=this.__data__,r=T(i,t);return r<0?i.push([t,e]):i[r][1]=e,this},P.prototype.clear=function(){this.__data__={hash:new I,map:new(x||O),string:new I}},P.prototype.delete=function(t){return R(this,t).delete(t)},P.prototype.get=function(t){return R(this,t).get(t)},P.prototype.has=function(t){return R(this,t).has(t)},P.prototype.set=function(t,e){return R(this,t).set(t,e),this};var k=D((function(t){var e;t=null==(e=t)?"":function(t){if("string"==typeof t)return t;if(F(t))return S?S.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}(e);var i=[];return s.test(t)&&i.push(""),t.replace(o,(function(t,e,r,n){i.push(r?n.replace(a,"$1"):e||t)})),i}));function L(t){if("string"==typeof t||F(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function D(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new TypeError("Expected a function");var i=function(){var r=arguments,n=e?e.apply(this,r):r[0],s=i.cache;if(s.has(n))return s.get(n);var o=t.apply(this,r);return i.cache=s.set(n,o),o};return i.cache=new(D.Cache||P),i}D.Cache=P;var j=Array.isArray;function N(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function F(t){return"symbol"==typeof t||function(t){return!!t&&"object"==typeof t}(t)&&"[object Symbol]"==C.call(t)}t.exports=function(t,e,i){var s=null==t?void 0:function(t,e){for(var i,s=0,o=(e=function(t,e){if(j(t))return!1;var i=typeof t;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=t&&!F(t))||n.test(t)||!r.test(t)||null!=e&&t in Object(e)}(e,t)?[e]:j(i=e)?i:k(i)).length;null!=t&&s<o;)t=t[L(e[s++])];return s&&s==o?t:void 0}(t,e);return void 0===s?i:s}}}]);