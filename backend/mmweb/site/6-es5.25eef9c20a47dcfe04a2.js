function _get(e,t,i){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=_superPropBase(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var i,n=_getPrototypeOf(e);if(t){var r=_getPrototypeOf(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{"1CWa":function(e,t,i){"use strict";if(e.exports)var n=i("wiYu");function r(e,t){if(!(this instanceof r))return new r(e,t);this.lat=Number(e),this.lon=Number(t)}r.prototype.distanceTo=function(e,t){if(!(e instanceof r))throw new TypeError("point is not LatLon object");var i=t=void 0===t?6371e3:Number(t),n=this.lat.toRadians(),s=this.lon.toRadians(),o=e.lat.toRadians(),a=o-n,c=e.lon.toRadians()-s,u=Math.sin(a/2)*Math.sin(a/2)+Math.cos(n)*Math.cos(o)*Math.sin(c/2)*Math.sin(c/2);return i*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)))},r.prototype.bearingTo=function(e){if(!(e instanceof r))throw new TypeError("point is not LatLon object");var t=this.lat.toRadians(),i=e.lat.toRadians(),n=(e.lon-this.lon).toRadians(),s=Math.sin(n)*Math.cos(i),o=Math.cos(t)*Math.sin(i)-Math.sin(t)*Math.cos(i)*Math.cos(n);return(Math.atan2(s,o).toDegrees()+360)%360},r.prototype.finalBearingTo=function(e){if(!(e instanceof r))throw new TypeError("point is not LatLon object");return(e.bearingTo(this)+180)%360},r.prototype.midpointTo=function(e){if(!(e instanceof r))throw new TypeError("point is not LatLon object");var t=this.lat.toRadians(),i=this.lon.toRadians(),n=e.lat.toRadians(),s=(e.lon-this.lon).toRadians(),o=Math.cos(n)*Math.cos(s),a=Math.cos(n)*Math.sin(s),c=Math.sqrt((Math.cos(t)+o)*(Math.cos(t)+o)+a*a),u=Math.sin(t)+Math.sin(n),l=Math.atan2(u,c),h=i+Math.atan2(a,Math.cos(t)+o);return new r(l.toDegrees(),(h.toDegrees()+540)%360-180)},r.prototype.intermediatePointTo=function(e,t){if(!(e instanceof r))throw new TypeError("point is not LatLon object");var i=this.lat.toRadians(),n=this.lon.toRadians(),s=e.lat.toRadians(),o=e.lon.toRadians(),a=Math.sin(i),c=Math.cos(i),u=Math.sin(n),l=Math.cos(n),h=Math.sin(s),p=Math.cos(s),f=Math.sin(o),v=Math.cos(o),d=s-i,y=o-n,m=Math.sin(d/2)*Math.sin(d/2)+Math.cos(i)*Math.cos(s)*Math.sin(y/2)*Math.sin(y/2),g=2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)),C=Math.sin((1-t)*g)/Math.sin(g),_=Math.sin(t*g)/Math.sin(g),w=C*c*l+_*p*v,b=C*c*u+_*p*f,k=Math.atan2(C*a+_*h,Math.sqrt(w*w+b*b)),M=Math.atan2(b,w);return new r(k.toDegrees(),(M.toDegrees()+540)%360-180)},r.prototype.destinationPoint=function(e,t,i){i=void 0===i?6371e3:i;var n=Number(e)/Number(i),s=Number(t).toRadians(),o=this.lat.toRadians(),a=this.lon.toRadians(),c=Math.sin(o),u=Math.cos(o),l=Math.sin(n),h=Math.cos(n),p=Math.sin(s),f=c*h+u*l*Math.cos(s),v=Math.asin(f),d=a+Math.atan2(p*l*u,h-c*f);return new r(v.toDegrees(),(d.toDegrees()+540)%360-180)},r.intersection=function(e,t,i,n){if(!(e instanceof r))throw new TypeError("p1 is not LatLon object");if(!(i instanceof r))throw new TypeError("p2 is not LatLon object");var s=e.lat.toRadians(),o=e.lon.toRadians(),a=i.lat.toRadians(),c=i.lon.toRadians(),u=Number(t).toRadians(),l=Number(n).toRadians(),h=a-s,p=c-o,f=2*Math.asin(Math.sqrt(Math.sin(h/2)*Math.sin(h/2)+Math.cos(s)*Math.cos(a)*Math.sin(p/2)*Math.sin(p/2)));if(0==f)return null;var v=Math.acos((Math.sin(a)-Math.sin(s)*Math.cos(f))/(Math.sin(f)*Math.cos(s)));isNaN(v)&&(v=0);var d=Math.acos((Math.sin(s)-Math.sin(a)*Math.cos(f))/(Math.sin(f)*Math.cos(a))),y=u-(Math.sin(c-o)>0?v:2*Math.PI-v),m=(Math.sin(c-o)>0?2*Math.PI-d:d)-l;if(0==Math.sin(y)&&0==Math.sin(m))return null;if(Math.sin(y)*Math.sin(m)<0)return null;var g=-Math.cos(y)*Math.cos(m)+Math.sin(y)*Math.sin(m)*Math.cos(f),C=Math.atan2(Math.sin(f)*Math.sin(y)*Math.sin(m),Math.cos(m)+Math.cos(y)*g),_=Math.asin(Math.sin(s)*Math.cos(C)+Math.cos(s)*Math.sin(C)*Math.cos(u)),w=o+Math.atan2(Math.sin(u)*Math.sin(C)*Math.cos(s),Math.cos(C)-Math.sin(s)*Math.sin(_));return new r(_.toDegrees(),(w.toDegrees()+540)%360-180)},r.prototype.crossTrackDistanceTo=function(e,t,i){if(!(e instanceof r))throw new TypeError("\u2018pathStart\u2019 is not LatLon object");if(!(t instanceof r))throw new TypeError("\u2018pathEnd\u2019 is not LatLon object");var n=void 0===i?6371e3:Number(i),s=e.distanceTo(this,n)/n,o=e.bearingTo(this).toRadians(),a=e.bearingTo(t).toRadians();return Math.asin(Math.sin(s)*Math.sin(o-a))*n},r.prototype.alongTrackDistanceTo=function(e,t,i){if(!(e instanceof r))throw new TypeError("\u2018pathStart\u2019 is not LatLon object");if(!(t instanceof r))throw new TypeError("\u2018pathEnd\u2019 is not LatLon object");var n=void 0===i?6371e3:i,s=e.distanceTo(this,n)/n,o=e.bearingTo(this).toRadians(),a=e.bearingTo(t).toRadians(),c=Math.asin(Math.sin(s)*Math.sin(o-a));return Math.acos(Math.cos(s)/Math.abs(Math.cos(c)))*Math.sign(Math.cos(a-o))*n},r.prototype.maxLatitude=function(e){var t=Number(e).toRadians(),i=this.lat.toRadians();return Math.acos(Math.abs(Math.sin(t)*Math.cos(i))).toDegrees()},r.crossingParallels=function(e,t,i){var n=Number(i).toRadians(),r=e.lat.toRadians(),s=e.lon.toRadians(),o=t.lat.toRadians(),a=t.lon.toRadians()-s,c=Math.sin(r)*Math.cos(o)*Math.cos(n)*Math.sin(a),u=Math.sin(r)*Math.cos(o)*Math.cos(n)*Math.cos(a)-Math.cos(r)*Math.sin(o)*Math.cos(n),l=Math.cos(r)*Math.cos(o)*Math.sin(n)*Math.sin(a);if(l*l>c*c+u*u)return null;var h=Math.atan2(-u,c),p=Math.acos(l/Math.sqrt(c*c+u*u)),f=s+h+p;return{lon1:((s+h-p).toDegrees()+540)%360-180,lon2:(f.toDegrees()+540)%360-180}},r.prototype.rhumbDistanceTo=function(e,t){if(!(e instanceof r))throw new TypeError("point is not LatLon object");var i=t=void 0===t?6371e3:Number(t),n=this.lat.toRadians(),s=e.lat.toRadians(),o=s-n,a=Math.abs(e.lon-this.lon).toRadians();a>Math.PI&&(a-=2*Math.PI);var c=Math.log(Math.tan(s/2+Math.PI/4)/Math.tan(n/2+Math.PI/4)),u=Math.abs(c)>1e-11?o/c:Math.cos(n);return Math.sqrt(o*o+u*u*a*a)*i},r.prototype.rhumbBearingTo=function(e){if(!(e instanceof r))throw new TypeError("point is not LatLon object");var t=this.lat.toRadians(),i=e.lat.toRadians(),n=(e.lon-this.lon).toRadians();n>Math.PI&&(n-=2*Math.PI),n<-Math.PI&&(n+=2*Math.PI);var s=Math.log(Math.tan(i/2+Math.PI/4)/Math.tan(t/2+Math.PI/4));return(Math.atan2(n,s).toDegrees()+360)%360},r.prototype.rhumbDestinationPoint=function(e,t,i){i=void 0===i?6371e3:i;var n=this.lat.toRadians(),s=this.lon.toRadians(),o=Number(t).toRadians(),a=e/i,c=a*Math.cos(o),u=n+c;Math.abs(u)>Math.PI/2&&(u=u>0?Math.PI-u:-Math.PI-u);var l=Math.log(Math.tan(u/2+Math.PI/4)/Math.tan(n/2+Math.PI/4)),h=Math.abs(l)>1e-11?c/l:Math.cos(n),p=s+a*Math.sin(o)/h;return new r(u.toDegrees(),(p.toDegrees()+540)%360-180)},r.prototype.rhumbMidpointTo=function(e){if(!(e instanceof r))throw new TypeError("point is not LatLon object");var t=this.lat.toRadians(),i=this.lon.toRadians(),n=e.lat.toRadians(),s=e.lon.toRadians();Math.abs(s-i)>Math.PI&&(i+=2*Math.PI);var o=(t+n)/2,a=Math.tan(Math.PI/4+t/2),c=Math.tan(Math.PI/4+n/2),u=Math.tan(Math.PI/4+o/2),l=((s-i)*Math.log(u)+i*Math.log(c)-s*Math.log(a))/Math.log(c/a);return isFinite(l)||(l=(i+s)/2),r(o.toDegrees(),(l.toDegrees()+540)%360-180)},r.areaOf=function(e,t){var i=void 0===t?6371e3:Number(t),n=e[0].equals(e[e.length-1]);n||e.push(e[0]);for(var r=e.length-1,s=0,o=0;o<r;o++){var a=e[o].lat.toRadians(),c=e[o+1].lat.toRadians(),u=(e[o+1].lon-e[o].lon).toRadians();s+=2*Math.atan2(Math.tan(u/2)*(Math.tan(a/2)+Math.tan(c/2)),1+Math.tan(a/2)*Math.tan(c/2))}(function(e){for(var t=0,i=e[0].bearingTo(e[1]),n=0;n<e.length-1;n++){var r=e[n].bearingTo(e[n+1]),s=e[n].finalBearingTo(e[n+1]);t+=(r-i+540)%360-180,t+=(s-r+540)%360-180,i=s}return t+=((r=e[0].bearingTo(e[1]))-i+540)%360-180,Math.abs(t)<90})(e)&&(s=Math.abs(s)-2*Math.PI);var l=Math.abs(s*i*i);return n||e.pop(),l},r.prototype.equals=function(e){if(!(e instanceof r))throw new TypeError("point is not LatLon object");return this.lat==e.lat&&this.lon==e.lon},r.prototype.toString=function(e,t){return n.toLat(this.lat,e,t)+", "+n.toLon(this.lon,e,t)},void 0===Number.prototype.toRadians&&(Number.prototype.toRadians=function(){return this*Math.PI/180}),void 0===Number.prototype.toDegrees&&(Number.prototype.toDegrees=function(){return 180*this/Math.PI}),e.exports&&(e.exports=r)},"1gqn":function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},"862v":function(e,t,i){"use strict";var n;i.r(t);var r=i("ofXK"),s=i("tyNb"),o=i("fXoL"),a=i("Vws6"),c=i("MCLT"),u=i("XNiG"),l=i("oB13");function h(e){return e?Object(l.a)((function(){return new u.a}),e):Object(l.a)(new u.a)}var p=i("5+tZ"),f=i("3E0/"),v=i("1G5W"),d=i("pLZG"),y=i("lJxs"),m=i("eIep"),g=i("vkgz"),C=i("VRyK"),_=i("HDdC"),w=i("LRne"),b=i("Cfvw"),k=(i("2Vo4"),i("xgIS")),M=i("mVnp"),x=i("8USJ");function S(e){return null!=e}function E(e){return null==e}function I(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}var P=function e(t,i,n,r){_classCallCheck(this,e),this.input=i,this.errLocation=n,this.ctxLocation=r,this.message="Parser Error: ".concat(t," ").concat(n," [").concat(i,"] in ").concat(r)},O=function e(t,i){_classCallCheck(this,e),this.start=t,this.end=i},R=function(){function e(t){_classCallCheck(this,e),this.span=t}return _createClass(e,[{key:"visit",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return null}},{key:"toString",value:function(){return"AST"}}]),e}(),T=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r,s){var o;return _classCallCheck(this,i),(o=t.call(this,e)).prefix=n,o.uninterpretedExpression=r,o.location=s,o}return _createClass(i,[{key:"visit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.visitQuote(this,t)}},{key:"toString",value:function(){return"Quote"}}]),i}(R),A=function(e){_inherits(i,e);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"visit",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]}}]),i}(R),L=function(e){_inherits(i,e);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"visit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.visitImplicitReceiver(this,t)}}]),i}(R),D=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n){var r;return _classCallCheck(this,i),(r=t.call(this,e)).expressions=n,r}return _createClass(i,[{key:"visit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.visitChain(this,t)}}]),i}(R),j=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r,s){var o;return _classCallCheck(this,i),(o=t.call(this,e)).condition=n,o.trueExp=r,o.falseExp=s,o}return _createClass(i,[{key:"visit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.visitConditional(this,t)}}]),i}(R),N=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r){var s;return _classCallCheck(this,i),(s=t.call(this,e)).receiver=n,s.name=r,s}return _createClass(i,[{key:"visit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.visitPropertyRead(this,t)}}]),i}(R),F=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r,s){var o;return _classCallCheck(this,i),(o=t.call(this,e)).receiver=n,o.name=r,o.value=s,o}return _createClass(i,[{key:"visit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.visitPropertyWrite(this,t)}}]),i}(R),V=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r){var s;return _classCallCheck(this,i),(s=t.call(this,e)).receiver=n,s.name=r,s}return _createClass(i,[{key:"visit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.visitSafePropertyRead(this,t)}}]),i}(R),B=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r){var s;return _classCallCheck(this,i),(s=t.call(this,e)).obj=n,s.key=r,s}return _createClass(i,[{key:"visit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.visitKeyedRead(this,t)}}]),i}(R),K=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r,s){var o;return _classCallCheck(this,i),(o=t.call(this,e)).obj=n,o.key=r,o.value=s,o}return _createClass(i,[{key:"visit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.visitKeyedWrite(this,t)}}]),i}(R),z=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r,s){var o;return _classCallCheck(this,i),(o=t.call(this,e)).exp=n,o.name=r,o.args=s,o}return _createClass(i,[{key:"visit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.visitPipe(this,t)}}]),i}(R),G=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n){var r;return _classCallCheck(this,i),(r=t.call(this,e)).value=n,r}return _createClass(i,[{key:"visit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.visitLiteralPrimitive(this,t)}}]),i}(R),U=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n){var r;return _classCallCheck(this,i),(r=t.call(this,e)).expressions=n,r}return _createClass(i,[{key:"visit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.visitLiteralArray(this,t)}}]),i}(R),W=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r){var s;return _classCallCheck(this,i),(s=t.call(this,e)).keys=n,s.values=r,s}return _createClass(i,[{key:"visit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.visitLiteralMap(this,t)}}]),i}(R),H=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r){var s;return _classCallCheck(this,i),(s=t.call(this,e)).strings=n,s.expressions=r,s}return _createClass(i,[{key:"visit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.visitInterpolation(this,t)}}]),i}(R),q=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r,s){var o;return _classCallCheck(this,i),(o=t.call(this,e)).operation=n,o.left=r,o.right=s,o}return _createClass(i,[{key:"visit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.visitBinary(this,t)}}]),i}(R),X=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n){var r;return _classCallCheck(this,i),(r=t.call(this,e)).expression=n,r}return _createClass(i,[{key:"visit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.visitPrefixNot(this,t)}}]),i}(R),Z=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r,s){var o;return _classCallCheck(this,i),(o=t.call(this,e)).receiver=n,o.name=r,o.args=s,o}return _createClass(i,[{key:"visit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.visitMethodCall(this,t)}}]),i}(R),$=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r,s){var o;return _classCallCheck(this,i),(o=t.call(this,e)).receiver=n,o.name=r,o.args=s,o}return _createClass(i,[{key:"visit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.visitSafeMethodCall(this,t)}}]),i}(R),Y=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r){var s;return _classCallCheck(this,i),(s=t.call(this,e)).target=n,s.args=r,s}return _createClass(i,[{key:"visit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e.visitFunctionCall(this,t)}}]),i}(R),J=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r,s){var o;return _classCallCheck(this,i),(o=t.call(this,new O(0,E(n)?0:n.length))).ast=e,o.source=n,o.location=r,o.errors=s,o}return _createClass(i,[{key:"visit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.ast.visit(e,t)}},{key:"toString",value:function(){return"".concat(this.source," in ").concat(this.location)}}]),i}(R),Q=function e(t,i,n,r,s){_classCallCheck(this,e),this.span=t,this.key=i,this.keyIsVar=n,this.name=r,this.expression=s},ee=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"visitBinary",value:function(e,t){return e.left.visit(this),e.right.visit(this),null}},{key:"visitChain",value:function(e,t){return this.visitAll(e.expressions,t)}},{key:"visitConditional",value:function(e,t){return e.condition.visit(this),e.trueExp.visit(this),e.falseExp.visit(this),null}},{key:"visitPipe",value:function(e,t){return e.exp.visit(this),this.visitAll(e.args,t),null}},{key:"visitFunctionCall",value:function(e,t){return e.target.visit(this),this.visitAll(e.args,t),null}},{key:"visitImplicitReceiver",value:function(e,t){return null}},{key:"visitInterpolation",value:function(e,t){return this.visitAll(e.expressions,t)}},{key:"visitKeyedRead",value:function(e,t){return e.obj.visit(this),e.key.visit(this),null}},{key:"visitKeyedWrite",value:function(e,t){return e.obj.visit(this),e.key.visit(this),e.value.visit(this),null}},{key:"visitLiteralArray",value:function(e,t){return this.visitAll(e.expressions,t)}},{key:"visitLiteralMap",value:function(e,t){return this.visitAll(e.values,t)}},{key:"visitLiteralPrimitive",value:function(e,t){return null}},{key:"visitMethodCall",value:function(e,t){return e.receiver.visit(this),this.visitAll(e.args,t)}},{key:"visitPrefixNot",value:function(e,t){return e.expression.visit(this),null}},{key:"visitPropertyRead",value:function(e,t){return e.receiver.visit(this),null}},{key:"visitPropertyWrite",value:function(e,t){return e.receiver.visit(this),e.value.visit(this),null}},{key:"visitSafePropertyRead",value:function(e,t){return e.receiver.visit(this),null}},{key:"visitSafeMethodCall",value:function(e,t){return e.receiver.visit(this),this.visitAll(e.args,t)}},{key:"visitAll",value:function(e,t){var i=this;return e.forEach((function(e){return e.visit(i,t)})),null}},{key:"visitQuote",value:function(e,t){return null}}]),e}();function te(e){return 48<=e&&e<=57}var ie=new(function(){function e(t,i){_classCallCheck(this,e),this.start=t,this.end=i}return _createClass(e,null,[{key:"fromArray",value:function(t){return t?(function(e,t){if(S(t)&&(!Array.isArray(t)||2!=t.length))throw new Error("Expected 'interpolation' to be an array, [start, end].")}(0,t),new e(t[0],t[1])):ie}}]),e}())("{{","}}"),ne=function(e){return e[e.Character=0]="Character",e[e.Identifier=1]="Identifier",e[e.Keyword=2]="Keyword",e[e.String=3]="String",e[e.Operator=4]="Operator",e[e.Number=5]="Number",e[e.Error=6]="Error",e}({}),re=["var","let","null","undefined","true","false","if","else","this"],se=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"tokenize",value:function(e){for(var t=new le(e),i=[],n=t.scanToken();null!=n;)i.push(n),n=t.scanToken();return i}}]),e}(),oe=function(){function e(t,i,n,r){_classCallCheck(this,e),this.index=t,this.type=i,this.numValue=n,this.strValue=r}return _createClass(e,[{key:"isCharacter",value:function(e){return this.type==ne.Character&&this.numValue==e}},{key:"isNumber",value:function(){return this.type==ne.Number}},{key:"isString",value:function(){return this.type==ne.String}},{key:"isOperator",value:function(e){return this.type==ne.Operator&&this.strValue==e}},{key:"isIdentifier",value:function(){return this.type==ne.Identifier}},{key:"isKeyword",value:function(){return this.type==ne.Keyword}},{key:"isKeywordLet",value:function(){return this.type==ne.Keyword&&"let"==this.strValue}},{key:"isKeywordNull",value:function(){return this.type==ne.Keyword&&"null"==this.strValue}},{key:"isKeywordUndefined",value:function(){return this.type==ne.Keyword&&"undefined"==this.strValue}},{key:"isKeywordTrue",value:function(){return this.type==ne.Keyword&&"true"==this.strValue}},{key:"isKeywordFalse",value:function(){return this.type==ne.Keyword&&"false"==this.strValue}},{key:"isKeywordThis",value:function(){return this.type==ne.Keyword&&"this"==this.strValue}},{key:"isError",value:function(){return this.type==ne.Error}},{key:"toNumber",value:function(){return this.type==ne.Number?this.numValue:-1}},{key:"toString",value:function(){switch(this.type){case ne.Character:case ne.Identifier:case ne.Keyword:case ne.Operator:case ne.String:case ne.Error:return this.strValue;case ne.Number:return this.numValue.toString();default:return null}}}]),e}();function ae(e,t){return new oe(e,ne.Character,t,String.fromCharCode(t))}function ce(e,t){return new oe(e,ne.Operator,0,t)}var ue=new oe(-1,ne.Character,0,""),le=function(){function e(t){_classCallCheck(this,e),this.input=t,this.peek=0,this.index=-1,this.length=t.length,this.advance()}return _createClass(e,[{key:"advance",value:function(){this.peek=++this.index>=this.length?0:this.input.charCodeAt(this.index)}},{key:"scanToken",value:function(){for(var e=this.input,t=this.length,i=this.peek,n=this.index;i<=32;){if(++n>=t){i=0;break}i=e.charCodeAt(n)}if(this.peek=i,this.index=n,n>=t)return null;if(he(i))return this.scanIdentifier();if(te(i))return this.scanNumber(n);var r,s=n;switch(i){case 46:return this.advance(),te(this.peek)?this.scanNumber(s):ae(s,46);case 40:case 41:case 123:case 125:case 91:case 93:case 44:case 58:case 59:return this.scanCharacter(s,i);case 39:case 34:return this.scanString();case 35:case 43:case 45:case 42:case 47:case 37:case 94:return this.scanOperator(s,String.fromCharCode(i));case 63:return this.scanComplexOperator(s,"?",46,".");case 60:case 62:return this.scanComplexOperator(s,String.fromCharCode(i),61,"=");case 33:case 61:return this.scanComplexOperator(s,String.fromCharCode(i),61,"=",61,"=");case 38:return this.scanComplexOperator(s,"&",38,"&");case 124:return this.scanComplexOperator(s,"|",124,"|");case 160:for(;(r=this.peek)>=9&&r<=32||160==r;)this.advance();return this.scanToken()}return this.advance(),this.error("Unexpected character [".concat(String.fromCharCode(i),"]"),0)}},{key:"scanCharacter",value:function(e,t){return this.advance(),ae(e,t)}},{key:"scanOperator",value:function(e,t){return this.advance(),ce(e,t)}},{key:"scanComplexOperator",value:function(e,t,i,n,r,s){this.advance();var o=t;return this.peek==i&&(this.advance(),o+=n),null!=r&&this.peek==r&&(this.advance(),o+=s),ce(e,o)}},{key:"scanIdentifier",value:function(){var e=this.index;for(this.advance();pe(this.peek);)this.advance();var t,i=this.input.substring(e,this.index);return re.indexOf(i)>-1?new oe(e,ne.Keyword,0,i):(t=i,new oe(e,ne.Identifier,0,t))}},{key:"scanNumber",value:function(e){var t,i=this.index===e;for(this.advance();;){if(te(this.peek));else if(46==this.peek)i=!1;else{if(101!=(t=this.peek)&&69!=t)break;if(this.advance(),fe(this.peek)&&this.advance(),!te(this.peek))return this.error("Invalid exponent",-1);i=!1}this.advance()}var n=this.input.substring(e,this.index),r=i?function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"parseIntAutoRadix",value:function(e){var t=parseInt(e);if(isNaN(t))throw new Error("Invalid integer literal when parsing "+e);return t}},{key:"isNumeric",value:function(e){return!isNaN(e-parseFloat(e))}}]),e}().parseIntAutoRadix(n):parseFloat(n);return new oe(e,ne.Number,r,"")}},{key:"scanString",value:function(){var e=this.index,t=this.peek;this.advance();for(var i="",n=this.index,r=this.input;this.peek!=t;)if(92==this.peek){var s=void 0;if(i+=r.substring(n,this.index),this.advance(),this.peek=this.peek,117==this.peek){var o=r.substring(this.index+1,this.index+5);if(!/^[0-9a-f]+$/i.test(o))return this.error("Invalid unicode escape [\\u".concat(o,"]"),0);s=parseInt(o,16);for(var a=0;a<5;a++)this.advance()}else s=ve(this.peek),this.advance();i+=String.fromCharCode(s),n=this.index}else{if(0==this.peek)return this.error("Unterminated quote",0);this.advance()}var c=r.substring(n,this.index);return this.advance(),new oe(e,ne.String,0,i+c)}},{key:"error",value:function(e,t){var i=this.index+t;return function(e,t){return new oe(e,ne.Error,0,t)}(i,"Lexer Error: ".concat(e," at column ").concat(i," in expression [").concat(this.input,"]"))}}]),e}();function he(e){return 97<=e&&e<=122||65<=e&&e<=90||95==e||36==e}function pe(e){return function(e){return e>=97&&e<=122||e>=65&&e<=90}(e)||te(e)||95==e||36==e}function fe(e){return 45==e||43==e}function ve(e){switch(e){case 110:return 10;case 102:return 12;case 114:return 13;case 116:return 9;case 118:return 11;default:return e}}var de=function e(t,i,n){_classCallCheck(this,e),this.strings=t,this.expressions=i,this.offsets=n},ye=function e(t,i,n){_classCallCheck(this,e),this.templateBindings=t,this.warnings=i,this.errors=n};function me(e){var t=I(e.start)+"([\\s\\S]*?)"+I(e.end);return new RegExp(t,"g")}var ge=function(){function e(t){_classCallCheck(this,e),this._lexer=t,this.errors=[]}return _createClass(e,[{key:"parseAction",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ie;this._checkNoInterpolation(e,t,i);var n=this._stripComments(e),r=this._lexer.tokenize(this._stripComments(e)),s=new Ce(e,t,r,n.length,!0,this.errors,e.length-n.length).parseChain();return new J(s,e,t,this.errors)}},{key:"parseBinding",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ie,n=this._parseBindingAst(e,t,i);return new J(n,e,t,this.errors)}},{key:"parseSimpleBinding",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ie,n=this._parseBindingAst(e,t,i),r=_e.check(n);return r.length>0&&this._reportError("Host binding expression cannot contain ".concat(r.join(" ")),e,t),new J(n,e,t,this.errors)}},{key:"_reportError",value:function(e,t,i,n){this.errors.push(new P(e,t,i,n))}},{key:"_parseBindingAst",value:function(e,t,i){var n=this._parseQuote(e,t);if(S(n))return n;this._checkNoInterpolation(e,t,i);var r=this._stripComments(e),s=this._lexer.tokenize(r);return new Ce(e,t,s,r.length,!1,this.errors,e.length-r.length).parseChain()}},{key:"_parseQuote",value:function(e,t){if(E(e))return null;var i=e.indexOf(":");if(-1==i)return null;var n=e.substring(0,i).trim();if(!function(e){if(0==e.length)return!1;var t=new le(e);if(!he(t.peek))return!1;for(t.advance();0!==t.peek;){if(!pe(t.peek))return!1;t.advance()}return!0}(n))return null;var r=e.substring(i+1);return new T(new O(0,e.length),n,r,t)}},{key:"parseTemplateBindings",value:function(e,t,i){var n=this._lexer.tokenize(t);if(e){var r=this._lexer.tokenize(e).map((function(e){return e.index=0,e}));n.unshift.apply(n,_toConsumableArray(r))}return new Ce(t,i,n,t.length,!1,this.errors,0).parseTemplateBindings()}},{key:"parseInterpolation",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ie,n=this.splitInterpolation(e,t,i);if(null==n)return null;for(var r=[],s=0;s<n.expressions.length;++s){var o=n.expressions[s],a=this._stripComments(o),c=this._lexer.tokenize(this._stripComments(n.expressions[s])),u=new Ce(e,t,c,a.length,!1,this.errors,n.offsets[s]+(o.length-a.length)).parseChain();r.push(u)}return new J(new H(new O(0,E(e)?0:e.length),n.strings,r),e,t,this.errors)}},{key:"splitInterpolation",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ie,n=me(i),r=e.split(n);if(r.length<=1)return null;for(var s=[],o=[],a=[],c=0,u=0;u<r.length;u++){var l=r[u];u%2==0?(s.push(l),c+=l.length):l.trim().length>0?(c+=i.start.length,o.push(l),a.push(c),c+=l.length+i.end.length):(this._reportError("Blank expressions are not allowed in interpolated strings",e,"at column ".concat(this._findInterpolationErrorColumn(r,u,i)," in"),t),o.push("$implict"),a.push(c))}return new de(s,o,a)}},{key:"wrapLiteralPrimitive",value:function(e,t){return new J(new G(new O(0,E(e)?0:e.length),e),e,t,this.errors)}},{key:"_stripComments",value:function(e){var t=this._commentStart(e);return S(t)?e.substring(0,t).trim():e}},{key:"_commentStart",value:function(e){for(var t,i=null,n=0;n<e.length-1;n++){var r=e.charCodeAt(n),s=e.charCodeAt(n+1);if(47===r&&47==s&&E(i))return n;i===r?i=null:E(i)&&(39===(t=r)||34===t||96===t)&&(i=r)}return null}},{key:"_checkNoInterpolation",value:function(e,t,i){var n=me(i),r=e.split(n);r.length>1&&this._reportError("Got interpolation (".concat(i.start).concat(i.end,") where expression was expected"),e,"at column ".concat(this._findInterpolationErrorColumn(r,1,i)," in"),t)}},{key:"_findInterpolationErrorColumn",value:function(e,t,i){for(var n="",r=0;r<t;r++)n+=r%2==0?e[r]:"".concat(i.start).concat(e[r]).concat(i.end);return n.length}}]),e}(),Ce=function(){function e(t,i,n,r,s,o,a){_classCallCheck(this,e),this.input=t,this.location=i,this.tokens=n,this.inputLength=r,this.parseAction=s,this.errors=o,this.offset=a,this.rparensExpected=0,this.rbracketsExpected=0,this.rbracesExpected=0,this.index=0}return _createClass(e,[{key:"peek",value:function(e){var t=this.index+e;return t<this.tokens.length?this.tokens[t]:ue}},{key:"span",value:function(e){return new O(e,this.inputIndex)}},{key:"advance",value:function(){this.index++}},{key:"optionalCharacter",value:function(e){return!!this.next.isCharacter(e)&&(this.advance(),!0)}},{key:"peekKeywordLet",value:function(){return this.next.isKeywordLet()}},{key:"expectCharacter",value:function(e){this.optionalCharacter(e)||this.error("Missing expected ".concat(String.fromCharCode(e)))}},{key:"optionalOperator",value:function(e){return!!this.next.isOperator(e)&&(this.advance(),!0)}},{key:"expectOperator",value:function(e){this.optionalOperator(e)||this.error("Missing expected operator ".concat(e))}},{key:"expectIdentifierOrKeyword",value:function(){var e=this.next;return e.isIdentifier()||e.isKeyword()?(this.advance(),e.toString()):(this.error("Unexpected token ".concat(e,", expected identifier or keyword")),"")}},{key:"expectIdentifierOrKeywordOrString",value:function(){var e=this.next;return e.isIdentifier()||e.isKeyword()||e.isString()?(this.advance(),e.toString()):(this.error("Unexpected token ".concat(e,", expected identifier, keyword, or string")),"")}},{key:"parseChain",value:function(){for(var e=[],t=this.inputIndex;this.index<this.tokens.length;){var i=this.parsePipe();if(e.push(i),this.optionalCharacter(59))for(this.parseAction||this.error("Binding expression cannot contain chained expression");this.optionalCharacter(59););else this.index<this.tokens.length&&this.error("Unexpected token '".concat(this.next,"'"))}return 0==e.length?new A(this.span(t)):1==e.length?e[0]:new D(this.span(t),e)}},{key:"parsePipe",value:function(){var e=this.parseExpression();if(this.optionalOperator("|")){this.parseAction&&this.error("Cannot have a pipe in an action expression");do{for(var t=this.expectIdentifierOrKeyword(),i=[];this.optionalCharacter(58);)i.push(this.parseExpression());e=new z(this.span(e.span.start),e,t,i)}while(this.optionalOperator("|"))}return e}},{key:"parseExpression",value:function(){return this.parseConditional()}},{key:"parseConditional",value:function(){var e=this.inputIndex,t=this.parseLogicalOr();if(this.optionalOperator("?")){var i,n=this.parsePipe();if(this.optionalCharacter(58))i=this.parsePipe();else{var r=this.input.substring(e,this.inputIndex);this.error("Conditional expression ".concat(r," requires all 3 expressions")),i=new A(this.span(e))}return new j(this.span(e),t,n,i)}return t}},{key:"parseLogicalOr",value:function(){for(var e=this.parseLogicalAnd();this.optionalOperator("||");){var t=this.parseLogicalAnd();e=new q(this.span(e.span.start),"||",e,t)}return e}},{key:"parseLogicalAnd",value:function(){for(var e=this.parseEquality();this.optionalOperator("&&");){var t=this.parseEquality();e=new q(this.span(e.span.start),"&&",e,t)}return e}},{key:"parseEquality",value:function(){for(var e=this.parseRelational();this.next.type==ne.Operator;){var t=this.next.strValue;switch(t){case"==":case"===":case"!=":case"!==":this.advance();var i=this.parseRelational();e=new q(this.span(e.span.start),t,e,i);continue}break}return e}},{key:"parseRelational",value:function(){for(var e=this.parseAdditive();this.next.type==ne.Operator;){var t=this.next.strValue;switch(t){case"<":case">":case"<=":case">=":this.advance();var i=this.parseAdditive();e=new q(this.span(e.span.start),t,e,i);continue}break}return e}},{key:"parseAdditive",value:function(){for(var e=this.parseMultiplicative();this.next.type==ne.Operator;){var t=this.next.strValue;switch(t){case"+":case"-":this.advance();var i=this.parseMultiplicative();e=new q(this.span(e.span.start),t,e,i);continue}break}return e}},{key:"parseMultiplicative",value:function(){for(var e=this.parsePrefix();this.next.type==ne.Operator;){var t=this.next.strValue;switch(t){case"*":case"%":case"/":this.advance();var i=this.parsePrefix();e=new q(this.span(e.span.start),t,e,i);continue}break}return e}},{key:"parsePrefix",value:function(){if(this.next.type==ne.Operator){var e,t=this.inputIndex,i=this.next.strValue;switch(i){case"+":return this.advance(),this.parsePrefix();case"-":return this.advance(),e=this.parsePrefix(),new q(this.span(t),i,new G(new O(t,t),0),e);case"!":return this.advance(),e=this.parsePrefix(),new X(this.span(t),e)}}return this.parseCallChain()}},{key:"parseCallChain",value:function(){for(var e=this.parsePrimary();;)if(this.optionalCharacter(46))e=this.parseAccessMemberOrMethodCall(e,!1);else if(this.optionalOperator("?."))e=this.parseAccessMemberOrMethodCall(e,!0);else if(this.optionalCharacter(91)){this.rbracketsExpected++;var t=this.parsePipe();if(this.rbracketsExpected--,this.expectCharacter(93),this.optionalOperator("=")){var i=this.parseConditional();e=new K(this.span(e.span.start),e,t,i)}else e=new B(this.span(e.span.start),e,t)}else{if(!this.optionalCharacter(40))return e;this.rparensExpected++;var n=this.parseCallArguments();this.rparensExpected--,this.expectCharacter(41),e=new Y(this.span(e.span.start),e,n)}}},{key:"parsePrimary",value:function(){var e=this.inputIndex;if(this.optionalCharacter(40)){this.rparensExpected++;var t=this.parsePipe();return this.rparensExpected--,this.expectCharacter(41),t}if(this.next.isKeywordNull())return this.advance(),new G(this.span(e),null);if(this.next.isKeywordUndefined())return this.advance(),new G(this.span(e),void 0);if(this.next.isKeywordTrue())return this.advance(),new G(this.span(e),!0);if(this.next.isKeywordFalse())return this.advance(),new G(this.span(e),!1);if(this.next.isKeywordThis())return this.advance(),new L(this.span(e));if(this.optionalCharacter(91)){this.rbracketsExpected++;var i=this.parseExpressionList(93);return this.rbracketsExpected--,this.expectCharacter(93),new U(this.span(e),i)}if(this.next.isCharacter(123))return this.parseLiteralMap();if(this.next.isIdentifier())return this.parseAccessMemberOrMethodCall(new L(this.span(e)),!1);if(this.next.isNumber()){var n=this.next.toNumber();return this.advance(),new G(this.span(e),n)}if(this.next.isString()){var r=this.next.toString();return this.advance(),new G(this.span(e),r)}return this.index>=this.tokens.length?(this.error("Unexpected end of expression: ".concat(this.input)),new A(this.span(e))):(this.error("Unexpected token ".concat(this.next)),new A(this.span(e)))}},{key:"parseExpressionList",value:function(e){var t=[];if(!this.next.isCharacter(e))do{t.push(this.parsePipe())}while(this.optionalCharacter(44));return t}},{key:"parseLiteralMap",value:function(){var e=[],t=[],i=this.inputIndex;if(this.expectCharacter(123),!this.optionalCharacter(125)){this.rbracesExpected++;do{var n=this.expectIdentifierOrKeywordOrString();e.push(n),this.expectCharacter(58),t.push(this.parsePipe())}while(this.optionalCharacter(44));this.rbracesExpected--,this.expectCharacter(125)}return new W(this.span(i),e,t)}},{key:"parseAccessMemberOrMethodCall",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e.span.start,n=this.expectIdentifierOrKeyword();if(this.optionalCharacter(40)){this.rparensExpected++;var r=this.parseCallArguments();this.expectCharacter(41),this.rparensExpected--;var s=this.span(i);return t?new $(s,e,n,r):new Z(s,e,n,r)}if(t)return this.optionalOperator("=")?(this.error("The '?.' operator cannot be used in the assignment"),new A(this.span(i))):new V(this.span(i),e,n);if(this.optionalOperator("=")){if(!this.parseAction)return this.error("Bindings cannot contain assignments"),new A(this.span(i));var o=this.parseConditional();return new F(this.span(i),e,n,o)}return new N(this.span(i),e,n)}},{key:"parseCallArguments",value:function(){if(this.next.isCharacter(41))return[];var e=[];do{e.push(this.parsePipe())}while(this.optionalCharacter(44));return e}},{key:"expectTemplateBindingKey",value:function(){var e="",t=!1;do{e+=this.expectIdentifierOrKeywordOrString(),(t=this.optionalOperator("-"))&&(e+="-")}while(t);return e.toString()}},{key:"parseTemplateBindings",value:function(){for(var e=[],t=null;this.index<this.tokens.length;){var i=this.inputIndex,n=this.peekKeywordLet();n&&this.advance();var r=this.expectTemplateBindingKey();n||(null==t?t=r:r=t+r[0].toUpperCase()+r.substring(1)),this.optionalCharacter(58);var s=null,o=null;if(n)s=this.optionalOperator("=")?this.expectTemplateBindingKey():"$implicit";else if(this.next!==ue&&!this.peekKeywordLet()){var a=this.inputIndex,c=this.parsePipe(),u=this.input.substring(a-this.offset,this.inputIndex-this.offset);o=new J(c,u,this.location,this.errors)}e.push(new Q(this.span(i),r,n,s,o)),this.optionalCharacter(59)||this.optionalCharacter(44)}return new ye(e,[],this.errors)}},{key:"error",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.errors.push(new P(e,this.input,this.locationText(t),this.location)),this.skip()}},{key:"locationText",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return E(e)&&(e=this.index),e<this.tokens.length?"at column ".concat(this.tokens[e].index+1," in"):"at the end of the expression"}},{key:"skip",value:function(){for(var e=this.next;this.index<this.tokens.length&&!e.isCharacter(59)&&(this.rparensExpected<=0||!e.isCharacter(41))&&(this.rbracesExpected<=0||!e.isCharacter(125))&&(this.rbracketsExpected<=0||!e.isCharacter(93));)this.next.isError()&&this.errors.push(new P(this.next.toString(),this.input,this.locationText(),this.location)),this.advance(),e=this.next}},{key:"next",get:function(){return this.peek(0)}},{key:"inputIndex",get:function(){return this.index<this.tokens.length?this.next.index+this.offset:this.inputLength+this.offset}}]),e}(),_e=function(){function e(){_classCallCheck(this,e),this.errors=[]}return _createClass(e,[{key:"visitImplicitReceiver",value:function(e,t){}},{key:"visitInterpolation",value:function(e,t){}},{key:"visitLiteralPrimitive",value:function(e,t){}},{key:"visitPropertyRead",value:function(e,t){}},{key:"visitPropertyWrite",value:function(e,t){}},{key:"visitSafePropertyRead",value:function(e,t){}},{key:"visitMethodCall",value:function(e,t){}},{key:"visitSafeMethodCall",value:function(e,t){}},{key:"visitFunctionCall",value:function(e,t){}},{key:"visitLiteralArray",value:function(e,t){this.visitAll(e.expressions)}},{key:"visitLiteralMap",value:function(e,t){this.visitAll(e.values)}},{key:"visitBinary",value:function(e,t){}},{key:"visitPrefixNot",value:function(e,t){}},{key:"visitConditional",value:function(e,t){}},{key:"visitPipe",value:function(e,t){this.errors.push("pipes")}},{key:"visitKeyedRead",value:function(e,t){}},{key:"visitKeyedWrite",value:function(e,t){}},{key:"visitAll",value:function(e){var t=this;return e.map((function(e){return e.visit(t)}))}},{key:"visitChain",value:function(e,t){}},{key:"visitQuote",value:function(e,t){}}],[{key:"check",value:function(t){var i=new e;return t.visit(i),i.errors}}]),e}(),we=new Map([["==",function(e,t){return e==t}],["===",function(e,t){return e===t}],["!=",function(e,t){return e!=t}],["!==",function(e,t){return e!==t}],["&&",function(e,t){return e&&t}],["||",function(e,t){return e||t}],["+",function(e,t){return e+t}],["-",function(e,t){return e-t}],["/",function(e,t){return e/t}],["*",function(e,t){return e*t}],["%",function(e,t){return e%t}],["<",function(e,t){return e<t}],["<=",function(e,t){return e<=t}],[">",function(e,t){return e>t}],[">=",function(e,t){return e>=t}]]);function be(e){return JSON.stringify(e).replace(/"/g,"")}function ke(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function Me(e){return"function"==typeof e}var xe,Se,Ee,Ie=function(e){_inherits(i,e);var t=_createSuper(i);function i(){return _classCallCheck(this,i),t.apply(this,arguments)}return _createClass(i,[{key:"visitBinary",value:function(e){var t=e.left.visit(this),i=e.right.visit(this);return"".concat(t," ").concat(e.operation," ").concat(i)}},{key:"visitChain",value:function(e){return be(this.visitAll(e.expressions))}},{key:"visitConditional",value:function(e){return"".concat(e.condition.visit(this)," ? ").concat(e.trueExp.visit(this)," : ").concat(e.falseExp.visit(this))}},{key:"visitPipe",value:function(e){var t=e.name,i=this.visitAll(e.args),n=e.exp.visit(this);return i.unshift(n),"pipesCache.get('".concat(t,"').transform.apply(null, ").concat(be(i),")")}},{key:"visitFunctionCall",value:function(e){var t=e.target.visit(this);return"".concat(t,".apply(").concat(t,", ").concat(be(this.visitAll(e.args)),")")}},{key:"visitImplicitReceiver",value:function(e){return"context"}},{key:"visitInterpolation",value:function(e){return this.visitAll(e.expressions)[0]}},{key:"visitKeyedRead",value:function(e){return"".concat(e.obj.visit(this),"[").concat(e.key.visit(this),"]")}},{key:"visitKeyedWrite",value:function(e){return null}},{key:"visitLiteralArray",value:function(e){return be(this.visitAll(e.expressions))}},{key:"visitLiteralMap",value:function(e){for(var t={},i=e.keys,n=this.visitAll(e.values),r=0,s=i.length;r<s;r++)t[i[r]]=n[r];return be(t)}},{key:"visitLiteralPrimitive",value:function(e){return"string"==typeof e.value?"'".concat(e.value,"'"):e.value}},{key:"visitMethodCall",value:function(e){var t=e.name,i=e.receiver.visit(this);return"".concat(i,"['").concat(t,"'].apply(").concat(i,", ").concat(be(this.visitAll(e.args)),")")}},{key:"visitPrefixNot",value:function(e){return e.expression.visit(this)}},{key:"visitPropertyRead",value:function(e){var t=e.name;return"".concat(e.receiver.visit(this),"['").concat(t,"']")}},{key:"visitPropertyWrite",value:function(e){return null}},{key:"visitSafePropertyRead",value:function(e){var t=e.name;return"".concat(e.receiver.visit(this),"['").concat(t,"']")}},{key:"visitSafeMethodCall",value:function(e){var t=e.name,i=e.receiver.visit(this);return"".concat(i,"['").concat(t,"'].apply(").concat(i,", ").concat(be(this.visitAll(e.args)),")")}},{key:"visitAll",value:function(e){var t=this;return e.map((function(e){return e.visit(t)}))}},{key:"visitQuote",value:function(e){return null}}]),i}(ee),Pe=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){var n;return _classCallCheck(this,i),(n=t.call(this)).pipes=e,n}return _createClass(i,[{key:"visitBinary",value:function(e,t){var i=we.get(e.operation);if(!i)throw new Error("Parse ERROR: on visitBinary, unknown operator ".concat(e.operation));return i(e.left.visit(this,t),e.right.visit(this,t))}},{key:"visitChain",value:function(e,t){return this.visitAll(e.expressions,t)}},{key:"visitConditional",value:function(e,t){return e.condition.visit(this,t)?e.trueExp.visit(this,t):null!=e.falseExp?e.falseExp.visit(this,t):null}},{key:"visitPipe",value:function(e,t){var i=this.pipes.get(e.name);if(!i)throw new Error("pipe ".concat(e.name," not found."));if(!i.transform)throw new Error("Parse ERROR: on visitPipe, transform method doesn't exist on pipe ".concat(e.name,"."));var n=e.exp.visit(this,t),r=this.visitAll(e.args,t);return r.unshift(n),i.transform.apply(null,r)}},{key:"visitFunctionCall",value:function(e,t){var i=e.target.visit(this,t);if(!Me(i))throw new Error("Parse ERROR: on visitFunctionCall, target is not a function.");var n=this.visitAll(e.args,t);return i.apply(i,n)}},{key:"visitImplicitReceiver",value:function(e,t){return t}},{key:"visitInterpolation",value:function(e,t){return this.visitAll(e.expressions,t)[0]}},{key:"visitKeyedRead",value:function(e,t){return e.obj.visit(this,t)[e.key.visit(this,t)]}},{key:"visitKeyedWrite",value:function(e,t){var i=e.obj.visit(this,t),n=e.key.visit(this,t),r=e.value.visit(this,t);return i[n]=r,null}},{key:"visitLiteralArray",value:function(e,t){return this.visitAll(e.expressions,t)}},{key:"visitLiteralMap",value:function(e,t){for(var i={},n=e.keys,r=this.visitAll(e.values,t),s=0,o=n.length;s<o;s++)i[n[s]]=r[s];return i}},{key:"visitLiteralPrimitive",value:function(e,t){return e.value}},{key:"visitMethodCall",value:function(e,t){var i=e.receiver.visit(this,t);if(!ke(i))throw new Error("Parse ERROR: on visitMethodCall, invalid method receiver.");var n=i[e.name];if(!Me(n))throw new Error("Parse ERROR: on visitMethodCall, method ".concat(e.name," doesn't exist on receiver."));var r=this.visitAll(e.args,t);return n.apply(i,r)}},{key:"visitPrefixNot",value:function(e,t){return e.expression.visit(this,t)}},{key:"visitPropertyRead",value:function(e,t){var i=e.receiver.visit(this,t);if(!ke(i))throw new Error("Parse ERROR: on visitPropertyRead, invalid property receiver.");return i[e.name]}},{key:"visitPropertyWrite",value:function(e,t){var i=e.receiver.visit(this,t);if(!ke(i))throw new Error("Parse ERROR: on visitPropertyRead, invalid property receiver.");return i[e.name]=e.value.visit(this,t),null}},{key:"visitSafePropertyRead",value:function(e,t){var i=e.receiver.visit(this,t);if(!ke(i))throw new Error("Parse ERROR: on visitSafePropertyRead, invalid property receiver.");return i[e.name]}},{key:"visitSafeMethodCall",value:function(e,t){var i=e.receiver.visit(this,t);if(!ke(i))throw new Error("Parse ERROR: on visitSafeMethodCall, invalid method receiver.");var n=i[e.name];if(!Me(n))throw new Error("Parse ERROR: on visitSafeMethodCall, method ".concat(e.name," doesn't exist on receiver."));var r=this.visitAll(e.args,t);return n.apply(i,r)}},{key:"visitAll",value:function(e,t){var i=this;return e.map((function(e){return e.visit(i,t)}))}},{key:"visitQuote",value:function(e,t){throw new Error("Parse ERROR: on visitQuote, quote expression not allowed.")}}]),i}(ee),Oe=new o.InjectionToken("PipesConfig"),Re=((xe=function(){function e(t){var i=this;_classCallCheck(this,e),this._parser=new ge(new se),this._pipesCache=new Map,this._evalCache=new Map,this._calcCache=new Map,t&&t.length&&t.filter((function(e){return e&&e.length})).forEach((function(e){return e.forEach((function(e){return i._pipesCache.set(e.pipeName,e.pipeInstance)}))}))}return _createClass(e,[{key:"eval",value:function(e){if(this._evalCache.has(e))return this._evalCache.get(e);var t=new Ie,i=this._parser.parseInterpolation(e,"Parse");i||(i=this._parser.parseBinding(e,"Parse"));var n=i.visit(t),r=this._pipesCache,s=new Function("context","pipesCache","return ".concat(n,";")),o=function(e){return s(e,r)};return this._evalCache.set(e,o),o}},{key:"calc",value:function(e){if(this._calcCache.has(e))return this._calcCache.get(e);var t=new Pe(this._pipesCache),i=this._parser.parseInterpolation(e,"Parse");i||(i=this._parser.parseBinding(e,"Parse"));var n=function(e){return i.visit(t,e)};return this._calcCache.set(e,n),n}}]),e}()).\u0275fac=function(e){return new(e||xe)(o["\u0275\u0275inject"](Oe,8))},xe.\u0275prov=Object(o["\u0275\u0275defineInjectable"])({factory:function(){return new xe(Object(o["\u0275\u0275inject"])(Oe,8))},token:xe,providedIn:"root"}),xe),Te=((Ee=Se=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"forRoot",value:function(e){return{ngModule:Se,providers:[{provide:Oe,multi:!0,useValue:e||[]}]}}}]),e}()).\u0275mod=o["\u0275\u0275defineNgModule"]({type:Ee}),Ee.\u0275inj=o["\u0275\u0275defineInjector"]({factory:function(e){return new(e||Ee)}}),Ee);function Ae(e,t){1&e&&o["\u0275\u0275element"](0,"ac-default-plonter")}i("yDJ3");var Le=["*"];function De(e,t){if(1&e){var i=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"div"),o["\u0275\u0275elementStart"](1,"div",4),o["\u0275\u0275listener"]("click",(function(){o["\u0275\u0275restoreView"](i);var e=t.$implicit;return o["\u0275\u0275nextContext"](2).chooseEntity(e)})),o["\u0275\u0275text"](2),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()}if(2&e){var n=t.$implicit;o["\u0275\u0275advance"](2),o["\u0275\u0275textInterpolate1"]("",(null==n?null:n.name)||(null==n?null:n.id)," ")}}var je=function(e){return{position:e}};function Ne(e,t){if(1&e&&(o["\u0275\u0275elementStart"](0,"ac-html",1),o["\u0275\u0275elementStart"](1,"div",2),o["\u0275\u0275template"](2,De,3,1,"div",3),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()),2&e){var i=o["\u0275\u0275nextContext"]();o["\u0275\u0275property"]("props",o["\u0275\u0275pureFunction1"](2,je,i.plonterPosition)),o["\u0275\u0275advance"](2),o["\u0275\u0275property"]("ngForOf",i.plonterService.entitesToPlonter)}}var Fe=["contextMenuContainer"];function Ve(e,t){}function Be(e,t){if(1&e&&(o["\u0275\u0275elementStart"](0,"ac-html",1),o["\u0275\u0275template"](1,Ve,0,0,"ng-template",null,2,o["\u0275\u0275templateRefExtractor"]),o["\u0275\u0275elementEnd"]()),2&e){var i=o["\u0275\u0275nextContext"]();o["\u0275\u0275property"]("props",o["\u0275\u0275pureFunction1"](1,je,i.contextMenuService.position))}}var Ke,ze,Ge,Ue=((Ge=function(){function e(){_classCallCheck(this,e),this.cesium=Cesium}return _createClass(e,[{key:"createViewer",value:function(e,t){return new this.cesium.Viewer(e,t?Object.assign({contextOptions:{webgl:{preserveDrawingBuffer:!0}}},t):{contextOptions:{webgl:{preserveDrawingBuffer:!0}}})}}]),e}()).\u0275fac=function(e){return new(e||Ge)},Ge.\u0275prov=o["\u0275\u0275defineInjectable"]({token:Ge,factory:Ge.\u0275fac}),Ge),We=((ze=function(){function e(){_classCallCheck(this,e),this.nextViewerOptionsIndex=0,this.nextViewerModifierIndex=0}return _createClass(e,[{key:"getNextViewerOptions",value:function(){return this._viewerOptions instanceof Array?this._viewerOptions[this.nextViewerOptionsIndex++]:this._viewerOptions}},{key:"getNextViewerModifier",value:function(){return this._viewerModifier instanceof Array?this._viewerModifier[this.nextViewerModifierIndex++]:this._viewerModifier}},{key:"viewerOptions",get:function(){return this._viewerOptions},set:function(e){this._viewerOptions=e}},{key:"viewerModifier",get:function(){return this._viewerModifier},set:function(e){this._viewerModifier=e}}]),e}()).\u0275fac=function(e){return new(e||ze)},ze.\u0275prov=o["\u0275\u0275defineInjectable"]({token:ze,factory:ze.\u0275fac}),ze),He=((Ke=function(){function e(t,i,n){_classCallCheck(this,e),this.ngZone=t,this.viewerFactory=i,this.viewerConfiguration=n}return _createClass(e,[{key:"init",value:function(e,t){var i=this;this.map=t,this.ngZone.runOutsideAngular((function(){var t=i.viewerConfiguration?i.viewerConfiguration.getNextViewerOptions():void 0;i.cesiumViewer=i.viewerFactory.createViewer(e,t);var n=i.viewerConfiguration&&i.viewerConfiguration.getNextViewerModifier();"function"==typeof n&&n(i.cesiumViewer)}))}},{key:"getViewer",value:function(){return this.cesiumViewer}},{key:"getScene",value:function(){return this.cesiumViewer.scene}},{key:"getCanvas",value:function(){return this.cesiumViewer.canvas}},{key:"getMap",value:function(){return this.map}}]),e}()).\u0275fac=function(e){return new(e||Ke)(o["\u0275\u0275inject"](o.NgZone),o["\u0275\u0275inject"](Ue),o["\u0275\u0275inject"](We,8))},Ke.\u0275prov=o["\u0275\u0275defineInjectable"]({token:Ke,factory:Ke.\u0275fac}),Ke),qe=Cesium.AssociativeArray,Xe=Cesium.Color,Ze=Cesium.ColorGeometryInstanceAttribute,$e=Cesium.defined,Ye=Cesium.DistanceDisplayCondition,Je=Cesium.DistanceDisplayConditionGeometryInstanceAttribute,Qe=Cesium.ShowGeometryInstanceAttribute,et=Cesium.Primitive,tt=Cesium.ShadowMode,it=Cesium.BoundingSphereState,nt=Cesium.ColorMaterialProperty,rt=Cesium.MaterialProperty,st=Cesium.Property,ot=new Xe,at=new Ye,ct=new Ye;function ut(e,t,i,n,r,s,o){var a;this.translucent=t,this.appearanceType=i,this.depthFailAppearanceType=n,this.depthFailMaterialProperty=r,this.depthFailMaterial=void 0,this.closed=s,this.shadows=o,this.primitives=e,this.createPrimitive=!1,this.waitingOnCreate=!1,this.primitive=void 0,this.oldPrimitive=void 0,this.geometry=new qe,this.updaters=new qe,this.updatersWithAttributes=new qe,this.attributes=new qe,this.subscriptions=new qe,this.showsUpdated=new qe,this.itemsToRemove=[],this.invalidated=!1,$e(r)&&(a=r.definitionChanged.addEventListener(ut.prototype.onMaterialChanged,this)),this.removeMaterialSubscription=a}ut.prototype.onMaterialChanged=function(){this.invalidated=!0},ut.prototype.isMaterial=function(e){var t=this.depthFailMaterialProperty,i=e.depthFailMaterialProperty;return i===t||!!$e(t)&&t.equals(i)},ut.prototype.add=function(e,t){var i=e.id;if(this.createPrimitive=!0,this.geometry.set(i,t),this.updaters.set(i,e),e.hasConstantFill&&e.fillMaterialProperty.isConstant&&st.isConstant(e.distanceDisplayConditionProperty)){var n=this;this.subscriptions.set(i,e.entity.definitionChanged.addEventListener((function(t,i,r,s){"isShowing"===i&&n.showsUpdated.set(e.id,e)})))}else this.updatersWithAttributes.set(i,e)},ut.prototype.remove=function(e){var t=e.id;if(this.createPrimitive=this.geometry.remove(t)||this.createPrimitive,this.updaters.remove(t)){this.updatersWithAttributes.remove(t);var i=this.subscriptions.get(t);$e(i)&&(i(),this.subscriptions.remove(t))}},ut.prototype.update=function(e){var t,i,n=!0,r=0,s=this.primitive,o=this.primitives;if(this.createPrimitive){var a=this.geometry.values,c=a.length;if(c>0){for($e(s)&&($e(this.oldPrimitive)?o.remove(s):this.oldPrimitive=s),i=0;i<c;i++){var u=a[i],l=u.attributes;t=this.attributes.get(u.id.id),$e(t)&&($e(l.show)&&(l.show.value=t.show),$e(l.color)&&(l.color.value=t.color),$e(l.depthFailColor)&&(l.depthFailColor.value=t.depthFailColor))}var h;$e(this.depthFailAppearanceType)&&($e(this.depthFailMaterialProperty)&&(this.depthFailMaterial=rt.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial)),h=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.translucent,closed:this.closed})),s=new et({show:!1,asynchronous:!0,geometryInstances:a,appearance:new this.appearanceType({flat:this.shadows===tt.DISABLED||this.shadows===tt.CAST_ONLY,translucent:this.translucent,closed:this.closed}),depthFailAppearance:h,shadows:this.shadows}),o.add(s),n=!1}else{$e(s)&&(o.remove(s),s=void 0);var p=this.oldPrimitive;$e(p)&&(o.remove(p),this.oldPrimitive=void 0)}this.attributes.removeAll(),this.primitive=s,this.createPrimitive=!1,this.waitingOnCreate=!0}else if($e(s)&&s.ready){s.show=!0,$e(this.oldPrimitive)&&(o.remove(this.oldPrimitive),this.oldPrimitive=void 0),!$e(this.depthFailAppearanceType)||this.depthFailMaterialProperty instanceof nt||(this.depthFailMaterial=rt.getValue(e,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);var f=this.updatersWithAttributes.values,v=f.length,d=this.waitingOnCreate;for(i=0;i<v;i++){var y=f[i],m=this.geometry.get(y.id);if(t=this.attributes.get(m.id.id),$e(t)||(t=s.getGeometryInstanceAttributes(m.id),this.attributes.set(m.id.id,t)),!y.fillMaterialProperty.isConstant||d){var g=st.getValueOrDefault(y.fillMaterialProperty.color,e,Xe.WHITE,ot);Xe.equals(t._lastColor,g)||(t._lastColor=Xe.clone(g,t._lastColor),t.color=Ze.toValue(g,t.color),(this.translucent&&255===t.color[3]||!this.translucent&&255!==t.color[3])&&(this.itemsToRemove[r++]=y))}if($e(this.depthFailAppearanceType)&&y.depthFailMaterialProperty instanceof nt&&(!y.depthFailMaterialProperty.isConstant||d)){var C=st.getValueOrDefault(y.depthFailMaterialProperty.color,e,Xe.WHITE,ot);Xe.equals(t._lastDepthFailColor,C)||(t._lastDepthFailColor=Xe.clone(C,t._lastDepthFailColor),t.depthFailColor=Ze.toValue(C,t.depthFailColor))}var _=y.entity.isShowing&&(y.hasConstantFill||y.isFilled(e));_!==(1===t.show[0])&&(t.show=Qe.toValue(_,t.show));var w=y.distanceDisplayConditionProperty;if(!st.isConstant(w)){var b=st.getValueOrDefault(w,e,ct,at);Ye.equals(b,t._lastDistanceDisplayCondition)||(t._lastDistanceDisplayCondition=Ye.clone(b,t._lastDistanceDisplayCondition),t.distanceDisplayCondition=Je.toValue(b,t.distanceDisplayCondition))}}this.updateShows(s),this.waitingOnCreate=!1}else $e(s)&&!s.ready&&(n=!1);return this.itemsToRemove.length=r,n},ut.prototype.updateShows=function(e){for(var t=this.showsUpdated.values,i=t.length,n=0;n<i;n++){var r=t[n],s=this.geometry.get(r.id),o=this.attributes.get(s.id.id);$e(o)||(o=e.getGeometryInstanceAttributes(s.id),this.attributes.set(s.id.id,o));var a=r.entity.isShowing;a!==(1===o.show[0])&&(o.show=Qe.toValue(a,o.show))}this.showsUpdated.removeAll()},ut.prototype.contains=function(e){return this.updaters.contains(e.id)},ut.prototype.getBoundingSphere=function(e,t){var i=this.primitive;if(!i.ready)return it.PENDING;var n=i.getGeometryInstanceAttributes(e.entity);return!$e(n)||!$e(n.boundingSphere)||$e(n.show)&&0===n.show[0]?it.FAILED:(n.boundingSphere.clone(t),it.DONE)},ut.prototype.removeAllPrimitives=function(){var e=this.primitives,t=this.primitive;$e(t)&&(e.remove(t),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());var i=this.oldPrimitive;$e(i)&&(e.remove(i),this.oldPrimitive=void 0)},ut.prototype.destroy=function(){var e=this.primitive,t=this.primitives;$e(e)&&t.remove(e);var i=this.oldPrimitive;$e(i)&&t.remove(i),$e(this.removeMaterialSubscription)&&this.removeMaterialSubscription()};var lt,ht,pt,ft,vt=!1,dt=new o.InjectionToken("ANGULAR_CESIUM_CONFIG"),yt=((lt=function e(t){_classCallCheck(this,e),this.config=t,!1!==(!t||t.fixEntitiesShadows)&&(vt||(Cesium.StaticGeometryColorBatch.prototype.add=function(e,t){var i,n,r=t.createFillGeometryInstance(e);255===r.attributes.color.value[3]?(i=this._solidItems,n=!1):(i=this._translucentItems,n=!0);for(var s=i.length,o=0;o<s;o++){var a=i[o];if(a.isMaterial(t))return void a.add(t,r)}var c=new ut(this._primitives,n,this._appearanceType,this._depthFailAppearanceType,t.depthFailMaterialProperty,this._closed,this._shadows);c.add(t,r),i.push(c)},vt=!0))}).\u0275fac=function(e){return new(e||lt)(o["\u0275\u0275inject"](dt,8))},lt.\u0275prov=o["\u0275\u0275defineInjectable"]({token:lt,factory:lt.\u0275fac}),lt),mt=function(e){return e[e.SCENE3D=0]="SCENE3D",e[e.COLUMBUS_VIEW=1]="COLUMBUS_VIEW",e[e.SCENE2D=2]="SCENE2D",e[e.PERFORMANCE_SCENE2D=3]="PERFORMANCE_SCENE2D",e}({}),gt=((pt=ht=function(){function e(){_classCallCheck(this,e),this.isSceneModePerformance2D=!1}return _createClass(e,[{key:"init",value:function(e){this.viewer=e.getViewer(),this.scene=e.getScene(),this.screenSpaceCameraController=this.scene.screenSpaceCameraController,this.camera=this.scene.camera,this.lastRotate=this.screenSpaceCameraController.enableRotate,this.lastTilt=this.screenSpaceCameraController.enableTilt,this.lastLook=this.screenSpaceCameraController.enableLook}},{key:"_listenToSceneModeMorph",value:function(e){this.morphListenerCancelFn=this.scene.morphStart.addEventListener(e)}},{key:"_revertCameraProperties",value:function(){this.isSceneModePerformance2D=!1,this.enableTilt(this.lastTilt),this.enableRotate(this.lastRotate),this.enableLook(this.lastLook)}},{key:"getCamera",value:function(){return this.camera}},{key:"getScreenSpaceCameraController",value:function(){return this.screenSpaceCameraController}},{key:"getMinimumZoom",value:function(){return this.screenSpaceCameraController.minimumZoomDistance}},{key:"setMinimumZoom",value:function(e){this.screenSpaceCameraController.minimumZoomDistance=e}},{key:"getMaximumZoom",value:function(){return this.screenSpaceCameraController.maximumZoomDistance}},{key:"setMaximumZoom",value:function(e){this.screenSpaceCameraController.maximumZoomDistance=e}},{key:"enableTilt",value:function(e){this.screenSpaceCameraController.enableTilt=e}},{key:"enableRotate",value:function(e){this.screenSpaceCameraController.enableRotate=e}},{key:"enableLook",value:function(e){this.screenSpaceCameraController.enableLook=e}},{key:"enableTranslate",value:function(e){this.screenSpaceCameraController.enableTranslate=e}},{key:"enableZoom",value:function(e){this.screenSpaceCameraController.enableZoom=e}},{key:"enableInputs",value:function(e){this.screenSpaceCameraController.enableInputs=e}},{key:"setSceneMode",value:function(e,t){var i=this;switch(e){case mt.SCENE3D:this.isSceneModePerformance2D&&this._revertCameraProperties(),this.scene.morphTo3D(t);break;case mt.COLUMBUS_VIEW:this.isSceneModePerformance2D&&this._revertCameraProperties(),this.scene.morphToColumbusView(t);break;case mt.SCENE2D:this.isSceneModePerformance2D&&this._revertCameraProperties(),this.scene.morphTo2D(t);break;case mt.PERFORMANCE_SCENE2D:this.isSceneModePerformance2D=!0,this.lastLook=this.screenSpaceCameraController.enableLook,this.lastTilt=this.screenSpaceCameraController.enableTilt,this.lastRotate=this.screenSpaceCameraController.enableRotate,this.screenSpaceCameraController.enableTilt=!1,this.screenSpaceCameraController.enableRotate=!1,this.screenSpaceCameraController.enableLook=!1,this.morphListenerCancelFn&&this.morphListenerCancelFn(),this.scene.morphToColumbusView(t);var n=this.scene.morphComplete.addEventListener((function(){i.camera.setView({destination:Cesium.Cartesian3.fromDegrees(0,0,Math.min(ht.PERFORMANCE_2D_ALTITUDE,i.getMaximumZoom())),orientation:{pitch:Cesium.Math.toRadians(-90)}}),n(),i._listenToSceneModeMorph(i._revertCameraProperties.bind(i))}))}}},{key:"cameraFlyTo",value:function(e){return this.camera.flyTo(e)}},{key:"flyTo",value:function(e,t){return this.viewer.flyTo(e,t)}},{key:"zoomIn",value:function(e){return this.camera.zoomIn(e||this.camera.defaultZoomAmount)}},{key:"zoomOut",value:function(e){return this.camera.zoomOut(e||this.camera.defaultZoomAmount)}},{key:"zoomTo",value:function(e,t){return this.viewer.zoomTo(e,t)}},{key:"setView",value:function(e){this.camera.setView(e)}},{key:"setRotation",value:function(e){this.setView({orientation:{heading:e}})}},{key:"lockRotation",value:function(e){this.scene.screenSpaceCameraController.enableRotate=!e}},{key:"trackEntity",value:function(e,t){var i=this,n=t&&t.flyTo||!1;return this.viewer.trackedEntity=void 0,new Promise((function(r){if(n){var s=t&&t.flyToDuration||1,o=t&&t.altitude||1e4,a=e.position.getValue(Cesium.JulianDate.now()),c=Cesium.Cartographic.fromCartesian(a),u=o-c.height;c.height=o;var l=Cesium.Cartesian3.fromRadians(c.longitude,c.latitude,c.height);i.cameraFlyTo({duration:s,destination:l,complete:function(){i.viewer.trackedEntity=e,setTimeout((function(){u>0?i.camera.zoomOut(u):i.camera.zoomIn(u)}),0),r()}})}else i.viewer.trackedEntity=e,r()}))}},{key:"untrackEntity",value:function(){this.trackEntity()}}]),e}()).\u0275fac=function(e){return new(e||pt)},pt.\u0275prov=o["\u0275\u0275defineInjectable"]({token:pt,factory:pt.\u0275fac}),pt.PERFORMANCE_2D_ALTITUDE=25e6,pt),Ct=function(e){return e[e.MOUSE_MOVE=Cesium.ScreenSpaceEventType.MOUSE_MOVE]="MOUSE_MOVE",e[e.LEFT_CLICK=Cesium.ScreenSpaceEventType.LEFT_CLICK]="LEFT_CLICK",e[e.LEFT_DOUBLE_CLICK=Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK]="LEFT_DOUBLE_CLICK",e[e.LEFT_DOWN=Cesium.ScreenSpaceEventType.LEFT_DOWN]="LEFT_DOWN",e[e.LEFT_UP=Cesium.ScreenSpaceEventType.LEFT_UP]="LEFT_UP",e[e.MIDDLE_CLICK=Cesium.ScreenSpaceEventType.MIDDLE_CLICK]="MIDDLE_CLICK",e[e.MIDDLE_DOUBLE_CLICK=Cesium.ScreenSpaceEventType.MIDDLE_DOUBLE_CLICK]="MIDDLE_DOUBLE_CLICK",e[e.MIDDLE_DOWN=Cesium.ScreenSpaceEventType.MIDDLE_DOWN]="MIDDLE_DOWN",e[e.MIDDLE_UP=Cesium.ScreenSpaceEventType.MIDDLE_UP]="MIDDLE_UP",e[e.PINCH_START=Cesium.ScreenSpaceEventType.PINCH_START]="PINCH_START",e[e.PINCH_END=Cesium.ScreenSpaceEventType.PINCH_END]="PINCH_END",e[e.PINCH_MOVE=Cesium.ScreenSpaceEventType.PINCH_MOVE]="PINCH_MOVE",e[e.RIGHT_CLICK=Cesium.ScreenSpaceEventType.RIGHT_CLICK]="RIGHT_CLICK",e[e.RIGHT_DOUBLE_CLICK=Cesium.ScreenSpaceEventType.RIGHT_DOUBLE_CLICK]="RIGHT_DOUBLE_CLICK",e[e.RIGHT_DOWN=Cesium.ScreenSpaceEventType.RIGHT_DOWN]="RIGHT_DOWN",e[e.RIGHT_UP=Cesium.ScreenSpaceEventType.RIGHT_UP]="RIGHT_UP",e[e.WHEEL=Cesium.ScreenSpaceEventType.WHEEL]="WHEEL",e[e.LONG_LEFT_PRESS=110]="LONG_LEFT_PRESS",e[e.LONG_RIGHT_PRESS=111]="LONG_RIGHT_PRESS",e[e.LONG_MIDDLE_PRESS=112]="LONG_MIDDLE_PRESS",e[e.LEFT_CLICK_DRAG=113]="LEFT_CLICK_DRAG",e[e.RIGHT_CLICK_DRAG=114]="RIGHT_CLICK_DRAG",e[e.MIDDLE_CLICK_DRAG=115]="MIDDLE_CLICK_DRAG",e}({}),_t=function(e){return e[e.NO_PICK=0]="NO_PICK",e[e.PICK_FIRST=1]="PICK_FIRST",e[e.PICK_ONE=2]="PICK_ONE",e[e.PICK_ALL=3]="PICK_ALL",e}({}),wt=((ft=function(){function e(){_classCallCheck(this,e),this._showContextMenu=!1,this._contextMenuChangeNotifier=new o.EventEmitter,this._onOpen=new o.EventEmitter,this._onClose=new o.EventEmitter,this._defaultContextMenuOptions={closeOnLeftCLick:!0,closeOnLeftClickPriority:10}}return _createClass(e,[{key:"init",value:function(e){this.mapEventsManager=e}},{key:"open",value:function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.close(),this._content=e,this._position=t,this._options=Object.assign({},this._defaultContextMenuOptions,n),this._showContextMenu=!0,this.mapEventsManager&&this._options.closeOnLeftCLick&&(this.leftClickRegistration=this.mapEventsManager.register({event:Ct.LEFT_CLICK,pick:_t.NO_PICK,priority:this._options.closeOnLeftClickPriority}),this.leftClickSubscription=this.leftClickRegistration.subscribe((function(){i.leftClickSubscription.unsubscribe(),i.close()}))),this._contextMenuChangeNotifier.emit(),this._onOpen.emit()}},{key:"close",value:function(){this._content=void 0,this._position=void 0,this._options=void 0,this._showContextMenu=!1,this.leftClickRegistration&&(this.leftClickRegistration.dispose(),this.leftClickRegistration=void 0),this.leftClickSubscription&&(this.leftClickSubscription.unsubscribe(),this.leftClickSubscription=void 0),this._contextMenuChangeNotifier.emit(),this._onClose.emit()}},{key:"contextMenuChangeNotifier",get:function(){return this._contextMenuChangeNotifier}},{key:"showContextMenu",get:function(){return this._showContextMenu}},{key:"options",get:function(){return this._options}},{key:"position",get:function(){return this._position}},{key:"content",get:function(){return this._content}},{key:"onOpen",get:function(){return this._onOpen}},{key:"onClose",get:function(){return this._onClose}}]),e}()).\u0275fac=function(e){return new(e||ft)},ft.\u0275prov=o["\u0275\u0275defineInjectable"]({token:ft,factory:ft.\u0275fac}),ft),bt=a.LatLonVectors;window.geodesy=a;var kt,Mt,xt,St,Et,It,Pt,Ot,Rt,Tt,At,Lt,Dt,jt,Nt,Ft,Vt,Bt,Kt,zt,Gt,Ut,Wt,Ht,qt,Xt,Zt,$t,Yt,Jt,Qt,ei,ti,ii,ni,ri,si,oi,ai,ci,ui,li,hi,pi,fi,vi,di,yi,mi,gi,Ci,_i,wi,bi,ki,Mi,xi=((kt=function(){function e(t){_classCallCheck(this,e),this.cesiumService=t}return _createClass(e,[{key:"screenToCartesian3",value:function(e,t){if(this.cesiumService){var i=Object.assign({},e);if(t){var n=this.cesiumService.getViewer().canvas.getBoundingClientRect();i.x+=n.left,i.y+=n.top}return this.cesiumService.getViewer().camera.pickEllipsoid(i)}throw new Error("ANGULAR2-CESIUM - Cesium service should be provided in order to do screen position calculations")}},{key:"screenToCartographic",value:function(e,t){return this.cartesian3ToCartographic(this.screenToCartesian3(e),t)}},{key:"cartesian3ToCartographic",value:function(e,t){return Cesium.Cartographic.fromCartesian(e,t)}},{key:"degreesToCartographic",value:function(e,t,i){return Cesium.Cartographic.fromDegrees(e,t,i)}},{key:"radiansToCartographic",value:function(e,t,i){return Cesium.Cartographic.fromRadians(e,t,i)}},{key:"degreesToUTM",value:function(e,t){return new a.LatLonEllipsoidal(t,e).toUtm()}},{key:"UTMToDegrees",value:function(e,t,i,n){return this.geodesyToCesiumObject(new a.Utm(e,t,i,n).toLatLonE())}},{key:"geodesyToCesiumObject",value:function(e){return{longitude:e.lon,latitude:e.lat,height:e.height?e.height:0}}},{key:"midPointToCartesian3",value:function(e,t){var i=function(e){return Cesium.Math.toDegrees(e)},n=new bt(i(e.latitude),i(e.longitude)),r=new bt(i(t.latitude),i(t.longitude)),s=n.midpointTo(r);return Cesium.Cartesian3.fromDegrees(s.lon,s.lat)}},{key:"middlePointByScreen",value:function(e,t){var i=this.cesiumService.getScene(),n=Cesium.SceneTransforms.wgs84ToWindowCoordinates(i,e),r=Cesium.SceneTransforms.wgs84ToWindowCoordinates(i,t),s=new Cesium.Cartesian2((r.x+n.x)/2,(r.y+n.y)/2);return i.pickPosition(s)}},{key:"bearingTo",value:function(e,t){var i=function(e){return Cesium.Math.toDegrees(e)},n=new bt(i(e.latitude),i(e.longitude)),r=new bt(i(t.latitude),i(t.longitude));return n.bearingTo(r)}},{key:"bearingToCartesian",value:function(e,t){var i=Cesium.Cartographic.fromCartesian(e),n=Cesium.Cartographic.fromCartesian(t);return this.bearingTo(i,n)}}],[{key:"cartesian3ToLatLon",value:function(e,t){var i=Cesium.Cartographic.fromCartesian(e,t);return{lon:Cesium.Math.toDegrees(i.longitude),lat:Cesium.Math.toDegrees(i.latitude),height:i.height}}}]),e}()).\u0275fac=function(e){return new(e||kt)(o["\u0275\u0275inject"](He,8))},kt.\u0275prov=o["\u0275\u0275defineInjectable"]({token:kt,factory:kt.\u0275fac}),kt),Si=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"setPropsAssigner",value:function(e){this._propsAssigner=e}}]),e}(),Ei=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n){var r;return _classCallCheck(this,i),(r=t.call(this)).drawerType=e,r.cesiumService=n,r._show=!0,r}return _createClass(i,[{key:"init",value:function(){this._cesiumCollection=new this.drawerType,this._primitiveCollectionWrap=new Cesium.PrimitiveCollection,this._primitiveCollectionWrap.add(this._cesiumCollection),this.cesiumService.getScene().primitives.add(this._primitiveCollectionWrap)}},{key:"add",value:function(e){return this._cesiumCollection.add(e)}},{key:"update",value:function(e,t){this._propsAssigner?this._propsAssigner(e,t):Object.assign(e,t)}},{key:"remove",value:function(e){this._cesiumCollection.remove(e)}},{key:"removeAll",value:function(){this._cesiumCollection.removeAll()}},{key:"setShow",value:function(e){this._show=e,this._primitiveCollectionWrap.show=e}},{key:"getShow",value:function(){return this._show}}]),i}(Si),Ii=((St=Mt=function(){function e(t){_classCallCheck(this,e),this.cesiumService=t}return _createClass(e,[{key:"screenPositionToCartesian3",value:function(e){return this.cesiumService.getViewer().camera.pickEllipsoid(e)}}],[{key:"pointByLocationDistanceAndAzimuth",value:function(e,t,i,n){for(var r,s,o=t/Cesium.Ellipsoid.WGS84.maximumRadius,a=e instanceof Cesium.Cartesian3?Cesium.Cartographic.fromCartesian(e):e,c=e instanceof Cesium.Cartesian3?e:Cesium.Cartesian3.fromRadians(e.longitude,e.latitude,e.height),u=0,l=.1,h=-.1;0===u||u<16&&Math.max(s,t)/Math.min(s,t)>1.000001;)r=Mt._pointByLocationDistanceAndAzimuth(a,o*(1+(h+(l-h)/2)),i),(s=this.distance(c,r))>t?l=h+(l-h)/2:h+=(l-h)/2,u++;return r}},{key:"_pointByLocationDistanceAndAzimuth",value:function(e,t,i){var n=e.latitude,r=e.longitude,s=Math.asin(Math.sin(n)*Math.cos(t)+Math.cos(n)*Math.sin(t)*Math.cos(i)),o=r+Math.atan2(Math.sin(i)*Math.sin(t)*Math.cos(n),Math.cos(t)-Math.sin(n)*Math.sin(s));return o=(o+3*Math.PI)%(2*Math.PI)-Math.PI,Cesium.Cartesian3.fromRadians(o,s)}},{key:"distance",value:function(e,t){return Cesium.Cartesian3.distance(e,t)}},{key:"getPositionsDelta",value:function(e,t){return{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}}},{key:"addDeltaToPosition",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(i){e.x+=t.x,e.y+=t.y,e.z+=t.z;var n=Cesium.Cartographic.fromCartesian(e);n.height=0;var r=Cesium.Cartesian3.fromRadians(n.longitude,n.latitude,n.height);return e.x=r.x,e.y=r.y,e.z=r.z,e}var s=new Cesium.Cartesian3(e.x+t.x,e.y+t.y,e.z+t.z),o=Cesium.Cartographic.fromCartesian(s);return o.height=0,Cesium.Cartesian3.fromRadians(o.longitude,o.latitude,o.height)}},{key:"middleCartesian3Point",value:function(e,t){return new Cesium.Cartesian3(t.x-e.x/2,t.y-e.y/2,t.z-e.z/2)}}]),e}()).\u0275fac=function(e){return new(e||St)(o["\u0275\u0275inject"](He))},St.\u0275prov=o["\u0275\u0275defineInjectable"]({token:St,factory:St.\u0275fac}),St),Pi=((xt=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,Cesium.PolylineCollection,e)}return _createClass(i,[{key:"_calculateArcPositions",value:function(e){for(var t=e.quality||18,i=e.delta/t,n=[],r=0;r<t+1;++r){var s=Ii.pointByLocationDistanceAndAzimuth(e.center,e.radius,e.angle+i*r,!0);n.push(s)}return n}},{key:"_calculateTriangle",value:function(e){return[e.center,Ii.pointByLocationDistanceAndAzimuth(e.center,e.radius,e.angle,!0)]}},{key:"_calculateArc",value:function(e){var t=this._calculateArcPositions(e);return e.drawEdges?t.concat(this._calculateTriangle(e)):t}},{key:"add",value:function(e){if(e.positions=this._calculateArc(e),e.color){var t=Cesium.Material.fromType("Color");t.uniforms.color=e.color,e.material=t}return this._cesiumCollection.add(e)}},{key:"update",value:function(e,t){return t.constantColor||!t.color||e.material.uniforms.color.equals(t.color)||(e.material.uniforms.color=t.color),e.width=void 0!==t.width?t.width:e.width,e.show=void 0!==t.show?t.show:e.show,e.distanceDisplayCondition=void 0!==t.distanceDisplayCondition?t.distanceDisplayCondition:e.distanceDisplayCondition,e.positions=this._calculateArc(t),e}}]),i}(Ei)).\u0275fac=function(e){return new(e||xt)(o["\u0275\u0275inject"](He))},xt.\u0275prov=o["\u0275\u0275defineInjectable"]({token:xt,factory:xt.\u0275fac}),xt),Oi=function(e){return e[e.ellipse=Cesium.EllipseGraphics]="ellipse",e[e.ellipsoid=Cesium.EllipsoidGraphics]="ellipsoid",e[e.polygon=Cesium.PolygonGraphics]="polygon",e[e.polyline=Cesium.PolylineGraphics]="polyline",e[e.polylineVolume=Cesium.PolylineVolumeGraphics]="polylineVolume",e[e.box=Cesium.BoxGraphics]="box",e[e.corridor=Cesium.CorridorGraphics]="corridor",e[e.cylinder=Cesium.CylinderGraphics]="cylinder",e[e.label=Cesium.LabelGraphics]="label",e[e.billboard=Cesium.BillboardGraphics]="billboard",e[e.model=Cesium.ModelGraphics]="model",e[e.path=Cesium.PathGraphics]="path",e[e.point=Cesium.PointGraphics]="point",e[e.rectangle=Cesium.RectangleGraphics]="rectangle",e[e.wall=Cesium.WallGraphics]="wall",e}({}),Ri=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;_classCallCheck(this,e),this.entityCollection=t,this._isSuspended=!1,this._isHardSuspend=!1,this._updateRate=n,this._collectionSize=i}return _createClass(e,[{key:"setShow",value:function(e){this.entityCollection.show=e}},{key:"collection",value:function(){return this.entityCollection}},{key:"isFree",value:function(){return this._collectionSize<1||this.entityCollection.values.length<this._collectionSize}},{key:"add",value:function(e){return this.suspend(),this.entityCollection.add(e)}},{key:"remove",value:function(e){return this.suspend(),this.entityCollection.remove(e)}},{key:"removeNoSuspend",value:function(e){this.entityCollection.remove(e)}},{key:"removeAll",value:function(){this.suspend(),this.entityCollection.removeAll()}},{key:"onEventSuspension",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._onEventSuspensionCallback={callback:e,once:i},function(){t._onEventSuspensionCallback=void 0}}},{key:"onEventResume",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._onEventResumeCallback={callback:e,once:i},this._isSuspended||this.triggerEventResume(),function(){t._onEventResumeCallback=void 0}}},{key:"triggerEventSuspension",value:function(){if(void 0!==this._onEventSuspensionCallback){var e=this._onEventSuspensionCallback.callback;this._onEventSuspensionCallback.once&&(this._onEventSuspensionCallback=void 0),e()}}},{key:"triggerEventResume",value:function(){if(void 0!==this._onEventResumeCallback){var e=this._onEventResumeCallback.callback;this._onEventResumeCallback.once&&(this._onEventResumeCallback=void 0),e()}}},{key:"suspend",value:function(){var e=this;this._updateRate<0||this._isHardSuspend||this._isSuspended||(this._isSuspended=!0,this.entityCollection.suspendEvents(),this.triggerEventSuspension(),this._suspensionTimeout=setTimeout((function(){e.entityCollection.resumeEvents(),e.triggerEventResume(),e._isSuspended=!1,e._suspensionTimeout=void 0}),this._updateRate))}},{key:"hardSuspend",value:function(){this.entityCollection.suspendEvents(),this._isHardSuspend=!0}},{key:"hardResume",value:function(){this.entityCollection.resumeEvents(),this._isHardSuspend=!1}},{key:"isSuspended",get:function(){return this._isSuspended}},{key:"updateRate",get:function(){return this._updateRate},set:function(e){this._updateRate=e}},{key:"collectionSize",get:function(){return this._collectionSize},set:function(e){this._collectionSize=e}}]),e}(),Ti=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n){var r,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collectionMaxSize:-1,collectionSuspensionTime:-1,collectionsNumber:1};for(var o in _classCallCheck(this,i),(r=t.call(this)).cesiumService=e,r.graphicsType=n,r.defaultOptions=s,r.entityCollections=new Map,r.graphicsTypeName=Oi[r.graphicsType],Oi)Oi[o]===r.graphicsType&&(r.graphicsTypeName=o);return r}return _createClass(i,[{key:"getFreeEntitiesCollection",value:function(){var e=null;return this.entityCollections.forEach((function(t){t.isFree()&&(e=t)})),e}},{key:"init",value:function(e){for(var t=e||this.defaultOptions,i=[],n=0;n<t.collectionsNumber;n++){var r=new Cesium.CustomDataSource(this.graphicsTypeName);i.push(r),this.cesiumService.getViewer().dataSources.add(r),this.entityCollections.set(r.entities,new Ri(r.entities,t.collectionMaxSize,t.collectionSuspensionTime))}return i}},{key:"add",value:function(e){var t=this.getFreeEntitiesCollection();if(null===t)throw new Error("No more free entity collections");var i=_defineProperty({position:void 0!==e.position?e.position:void 0,description:void 0!==e.description?e.description:void 0,orientation:void 0!==e.orientation?e.orientation:void 0,viewFrom:void 0!==e.viewFrom?e.viewFrom:void 0},this.graphicsTypeName,e);return void 0!==e.name&&(i.name=e.name),void 0!==e.availability&&(i.availability=e.availability),t.add(i)}},{key:"update",value:function(e,t){this.suspendEntityCollection(e),e.position instanceof Cesium.CallbackProperty&&e.position._isConstant&&(e.position=t.position),e.position=void 0!==t.position?t.position:void 0,e.name=void 0!==t.name?t.name:e.name,e.description=void 0!==t.description?t.description:e.description,e.orientation=void 0!==t.orientation?t.orientation:e.orientation,e.viewFrom=void 0!==t.viewFrom?t.viewFrom:e.viewFrom,e.availability=t.availability,this._propsAssigner?this._propsAssigner(e[this.graphicsTypeName],t):Object.assign(e[this.graphicsTypeName],t)}},{key:"remove",value:function(e){this.entityCollections.get(e.entityCollection).remove(e)}},{key:"removeAll",value:function(){this.entityCollections.forEach((function(e){e.removeAll()}))}},{key:"setShow",value:function(e){this.entityCollections.forEach((function(t){t.setShow(e)}))}},{key:"suspendEntityCollection",value:function(e){var t=e.entityCollection;if(!this.entityCollections.has(t))throw new Error("No EntityCollection for entity.entityCollection");this.entityCollections.get(t).suspend()}}]),i}(Si),Ai=((Lt=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,e,Oi.billboard)}return i}(Ti)).\u0275fac=function(e){return new(e||Lt)(o["\u0275\u0275inject"](He))},Lt.\u0275prov=o["\u0275\u0275defineInjectable"]({token:Lt,factory:Lt.\u0275fac}),Lt),Li=((At=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){var n;return _classCallCheck(this,i),(n=t.call(this)).cesiumService=e,n}return _createClass(i,[{key:"init",value:function(e){var t=[];return this.czmlStream=new Cesium.CzmlDataSource("czml"),t.push(this.czmlStream),this.cesiumService.getViewer().dataSources.add(this.czmlStream),t}},{key:"add",value:function(e){return this.czmlStream.process(e.czmlPacket),e}},{key:"update",value:function(e,t){this.czmlStream.process(t.czmlPacket)}},{key:"remove",value:function(e){this.czmlStream.entities.removeById(e.acEntity.id)}},{key:"removeAll",value:function(){this.czmlStream.entities.removeAll()}},{key:"setShow",value:function(e){this.czmlStream.entities.show=e}}]),i}(Si)).\u0275fac=function(e){return new(e||At)(o["\u0275\u0275inject"](He))},At.\u0275prov=o["\u0275\u0275defineInjectable"]({token:At,factory:At.\u0275fac}),At),Di=((Tt=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,e,Oi.ellipse)}return i}(Ti)).\u0275fac=function(e){return new(e||Tt)(o["\u0275\u0275inject"](He))},Tt.\u0275prov=o["\u0275\u0275defineInjectable"]({token:Tt,factory:Tt.\u0275fac}),Tt),ji=((Rt=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,e,Oi.label)}return i}(Ti)).\u0275fac=function(e){return new(e||Rt)(o["\u0275\u0275inject"](He))},Rt.\u0275prov=o["\u0275\u0275defineInjectable"]({token:Rt,factory:Rt.\u0275fac}),Rt),Ni=((Ot=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,e,Oi.point)}return i}(Ti)).\u0275fac=function(e){return new(e||Ot)(o["\u0275\u0275inject"](He))},Ot.\u0275prov=o["\u0275\u0275defineInjectable"]({token:Ot,factory:Ot.\u0275fac}),Ot),Fi=((Pt=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,e,Oi.polygon)}return i}(Ti)).\u0275fac=function(e){return new(e||Pt)(o["\u0275\u0275inject"](He))},Pt.\u0275prov=o["\u0275\u0275defineInjectable"]({token:Pt,factory:Pt.\u0275fac}),Pt),Vi=((It=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,e,Oi.polyline)}return i}(Ti)).\u0275fac=function(e){return new(e||It)(o["\u0275\u0275inject"](He))},It.\u0275prov=o["\u0275\u0275defineInjectable"]({token:It,factory:It.\u0275fac}),It),Bi=((Et=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,Cesium.PolylineCollection,e)}return _createClass(i,[{key:"add",value:function(e){return this._cesiumCollection.add(this.withColorMaterial(e))}},{key:"update",value:function(e,t){t.material instanceof Cesium.Color&&(e.material&&e.material.uniforms&&e.material.uniforms.color instanceof Cesium.Color?this.withColorMaterial(t):e.material.uniforms.color.equals(t.material)||(e.material.uniforms.color=t.material)),_get(_getPrototypeOf(i.prototype),"update",this).call(this,e,t)}},{key:"withColorMaterial",value:function(e){if(e.material instanceof Cesium.Color){var t=Cesium.Material.fromType("Color");t.uniforms.color=e.material,e.material=t}return e}}]),i}(Ei)).\u0275fac=function(e){return new(e||Et)(o["\u0275\u0275inject"](He))},Et.\u0275prov=o["\u0275\u0275defineInjectable"]({token:Et,factory:Et.\u0275fac}),Et),Ki=function(e){return e[e.CAMERA_FORWARD=0]="CAMERA_FORWARD",e[e.CAMERA_BACKWARD=1]="CAMERA_BACKWARD",e[e.CAMERA_RIGHT=2]="CAMERA_RIGHT",e[e.CAMERA_LEFT=3]="CAMERA_LEFT",e[e.CAMERA_UP=4]="CAMERA_UP",e[e.CAMERA_DOWN=5]="CAMERA_DOWN",e[e.CAMERA_LOOK_RIGHT=6]="CAMERA_LOOK_RIGHT",e[e.CAMERA_LOOK_LEFT=7]="CAMERA_LOOK_LEFT",e[e.CAMERA_LOOK_UP=8]="CAMERA_LOOK_UP",e[e.CAMERA_LOOK_DOWN=9]="CAMERA_LOOK_DOWN",e[e.CAMERA_TWIST_RIGHT=10]="CAMERA_TWIST_RIGHT",e[e.CAMERA_TWIST_LEFT=11]="CAMERA_TWIST_LEFT",e[e.CAMERA_ROTATE_RIGHT=12]="CAMERA_ROTATE_RIGHT",e[e.CAMERA_ROTATE_LEFT=13]="CAMERA_ROTATE_LEFT",e[e.CAMERA_ROTATE_UP=14]="CAMERA_ROTATE_UP",e[e.CAMERA_ROTATE_DOWN=15]="CAMERA_ROTATE_DOWN",e[e.CAMERA_ZOOM_IN=16]="CAMERA_ZOOM_IN",e[e.CAMERA_ZOOM_OUT=17]="CAMERA_ZOOM_OUT",e}({}),zi=(_defineProperty(n={},Ki.CAMERA_FORWARD,(function(e,t){var i=e.getViewer().camera,n=e.getScene().globe.ellipsoid.cartesianToCartographic(i.position).height;i.moveForward(n/(t.moveRate||100))})),_defineProperty(n,Ki.CAMERA_BACKWARD,(function(e,t){var i=e.getViewer().camera,n=e.getScene().globe.ellipsoid.cartesianToCartographic(i.position).height;i.moveBackward(n/(t.moveRate||100))})),_defineProperty(n,Ki.CAMERA_UP,(function(e,t){var i=e.getViewer().camera,n=e.getScene().globe.ellipsoid.cartesianToCartographic(i.position).height;i.moveUp(n/(t.moveRate||100))})),_defineProperty(n,Ki.CAMERA_DOWN,(function(e,t){var i=e.getViewer().camera,n=e.getScene().globe.ellipsoid.cartesianToCartographic(i.position).height;i.moveDown(n/(t.moveRate||100))})),_defineProperty(n,Ki.CAMERA_RIGHT,(function(e,t){var i=e.getViewer().camera,n=e.getScene().globe.ellipsoid.cartesianToCartographic(i.position).height;i.moveRight(n/(t.moveRate||100))})),_defineProperty(n,Ki.CAMERA_LEFT,(function(e,t){var i=e.getViewer().camera,n=e.getScene().globe.ellipsoid.cartesianToCartographic(i.position).height;i.moveLeft(n/(t.moveRate||100))})),_defineProperty(n,Ki.CAMERA_LOOK_RIGHT,(function(e,t){var i=e.getViewer().camera;i.lookRight(i.positionCartographic.latitude*(t.lookFactor||.01))})),_defineProperty(n,Ki.CAMERA_LOOK_LEFT,(function(e,t){var i=e.getViewer().camera;i.lookLeft(i.positionCartographic.latitude*(t.lookFactor||.01))})),_defineProperty(n,Ki.CAMERA_LOOK_UP,(function(e,t){var i=e.getViewer().camera;i.lookUp(i.positionCartographic.longitude*(-1*(t.lookFactor||.01)))})),_defineProperty(n,Ki.CAMERA_LOOK_DOWN,(function(e,t){var i=e.getViewer().camera;i.lookDown(i.positionCartographic.longitude*(-1*(t.lookFactor||.01)))})),_defineProperty(n,Ki.CAMERA_TWIST_RIGHT,(function(e,t){e.getViewer().camera.twistRight(t.amount||.01)})),_defineProperty(n,Ki.CAMERA_TWIST_LEFT,(function(e,t){e.getViewer().camera.twistLeft(t.amount||.01)})),_defineProperty(n,Ki.CAMERA_ROTATE_RIGHT,(function(e,t){e.getViewer().camera.rotateRight(t.angle||.01)})),_defineProperty(n,Ki.CAMERA_ROTATE_LEFT,(function(e,t){e.getViewer().camera.rotateLeft(t.angle||.01)})),_defineProperty(n,Ki.CAMERA_ROTATE_UP,(function(e,t){e.getViewer().camera.rotateUp(t.angle||.01)})),_defineProperty(n,Ki.CAMERA_ROTATE_DOWN,(function(e,t){e.getViewer().camera.rotateDown(t.angle||.01)})),_defineProperty(n,Ki.CAMERA_ZOOM_IN,(function(e,t){e.getViewer().camera.zoomIn(t.amount)})),_defineProperty(n,Ki.CAMERA_ZOOM_OUT,(function(e,t){e.getViewer().camera.zoomOut(t.amount)})),n),Gi=function(e){return e[e.IGNORED=0]="IGNORED",e[e.NOT_PRESSED=1]="NOT_PRESSED",e[e.PRESSED=2]="PRESSED",e}({}),Ui=((Dt=function(){function e(t,i,n){_classCallCheck(this,e),this.ngZone=t,this.cesiumService=i,this.document=n,this._currentDefinitions=null,this._activeDefinitions={},this._keyMappingFn=this.defaultKeyMappingFn}return _createClass(e,[{key:"init",value:function(){var e=this.cesiumService.getCanvas();e.addEventListener("click",(function(){e.focus()})),this.handleKeydown=this.handleKeydown.bind(this),this.handleKeyup=this.handleKeyup.bind(this),this.handleTick=this.handleTick.bind(this)}},{key:"setKeyboardControls",value:function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)return this.removeKeyboardControls();this._currentDefinitions||this.registerEvents(n),this._currentDefinitions=e,this._keyMappingFn=t||this.defaultKeyMappingFn,Object.keys(this._currentDefinitions).forEach((function(e){i._activeDefinitions[e]={state:Gi.NOT_PRESSED,action:null,keyboardEvent:null}}))}},{key:"removeKeyboardControls",value:function(){this.unregisterEvents(),this._currentDefinitions=null}},{key:"getAction",value:function(e){return this._currentDefinitions[e]||null}},{key:"defaultKeyMappingFn",value:function(e){return String.fromCharCode(e.keyCode)}},{key:"handleKeydown",value:function(e){var t=this._keyMappingFn(e),i=this.getAction(t);if(i&&this._activeDefinitions[t].state!==Gi.IGNORED){var n=!0,r=this.getParams(i.params,e);i.validation&&(n=i.validation(this.cesiumService,r,e)),!0===n&&(this._activeDefinitions[t]={state:Gi.PRESSED,action:i,keyboardEvent:e})}}},{key:"handleKeyup",value:function(e){var t=this._keyMappingFn(e),i=this.getAction(t);i&&(this._activeDefinitions[t]={state:Gi.NOT_PRESSED,action:null,keyboardEvent:e},i.done&&"function"==typeof i.done&&i.done(this.cesiumService,e))}},{key:"handleTick",value:function(){var e=this;Object.keys(this._activeDefinitions).forEach((function(t){var i=e._activeDefinitions[t];null!==i&&null!==i.action&&i.state===Gi.PRESSED&&e.executeAction(i.action,t,i.keyboardEvent)}))}},{key:"getParams",value:function(e,t){return e?"function"==typeof e?e(this.cesiumService,t):e:{}}},{key:"executeAction",value:function(e,t,i){if(this._currentDefinitions){var n=this.getParams(e.params,i);if(Object(c.isNumber)(e.action)){var r=zi[e.action];r&&r(this.cesiumService,n,i)}else"function"==typeof e.action&&!1===e.action(this.cesiumService,n,i)&&(this._activeDefinitions[t]={state:Gi.IGNORED,action:null,keyboardEvent:null})}}},{key:"registerEvents",value:function(e){var t=this,i=function(){t.document.addEventListener("keydown",t.handleKeydown),t.document.addEventListener("keyup",t.handleKeyup),t.cesiumService.getViewer().clock.onTick.addEventListener(t.handleTick)};e?this.ngZone.runOutsideAngular(i):i()}},{key:"unregisterEvents",value:function(){this.document.removeEventListener("keydown",this.handleKeydown),this.document.removeEventListener("keyup",this.handleKeyup),this.cesiumService.getViewer().clock.onTick.removeEventListener(this.handleTick)}}]),e}()).\u0275fac=function(e){return new(e||Dt)(o["\u0275\u0275inject"](o.NgZone),o["\u0275\u0275inject"](He),o["\u0275\u0275inject"](r.d))},Dt.\u0275prov=o["\u0275\u0275defineInjectable"]({token:Dt,factory:Dt.\u0275fac}),Dt),Wi=function(){function e(t,i){_classCallCheck(this,e),this.event=t,this.modifier=i}return _createClass(e,[{key:"init",value:function(e){var t=this;return this.observer=_.a.create((function(i){e.setInputAction((function(e){e.position&&(e.startPosition=e.position,e.endPosition=e.position),i.next(e)}),t.event,t.modifier)})),this.observer}}]),e}(),Hi=((jt=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r){var s;return _classCallCheck(this,i),(s=t.call(this,e,n)).event=e,s.modifier=n,s.eventFactory=r,s}return _createClass(i,[{key:"init",value:function(){var e,t;this.event===Ct.LONG_LEFT_PRESS?(e=Ct.LEFT_DOWN,t=Ct.LEFT_UP):this.event===Ct.LONG_RIGHT_PRESS?(e=Ct.RIGHT_DOWN,t=Ct.RIGHT_UP):this.event===Ct.LONG_MIDDLE_PRESS&&(e=Ct.MIDDLE_DOWN,t=Ct.MIDDLE_UP);var n=this.eventFactory.get(e,this.modifier),r=this.eventFactory.get(t,this.modifier);return h()(n.pipe(Object(p.a)((function(e){return Object(w.a)(e).pipe(Object(f.a)(i.LONG_PRESS_EVENTS_DURATION),Object(v.a)(r))}))))}}]),i}(Wi)).LONG_PRESS_EVENTS_DURATION=250,jt),qi=((Vt=Nt=function(){function e(t){_classCallCheck(this,e),this.cesiumService=t,this.cesiumEventsObservables=new Map}return _createClass(e,[{key:"init",value:function(){this.eventsHandler=this.cesiumService.getViewer().screenSpaceEventHandler}},{key:"get",value:function(e,t){var i=Nt.getEventFullName(e,t);if(this.cesiumEventsObservables.has(i))return this.cesiumEventsObservables.get(i);var n=this.createCesiumEventObservable(e,t);return this.cesiumEventsObservables.set(i,n),n}},{key:"createCesiumEventObservable",value:function(e,t){var i;return(i=Nt.longPressEvents.has(e)?this.createSpecialCesiumEventObservable(e,t):h()(new Wi(e,t).init(this.eventsHandler))).connect(),i}},{key:"createSpecialCesiumEventObservable",value:function(e,t){return new Hi(e,t,this).init()}}],[{key:"getEventFullName",value:function(e,t){return t?"".concat(e,"_").concat(t):e.toString()}}]),e}()).\u0275fac=function(e){return new(e||Vt)(o["\u0275\u0275inject"](He))},Vt.\u0275prov=o["\u0275\u0275defineInjectable"]({token:Vt,factory:Vt.\u0275fac}),Vt.longPressEvents=new Set([Ct.LONG_LEFT_PRESS,Ct.LONG_RIGHT_PRESS,Ct.LONG_MIDDLE_PRESS]),Vt),Xi=((Ft=function(){function e(){_classCallCheck(this,e),this._entitesToPlonter=[],this._plonterChangeNotifier=new o.EventEmitter,this._plonterObserver=new u.a}return _createClass(e,[{key:"plonterIt",value:function(e){return this._eventResult=e,this._entitesToPlonter=e.entities,this._plonterShown=!0,this._plonterChangeNotifier.emit(),this._plonterObserver}},{key:"resolvePlonter",value:function(e){this._plonterShown=!1,this._eventResult.entities=[e],this._plonterChangeNotifier.emit(),this._plonterObserver.next(this._eventResult)}},{key:"plonterChangeNotifier",get:function(){return this._plonterChangeNotifier}},{key:"plonterShown",get:function(){return this._plonterShown}},{key:"entitesToPlonter",get:function(){return this._entitesToPlonter}},{key:"plonterClickPosition",get:function(){return this._eventResult.movement}}]),e}()).\u0275fac=function(e){return new(e||Ft)},Ft.\u0275prov=o["\u0275\u0275defineInjectable"]({token:Ft,factory:Ft.\u0275fac}),Ft),Zi=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getDragEventTypes",value:function(e){var t,i;return e===Ct.LEFT_CLICK_DRAG?(t=Ct.LEFT_DOWN,i=Ct.LEFT_UP):e===Ct.RIGHT_CLICK_DRAG?(t=Ct.RIGHT_DOWN,i=Ct.RIGHT_UP):e===Ct.MIDDLE_CLICK_DRAG&&(t=Ct.MIDDLE_DOWN,i=Ct.MIDDLE_UP),{mouseDownEvent:t,mouseUpEvent:i}}}]),e}();return e.dragEvents=new Set([Ct.LEFT_CLICK_DRAG,Ct.RIGHT_CLICK_DRAG,Ct.MIDDLE_CLICK_DRAG]),e}(),$i=function e(t,i,n,r){_classCallCheck(this,e),this.observable=t,this.stopper=i,this.priority=n,this.isPaused=r},Yi=((Wt=function(){function e(t,i,n){_classCallCheck(this,e),this.cesiumService=t,this.eventBuilder=i,this.plonterService=n,this.eventRegistrations=new Map}return _createClass(e,[{key:"init",value:function(){this.eventBuilder.init(),this.scene=this.cesiumService.getScene()}},{key:"register",value:function(e){var t=this;if(void 0===this.scene)throw new Error("CesiumService has not been initialized yet - MapEventsManagerService must be injected  under ac-map");if(e.pick=e.pick||_t.NO_PICK,e.priority=e.priority||0,e.pickConfig=e.pickConfig||{},e.entityType&&e.pick===_t.NO_PICK)throw new Error("MapEventsManagerService: can't register an event with entityType and PickOptions.NO_PICK - It doesn't make sense ");var i=qi.getEventFullName(e.event,e.modifier);this.eventRegistrations.has(i)||this.eventRegistrations.set(i,[]);var n=this.createEventRegistration(e),r=n.observable;return r.dispose=function(){return t.disposeObservable(n,i)},this.eventRegistrations.get(i).push(n),this.sortRegistrationsByPriority(i),r}},{key:"disposeObservable",value:function(e,t){e.stopper.next(1);var i=this.eventRegistrations.get(t),n=i.indexOf(e);-1!==n&&i.splice(n,1),this.sortRegistrationsByPriority(t)}},{key:"sortRegistrationsByPriority",value:function(e){var t=this.eventRegistrations.get(e);if(t.sort((function(e,t){return t.priority-e.priority})),0!==t.length){var i=t[0].priority;t.forEach((function(e){e.isPaused=e.priority<i}))}}},{key:"createEventRegistration",value:function(e){var t,i=this,n=e.event,r=e.modifier,s=e.entityType,o=e.pick,a=e.priority,c=e.pickFilter,l=e.pickConfig,h=this.eventBuilder.get(n,r),p=new u.a,f=new $i(void 0,p,a,!1);return t=Zi.dragEvents.has(n)?this.createDragEvent({event:n,modifier:r,entityType:s,pick:o,priority:a,pickFilter:c,pickConfig:l}).pipe(Object(v.a)(p)):h.pipe(Object(d.a)((function(){return!f.isPaused})),Object(y.a)((function(e){return i.triggerPick(e,o,l)})),Object(d.a)((function(e){return null!==e.cesiumEntities||void 0===s})),Object(y.a)((function(e){return i.addEntities(e,s,o,c)})),Object(d.a)((function(e){return null!==e.entities||void 0===s&&!c})),Object(m.a)((function(e){return i.plonter(e,o)})),Object(v.a)(p)),f.observable=t,f}},{key:"createDragEvent",value:function(e){var t=e.event,i=e.modifier,n=e.entityType,r=e.pick,s=e.priority,o=e.pickFilter,a=e.pickConfig,c=Zi.getDragEventTypes(t),l=c.mouseDownEvent,h=c.mouseUpEvent,f=this.eventBuilder.get(h),d=this.eventBuilder.get(Ct.MOUSE_MOVE),m=this.createEventRegistration({event:l,modifier:i,entityType:n,pick:r,priority:s,pickFilter:o,pickConfig:a}),_=new u.a,w=m.observable.pipe(Object(p.a)((function(e){var t=null,i=e.movement.startPosition.x,n=e.movement.startPosition.y;return d.pipe(Object(y.a)((function(r){return t={movement:{drop:!1,startPosition:{x:i,y:n},endPosition:r.endPosition},entities:e.entities,cesiumEntities:e.cesiumEntities}})),Object(v.a)(f),Object(g.a)({complete:function(){if(t){var e=Object.assign({},t);e.movement.drop=!0,_.next(e)}}}))})));return Object(C.a)(w,_)}},{key:"triggerPick",value:function(e,t,i){var n=[];switch(t){case _t.PICK_ONE:case _t.PICK_ALL:n=0===(n=this.scene.drillPick(e.endPosition,i.drillPickLimit,i.pickWidth,i.pickHeight)).length?null:n;break;case _t.PICK_FIRST:var r=this.scene.pick(e.endPosition,i.pickWidth,i.pickHeight);n=void 0===r?null:[r]}return n&&(n=n.map((function(e){return e.id&&e.id instanceof Cesium.Entity?e.id:e.primitive}))),{movement:e,cesiumEntities:n}}},{key:"addEntities",value:function(e,t,i,n){if(null===e.cesiumEntities)return e.entities=null,e;var r=[];return i!==_t.NO_PICK&&(r=(r=t?e.cesiumEntities.map((function(e){return e.acEntity})).filter((function(e){return e&&e instanceof t})):e.cesiumEntities.map((function(e){return e.acEntity}))).reduce((function(e,t){return e.indexOf(t)<0&&e.push(t),e}),[]),0===(r=n&&r?r.filter(n):r).length&&(r=null)),e.entities=r,e}},{key:"plonter",value:function(e,t){return t===_t.PICK_ONE&&null!==e.entities&&e.entities.length>1?this.plonterService.plonterIt(e):Object(w.a)(e)}}]),e}()).\u0275fac=function(e){return new(e||Wt)(o["\u0275\u0275inject"](He),o["\u0275\u0275inject"](qi),o["\u0275\u0275inject"](Xi))},Wt.\u0275prov=o["\u0275\u0275defineInjectable"]({token:Wt,factory:Wt.\u0275fac}),Wt),Ji=((Ut=function(){function e(t){_classCallCheck(this,e),this.cesiumService=t,this.layersDataSources=[]}return _createClass(e,[{key:"registerLayerDataSources",value:function(e,t){var i=this;e.forEach((function(e){e.zIndex=t,i.layersDataSources.push(e)}))}},{key:"drawAllLayers",value:function(){var e=this;this.layersDataSources.sort((function(e,t){return e.zIndex-t.zIndex})),this.layersDataSources.forEach((function(t){e.cesiumService.getViewer().dataSources.add(t)}))}},{key:"updateAndRefresh",value:function(e,t){var i=this;e&&e.length&&(e.forEach((function(e){var n=i.layersDataSources.indexOf(e);-1!==n&&(i.layersDataSources[n].zIndex=t)})),this.cesiumService.getViewer().dataSources.removeAll(),this.drawAllLayers())}},{key:"removeDataSources",value:function(e){var t=this;e.forEach((function(e){var i=t.layersDataSources.indexOf(e);-1!==i&&(t.layersDataSources.splice(i,1),t.cesiumService.getViewer().dataSources.remove(e,!0))}))}}]),e}()).\u0275fac=function(e){return new(e||Ut)(o["\u0275\u0275inject"](He))},Ut.\u0275prov=o["\u0275\u0275defineInjectable"]({token:Ut,factory:Ut.\u0275fac}),Ut),Qi=((Gt=function(){function e(){_classCallCheck(this,e),this.defaultIdCounter=0,this._Maps=new Map,this.eventRemoveCallbacks=[]}return _createClass(e,[{key:"getMap",value:function(e){return e?this._Maps.get(e):this.firstMap}},{key:"_registerMap",value:function(e,t){this.firstMap||(this.firstMap=t);var i=e||this.generateDefaultId();if(this._Maps.has(i))throw new Error("Map with id: ".concat(i," already exist"));return this._Maps.set(i,t),i}},{key:"_removeMapById",value:function(e){return this._Maps.delete(e)}},{key:"generateDefaultId",value:function(){return this.defaultIdCounter++,"default-map-id-"+this.defaultIdCounter}},{key:"sync2DMapsCameras",value:function(e){var t=this;this.unsyncMapsCameras();var i=e.map((function(e){var i=t.getMap(e.id);if(!i)throw new Error("Couldn't find map with id: ".concat(e.id));return{map:i,options:{sensitivity:e.sensitivity,bindZoom:e.bindZoom}}}));i.forEach((function(e){var n=e.map,r=e.options,s=n.getCameraService().getCamera(),o=s.positionCartographic;s.percentageChanged=r.sensitivity||.01;var a=s.changed.addEventListener((function(){i.forEach((function(e){var t=e.map,i=e.options;if(t!==n){var r=t.getCameraService().getCamera(),s=Cesium.Ellipsoid.WGS84.cartographicToCartesian({longitude:o.longitude,latitude:o.latitude,height:i.bindZoom?o.height:r.positionCartographic.height});t.getCesiumViewer().scene.mode!==Cesium.SceneMode.MORPHING&&r.setView({destination:s,orientation:{heading:r.heading,pitch:r.pitch}})}}))}));t.eventRemoveCallbacks.push(a)}))}},{key:"unsyncMapsCameras",value:function(){this.eventRemoveCallbacks.forEach((function(e){return e()})),this.eventRemoveCallbacks=[]}}]),e}()).\u0275fac=function(e){return new(e||Gt)},Gt.\u0275prov=o["\u0275\u0275defineInjectable"]({token:Gt,factory:Gt.\u0275fac}),Gt),en=((zt=function(){function e(t){_classCallCheck(this,e),this.cesiumService=t}return _createClass(e,[{key:"getMapScreenshotDataUrlBase64",value:function(){return this.cesiumService.getCanvas().toDataURL()}},{key:"downloadMapScreenshot",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"map.png",t=this.getMapScreenshotDataUrlBase64();this.downloadURI(t,e)}},{key:"downloadURI",value:function(e,t){var i=document.createElement("a");i.download=t,i.href=e,document.body.appendChild(i),i.click(),document.body.removeChild(i)}}]),e}()).\u0275fac=function(e){return new(e||zt)(o["\u0275\u0275inject"](He))},zt.\u0275prov=o["\u0275\u0275defineInjectable"]({token:zt,factory:zt.\u0275fac}),zt),tn=((Kt=function(){function e(t,i,n,r,s,o,a,c,u,l,h,p,f,v,d,y,m,g,C,_){_classCallCheck(this,e),this._cesiumService=t,this._cameraService=i,this._elemRef=n,this.document=r,this.mapsManagerService=s,this.billboardDrawerService=o,this.labelDrawerService=a,this.ellipseDrawerService=c,this.polylineDrawerService=u,this.polygonDrawerService=l,this.arcDrawerService=h,this.pointDrawerService=p,this.czmlDrawerService=f,this.mapEventsManager=v,this.keyboardControlService=d,this.mapLayersService=y,this.configurationService=m,this.screenshotService=g,this.contextMenuService=C,this.coordinateConverter=_,this.disableDefaultPlonter=!1,this.mapContainer=this.document.createElement("div"),this.mapContainer.style.width="100%",this.mapContainer.style.height="100%",this.mapContainer.className="map-container",this._cesiumService.init(this.mapContainer,this),this._cameraService.init(this._cesiumService),this.mapEventsManager.init(),this.billboardDrawerService.init(),this.labelDrawerService.init(),this.ellipseDrawerService.init(),this.polylineDrawerService.init(),this.polygonDrawerService.init(),this.arcDrawerService.init(),this.pointDrawerService.init(),this.czmlDrawerService.init(),this.keyboardControlService.init(),this.contextMenuService.init(this.mapEventsManager)}return _createClass(e,[{key:"ngOnInit",value:function(){this.mapId=this.mapsManagerService._registerMap(this.mapId,this),this.containerId||this._elemRef.nativeElement.appendChild(this.mapContainer)}},{key:"ngOnChanges",value:function(e){if(e.sceneMode&&this._cameraService.setSceneMode(e.sceneMode.currentValue),e.flyTo&&this._cameraService.cameraFlyTo(e.flyTo.currentValue),e.containerId&&!e.containerId.firstChange){var t=this.document.getElementById(e.containerId.currentValue);if(!t)throw new Error("No element found with id: ".concat(e.containerId.currentValue));t.appendChild(this.mapContainer)}}},{key:"ngAfterViewInit",value:function(){var e=this;this.mapLayersService.drawAllLayers(),this.containerId&&setTimeout((function(){var t=e.document.getElementById(e.containerId);if(!t)throw new Error("No element found with id: ".concat(e.containerId));t.appendChild(e.mapContainer)}),0)}},{key:"ngOnDestroy",value:function(){this.mapContainer.remove(),this.mapsManagerService._removeMapById(this.mapId)}},{key:"getCesiumService",value:function(){return this._cesiumService}},{key:"getCesiumViewer",value:function(){return this._cesiumService.getViewer()}},{key:"getCameraService",value:function(){return this._cameraService}},{key:"getId",value:function(){return this.mapId}},{key:"getMapContainer",value:function(){return this.mapContainer}},{key:"getMapEventsManager",value:function(){return this.mapEventsManager}},{key:"getContextMenuService",value:function(){return this.contextMenuService}},{key:"getScreenshotService",value:function(){return this.screenshotService}},{key:"getKeyboardControlService",value:function(){return this.keyboardControlService}},{key:"getCoordinateConverter",value:function(){return this.coordinateConverter}}]),e}()).\u0275fac=function(e){return new(e||Kt)(o["\u0275\u0275directiveInject"](He),o["\u0275\u0275directiveInject"](gt),o["\u0275\u0275directiveInject"](o.ElementRef),o["\u0275\u0275directiveInject"](r.d),o["\u0275\u0275directiveInject"](Qi),o["\u0275\u0275directiveInject"](Ai),o["\u0275\u0275directiveInject"](ji),o["\u0275\u0275directiveInject"](Di),o["\u0275\u0275directiveInject"](Vi),o["\u0275\u0275directiveInject"](Fi),o["\u0275\u0275directiveInject"](Pi),o["\u0275\u0275directiveInject"](Ni),o["\u0275\u0275directiveInject"](Li),o["\u0275\u0275directiveInject"](Yi),o["\u0275\u0275directiveInject"](Ui),o["\u0275\u0275directiveInject"](Ji),o["\u0275\u0275directiveInject"](yt),o["\u0275\u0275directiveInject"](en),o["\u0275\u0275directiveInject"](wt),o["\u0275\u0275directiveInject"](xi))},Kt.\u0275cmp=o["\u0275\u0275defineComponent"]({type:Kt,selectors:[["ac-map"]],inputs:{disableDefaultPlonter:"disableDefaultPlonter",mapId:"mapId",flyTo:"flyTo",sceneMode:"sceneMode",containerId:"containerId"},features:[o["\u0275\u0275ProvidersFeature"]([He,Ai,qi,Ui,Yi,Xi,ji,Vi,Bi,Di,Ni,Pi,Li,Fi,Ji,gt,en,wt,xi]),o["\u0275\u0275NgOnChangesFeature"]],ngContentSelectors:Le,decls:3,vars:1,consts:[[4,"ngIf"]],template:function(e,t){1&e&&(o["\u0275\u0275projectionDef"](),o["\u0275\u0275template"](0,Ae,1,0,"ac-default-plonter",0),o["\u0275\u0275element"](1,"ac-context-menu-wrapper"),o["\u0275\u0275projection"](2)),2&e&&o["\u0275\u0275property"]("ngIf",!t.disableDefaultPlonter)},directives:function(){return[r.m,Nn,jn]},encapsulation:2}),Kt),nn=((Bt=function(){function e(){_classCallCheck(this,e),this._cache=!0,this.descriptions=[],this.layerUpdate=new o.EventEmitter}return _createClass(e,[{key:"setEntityName",value:function(e){this._entityName=e}},{key:"getEntityName",value:function(){return this._entityName}},{key:"registerDescription",value:function(e){this.descriptions.indexOf(e)<0&&this.descriptions.push(e)}},{key:"unregisterDescription",value:function(e){var t=this.descriptions.indexOf(e);t>-1&&this.descriptions.splice(t,1)}},{key:"getDescriptions",value:function(){return this.descriptions}},{key:"layerUpdates",value:function(){return this.layerUpdate}},{key:"cache",get:function(){return this._cache},set:function(e){this._cache=e}},{key:"zIndex",get:function(){return this._zIndex},set:function(e){e!==this._zIndex&&this.layerUpdate.emit(),this._zIndex=e}},{key:"show",get:function(){return this._show},set:function(e){e!==this._show&&this.layerUpdate.emit(),this._show=e}},{key:"options",get:function(){return this._options},set:function(e){this._options=e,this.layerUpdate.emit()}},{key:"context",get:function(){return this._context},set:function(e){this._context=e,this.layerUpdate.emit()}}]),e}()).\u0275fac=function(e){return new(e||Bt)},Bt.\u0275prov=o["\u0275\u0275defineInjectable"]({token:Bt,factory:Bt.\u0275fac}),Bt),rn=function(e){return e[e.ADD_UPDATE=0]="ADD_UPDATE",e[e.DELETE=1]="DELETE",e}({}),sn=((Ht=function(){function e(){_classCallCheck(this,e),this._cache=new Map}return _createClass(e,[{key:"get",value:function(e,t){if(this._cache.has(e))return this._cache.get(e);var i=t();return this._cache.set(e,i),i}},{key:"clear",value:function(){this._cache.clear()}}]),e}()).\u0275fac=function(e){return new(e||Ht)},Ht.\u0275prov=o["\u0275\u0275defineInjectable"]({token:Ht,factory:Ht.\u0275fac}),Ht),on=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"throwIfAnyNotPresent",value:function(t,i){i.forEach((function(i){return e.throwIfNotPresent(t,i)}))}},{key:"throwIfNotPresent",value:function(t,i){if(!e.present(t[i]))throw new Error("Error: ".concat(i," was not given."))}},{key:"present",value:function(e){return null!=e}}]),e}(),an=((Xt=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,Cesium.PrimitiveCollection,e)}return _createClass(i,[{key:"add",value:function(e){return on.throwIfAnyNotPresent(e,["center","semiMajorAxis","semiMinorAxis"]),_get(_getPrototypeOf(i.prototype),"add",this).call(this,new M.EllipsePrimitive(e))}},{key:"update",value:function(e,t){return e.updateLocationData(t),e}}]),i}(Ei)).\u0275fac=function(e){return new(e||Xt)(o["\u0275\u0275inject"](He))},Xt.\u0275prov=o["\u0275\u0275defineInjectable"]({token:Xt,factory:Xt.\u0275fac}),Xt),cn=((qt=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,Cesium.PolylineCollection,e)}return i}(Ei)).\u0275fac=function(e){return new(e||qt)(o["\u0275\u0275inject"](He))},qt.\u0275prov=o["\u0275\u0275defineInjectable"]({token:qt,factory:qt.\u0275fac}),qt),un=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n){var r;return _classCallCheck(this,i),(r=t.call(this,Cesium.PrimitiveCollection,n)).geometryType=e,r}return _createClass(i,[{key:"add",value:function(e,t,n){t.geometry=new this.geometryType(e),n.geometryInstances=new Cesium.GeometryInstance(t),n.asynchronous=!1;var r=new Cesium.Primitive(n);return _get(_getPrototypeOf(i.prototype),"add",this).call(this,r)}},{key:"update",value:function(e,t,n,r){return n.geometry=new this.geometryType(t),r.geometryInstances=new Cesium.GeometryInstance(n),this._cesiumCollection.remove(e),_get(_getPrototypeOf(i.prototype),"add",this).call(this,new Cesium.Primitive(r))}}]),i}(Ei),ln=((mi=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,Cesium.CircleGeometry,e)}return i}(un)).\u0275fac=function(e){return new(e||mi)(o["\u0275\u0275inject"](He))},mi.\u0275prov=o["\u0275\u0275defineInjectable"]({token:mi,factory:mi.\u0275fac}),mi),hn=((yi=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,Cesium.PolylineGeometry,e)}return _createClass(i,[{key:"update",value:function(e,t,i,n){var r=i.attributes.color.value;return e.ready?e.getGeometryInstanceAttributes().color=r:Cesium.when(e.readyPromise).then((function(e){e.getGeometryInstanceAttributes().color.value=r})),e}}]),i}(un)).\u0275fac=function(e){return new(e||yi)(o["\u0275\u0275inject"](He))},yi.\u0275prov=o["\u0275\u0275defineInjectable"]({token:yi,factory:yi.\u0275fac}),yi),pn=((di=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,Cesium.PolygonGeometry,e)}return i}(un)).\u0275fac=function(e){return new(e||di)(o["\u0275\u0275inject"](He))},di.\u0275prov=o["\u0275\u0275defineInjectable"]({token:di,factory:di.\u0275fac}),di),fn=((vi=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,Cesium.EllipseGeometry,e)}return i}(un)).\u0275fac=function(e){return new(e||vi)(o["\u0275\u0275inject"](He))},vi.\u0275prov=o["\u0275\u0275defineInjectable"]({token:vi,factory:vi.\u0275fac}),vi),vn=((fi=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,e,Oi.model)}return i}(Ti)).\u0275fac=function(e){return new(e||fi)(o["\u0275\u0275inject"](He))},fi.\u0275prov=o["\u0275\u0275defineInjectable"]({token:fi,factory:fi.\u0275fac}),fi),dn=((pi=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,e,Oi.box)}return i}(Ti)).\u0275fac=function(e){return new(e||pi)(o["\u0275\u0275inject"](He))},pi.\u0275prov=o["\u0275\u0275defineInjectable"]({token:pi,factory:pi.\u0275fac}),pi),yn=((hi=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,e,Oi.corridor)}return i}(Ti)).\u0275fac=function(e){return new(e||hi)(o["\u0275\u0275inject"](He))},hi.\u0275prov=o["\u0275\u0275defineInjectable"]({token:hi,factory:hi.\u0275fac}),hi),mn=((li=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,e,Oi.cylinder)}return i}(Ti)).\u0275fac=function(e){return new(e||li)(o["\u0275\u0275inject"](He))},li.\u0275prov=o["\u0275\u0275defineInjectable"]({token:li,factory:li.\u0275fac}),li),gn=((ui=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,e,Oi.ellipsoid)}return i}(Ti)).\u0275fac=function(e){return new(e||ui)(o["\u0275\u0275inject"](He))},ui.\u0275prov=o["\u0275\u0275defineInjectable"]({token:ui,factory:ui.\u0275fac}),ui),Cn=((ci=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,e,Oi.polylineVolume)}return i}(Ti)).\u0275fac=function(e){return new(e||ci)(o["\u0275\u0275inject"](He))},ci.\u0275prov=o["\u0275\u0275defineInjectable"]({token:ci,factory:ci.\u0275fac}),ci),_n=((ai=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,e,Oi.wall)}return i}(Ti)).\u0275fac=function(e){return new(e||ai)(o["\u0275\u0275inject"](He))},ai.\u0275prov=o["\u0275\u0275defineInjectable"]({token:ai,factory:ai.\u0275fac}),ai),wn=((oi=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,e,Oi.rectangle)}return i}(Ti)).\u0275fac=function(e){return new(e||oi)(o["\u0275\u0275inject"](He))},oi.\u0275prov=o["\u0275\u0275defineInjectable"]({token:oi,factory:oi.\u0275fac}),oi),bn=((si=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,Cesium.LabelCollection,e)}return i}(Ei)).\u0275fac=function(e){return new(e||si)(o["\u0275\u0275inject"](He))},si.\u0275prov=o["\u0275\u0275defineInjectable"]({token:si,factory:si.\u0275fac}),si),kn=((ri=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,Cesium.BillboardCollection,e)}return i}(Ei)).\u0275fac=function(e){return new(e||ri)(o["\u0275\u0275inject"](He))},ri.\u0275prov=o["\u0275\u0275defineInjectable"]({token:ri,factory:ri.\u0275fac}),ri),Mn=((ni=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){return _classCallCheck(this,i),t.call(this,Cesium.PointPrimitiveCollection,e)}return i}(Ei)).\u0275fac=function(e){return new(e||ni)(o["\u0275\u0275inject"](He))},ni.\u0275prov=o["\u0275\u0275defineInjectable"]({token:ni,factory:ni.\u0275fac}),ni),xn=((ii=function(e){_inherits(i,e);var t=_createSuper(i);function i(e){var n;return _classCallCheck(this,i),(n=t.call(this,Cesium.HtmlCollection,e))._cesiumService=e,n}return _createClass(i,[{key:"add",value:function(e){return e.scene=this._cesiumService.getScene(),e.mapContainer=this._cesiumService.getMap().getMapContainer(),_get(_getPrototypeOf(i.prototype),"add",this).call(this,e)}}]),i}(Ei)).\u0275fac=function(e){return new(e||ii)(o["\u0275\u0275inject"](He))},ii.\u0275prov=o["\u0275\u0275defineInjectable"]({token:ii,factory:ii.\u0275fac}),ii),Sn=((ti=function(){function e(t,i,n,r,s,o,a,c,l,h,p,f,v,d,y,m,g,C,_,w,b,k,M,x,S,E,I,P,O,R){_classCallCheck(this,e),this.layerService=t,this._computationCache=i,this.mapLayersService=n,this.show=!0,this.store=!1,this.zIndex=0,this.debug=!1,this.acForRgx=/^let\s+.+\s+of\s+.+$/,this.stopObservable=new u.a,this._updateStream=new u.a,this.entitiesStore=new Map,this.layerDrawerDataSources=[],this._drawerList=new Map([["billboard",r],["label",s],["ellipse",o],["polyline",a],["polygon",c],["arc",l],["point",h],["model",p],["box",f],["corridor",v],["cylinder",d],["ellipsoid",y],["polylineVolume",m],["rectangle",C],["wall",g],["polylinePrimitive",S],["labelPrimitive",E],["billboardPrimitive",I],["pointPrimitive",P],["html",O],["czml",R],["dynamicEllipse",_],["dynamicPolyline",w],["staticCircle",b],["staticPolyline",k],["staticPolygon",M],["staticEllipse",x]])}return _createClass(e,[{key:"init",value:function(){var e=this;this.initValidParams(),Object(C.a)(this._updateStream,this.observable).pipe(Object(v.a)(this.stopObservable)).subscribe((function(t){e._computationCache.clear(),e.debug&&console.log("AcLayer received notification:",t);var i=t.entity;e.store&&(i=e.updateStore(t)),e.context[e.entityName]=i,e.layerService.getDescriptions().forEach((function(n){switch(t.actionType){case rn.ADD_UPDATE:n.draw(e.context,t.id,i);break;case rn.DELETE:n.remove(t.id);break;default:console.error("[ac-layer] unknown AcNotification.actionType for notification: "+t)}}))}))}},{key:"updateStore",value:function(e){if(e.actionType!==rn.DELETE){if(this.entitiesStore.has(e.id)){var t=this.entitiesStore.get(e.id);return Object.assign(t,e.entity),t}return this.entitiesStore.set(e.id,e.entity),e.entity}this.entitiesStore.delete(e.id)}},{key:"initValidParams",value:function(){if(!this.context)throw new Error("ac-layer: must initialize [context] ");if(!this.acForRgx.test(this.acFor))throw new Error('ac-layer: Invalid [acFor] syntax. Expected: [acFor]="let item of observable" .Instead received: '.concat(this.acFor));var e=this.acFor.split(" ");if(this.observable=this.context[e[3]],this.entityName=e[1],!this.isObservable(this.observable))throw new Error("ac-layer: must initailize [acFor] with rx observable, instead received: "+this.observable);this.layerService.context=this.context,this.layerService.setEntityName(this.entityName)}},{key:"isObservable",value:function(e){return e&&"function"==typeof e.subscribe}},{key:"ngAfterContentInit",value:function(){this.init()}},{key:"ngOnInit",value:function(){var e=this;this.layerService.context=this.context,this.layerService.options=this.options,this.layerService.show=this.show,this.layerService.zIndex=this.zIndex,this._drawerList.forEach((function(t,i){var n,r=t.init(e.options?e.options[i]:void 0);r&&(n=e.layerDrawerDataSources).push.apply(n,_toConsumableArray(r)),t.setShow(e.show)}))}},{key:"ngOnChanges",value:function(e){if(e.show&&!e.show.firstChange){var t=e.show.currentValue;this.layerService.show=t,this._drawerList.forEach((function(e){return e.setShow(t)}))}if(e.zIndex&&!e.zIndex.firstChange){var i=e.zIndex.currentValue;this.layerService.zIndex=i,this.mapLayersService.updateAndRefresh(this.layerDrawerDataSources,i)}}},{key:"ngOnDestroy",value:function(){this.mapLayersService.removeDataSources(this.layerDrawerDataSources),this.stopObservable.next(!0),this.removeAll()}},{key:"getLayerService",value:function(){return this.layerService}},{key:"getLayerDrawerDataSources",value:function(){return this.layerDrawerDataSources}},{key:"getDrawerDataSourcesByName",value:function(e){return this.layerDrawerDataSources.filter((function(t){return t.name===e}))}},{key:"getStore",value:function(){return this.entitiesStore}},{key:"removeAll",value:function(){this.layerService.getDescriptions().forEach((function(e){return e.removeAll()})),this.entitiesStore.clear()}},{key:"remove",value:function(e){this._updateStream.next({id:e,actionType:rn.DELETE}),this.entitiesStore.delete(e)}},{key:"updateNotification",value:function(e){this._updateStream.next(e)}},{key:"update",value:function(e,t){this._updateStream.next({entity:e,id:t,actionType:rn.ADD_UPDATE})}},{key:"refreshAll",value:function(e){var t=this;Object(b.a)(e).subscribe((function(e){return t._updateStream.next(e)}))}}]),e}()).\u0275fac=function(e){return new(e||ti)(o["\u0275\u0275directiveInject"](nn),o["\u0275\u0275directiveInject"](sn),o["\u0275\u0275directiveInject"](Ji),o["\u0275\u0275directiveInject"](Ai),o["\u0275\u0275directiveInject"](ji),o["\u0275\u0275directiveInject"](Di),o["\u0275\u0275directiveInject"](Vi),o["\u0275\u0275directiveInject"](Fi),o["\u0275\u0275directiveInject"](Pi),o["\u0275\u0275directiveInject"](Ni),o["\u0275\u0275directiveInject"](vn),o["\u0275\u0275directiveInject"](dn),o["\u0275\u0275directiveInject"](yn),o["\u0275\u0275directiveInject"](mn),o["\u0275\u0275directiveInject"](gn),o["\u0275\u0275directiveInject"](Cn),o["\u0275\u0275directiveInject"](_n),o["\u0275\u0275directiveInject"](wn),o["\u0275\u0275directiveInject"](an),o["\u0275\u0275directiveInject"](cn),o["\u0275\u0275directiveInject"](ln),o["\u0275\u0275directiveInject"](hn),o["\u0275\u0275directiveInject"](pn),o["\u0275\u0275directiveInject"](fn),o["\u0275\u0275directiveInject"](Bi),o["\u0275\u0275directiveInject"](bn),o["\u0275\u0275directiveInject"](kn),o["\u0275\u0275directiveInject"](Mn),o["\u0275\u0275directiveInject"](xn),o["\u0275\u0275directiveInject"](Li))},ti.\u0275cmp=o["\u0275\u0275defineComponent"]({type:ti,selectors:[["ac-layer"]],inputs:{show:"show",store:"store",zIndex:"zIndex",debug:"debug",acFor:"acFor",context:"context",options:"options"},features:[o["\u0275\u0275ProvidersFeature"]([nn,sn,Ai,ji,Di,Vi,Pi,Ni,Fi,vn,dn,yn,mn,gn,Cn,_n,wn,Bi,bn,kn,Mn,xn,Li,an,cn,ln,hn,pn,fn]),o["\u0275\u0275NgOnChangesFeature"]],ngContentSelectors:Le,decls:1,vars:0,template:function(e,t){1&e&&(o["\u0275\u0275projectionDef"](),o["\u0275\u0275projection"](0))},encapsulation:2,changeDetection:0}),ti),En=((ei=function(){function e(){_classCallCheck(this,e),this._mapper=new x.JsonStringMapper}return _createClass(e,[{key:"map",value:function(e){return this._mapper.map(e)}}]),e}()).\u0275fac=function(e){return new(e||ei)},ei.\u0275prov=o["\u0275\u0275defineInjectable"]({token:ei,factory:ei.\u0275fac}),ei),In=((Qt=function(){function e(t,i){_classCallCheck(this,e),this._parser=t,this._jsonMapper=i,this._assignersCache=new Map,this._evaluatorsCache=new Map}return _createClass(e,[{key:"_compile",value:function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n={},r=new Map;this._jsonMapper.map(e).forEach((function(e,i){return r.set(i,{expression:e,get:t._parser.eval(e)})})),r.forEach((function(e,t){n[t||"undefined"]=i?"cache.get(`".concat(e.expression,"`, () => propsMap.get('").concat(t,"').get(context))"):"propsMap.get('".concat(t,"').get(context)")}));var s="return ".concat(JSON.stringify(n).replace(/"/g,""),";"),o=new Function("propsMap","cache","context",s);return function(e,t){return o(r,e,t)}}},{key:"_build",value:function(e){var t=Array.from(this._jsonMapper.map(e).keys()),i=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i="";e.forEach((function(e){i+=t?"if(!(obj1['".concat(e,"'] instanceof Cesium.CallbackProperty))obj1['").concat(e,"'] = obj2['").concat(e,"']; "):"if (!(obj1['".concat(e,"'] instanceof Cesium.CallbackProperty) && obj2['").concat(e,"'] !== undefined) { obj1['").concat(e,"'] = obj2['").concat(e,"']; } ")})),i+="return obj1";var n=new Function("obj1","obj2",i);return function(e,t){return n(e,t)}}}]),e}().create(t);return function(e,t){return i(e,t)}}},{key:"createEvaluator",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!i&&this._evaluatorsCache.has(e))return this._evaluatorsCache.get(e);var n=this._compile(e,t);return this._evaluatorsCache.set(e,n),n}},{key:"createAssigner",value:function(e){if(this._assignersCache.has(e))return this._assignersCache.get(e);var t=this._build(e);return this._assignersCache.set(e,t),t}}]),e}()).\u0275fac=function(e){return new(e||Qt)(o["\u0275\u0275inject"](Re),o["\u0275\u0275inject"](En))},Qt.\u0275prov=o["\u0275\u0275defineInjectable"]({token:Qt,factory:Qt.\u0275fac}),Qt),Pn=((Jt=function(){function e(t,i,n,r){_classCallCheck(this,e),this._drawer=t,this._layerService=i,this._computationCache=n,this._cesiumProperties=r,this.onDraw=new o.EventEmitter,this.onRemove=new o.EventEmitter,this._cesiumObjectsMap=new Map}return _createClass(e,[{key:"_propsEvaluator",value:function(e){return this._propsEvaluateFn(this._computationCache,e)}},{key:"_getPropsAssigner",value:function(){var e=this;return function(t,i){return e._propsAssignerFn(t,i)}}},{key:"getLayerService",value:function(){return this._layerService}},{key:"setLayerService",value:function(e){this._layerService.unregisterDescription(this),this._layerService=e,this._layerService.registerDescription(this),this._propsEvaluateFn=this._cesiumProperties.createEvaluator(this.props,this._layerService.cache,!0),this._propsAssignerFn=this._cesiumProperties.createAssigner(this.props)}},{key:"ngOnInit",value:function(){this.props||console.error("ac-desc components error: [props] input is mandatory"),this._layerService.registerDescription(this),this._propsEvaluateFn=this._cesiumProperties.createEvaluator(this.props,this._layerService.cache),this._propsAssignerFn=this._cesiumProperties.createAssigner(this.props)}},{key:"getCesiumObjectsMap",value:function(){return this._cesiumObjectsMap}},{key:"draw",value:function(e,t,i){var n=this._propsEvaluator(e);if(this._cesiumObjectsMap.has(t)){var r=this._cesiumObjectsMap.get(t);this.onDraw.emit({acEntity:i,cesiumEntity:r,entityId:t}),r.acEntity=i,this._drawer.setPropsAssigner(this._getPropsAssigner()),this._drawer.update(r,n)}else{var s=this._drawer.add(n);this.onDraw.emit({acEntity:i,cesiumEntity:s,entityId:t}),s.acEntity=i,this._cesiumObjectsMap.set(t,s)}}},{key:"remove",value:function(e){var t=this._cesiumObjectsMap.get(e);t&&(this.onRemove.emit({acEntity:t.acEntity,cesiumEntity:t,entityId:e}),this._drawer.remove(t),this._cesiumObjectsMap.delete(e))}},{key:"removeAll",value:function(){this._cesiumObjectsMap.clear(),this._drawer.removeAll()}},{key:"ngOnDestroy",value:function(){this._layerService.unregisterDescription(this),this.removeAll()}}]),e}()).\u0275fac=function(e){return new(e||Jt)(o["\u0275\u0275directiveInject"](Si),o["\u0275\u0275directiveInject"](nn),o["\u0275\u0275directiveInject"](sn),o["\u0275\u0275directiveInject"](In))},Jt.\u0275dir=o["\u0275\u0275defineDirective"]({type:Jt,inputs:{props:"props"},outputs:{onDraw:"onDraw",onRemove:"onRemove"}}),Jt),On=((Yt=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"transform",value:function(e,t){return new Cesium.Cartesian2(e[0],e[1])}}]),e}()).\u0275fac=function(e){return new(e||Yt)},Yt.\u0275pipe=o["\u0275\u0275definePipe"]({name:"pixelOffset",type:Yt,pure:!0}),Yt),Rn=(($t=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"transform",value:function(e,t){return(360-Math.round(180*e/Math.PI))%360}}]),e}()).\u0275fac=function(e){return new(e||$t)},$t.\u0275pipe=o["\u0275\u0275definePipe"]({name:"radiansToDegrees",type:$t,pure:!0}),$t),Tn=((Zt=function e(){_classCallCheck(this,e)}).\u0275mod=o["\u0275\u0275defineNgModule"]({type:Zt}),Zt.\u0275inj=o["\u0275\u0275defineInjector"]({factory:function(e){return new(e||Zt)},providers:[],imports:[[r.c]]}),Zt),An=function(e){return e[e.ArcGisMapServer=Cesium.ArcGisMapServerImageryProvider]="ArcGisMapServer",e[e.WebMapTileService=Cesium.WebMapTileServiceImageryProvider]="WebMapTileService",e[e.MapTileService=Cesium.TileMapServiceImageryProvider]="MapTileService",e[e.WebMapService=Cesium.WebMapServiceImageryProvider]="WebMapService",e[e.SingleTileImagery=Cesium.SingleTileImageryProvider]="SingleTileImagery",e[e.OpenStreetMap=Cesium.OpenStreetMapImageryProvider]="OpenStreetMap",e[e.BingMaps=Cesium.BingMapsImageryProvider]="BingMaps",e[e.GoogleEarthEnterpriseMaps=Cesium.GoogleEarthEnterpriseMapsProvider]="GoogleEarthEnterpriseMaps",e[e.MapBox=Cesium.MapboxImageryProvider]="MapBox",e[e.UrlTemplateImagery=Cesium.UrlTemplateImageryProvider]="UrlTemplateImagery",e[e.OFFLINE=null]="OFFLINE",e}({}),Ln=((_i=function(){function e(t){_classCallCheck(this,e),this.cesiumService=t,this.options={},this.provider=An.OFFLINE,this.show=!0,this.alpha=1,this.brightness=1,this.contrast=1,this.imageryLayersCollection=this.cesiumService.getScene().imageryLayers}return _createClass(e,[{key:"createOfflineMapProvider",value:function(){return Cesium.createTileMapServiceImageryProvider({url:Cesium.buildModuleUrl("Assets/Textures/NaturalEarthII")})}},{key:"ngOnInit",value:function(){if(!on.present(this.options.url)&&this.provider!==An.OFFLINE)throw new Error("options must have a url");switch(this.provider){case An.WebMapService:case An.WebMapTileService:case An.ArcGisMapServer:case An.SingleTileImagery:case An.BingMaps:case An.GoogleEarthEnterpriseMaps:case An.MapBox:case An.UrlTemplateImagery:case An.MapTileService:case An.OpenStreetMap:this.layerProvider=new this.provider(this.options);break;case An.OFFLINE:this.layerProvider=this.createOfflineMapProvider();break;default:console.log("ac-map-layer-provider: [provider] wasn't found. setting OFFLINE provider as default"),this.layerProvider=this.createOfflineMapProvider()}this.show&&(this.imageryLayer=this.imageryLayersCollection.addImageryProvider(this.layerProvider,this.index),this.imageryLayer.alpha=this.alpha,this.imageryLayer.contrast=this.contrast,this.imageryLayer.brightness=this.brightness)}},{key:"ngOnChanges",value:function(e){e.show&&!e.show.isFirstChange()&&(e.show.currentValue?this.imageryLayer?this.imageryLayersCollection.add(this.imageryLayer,this.index):(this.imageryLayer=this.imageryLayersCollection.addImageryProvider(this.layerProvider,this.index),this.imageryLayer.alpha=this.alpha,this.imageryLayer.contrast=this.contrast,this.imageryLayer.brightness=this.brightness):this.imageryLayer&&this.imageryLayersCollection.remove(this.imageryLayer,!1)),e.alpha&&!e.alpha.isFirstChange()&&this.imageryLayer&&(this.imageryLayer.alpha=this.alpha),e.contrast&&!e.contrast.isFirstChange()&&this.imageryLayer&&(this.imageryLayer.contrast=this.contrast),e.brightness&&!e.brightness.isFirstChange()&&this.imageryLayer&&(this.imageryLayer.brightness=this.brightness)}},{key:"ngOnDestroy",value:function(){this.imageryLayer&&this.imageryLayersCollection.remove(this.imageryLayer,!0)}}]),e}()).\u0275fac=function(e){return new(e||_i)(o["\u0275\u0275directiveInject"](He))},_i.\u0275cmp=o["\u0275\u0275defineComponent"]({type:_i,selectors:[["ac-map-layer-provider"]],inputs:{options:"options",provider:"provider",show:"show",alpha:"alpha",brightness:"brightness",contrast:"contrast",index:"index"},features:[o["\u0275\u0275NgOnChangesFeature"]],decls:0,vars:0,template:function(e,t){},encapsulation:2}),_i),Dn=((Ci=function(){function e(t,i,n){_classCallCheck(this,e),this.cesiumService=t,this.elementRef=i,this.renderer=n,this.isDraw=!1}return _createClass(e,[{key:"setScreenPosition",value:function(e){e&&(this.renderer.setStyle(this.elementRef.nativeElement,"top","".concat(e.y,"px")),this.renderer.setStyle(this.elementRef.nativeElement,"left","".concat(e.x,"px")))}},{key:"ngOnInit",value:function(){this.cesiumService.getMap().getMapContainer().appendChild(this.elementRef.nativeElement),!1===this.props.show&&this.hideElement()}},{key:"remove",value:function(){this.isDraw&&(this.isDraw=!1,this.cesiumService.getScene().preRender.removeEventListener(this.preRenderEventListener),this.hideElement())}},{key:"hideElement",value:function(){this.renderer.setStyle(this.elementRef.nativeElement,"display","none")}},{key:"add",value:function(){var e=this;this.isDraw||(this.isDraw=!0,this.preRenderEventListener=function(){var t=Cesium.SceneTransforms.wgs84ToWindowCoordinates(e.cesiumService.getScene(),e.props.position);e.setScreenPosition(t)},this.renderer.setStyle(this.elementRef.nativeElement,"display","block"),this.cesiumService.getScene().preRender.addEventListener(this.preRenderEventListener))}},{key:"ngDoCheck",value:function(){void 0===this.props.show||this.props.show?this.add():this.remove()}},{key:"ngOnDestroy",value:function(){this.remove()}}]),e}()).\u0275fac=function(e){return new(e||Ci)(o["\u0275\u0275directiveInject"](He),o["\u0275\u0275directiveInject"](o.ElementRef),o["\u0275\u0275directiveInject"](o.Renderer2))},Ci.\u0275cmp=o["\u0275\u0275defineComponent"]({type:Ci,selectors:[["ac-html"]],inputs:{props:"props"},ngContentSelectors:Le,decls:1,vars:0,template:function(e,t){1&e&&(o["\u0275\u0275projectionDef"](),o["\u0275\u0275projection"](0))},styles:["[_nghost-%COMP%] {\n                position: absolute;\n                z-index: 100;\n\t\t\t\t}"]}),Ci),jn=((gi=function(){function e(t,i,n){_classCallCheck(this,e),this.plonterService=t,this.cd=i,this.geoConverter=n}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.plonterService.plonterChangeNotifier.subscribe((function(){return e.cd.detectChanges()}))}},{key:"chooseEntity",value:function(e){this.plonterService.resolvePlonter(e)}},{key:"plonterPosition",get:function(){if(this.plonterService.plonterShown)return this.geoConverter.screenToCartesian3(this.plonterService.plonterClickPosition.endPosition)}}]),e}()).\u0275fac=function(e){return new(e||gi)(o["\u0275\u0275directiveInject"](Xi),o["\u0275\u0275directiveInject"](o.ChangeDetectorRef),o["\u0275\u0275directiveInject"](xi))},gi.\u0275cmp=o["\u0275\u0275defineComponent"]({type:gi,selectors:[["ac-default-plonter"]],features:[o["\u0275\u0275ProvidersFeature"]([xi])],decls:1,vars:1,consts:[[3,"props",4,"ngIf"],[3,"props"],[1,"plonter-context-menu"],[4,"ngFor","ngForOf"],[1,"plonter-item",3,"click"]],template:function(e,t){1&e&&o["\u0275\u0275template"](0,Ne,3,4,"ac-html",0),2&e&&o["\u0275\u0275property"]("ngIf",t.plonterService.plonterShown)},directives:[r.m,Dn,r.l],styles:[".plonter-context-menu[_ngcontent-%COMP%] {\n            background-color: rgba(250, 250, 250, 0.8);\n            box-shadow: 1px 1px 5px 0px rgba(0, 0, 0, 0.15);\n        }\n\n        .plonter-item[_ngcontent-%COMP%] {\n            cursor: pointer;\n            padding: 2px 15px;\n            text-align: start;\n        }\n\n        .plonter-item[_ngcontent-%COMP%]:hover {\n            background-color: rgba(0, 0, 0, 0.15);\n        }"],changeDetection:0}),gi),Nn=((wi=function(){function e(t,i,n){_classCallCheck(this,e),this.contextMenuService=t,this.cd=i,this.componentFactoryResolver=n}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.contextMenuChangeSubscription=this.contextMenuService.contextMenuChangeNotifier.subscribe((function(){return e.cd.detectChanges()})),this.contextMenuOpenSubscription=this.contextMenuService.onOpen.subscribe((function(){var t=e.componentFactoryResolver.resolveComponentFactory(e.contextMenuService.content);e.viewContainerRef.clear(),e.viewContainerRef.createComponent(t).instance.data=e.contextMenuService.options.data,e.cd.detectChanges()}))}},{key:"ngOnDestroy",value:function(){this.contextMenuChangeSubscription&&this.contextMenuChangeSubscription.unsubscribe(),this.contextMenuOpenSubscription&&this.contextMenuOpenSubscription.unsubscribe()}}]),e}()).\u0275fac=function(e){return new(e||wi)(o["\u0275\u0275directiveInject"](wt),o["\u0275\u0275directiveInject"](o.ChangeDetectorRef),o["\u0275\u0275directiveInject"](o.ComponentFactoryResolver))},wi.\u0275cmp=o["\u0275\u0275defineComponent"]({type:wi,selectors:[["ac-context-menu-wrapper"]],viewQuery:function(e,t){var i;1&e&&o["\u0275\u0275viewQuery"](Fe,!0,o.ViewContainerRef),2&e&&o["\u0275\u0275queryRefresh"](i=o["\u0275\u0275loadQuery"]())&&(t.viewContainerRef=i.first)},decls:1,vars:1,consts:[[3,"props",4,"ngIf"],[3,"props"],["contextMenuContainer",""]],template:function(e,t){1&e&&o["\u0275\u0275template"](0,Be,3,3,"ac-html",0),2&e&&o["\u0275\u0275property"]("ngIf",t.contextMenuService.showContextMenu)},directives:[r.m,Dn],encapsulation:2,changeDetection:0}),wi),Fn=[{pipeName:"pixelOffset",pipeInstance:new On},{pipeName:"radiansToDegrees",pipeInstance:new Rn}],Vn=((bi=function(e){_inherits(i,e);var t=_createSuper(i);function i(e,n,r,s){return _classCallCheck(this,i),t.call(this,e,n,r,s)}return i}(Pn)).\u0275fac=function(e){return new(e||bi)(o["\u0275\u0275directiveInject"](Li),o["\u0275\u0275directiveInject"](nn),o["\u0275\u0275directiveInject"](sn),o["\u0275\u0275directiveInject"](In))},bi.\u0275cmp=o["\u0275\u0275defineComponent"]({type:bi,selectors:[["ac-czml-desc"]],features:[o["\u0275\u0275InheritDefinitionFeature"]],decls:0,vars:0,template:function(e,t){},encapsulation:2}),bi),Bn=((Mi=ki=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"forRoot",value:function(e){return{ngModule:ki,providers:[En,In,Ii,Ue,Qi,yt,{provide:dt,useValue:e},{provide:Oe,multi:!0,useValue:e&&e.customPipes||[]},{provide:Oe,multi:!0,useValue:Fn}]}}}]),e}()).\u0275mod=o["\u0275\u0275defineNgModule"]({type:Mi}),Mi.\u0275inj=o["\u0275\u0275defineInjector"]({factory:function(e){return new(e||Mi)},imports:[[r.c,Te,Tn]]}),Mi);Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium,Cesium;var Kn,zn,Gn=((Kn=function(){function e(t,i){_classCallCheck(this,e),this.document=t,this.mapsManager=i,this.mainSubject=new u.a}return _createClass(e,[{key:"setCoordinateConverter",value:function(e){this.coordinateConverter=e}},{key:"drag",value:function(e,t){var i=this;if(!this.coordinateConverter){var n=this.mapsManager.getMap();n&&(this.coordinateConverter=n.getCoordinateConverter())}this.cancel();var r=document.createElement("img");r.src=e,r.style.position="fixed",r.style.visibility="hidden",r.style.width="30px",r.style.height="30px",r.style["user-drag"]="none",r.style["user-select"]="none",r.style["-moz-user-select"]="none",r.style["-webkit-user-drag"]="none",r.style["-webkit-user-select"]="none",r.style["-ms-user-select"]="none",Object.assign(r.style,t),document.body.appendChild(r),this.createDragObservable(),this.dragObservable.subscribe((function(e){r.style.visibility="visible",r.style.left=e.screenPosition.x-r.clientWidth/2+"px",r.style.top=e.screenPosition.y-r.clientHeight/2+"px",i.mainSubject.next(e),e.drop&&r.remove()}),(function(e){r.remove()}),(function(){r.remove()}))}},{key:"dragUpdates",value:function(){return this.mainSubject}},{key:"cancel",value:function(){this.stopper&&(this.stopper.next(!0),this.stopper=void 0,this.dragObservable=void 0)}},{key:"createDragObservable",value:function(){var e,t,i,n=this,r=new u.a,s=new u.a,o=Object(k.a)(document,"pointerup"),a=Object(k.a)(document,"pointermove").pipe(Object(y.a)((function(r){return e=e||r.x,t=t||r.y,i={drop:!1,initialScreenPosition:{x:e,y:t},screenPosition:{x:r.x,y:r.y},mapPosition:n.coordinateConverter?n.coordinateConverter.screenToCartesian3({x:r.x,y:r.y}):void 0}})),Object(v.a)(o),Object(g.a)(void 0,void 0,(function(){if(i){var e=Object.assign({},i);e.drop=!0,s.next(e)}})));this.dragObservable=a.pipe(function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(e){return e.lift.call(Object(C.a).apply(void 0,[e].concat(t)))}}(s),Object(v.a)(r)),this.stopper=r}}]),e}()).\u0275fac=function(e){return new(e||Kn)(o["\u0275\u0275inject"](r.d),o["\u0275\u0275inject"](Qi))},Kn.\u0275prov=o["\u0275\u0275defineInjectable"]({token:Kn,factory:Kn.\u0275fac}),Kn),Un=function(e){return e[e.LEFT=0]="LEFT",e[e.MIDDLE=1]="MIDDLE",e[e.RIGHT=2]="RIGHT",e}({}),Wn=((zn=function(){function e(t,i,n){_classCallCheck(this,e),this.mapsManager=t,this.mapsZoomElements=new Map,this.defaultOptions={animationDurationInSeconds:.5,resetKeyCode:27,borderStyle:"2px solid rgba(0,0,0,0.5)",backgroundColor:"rgba(0,0,0,0.2)",autoDisableOnZoom:!0,threshold:9,keepRotation:!0,mouseButton:Un.LEFT}}return _createClass(e,[{key:"init",value:function(e,t){this.cameraService=t,this.cesiumService=e}},{key:"activate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;if(!(this.cameraService&&this.cesiumService||i))throw new Error("The function must receive a mapId if the service wasn't initialized");var n,r,s=Object.assign({},this.defaultOptions,t),o=this.cameraService;if(this.cesiumService&&(n=this.cesiumService.getViewer().container,r=this.cesiumService.getMap()),i){if(!(r=this.mapsManager.getMap(i)))throw new Error("Map not found with id: ".concat(i));o=r.getCameraService(),n=r.getCesiumViewer().container}if(!o||!n)throw new Error("The function must receive a mapId if the service wasn't initialized");this.disable(i);var a=document.createElement("div");n.style.position="relative",a.style.position="absolute",a.style.width="100%",a.style.height="100%",a.style.top="0",a.style.left="0",n.appendChild(a);var c={container:a};this.mapsZoomElements.set(i||this.cesiumService.getMap().getId(),c);var u,l={endX:0,endY:0,startX:0,startY:0};a.onmousedown=function(e){if(e.button===s.mouseButton&&!u){t&&t.onStart&&t.onStart(r);var i=e.currentTarget.getBoundingClientRect(),n=e.clientY-i.top;l.startX=e.clientX-i.left,l.startY=n,(u=document.createElement("div")).className="zoom-to-rectangle-border",u.style.position="absolute",u.style.border=s.borderStyle,u.style.backgroundColor=s.backgroundColor,u.style.left=l.startX+"px",u.style.top=l.startY+"px",a.appendChild(u),c.borderElement=u}},a.onmouseup=function(t){var n;u&&(l&&Math.abs(l.endX-l.startX)*Math.abs(l.endY-l.startY)>s.threshold&&(n=e.zoomCameraToRectangle(o,l,s.animationDurationInSeconds,s)),u.remove(),u=void 0,c.borderElement=void 0,l={endX:0,endY:0,startX:0,startY:0},s.onComplete&&s.onComplete(r),s.autoDisableOnZoom&&n&&e.disable(i))},a.onmousemove=function(e){if(u){var t=e.currentTarget.getBoundingClientRect(),i=e.clientY-t.top;l.endX=e.clientX-t.left,l.endY=i,u.style.width=Math.abs(l.endX-l.startX)+"px",u.style.height=Math.abs(l.endY-l.startY)+"px",u.style.left=Math.min(l.startX,l.endX)+"px",u.style.top=Math.min(l.startY,l.endY)+"px"}};var h=function(e){e.keyCode===s.resetKeyCode&&u&&(u.remove(),u=void 0,c.borderElement=void 0,l={endX:0,endY:0,startX:0,startY:0})};document.addEventListener("keydown",h),c.resetOnEscapePressFunc=h}},{key:"disable",value:function(e){if(!this.cesiumService&&!e)throw new Error("If the service was not initialized with CesiumService, mapId must be provided");var t=this.mapsZoomElements.get(e||this.cesiumService.getMap().getId());t&&(t.container.remove(),t.borderElement&&t.borderElement.remove(),t.resetOnEscapePressFunc&&document.removeEventListener("keydown",t.resetOnEscapePressFunc)),this.mapsZoomElements.delete(e)}},{key:"zoomCameraToRectangle",value:function(e,t,i,n){var r=e.getCamera(),s=r.pickEllipsoid({x:t.startX,y:t.startY}),o=r.pickEllipsoid({x:t.endX,y:t.endY});if(!s||!o)return!1;var a=Cesium.Cartographic.fromCartesian(s),c=Cesium.Cartographic.fromCartesian(o);return e.cameraFlyTo({destination:new Cesium.Rectangle(Math.min(a.longitude,c.longitude),Math.min(a.latitude,c.latitude),Math.max(a.longitude,c.longitude),Math.max(a.latitude,c.latitude)),orientation:n.keepRotation?{heading:r.heading}:void 0,duration:i}),!0}}]),e}()).\u0275fac=function(e){return new(e||zn)(o["\u0275\u0275inject"](Qi),o["\u0275\u0275inject"](gt,8),o["\u0275\u0275inject"](He,8))},zn.\u0275prov=o["\u0275\u0275defineInjectable"]({token:zn,factory:zn.\u0275fac}),zn);Cesium,Cesium,Cesium;var Hn,qn=((Hn=function e(){_classCallCheck(this,e)}).\u0275mod=o["\u0275\u0275defineNgModule"]({type:Hn}),Hn.\u0275inj=o["\u0275\u0275defineInjector"]({factory:function(e){return new(e||Hn)},providers:[Gn,Wn],imports:[[r.c,Bn]]}),Hn),Xn=i("tk/3"),Zn=i("JIr8"),$n=i("aceb");new Xn.d({"Content-Type":"application/json"});var Yn,Jn=((Yn=function(){function e(t,i){_classCallCheck(this,e),this.http=t,this.toastrService=i}return _createClass(e,[{key:"extractData",value:function(e){return e||{}}},{key:"handleError",value:function(){var e=this,t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments.length>1?arguments[1]:void 0);return function(i){return e.dangerToast("top-right","danger",i.statusText,i.status),Object(w.a)(t)}}},{key:"returnFalse",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e=arguments.length>1?arguments[1]:void 0;return Object(w.a)(e)}},{key:"getMapLayers",value:function(){return this.http.get("https://solmm01.fmg.local/api/map/layers").pipe(Object(y.a)(this.extractData),Object(Zn.a)(this.handleError("failed")))}},{key:"dangerToast",value:function(e,t,i,n){var r=this;this.toastRef=this.toastrService.show("API call error - "+n+": "+i,"Failed",{position:e,status:t,preventDuplicates:!0,duration:0}),this.toastRef&&(this.tempToast=this.toastRef),this.delay&&clearTimeout(this.delay),this.delay=setTimeout((function(){r.clearToast(r.tempToast)}),5500)}},{key:"successToast",value:function(e,t,i,n){this.toastrService.show("API call error - "+n+": "+i,"Failed",{position:e,status:t,preventDuplicates:!0})}},{key:"clearToast",value:function(e){e&&e.close()}}]),e}()).\u0275fac=function(e){return new(e||Yn)(o["\u0275\u0275inject"](Xn.a),o["\u0275\u0275inject"]($n.ob))},Yn.\u0275prov=o["\u0275\u0275defineInjectable"]({token:Yn,factory:Yn.\u0275fac,providedIn:"root"}),Yn);function Qn(e,t){if(1&e){var i=o["\u0275\u0275getCurrentView"]();o["\u0275\u0275elementStart"](0,"nb-card"),o["\u0275\u0275elementStart"](1,"nb-card-body"),o["\u0275\u0275elementStart"](2,"div",4),o["\u0275\u0275elementStart"](3,"nb-checkbox",5),o["\u0275\u0275listener"]("checkedChange",(function(e){return o["\u0275\u0275restoreView"](i),o["\u0275\u0275nextContext"]().toggle("tetra",e)})),o["\u0275\u0275text"](4,"Tetra Positions"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](5,"div",4),o["\u0275\u0275elementStart"](6,"nb-checkbox",5),o["\u0275\u0275listener"]("checkedChange",(function(e){return o["\u0275\u0275restoreView"](i),o["\u0275\u0275nextContext"]().toggle("nams",e)})),o["\u0275\u0275text"](7,"Minestar NAMs"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](8,"div",4),o["\u0275\u0275elementStart"](9,"nb-checkbox",5),o["\u0275\u0275listener"]("checkedChange",(function(e){return o["\u0275\u0275restoreView"](i),o["\u0275\u0275nextContext"]().toggle("lanes",e)})),o["\u0275\u0275text"](10,"Minestar Lanes"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](11,"div",4),o["\u0275\u0275elementStart"](12,"nb-checkbox",5),o["\u0275\u0275listener"]("checkedChange",(function(e){return o["\u0275\u0275restoreView"](i),o["\u0275\u0275nextContext"]().toggle("zones",e)})),o["\u0275\u0275text"](13,"Minestar Zones"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementStart"](14,"div",4),o["\u0275\u0275elementStart"](15,"nb-checkbox",5),o["\u0275\u0275listener"]("checkedChange",(function(e){return o["\u0275\u0275restoreView"](i),o["\u0275\u0275nextContext"]().toggle("blocks",e)})),o["\u0275\u0275text"](16,"Minestar Grade Blocks"),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()}if(2&e){var n=o["\u0275\u0275nextContext"]();o["\u0275\u0275advance"](3),o["\u0275\u0275property"]("checked",n.tetra),o["\u0275\u0275advance"](3),o["\u0275\u0275property"]("checked",n.nams),o["\u0275\u0275advance"](3),o["\u0275\u0275property"]("checked",n.lanes),o["\u0275\u0275advance"](3),o["\u0275\u0275property"]("checked",n.zones),o["\u0275\u0275advance"](3),o["\u0275\u0275property"]("checked",n.blocks)}}var er,tr,ir,nr=((er=function(){function e(t){_classCallCheck(this,e),this.mapsManagerService=t,this.tetra=!0,this.nams=!0,this.lanes=!0,this.zones=!0,this.blocks=!0}return _createClass(e,[{key:"ngOnInit",value:function(){this.viewer=this.mapsManagerService.getMap().getCesiumViewer(),this.layers=this.viewer.imageryLayers}},{key:"toggle",value:function(e,t){console.log(e+" "+t),"tetra"==e&&(this.tetra=t,this.viewer.dataSources.getByName("Tetra CZML data")[0].show=t),"nams"==e&&(this.nams=t,this.layers._layers[5].show=t),"lanes"==e&&(this.lanes=t,this.layers._layers[3].show=t),"zones"==e&&(this.zones=t,this.layers._layers[4].show=t),"blocks"==e&&(this.blocks=t,this.layers._layers[2].show=t)}}]),e}()).\u0275fac=function(e){return new(e||er)(o["\u0275\u0275directiveInject"](Qi))},er.\u0275cmp=o["\u0275\u0275defineComponent"]({type:er,selectors:[["map-options"]],decls:5,vars:2,consts:[[1,"options"],["nbButton","","nbPopoverPlacement","end","nbPopoverAdjustment","noop",3,"nbPopover","status"],["icon","layers-outline"],["optionsRef",""],[1,"row"],[3,"checked","checkedChange"]],template:function(e,t){if(1&e&&(o["\u0275\u0275elementStart"](0,"div",0),o["\u0275\u0275elementStart"](1,"button",1),o["\u0275\u0275element"](2,"nb-icon",2),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"](),o["\u0275\u0275template"](3,Qn,17,5,"ng-template",null,3,o["\u0275\u0275templateRefExtractor"])),2&e){var i=o["\u0275\u0275reference"](4);o["\u0275\u0275advance"](1),o["\u0275\u0275property"]("nbPopover",i)("status","primary")}},directives:[$n.k,$n.U,$n.A,$n.n,$n.m,$n.s],styles:[".options[_ngcontent-%COMP%]{position:absolute;margin:5px;z-index:10}"]}),er),rr=i("l5mm"),sr=i("JX91"),or=((ir=function(){function e(t){_classCallCheck(this,e),this.http=t}return _createClass(e,[{key:"extractData",value:function(e){return e||{}}},{key:"getSdsCzml",value:function(){return this.http.get("https://solmm01.fmg.local/api/map/sds").pipe(Object(y.a)(this.extractData))}},{key:"getSdsRange",value:function(e,t){return this.http.get("https://solmm01.fmg.local/api/map/sds/range/get?start="+e+"&end="+t).pipe(Object(y.a)(this.extractData))}},{key:"getSdsRange$",value:function(e,t){var i=this.getSdsRange(e,t);return console.log(i),Object(rr.a)(99999999999).pipe(Object(sr.a)(0),Object(y.a)((function(e){return i})),Object(p.a)((function(e){return e})))}},{key:"getDataSteam$",value:function(e){var t=this.getSdsCzml();return Object(rr.a)(e).pipe(Object(sr.a)(0),Object(y.a)((function(e){return t})),Object(p.a)((function(e){return e})))}}]),e}()).\u0275fac=function(e){return new(e||ir)(o["\u0275\u0275inject"](Xn.a))},ir.\u0275prov=o["\u0275\u0275defineInjectable"]({token:ir,factory:ir.\u0275fac,providedIn:"root"}),ir),ar=((tr=function(){function e(t,i){_classCallCheck(this,e),this.sdsData=t,this.mapsManagerService=i,this.Cesium=Cesium}return _createClass(e,[{key:"ngOnInit",value:function(){Date.now();var e=this.mapsManagerService.getMap().getCesiumViewer();Cesium.knockout.getObservable(e.clockViewModel,"currentTime"),Object(rr.a)(1e3),this.entities$=this.sdsData.getDataSteam$(6e4).pipe(Object(y.a)((function(e){return{id:"Subscribers",actionType:rn.ADD_UPDATE,entity:e}})))}}]),e}()).\u0275fac=function(e){return new(e||tr)(o["\u0275\u0275directiveInject"](or),o["\u0275\u0275directiveInject"](Qi))},tr.\u0275cmp=o["\u0275\u0275defineComponent"]({type:tr,selectors:[["map-sds"]],decls:2,vars:2,consts:[["acFor","let entity of entities$",3,"context","debug"],["props","{\n      czmlPacket: entity\n    }"]],template:function(e,t){1&e&&(o["\u0275\u0275elementStart"](0,"ac-layer",0),o["\u0275\u0275element"](1,"ac-czml-desc",1),o["\u0275\u0275elementEnd"]()),2&e&&o["\u0275\u0275property"]("context",t)("debug",!0)},directives:[Sn,Vn],styles:[""]}),tr),cr=function(e,t,i){return{format:e,transparent:t,version:i}},ur=function(e,t,i,n){return{url:e,parameters:t,layers:i,enablePickFeatures:n}};function lr(e,t){if(1&e&&o["\u0275\u0275element"](0,"ac-map-layer-provider",3),2&e){var i=t.$implicit,n=o["\u0275\u0275nextContext"](2);o["\u0275\u0275property"]("provider",n.MapLayerProviderOptions.WebMapService)("index",i.index)("options",o["\u0275\u0275pureFunction4"](7,ur,i.url,o["\u0275\u0275pureFunction3"](3,cr,i.format,i.transparent,i.version),i.layers,i.pick_features))}}function hr(e,t){if(1&e&&(o["\u0275\u0275elementStart"](0,"div",1),o["\u0275\u0275elementStart"](1,"ac-map"),o["\u0275\u0275element"](2,"map-options"),o["\u0275\u0275element"](3,"map-sds"),o["\u0275\u0275template"](4,lr,1,12,"ac-map-layer-provider",2),o["\u0275\u0275elementEnd"](),o["\u0275\u0275elementEnd"]()),2&e){var i=o["\u0275\u0275nextContext"]();o["\u0275\u0275advance"](4),o["\u0275\u0275property"]("ngForOf",i.layers$)}}var pr,fr,vr=[{path:"",component:(pr=function(){function e(t,i){_classCallCheck(this,e),this.viewerConf=t,this.map=i,this.MapLayerProviderOptions=An,this.dataLoaded=!1;var n=Cesium.Rectangle.fromDegrees(117.702242,-22.260914,117.981473,-22.089772);Cesium.Camera.DEFAULT_VIEW_RECTANGLE=n,Cesium.Camera.DEFAULT_VIEW_FACTOR=0,t.viewerOptions={selectionIndicator:!0,timeline:!0,infoBox:!0,fullscreenButton:!0,baseLayerPicker:!0,animation:!0,shouldAnimate:!0,homeButton:!0,geocoder:!1,navigationHelpButton:!0,navigationInstructionsInitiallyVisible:!1,mapMode2D:Cesium.MapMode2D.ROTATE,automaticallyTrackDataSourceClocks:!0,vrButton:!0}}return _createClass(e,[{key:"ngOnInit",value:function(){var e=this;this.map.getMapLayers().subscribe((function(t){e.layers$=t,e.dataLoaded=!0}))}},{key:"ngOnDestroy",value:function(){clearInterval(this.interval)}},{key:"refreshData",value:function(){}}]),e}(),pr.\u0275fac=function(e){return new(e||pr)(o["\u0275\u0275directiveInject"](We),o["\u0275\u0275directiveInject"](Jn))},pr.\u0275cmp=o["\u0275\u0275defineComponent"]({type:pr,selectors:[["ngx-map"]],features:[o["\u0275\u0275ProvidersFeature"]([We])],decls:1,vars:1,consts:[["class","row",4,"ngIf"],[1,"row"],[3,"provider","index","options",4,"ngFor","ngForOf"],[3,"provider","index","options"]],template:function(e,t){1&e&&o["\u0275\u0275template"](0,hr,5,1,"div",0),2&e&&o["\u0275\u0275property"]("ngIf",t.dataLoaded)},directives:[r.m,tn,nr,ar,r.l,Ln],styles:["[_nghost-%COMP%]     nb-layout-column, ac-map[_ngcontent-%COMP%]{padding:0}ac-map[_ngcontent-%COMP%]{width:100vw;height:88vh;margin:0;overflow:hidden;position:relative}"]}),pr)}],dr=((fr=function e(){_classCallCheck(this,e)}).\u0275mod=o["\u0275\u0275defineNgModule"]({type:fr}),fr.\u0275inj=o["\u0275\u0275defineInjector"]({factory:function(e){return new(e||fr)},imports:[[s.g.forChild(vr)],s.g]}),fr),yr=i("h+2I");i.d(t,"MapModule",(function(){return gr}));var mr,gr=((mr=function e(){_classCallCheck(this,e)}).\u0275mod=o["\u0275\u0275defineNgModule"]({type:mr}),mr.\u0275inj=o["\u0275\u0275defineInjector"]({factory:function(e){return new(e||mr)},imports:[[r.c,dr,qn,yr.a,$n.l,$n.C,$n.V,$n.q,$n.t,Bn.forRoot({fixEntitiesShadows:!1,customPipes:[]})]]}),mr)},"8USJ":function(e,t,i){!function(e){"use strict";function t(e){return null!=e}function i(e){return null==e}var n=function(){function e(){}return e.parseIntAutoRadix=function(e){var t=parseInt(e);if(isNaN(t))throw new Error("Invalid integer literal when parsing "+e);return t},e.isNumeric=function(e){return!isNaN(e-parseFloat(e))},e}();function r(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}var s,o=(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])},function(e,t){function i(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),a=function(e,t,i,n){this.input=t,this.errLocation=i,this.ctxLocation=n,this.message="Parser Error: "+e+" "+i+" ["+t+"] in "+n},c=function(e,t){this.start=e,this.end=t},u=function(){function e(e){this.span=e}return e.prototype.visit=function(e,t){return void 0===t&&(t=null),null},e.prototype.toString=function(){return"AST"},e}(),l=function(e){function t(t,i,n,r){var s=e.call(this,t)||this;return s.prefix=i,s.uninterpretedExpression=n,s.location=r,s}return o(t,e),t.prototype.visit=function(e,t){return void 0===t&&(t=null),e.visitQuote(this,t)},t.prototype.toString=function(){return"Quote"},t}(u),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.visit=function(e,t){void 0===t&&(t=null)},t}(u),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.visit=function(e,t){return void 0===t&&(t=null),e.visitImplicitReceiver(this,t)},t}(u),f=function(e){function t(t,i){var n=e.call(this,t)||this;return n.expressions=i,n}return o(t,e),t.prototype.visit=function(e,t){return void 0===t&&(t=null),e.visitChain(this,t)},t}(u),v=function(e){function t(t,i,n,r){var s=e.call(this,t)||this;return s.condition=i,s.trueExp=n,s.falseExp=r,s}return o(t,e),t.prototype.visit=function(e,t){return void 0===t&&(t=null),e.visitConditional(this,t)},t}(u),d=function(e){function t(t,i,n){var r=e.call(this,t)||this;return r.receiver=i,r.name=n,r}return o(t,e),t.prototype.visit=function(e,t){return void 0===t&&(t=null),e.visitPropertyRead(this,t)},t}(u),y=function(e){function t(t,i,n,r){var s=e.call(this,t)||this;return s.receiver=i,s.name=n,s.value=r,s}return o(t,e),t.prototype.visit=function(e,t){return void 0===t&&(t=null),e.visitPropertyWrite(this,t)},t}(u),m=function(e){function t(t,i,n){var r=e.call(this,t)||this;return r.receiver=i,r.name=n,r}return o(t,e),t.prototype.visit=function(e,t){return void 0===t&&(t=null),e.visitSafePropertyRead(this,t)},t}(u),g=function(e){function t(t,i,n){var r=e.call(this,t)||this;return r.obj=i,r.key=n,r}return o(t,e),t.prototype.visit=function(e,t){return void 0===t&&(t=null),e.visitKeyedRead(this,t)},t}(u),C=function(e){function t(t,i,n,r){var s=e.call(this,t)||this;return s.obj=i,s.key=n,s.value=r,s}return o(t,e),t.prototype.visit=function(e,t){return void 0===t&&(t=null),e.visitKeyedWrite(this,t)},t}(u),_=function(e){function t(t,i,n,r){var s=e.call(this,t)||this;return s.exp=i,s.name=n,s.args=r,s}return o(t,e),t.prototype.visit=function(e,t){return void 0===t&&(t=null),e.visitPipe(this,t)},t}(u),w=function(e){function t(t,i){var n=e.call(this,t)||this;return n.value=i,n}return o(t,e),t.prototype.visit=function(e,t){return void 0===t&&(t=null),e.visitLiteralPrimitive(this,t)},t}(u),b=function(e){function t(t,i){var n=e.call(this,t)||this;return n.expressions=i,n}return o(t,e),t.prototype.visit=function(e,t){return void 0===t&&(t=null),e.visitLiteralArray(this,t)},t}(u),k=function(e){function t(t,i,n){var r=e.call(this,t)||this;return r.keys=i,r.values=n,r}return o(t,e),t.prototype.visit=function(e,t){return void 0===t&&(t=null),e.visitLiteralMap(this,t)},t}(u),M=function(e){function t(t,i,n){var r=e.call(this,t)||this;return r.strings=i,r.expressions=n,r}return o(t,e),t.prototype.visit=function(e,t){return void 0===t&&(t=null),e.visitInterpolation(this,t)},t}(u),x=function(e){function t(t,i,n,r){var s=e.call(this,t)||this;return s.operation=i,s.left=n,s.right=r,s}return o(t,e),t.prototype.visit=function(e,t){return void 0===t&&(t=null),e.visitBinary(this,t)},t}(u),S=function(e){function t(t,i){var n=e.call(this,t)||this;return n.expression=i,n}return o(t,e),t.prototype.visit=function(e,t){return void 0===t&&(t=null),e.visitPrefixNot(this,t)},t}(u),E=function(e){function t(t,i,n,r){var s=e.call(this,t)||this;return s.receiver=i,s.name=n,s.args=r,s}return o(t,e),t.prototype.visit=function(e,t){return void 0===t&&(t=null),e.visitMethodCall(this,t)},t}(u),I=function(e){function t(t,i,n,r){var s=e.call(this,t)||this;return s.receiver=i,s.name=n,s.args=r,s}return o(t,e),t.prototype.visit=function(e,t){return void 0===t&&(t=null),e.visitSafeMethodCall(this,t)},t}(u),P=function(e){function t(t,i,n){var r=e.call(this,t)||this;return r.target=i,r.args=n,r}return o(t,e),t.prototype.visit=function(e,t){return void 0===t&&(t=null),e.visitFunctionCall(this,t)},t}(u),O=function(e){function t(t,n,r,s){var o=e.call(this,new c(0,i(n)?0:n.length))||this;return o.ast=t,o.source=n,o.location=r,o.errors=s,o}return o(t,e),t.prototype.visit=function(e,t){return void 0===t&&(t=null),this.ast.visit(e,t)},t.prototype.toString=function(){return this.source+" in "+this.location},t}(u),R=function(e,t,i,n,r){this.span=e,this.key=t,this.keyIsVar=i,this.name=n,this.expression=r},T=function(){function e(){}return e.prototype.visitBinary=function(e,t){return e.left.visit(this),e.right.visit(this),null},e.prototype.visitChain=function(e,t){return this.visitAll(e.expressions,t)},e.prototype.visitConditional=function(e,t){return e.condition.visit(this),e.trueExp.visit(this),e.falseExp.visit(this),null},e.prototype.visitPipe=function(e,t){return e.exp.visit(this),this.visitAll(e.args,t),null},e.prototype.visitFunctionCall=function(e,t){return e.target.visit(this),this.visitAll(e.args,t),null},e.prototype.visitImplicitReceiver=function(e,t){return null},e.prototype.visitInterpolation=function(e,t){return this.visitAll(e.expressions,t)},e.prototype.visitKeyedRead=function(e,t){return e.obj.visit(this),e.key.visit(this),null},e.prototype.visitKeyedWrite=function(e,t){return e.obj.visit(this),e.key.visit(this),e.value.visit(this),null},e.prototype.visitLiteralArray=function(e,t){return this.visitAll(e.expressions,t)},e.prototype.visitLiteralMap=function(e,t){return this.visitAll(e.values,t)},e.prototype.visitLiteralPrimitive=function(e,t){return null},e.prototype.visitMethodCall=function(e,t){return e.receiver.visit(this),this.visitAll(e.args,t)},e.prototype.visitPrefixNot=function(e,t){return e.expression.visit(this),null},e.prototype.visitPropertyRead=function(e,t){return e.receiver.visit(this),null},e.prototype.visitPropertyWrite=function(e,t){return e.receiver.visit(this),e.value.visit(this),null},e.prototype.visitSafePropertyRead=function(e,t){return e.receiver.visit(this),null},e.prototype.visitSafeMethodCall=function(e,t){return e.receiver.visit(this),this.visitAll(e.args,t)},e.prototype.visitAll=function(e,t){var i=this;return e.forEach((function(e){return e.visit(i,t)})),null},e.prototype.visitQuote=function(e,t){return null},e}();function A(e){return 48<=e&&e<=57}var L,D=new(function(){function e(e,t){this.start=e,this.end=t}return e.fromArray=function(i){return i?(function(e,i){if(t(i)&&(!Array.isArray(i)||2!=i.length))throw new Error("Expected 'interpolation' to be an array, [start, end].")}(0,i),new e(i[0],i[1])):D},e}())("{{","}}");!function(e){e[e.Character=0]="Character",e[e.Identifier=1]="Identifier",e[e.Keyword=2]="Keyword",e[e.String=3]="String",e[e.Operator=4]="Operator",e[e.Number=5]="Number",e[e.Error=6]="Error"}(L||(L={}));var j=["var","let","null","undefined","true","false","if","else","this"],N=function(){function e(){}return e.prototype.tokenize=function(e){for(var t=new z(e),i=[],n=t.scanToken();null!=n;)i.push(n),n=t.scanToken();return i},e}(),F=function(){function e(e,t,i,n){this.index=e,this.type=t,this.numValue=i,this.strValue=n}return e.prototype.isCharacter=function(e){return this.type==L.Character&&this.numValue==e},e.prototype.isNumber=function(){return this.type==L.Number},e.prototype.isString=function(){return this.type==L.String},e.prototype.isOperator=function(e){return this.type==L.Operator&&this.strValue==e},e.prototype.isIdentifier=function(){return this.type==L.Identifier},e.prototype.isKeyword=function(){return this.type==L.Keyword},e.prototype.isKeywordLet=function(){return this.type==L.Keyword&&"let"==this.strValue},e.prototype.isKeywordNull=function(){return this.type==L.Keyword&&"null"==this.strValue},e.prototype.isKeywordUndefined=function(){return this.type==L.Keyword&&"undefined"==this.strValue},e.prototype.isKeywordTrue=function(){return this.type==L.Keyword&&"true"==this.strValue},e.prototype.isKeywordFalse=function(){return this.type==L.Keyword&&"false"==this.strValue},e.prototype.isKeywordThis=function(){return this.type==L.Keyword&&"this"==this.strValue},e.prototype.isError=function(){return this.type==L.Error},e.prototype.toNumber=function(){return this.type==L.Number?this.numValue:-1},e.prototype.toString=function(){switch(this.type){case L.Character:case L.Identifier:case L.Keyword:case L.Operator:case L.String:case L.Error:return this.strValue;case L.Number:return this.numValue.toString();default:return null}},e}();function V(e,t){return new F(e,L.Character,t,String.fromCharCode(t))}function B(e,t){return new F(e,L.Operator,0,t)}var K=new F(-1,L.Character,0,""),z=function(){function e(e){this.input=e,this.peek=0,this.index=-1,this.length=e.length,this.advance()}return e.prototype.advance=function(){this.peek=++this.index>=this.length?0:this.input.charCodeAt(this.index)},e.prototype.scanToken=function(){for(var e=this.input,t=this.length,i=this.peek,n=this.index;i<=32;){if(++n>=t){i=0;break}i=e.charCodeAt(n)}if(this.peek=i,this.index=n,n>=t)return null;if(G(i))return this.scanIdentifier();if(A(i))return this.scanNumber(n);var r,s=n;switch(i){case 46:return this.advance(),A(this.peek)?this.scanNumber(s):V(s,46);case 40:case 41:case 123:case 125:case 91:case 93:case 44:case 58:case 59:return this.scanCharacter(s,i);case 39:case 34:return this.scanString();case 35:case 43:case 45:case 42:case 47:case 37:case 94:return this.scanOperator(s,String.fromCharCode(i));case 63:return this.scanComplexOperator(s,"?",46,".");case 60:case 62:return this.scanComplexOperator(s,String.fromCharCode(i),61,"=");case 33:case 61:return this.scanComplexOperator(s,String.fromCharCode(i),61,"=",61,"=");case 38:return this.scanComplexOperator(s,"&",38,"&");case 124:return this.scanComplexOperator(s,"|",124,"|");case 160:for(;(r=this.peek)>=9&&r<=32||160==r;)this.advance();return this.scanToken()}return this.advance(),this.error("Unexpected character ["+String.fromCharCode(i)+"]",0)},e.prototype.scanCharacter=function(e,t){return this.advance(),V(e,t)},e.prototype.scanOperator=function(e,t){return this.advance(),B(e,t)},e.prototype.scanComplexOperator=function(e,t,i,n,r,s){this.advance();var o=t;return this.peek==i&&(this.advance(),o+=n),null!=r&&this.peek==r&&(this.advance(),o+=s),B(e,o)},e.prototype.scanIdentifier=function(){var e=this.index;for(this.advance();U(this.peek);)this.advance();var t=this.input.substring(e,this.index);return j.indexOf(t)>-1?new F(e,L.Keyword,0,t):new F(e,L.Identifier,0,t)},e.prototype.scanNumber=function(e){var t,i=this.index===e;for(this.advance();;){if(A(this.peek));else if(46==this.peek)i=!1;else{if(101!=(t=this.peek)&&69!=t)break;if(this.advance(),W(this.peek)&&this.advance(),!A(this.peek))return this.error("Invalid exponent",-1);i=!1}this.advance()}var r=this.input.substring(e,this.index),s=i?n.parseIntAutoRadix(r):parseFloat(r);return new F(e,L.Number,s,"")},e.prototype.scanString=function(){var e=this.index,t=this.peek;this.advance();for(var i="",n=this.index,r=this.input;this.peek!=t;)if(92==this.peek){i+=r.substring(n,this.index),this.advance();var s=void 0;if(this.peek=this.peek,117==this.peek){var o=r.substring(this.index+1,this.index+5);if(!/^[0-9a-f]+$/i.test(o))return this.error("Invalid unicode escape [\\u"+o+"]",0);s=parseInt(o,16);for(var a=0;a<5;a++)this.advance()}else s=H(this.peek),this.advance();i+=String.fromCharCode(s),n=this.index}else{if(0==this.peek)return this.error("Unterminated quote",0);this.advance()}var c=r.substring(n,this.index);return this.advance(),new F(e,L.String,0,i+c)},e.prototype.error=function(e,t){var i=this.index+t;return function(e,t){return new F(e,L.Error,0,t)}(i,"Lexer Error: "+e+" at column "+i+" in expression ["+this.input+"]")},e}();function G(e){return 97<=e&&e<=122||65<=e&&e<=90||95==e||36==e}function U(e){return function(e){return e>=97&&e<=122||e>=65&&e<=90}(e)||A(e)||95==e||36==e}function W(e){return 45==e||43==e}function H(e){switch(e){case 110:return 10;case 102:return 12;case 114:return 13;case 116:return 9;case 118:return 11;default:return e}}var q=function(e,t,i){this.strings=e,this.expressions=t,this.offsets=i},X=function(e,t,i){this.templateBindings=e,this.warnings=t,this.errors=i};function Z(e){var t=r(e.start)+"([\\s\\S]*?)"+r(e.end);return new RegExp(t,"g")}var $=function(){function e(e){this._lexer=e,this.errors=[]}return e.prototype.parseAction=function(e,t,i){void 0===i&&(i=D),this._checkNoInterpolation(e,t,i);var n=this._stripComments(e),r=this._lexer.tokenize(this._stripComments(e)),s=new Y(e,t,r,n.length,!0,this.errors,e.length-n.length).parseChain();return new O(s,e,t,this.errors)},e.prototype.parseBinding=function(e,t,i){void 0===i&&(i=D);var n=this._parseBindingAst(e,t,i);return new O(n,e,t,this.errors)},e.prototype.parseSimpleBinding=function(e,t,i){void 0===i&&(i=D);var n=this._parseBindingAst(e,t,i),r=J.check(n);return r.length>0&&this._reportError("Host binding expression cannot contain "+r.join(" "),e,t),new O(n,e,t,this.errors)},e.prototype._reportError=function(e,t,i,n){this.errors.push(new a(e,t,i,n))},e.prototype._parseBindingAst=function(e,i,n){var r=this._parseQuote(e,i);if(t(r))return r;this._checkNoInterpolation(e,i,n);var s=this._stripComments(e),o=this._lexer.tokenize(s);return new Y(e,i,o,s.length,!1,this.errors,e.length-s.length).parseChain()},e.prototype._parseQuote=function(e,t){if(i(e))return null;var n=e.indexOf(":");if(-1==n)return null;var r=e.substring(0,n).trim();if(!function(e){if(0==e.length)return!1;var t=new z(e);if(!G(t.peek))return!1;for(t.advance();0!==t.peek;){if(!U(t.peek))return!1;t.advance()}return!0}(r))return null;var s=e.substring(n+1);return new l(new c(0,e.length),r,s,t)},e.prototype.parseTemplateBindings=function(e,t,i){var n=this._lexer.tokenize(t);if(e){var r=this._lexer.tokenize(e).map((function(e){return e.index=0,e}));n.unshift.apply(n,r)}return new Y(t,i,n,t.length,!1,this.errors,0).parseTemplateBindings()},e.prototype.parseInterpolation=function(e,t,n){void 0===n&&(n=D);var r=this.splitInterpolation(e,t,n);if(null==r)return null;for(var s=[],o=0;o<r.expressions.length;++o){var a=r.expressions[o],u=this._stripComments(a),l=this._lexer.tokenize(this._stripComments(r.expressions[o])),h=new Y(e,t,l,u.length,!1,this.errors,r.offsets[o]+(a.length-u.length)).parseChain();s.push(h)}return new O(new M(new c(0,i(e)?0:e.length),r.strings,s),e,t,this.errors)},e.prototype.splitInterpolation=function(e,t,i){void 0===i&&(i=D);var n=Z(i),r=e.split(n);if(r.length<=1)return null;for(var s=[],o=[],a=[],c=0,u=0;u<r.length;u++){var l=r[u];u%2==0?(s.push(l),c+=l.length):l.trim().length>0?(c+=i.start.length,o.push(l),a.push(c),c+=l.length+i.end.length):(this._reportError("Blank expressions are not allowed in interpolated strings",e,"at column "+this._findInterpolationErrorColumn(r,u,i)+" in",t),o.push("$implict"),a.push(c))}return new q(s,o,a)},e.prototype.wrapLiteralPrimitive=function(e,t){return new O(new w(new c(0,i(e)?0:e.length),e),e,t,this.errors)},e.prototype._stripComments=function(e){var i=this._commentStart(e);return t(i)?e.substring(0,i).trim():e},e.prototype._commentStart=function(e){for(var t,n=null,r=0;r<e.length-1;r++){var s=e.charCodeAt(r),o=e.charCodeAt(r+1);if(47===s&&47==o&&i(n))return r;n===s?n=null:i(n)&&(39===(t=s)||34===t||96===t)&&(n=s)}return null},e.prototype._checkNoInterpolation=function(e,t,i){var n=Z(i),r=e.split(n);r.length>1&&this._reportError("Got interpolation ("+i.start+i.end+") where expression was expected",e,"at column "+this._findInterpolationErrorColumn(r,1,i)+" in",t)},e.prototype._findInterpolationErrorColumn=function(e,t,i){for(var n="",r=0;r<t;r++)n+=r%2==0?e[r]:""+i.start+e[r]+i.end;return n.length},e}(),Y=function(){function e(e,t,i,n,r,s,o){this.input=e,this.location=t,this.tokens=i,this.inputLength=n,this.parseAction=r,this.errors=s,this.offset=o,this.rparensExpected=0,this.rbracketsExpected=0,this.rbracesExpected=0,this.index=0}return e.prototype.peek=function(e){var t=this.index+e;return t<this.tokens.length?this.tokens[t]:K},Object.defineProperty(e.prototype,"next",{get:function(){return this.peek(0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputIndex",{get:function(){return this.index<this.tokens.length?this.next.index+this.offset:this.inputLength+this.offset},enumerable:!0,configurable:!0}),e.prototype.span=function(e){return new c(e,this.inputIndex)},e.prototype.advance=function(){this.index++},e.prototype.optionalCharacter=function(e){return!!this.next.isCharacter(e)&&(this.advance(),!0)},e.prototype.peekKeywordLet=function(){return this.next.isKeywordLet()},e.prototype.expectCharacter=function(e){this.optionalCharacter(e)||this.error("Missing expected "+String.fromCharCode(e))},e.prototype.optionalOperator=function(e){return!!this.next.isOperator(e)&&(this.advance(),!0)},e.prototype.expectOperator=function(e){this.optionalOperator(e)||this.error("Missing expected operator "+e)},e.prototype.expectIdentifierOrKeyword=function(){var e=this.next;return e.isIdentifier()||e.isKeyword()?(this.advance(),e.toString()):(this.error("Unexpected token "+e+", expected identifier or keyword"),"")},e.prototype.expectIdentifierOrKeywordOrString=function(){var e=this.next;return e.isIdentifier()||e.isKeyword()||e.isString()?(this.advance(),e.toString()):(this.error("Unexpected token "+e+", expected identifier, keyword, or string"),"")},e.prototype.parseChain=function(){for(var e=[],t=this.inputIndex;this.index<this.tokens.length;){var i=this.parsePipe();if(e.push(i),this.optionalCharacter(59))for(this.parseAction||this.error("Binding expression cannot contain chained expression");this.optionalCharacter(59););else this.index<this.tokens.length&&this.error("Unexpected token '"+this.next+"'")}return 0==e.length?new h(this.span(t)):1==e.length?e[0]:new f(this.span(t),e)},e.prototype.parsePipe=function(){var e=this.parseExpression();if(this.optionalOperator("|")){this.parseAction&&this.error("Cannot have a pipe in an action expression");do{for(var t=this.expectIdentifierOrKeyword(),i=[];this.optionalCharacter(58);)i.push(this.parseExpression());e=new _(this.span(e.span.start),e,t,i)}while(this.optionalOperator("|"))}return e},e.prototype.parseExpression=function(){return this.parseConditional()},e.prototype.parseConditional=function(){var e=this.inputIndex,t=this.parseLogicalOr();if(this.optionalOperator("?")){var i=this.parsePipe(),n=void 0;if(this.optionalCharacter(58))n=this.parsePipe();else{var r=this.input.substring(e,this.inputIndex);this.error("Conditional expression "+r+" requires all 3 expressions"),n=new h(this.span(e))}return new v(this.span(e),t,i,n)}return t},e.prototype.parseLogicalOr=function(){for(var e=this.parseLogicalAnd();this.optionalOperator("||");){var t=this.parseLogicalAnd();e=new x(this.span(e.span.start),"||",e,t)}return e},e.prototype.parseLogicalAnd=function(){for(var e=this.parseEquality();this.optionalOperator("&&");){var t=this.parseEquality();e=new x(this.span(e.span.start),"&&",e,t)}return e},e.prototype.parseEquality=function(){for(var e=this.parseRelational();this.next.type==L.Operator;){var t=this.next.strValue;switch(t){case"==":case"===":case"!=":case"!==":this.advance();var i=this.parseRelational();e=new x(this.span(e.span.start),t,e,i);continue}break}return e},e.prototype.parseRelational=function(){for(var e=this.parseAdditive();this.next.type==L.Operator;){var t=this.next.strValue;switch(t){case"<":case">":case"<=":case">=":this.advance();var i=this.parseAdditive();e=new x(this.span(e.span.start),t,e,i);continue}break}return e},e.prototype.parseAdditive=function(){for(var e=this.parseMultiplicative();this.next.type==L.Operator;){var t=this.next.strValue;switch(t){case"+":case"-":this.advance();var i=this.parseMultiplicative();e=new x(this.span(e.span.start),t,e,i);continue}break}return e},e.prototype.parseMultiplicative=function(){for(var e=this.parsePrefix();this.next.type==L.Operator;){var t=this.next.strValue;switch(t){case"*":case"%":case"/":this.advance();var i=this.parsePrefix();e=new x(this.span(e.span.start),t,e,i);continue}break}return e},e.prototype.parsePrefix=function(){if(this.next.type==L.Operator){var e=this.inputIndex,t=this.next.strValue,i=void 0;switch(t){case"+":return this.advance(),this.parsePrefix();case"-":return this.advance(),i=this.parsePrefix(),new x(this.span(e),t,new w(new c(e,e),0),i);case"!":return this.advance(),i=this.parsePrefix(),new S(this.span(e),i)}}return this.parseCallChain()},e.prototype.parseCallChain=function(){for(var e=this.parsePrimary();;)if(this.optionalCharacter(46))e=this.parseAccessMemberOrMethodCall(e,!1);else if(this.optionalOperator("?."))e=this.parseAccessMemberOrMethodCall(e,!0);else if(this.optionalCharacter(91)){this.rbracketsExpected++;var t=this.parsePipe();if(this.rbracketsExpected--,this.expectCharacter(93),this.optionalOperator("=")){var i=this.parseConditional();e=new C(this.span(e.span.start),e,t,i)}else e=new g(this.span(e.span.start),e,t)}else{if(!this.optionalCharacter(40))return e;this.rparensExpected++;var n=this.parseCallArguments();this.rparensExpected--,this.expectCharacter(41),e=new P(this.span(e.span.start),e,n)}},e.prototype.parsePrimary=function(){var e=this.inputIndex;if(this.optionalCharacter(40)){this.rparensExpected++;var t=this.parsePipe();return this.rparensExpected--,this.expectCharacter(41),t}if(this.next.isKeywordNull())return this.advance(),new w(this.span(e),null);if(this.next.isKeywordUndefined())return this.advance(),new w(this.span(e),void 0);if(this.next.isKeywordTrue())return this.advance(),new w(this.span(e),!0);if(this.next.isKeywordFalse())return this.advance(),new w(this.span(e),!1);if(this.next.isKeywordThis())return this.advance(),new p(this.span(e));if(this.optionalCharacter(91)){this.rbracketsExpected++;var i=this.parseExpressionList(93);return this.rbracketsExpected--,this.expectCharacter(93),new b(this.span(e),i)}if(this.next.isCharacter(123))return this.parseLiteralMap();if(this.next.isIdentifier())return this.parseAccessMemberOrMethodCall(new p(this.span(e)),!1);if(this.next.isNumber()){var n=this.next.toNumber();return this.advance(),new w(this.span(e),n)}if(this.next.isString()){var r=this.next.toString();return this.advance(),new w(this.span(e),r)}return this.index>=this.tokens.length?(this.error("Unexpected end of expression: "+this.input),new h(this.span(e))):(this.error("Unexpected token "+this.next),new h(this.span(e)))},e.prototype.parseExpressionList=function(e){var t=[];if(!this.next.isCharacter(e))do{t.push(this.parsePipe())}while(this.optionalCharacter(44));return t},e.prototype.parseLiteralMap=function(){var e=[],t=[],i=this.inputIndex;if(this.expectCharacter(123),!this.optionalCharacter(125)){this.rbracesExpected++;do{var n=this.expectIdentifierOrKeywordOrString();e.push(n),this.expectCharacter(58),t.push(this.parsePipe())}while(this.optionalCharacter(44));this.rbracesExpected--,this.expectCharacter(125)}return new k(this.span(i),e,t)},e.prototype.parseAccessMemberOrMethodCall=function(e,t){void 0===t&&(t=!1);var i=e.span.start,n=this.expectIdentifierOrKeyword();if(this.optionalCharacter(40)){this.rparensExpected++;var r=this.parseCallArguments();this.expectCharacter(41),this.rparensExpected--;var s=this.span(i);return t?new I(s,e,n,r):new E(s,e,n,r)}if(t)return this.optionalOperator("=")?(this.error("The '?.' operator cannot be used in the assignment"),new h(this.span(i))):new m(this.span(i),e,n);if(this.optionalOperator("=")){if(!this.parseAction)return this.error("Bindings cannot contain assignments"),new h(this.span(i));var o=this.parseConditional();return new y(this.span(i),e,n,o)}return new d(this.span(i),e,n)},e.prototype.parseCallArguments=function(){if(this.next.isCharacter(41))return[];var e=[];do{e.push(this.parsePipe())}while(this.optionalCharacter(44));return e},e.prototype.expectTemplateBindingKey=function(){var e="",t=!1;do{e+=this.expectIdentifierOrKeywordOrString(),(t=this.optionalOperator("-"))&&(e+="-")}while(t);return e.toString()},e.prototype.parseTemplateBindings=function(){for(var e=[],t=null;this.index<this.tokens.length;){var i=this.inputIndex,n=this.peekKeywordLet();n&&this.advance();var r=this.expectTemplateBindingKey();n||(null==t?t=r:r=t+r[0].toUpperCase()+r.substring(1)),this.optionalCharacter(58);var s=null,o=null;if(n)s=this.optionalOperator("=")?this.expectTemplateBindingKey():"$implicit";else if(this.next!==K&&!this.peekKeywordLet()){var a=this.inputIndex,c=this.parsePipe(),u=this.input.substring(a-this.offset,this.inputIndex-this.offset);o=new O(c,u,this.location,this.errors)}e.push(new R(this.span(i),r,n,s,o)),this.optionalCharacter(59)||this.optionalCharacter(44)}return new X(e,[],this.errors)},e.prototype.error=function(e,t){void 0===t&&(t=null),this.errors.push(new a(e,this.input,this.locationText(t),this.location)),this.skip()},e.prototype.locationText=function(e){return void 0===e&&(e=null),i(e)&&(e=this.index),e<this.tokens.length?"at column "+(this.tokens[e].index+1)+" in":"at the end of the expression"},e.prototype.skip=function(){for(var e=this.next;this.index<this.tokens.length&&!e.isCharacter(59)&&(this.rparensExpected<=0||!e.isCharacter(41))&&(this.rbracesExpected<=0||!e.isCharacter(125))&&(this.rbracketsExpected<=0||!e.isCharacter(93));)this.next.isError()&&this.errors.push(new a(this.next.toString(),this.input,this.locationText(),this.location)),this.advance(),e=this.next},e}(),J=function(){function e(){this.errors=[]}return e.check=function(t){var i=new e;return t.visit(i),i.errors},e.prototype.visitImplicitReceiver=function(e,t){},e.prototype.visitInterpolation=function(e,t){},e.prototype.visitLiteralPrimitive=function(e,t){},e.prototype.visitPropertyRead=function(e,t){},e.prototype.visitPropertyWrite=function(e,t){},e.prototype.visitSafePropertyRead=function(e,t){},e.prototype.visitMethodCall=function(e,t){},e.prototype.visitSafeMethodCall=function(e,t){},e.prototype.visitFunctionCall=function(e,t){},e.prototype.visitLiteralArray=function(e,t){this.visitAll(e.expressions)},e.prototype.visitLiteralMap=function(e,t){this.visitAll(e.values)},e.prototype.visitBinary=function(e,t){},e.prototype.visitPrefixNot=function(e,t){},e.prototype.visitConditional=function(e,t){},e.prototype.visitPipe=function(e,t){this.errors.push("pipes")},e.prototype.visitKeyedRead=function(e,t){},e.prototype.visitKeyedWrite=function(e,t){},e.prototype.visitAll=function(e){var t=this;return e.map((function(e){return e.visit(t)}))},e.prototype.visitChain=function(e,t){},e.prototype.visitQuote=function(e,t){},e}();function Q(e){return JSON.stringify(e).replace(/"/g,"")}var ee=function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),te=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ee(t,e),t.prototype._handleMethodArgs=function(e){if(!e)return"";for(var t="",i=0,n=e.length;i<n;i++)t+=i===n-1?""+e[i]:e[i]+", ";return t},t.prototype._handlePipeArgs=function(e){if(!e)return"";for(var t="",i=0,n=e;i<n.length;i++)t+=" : "+n[i];return t},t.prototype.visitBinary=function(e){var t=e.left.visit(this),i=e.right.visit(this);return t+" "+e.operation+" "+i},t.prototype.visitChain=function(e){return Q(this.visitAll(e.expressions))},t.prototype.visitConditional=function(e){return e.condition.visit(this)+" ? "+e.trueExp.visit(this)+" : "+e.falseExp.visit(this)},t.prototype.visitPipe=function(e){var t=e.name;return e.exp.visit(this)+" | "+t+this._handlePipeArgs(this.visitAll(e.args))},t.prototype.visitFunctionCall=function(e){return e.target.visit(this)+"("+this._handleMethodArgs(this.visitAll(e.args))+")"},t.prototype.visitImplicitReceiver=function(e){return""},t.prototype.visitInterpolation=function(e){return"{{"+this.visitAll(e.expressions)[0]+"}}"},t.prototype.visitKeyedRead=function(e){return e.obj.visit(this)+"["+e.key.visit(this)+"]"},t.prototype.visitKeyedWrite=function(e){return null},t.prototype.visitLiteralArray=function(e){return Q(this.visitAll(e.expressions))},t.prototype.visitLiteralMap=function(e,t){for(var i={},n=e.keys,r=this.visitAll(e.values),s=0,o=n.length;s<o;s++){var a=r[s];"string"!=typeof a&&t&&(a=""+a),i[n[s]]=a}return t?i:Q(i)},t.prototype.visitLiteralPrimitive=function(e){return"string"==typeof e.value?"'"+e.value+"'":e.value},t.prototype.visitMethodCall=function(e){var t=e.name,i=e.receiver.visit(this);return""+(i?i+".":i)+t+"("+this._handleMethodArgs(this.visitAll(e.args))+")"},t.prototype.visitPrefixNot=function(e){return e.expression.visit(this)},t.prototype.visitPropertyRead=function(e){var t=e.name,i=e.receiver.visit(this);return""+(i?i+".":i)+t},t.prototype.visitPropertyWrite=function(e){return null},t.prototype.visitSafePropertyRead=function(e){var t=e.name,i=e.receiver.visit(this);return""+(i?i+".":i)+t},t.prototype.visitSafeMethodCall=function(e){var t=e.name,i=e.receiver.visit(this);return""+(i?i+".":i)+t+"("+this._handleMethodArgs(this.visitAll(e.args))+")"},t.prototype.visitAll=function(e){var t=this;return e.map((function(e){return e.visit(t)}))},t.prototype.visitQuote=function(e){return null},t}(T),ie=function(){function e(){this._parser=new $(new N),this._cache=new Map}return e.prototype.map=function(e){var t=null,i=new te;if(this._cache.has(e))t=this._cache.get(e);else{if(t=this._parser.parseInterpolation(e,"JsonMapper"))throw new Error("JsonMapperVisitor ERROR: given expression must be json expression.");if(!((t=this._parser.parseBinding(e,"Parse")).ast instanceof k))throw new Error("JsonMapper ERROR: given expression must be json expression.");this._cache.set(e,t)}for(var n=new Map,r=t.visit(i,!0),s=Object.keys(r),o=0,a=s.length;o<a;o++)n.set(s[o],r[s[o]]);return n},e}();e.JsonStringMapper=ie,Object.defineProperty(e,"__esModule",{value:!0})}(t)},Cg5X:function(e,t,i){"use strict";if(e.exports)var n=i("Y1mi");function r(e,t){if(!(this instanceof r))return new r(e,t);this.easting=Number(e),this.northing=Number(t)}r.latLonToOsGrid=function(e){if(!(e instanceof n))throw new TypeError("point is not LatLon object");e.datum!=n.datum.OSGB36&&(e=e.convertDatum(n.datum.OSGB36));var t=e.lat.toRadians(),i=e.lon.toRadians(),s=6377563.396,o=6356256.909,a=.9996012717,c=49..toRadians(),u=(-2).toRadians(),l=1-o*o/(s*s),h=(s-o)/(s+o),p=h*h,f=h*h*h,v=Math.cos(t),d=Math.sin(t),y=s*a/Math.sqrt(1-l*d*d),m=s*a*(1-l)/Math.pow(1-l*d*d,1.5),g=y/m-1,C=o*a*((1+h+5/4*p+5/4*f)*(t-c)-(3*h+3*h*h+21/8*f)*Math.sin(t-c)*Math.cos(t+c)+(15/8*p+15/8*f)*Math.sin(2*(t-c))*Math.cos(2*(t+c))-35/24*f*Math.sin(3*(t-c))*Math.cos(3*(t+c))),_=v*v*v,w=_*v*v,b=Math.tan(t)*Math.tan(t),k=b*b,M=i-u,x=M*M,S=x*M,E=S*M,I=E*M,P=C+-1e5+y/2*d*v*x+y/24*d*_*(5-b+9*g)*E+y/720*d*w*(61-58*b+k)*(I*M),O=4e5+y*v*M+y/6*_*(y/m-b)*S+y/120*w*(5-18*b+k+14*g-58*b*g)*I;return P=Number(P.toFixed(3)),new r(O=Number(O.toFixed(3)),P)},r.osGridToLatLon=function(e,t){if(!(e instanceof r))throw new TypeError("gridref is not OsGridRef object");void 0===t&&(t=n.datum.WGS84);var i=e.easting,s=e.northing,o=6377563.396,a=6356256.909,c=.9996012717,u=49..toRadians(),l=(-2).toRadians(),h=1-a*a/(o*o),p=(o-a)/(o+a),f=p*p,v=p*p*p,d=u,y=0;do{y=a*c*((1+p+5/4*f+5/4*v)*((d=(s- -1e5-y)/(o*c)+d)-u)-(3*p+3*p*p+21/8*v)*Math.sin(d-u)*Math.cos(d+u)+(15/8*f+15/8*v)*Math.sin(2*(d-u))*Math.cos(2*(d+u))-35/24*v*Math.sin(3*(d-u))*Math.cos(3*(d+u)))}while(s- -1e5-y>=1e-5);var m=Math.cos(d),g=Math.sin(d),C=o*c/Math.sqrt(1-h*g*g),_=o*c*(1-h)/Math.pow(1-h*g*g,1.5),w=C/_-1,b=Math.tan(d),k=b*b,M=k*k,x=1/m,S=C*C*C,E=S*C*C,I=i-4e5,P=I*I,O=P*I,R=P*P,T=O*P,A=l+x/C*I-x/(6*S)*(C/_+2*k)*O+x/(120*E)*(5+28*k+24*M)*T-x/(E*C*C*5040)*(61+662*k+1320*M+M*k*720)*(T*P),L=new n((d=d-b/(2*_*C)*P+b/(24*_*S)*(5+3*k+w-9*k*w)*R-b/(720*_*E)*(61+90*k+45*M)*(R*P)).toDegrees(),A.toDegrees(),n.datum.OSGB36);return t!=n.datum.OSGB36&&(L=L.convertDatum(t)),L},r.parse=function(e){var t=(e=String(e).trim()).match(/^(\d+),\s*(\d+)$/);if(t)return new r(t[1],t[2]);if(!(t=e.match(/^[A-Z]{2}\s*[0-9]+\s*[0-9]+$/i)))throw new Error("Invalid grid reference");var i=e.toUpperCase().charCodeAt(0)-"A".charCodeAt(0),n=e.toUpperCase().charCodeAt(1)-"A".charCodeAt(0);i>7&&i--,n>7&&n--;var s=(i-2)%5*5+n%5,o=19-5*Math.floor(i/5)-Math.floor(n/5),a=e.slice(2).trim().split(/\s+/);if(1==a.length&&(a=[a[0].slice(0,a[0].length/2),a[0].slice(a[0].length/2)]),s<0||s>6||o<0||o>12)throw new Error("Invalid grid reference");if(2!=a.length)throw new Error("Invalid grid reference");if(a[0].length!=a[1].length)throw new Error("Invalid grid reference");return a[0]=(a[0]+"00000").slice(0,5),a[1]=(a[1]+"00000").slice(0,5),new r(s+a[0],o+a[1])},r.prototype.toString=function(e){if(e=void 0===e?10:Number(e),isNaN(e)||e%2!=0||e>16)throw new RangeError("Invalid precision \u2018"+e+"\u2019");var t=this.easting,i=this.northing;if(isNaN(t)||isNaN(i))throw new Error("Invalid grid reference");if(0==e){var n=Math.floor(t),r=t-n,s=Math.floor(i),o=i-s;return("000000"+n).slice(-6)+(r>0?r.toFixed(3).slice(1):"")+","+((s<1e6?("000000"+s).slice(-6):s)+(o>0?o.toFixed(3).slice(1):""))}var a=Math.floor(t/1e5),c=Math.floor(i/1e5);if(a<0||a>6||c<0||c>12)return"";var u=19-c-(19-c)%5+Math.floor((a+10)/5),l=5*(19-c)%25+a%5;u>7&&u++,l>7&&l++;var h=String.fromCharCode(u+"A".charCodeAt(0),l+"A".charCodeAt(0));return t=Math.floor(t%1e5/Math.pow(10,5-e/2)),i=Math.floor(i%1e5/Math.pow(10,5-e/2)),h+" "+(t=("00000000"+t).slice(-e/2))+" "+("00000000"+i).slice(-e/2)},e.exports&&(e.exports=r)},EO7G:function(e,t,i){"use strict";if(e.exports)var n=i("nXlo");if(e.exports)var r=i("Y1mi");function s(e,t,i,n,o,a,c){if(!(this instanceof s))return new s(e,t,i,n,o,a,c);if(void 0===c&&(c=r.datum.WGS84),!(1<=e&&e<=60))throw new Error("Invalid MGRS grid reference (zone \u2018"+e+"\u2019)");if(1!=t.length)throw new Error("Invalid MGRS grid reference (band \u2018"+t+"\u2019)");if(-1==s.latBands.indexOf(t))throw new Error("Invalid MGRS grid reference (band \u2018"+t+"\u2019)");if(1!=i.length)throw new Error("Invalid MGRS grid reference (e100k \u2018"+i+"\u2019)");if(1!=n.length)throw new Error("Invalid MGRS grid reference (n100k \u2018"+n+"\u2019)");this.zone=Number(e),this.band=t,this.e100k=i,this.n100k=n,this.easting=Number(o),this.northing=Number(a),this.datum=c}s.latBands="CDEFGHJKLMNPQRSTUVWXX",s.e100kLetters=["ABCDEFGH","JKLMNPQR","STUVWXYZ"],s.n100kLetters=["ABCDEFGHJKLMNPQRSTUV","FGHJKLMNPQRSTUVABCDE"],n.prototype.toMgrs=function(){if(isNaN(this.zone+this.easting+this.northing))throw new Error("Invalid UTM coordinate \u2018"+this.toString()+"\u2019");var e=this.zone,t=this.toLatLonE(),i=s.latBands.charAt(Math.floor(t.lat/8+10)),n=Math.floor(this.easting/1e5),r=s.e100kLetters[(e-1)%3].charAt(n-1),o=Math.floor(this.northing/1e5)%20,a=s.n100kLetters[(e-1)%2].charAt(o),c=this.easting%1e5,u=this.northing%1e5;return new s(e,i,r,a,c=Number(c.toFixed(6)),u=Number(u.toFixed(6)))},s.prototype.toUtm=function(){for(var e=this.zone,t=this.band,i=this.n100k,o=this.easting,a=this.northing,c=t>="N"?"N":"S",u=1e5*(s.e100kLetters[(e-1)%3].indexOf(this.e100k)+1),l=1e5*s.n100kLetters[(e-1)%2].indexOf(i),h=8*(s.latBands.indexOf(t)-10),p=1e5*Math.floor(new r(h,0).toUtm().northing/1e5),f=0;f+l+a<p;)f+=2e6;return new n(e,c,u+o,f+l+a,this.datum)},s.parse=function(e){if(!(e=e.trim()).match(/\s/)){var t=e.slice(5);t=t.slice(0,t.length/2)+" "+t.slice(-t.length/2),e=e.slice(0,3)+" "+e.slice(3,5)+" "+t}if(null==(e=e.match(/\S+/g))||4!=e.length)throw new Error("Invalid MGRS grid reference \u2018"+e+"\u2019");var i=e[0],n=i.slice(0,2),r=i.slice(2,3),o=e[1],a=o.slice(0,1),c=o.slice(1,2),u=e[2],l=e[3];return new s(n,r,a,c,u=u.length>=5?u:(u+"00000").slice(0,5),l=l.length>=5?l:(l+"00000").slice(0,5))},s.prototype.toString=function(e){if(e=void 0===e?10:Number(e),-1==[2,4,6,8,10].indexOf(e))throw new Error("Invalid precision \u2018"+e+"\u2019");var t=("00"+this.zone).slice(-2),i=this.band,n=this.e100k,r=this.n100k,s=Math.floor(this.easting/Math.pow(10,5-e/2)),o=Math.floor(this.northing/Math.pow(10,5-e/2));return t+i+" "+n+r+" "+("00000"+s).slice(-e/2)+" "+("00000"+o).slice(-e/2)},e.exports&&(e.exports=s)},LnQ2:function(e,t,i){"use strict";if(e.exports)var n=i("Y1mi");n.prototype.distanceTo=function(e){if(!(e instanceof n))throw new TypeError("point is not LatLon object");try{return Number(this.inverse(e).distance.toFixed(3))}catch(t){return NaN}},n.prototype.initialBearingTo=function(e){if(!(e instanceof n))throw new TypeError("point is not LatLon object");try{return Number(this.inverse(e).initialBearing.toFixed(9))}catch(t){return NaN}},n.prototype.finalBearingTo=function(e){if(!(e instanceof n))throw new TypeError("point is not LatLon object");try{return Number(this.inverse(e).finalBearing.toFixed(9))}catch(t){return NaN}},n.prototype.destinationPoint=function(e,t){return this.direct(Number(e),Number(t)).point},n.prototype.finalBearingOn=function(e,t){return Number(this.direct(Number(e),Number(t)).finalBearing.toFixed(9))},n.prototype.direct=function(e,t){var i,r,s,o,a=this.lat.toRadians(),c=this.lon.toRadians(),u=t.toRadians(),l=e,h=this.datum.ellipsoid.a,p=this.datum.ellipsoid.b,f=this.datum.ellipsoid.f,v=Math.sin(u),d=Math.cos(u),y=(1-f)*Math.tan(a),m=1/Math.sqrt(1+y*y),g=y*m,C=Math.atan2(y,d),_=m*v,w=1-_*_,b=w*(h*h-p*p)/(p*p),k=1+b/16384*(4096+b*(b*(320-175*b)-768)),M=b/1024*(256+b*(b*(74-47*b)-128)),x=l/(p*k),S=0;do{i=Math.cos(2*C+x),o=x,x=l/(p*k)+M*(r=Math.sin(x))*(i+M/4*((s=Math.cos(x))*(2*i*i-1)-M/6*i*(4*r*r-3)*(4*i*i-3)))}while(Math.abs(x-o)>1e-12&&++S<100);if(S>=100)throw new Error("Formula failed to converge");var E=g*r-m*s*d,I=Math.atan2(g*s+m*r*d,(1-f)*Math.sqrt(_*_+E*E)),P=f/16*w*(4+f*(4-3*w)),O=(c+(Math.atan2(r*v,m*s-g*r*d)-(1-P)*f*_*(x+P*r*(i+P*s*(2*i*i-1))))+3*Math.PI)%(2*Math.PI)-Math.PI,R=Math.atan2(_,-E);return R=(R+2*Math.PI)%(2*Math.PI),{point:new n(I.toDegrees(),O.toDegrees(),this.datum),finalBearing:R.toDegrees(),iterations:S}},n.prototype.inverse=function(e){var t=e;-180==this.lon&&(this.lon=180);var i,n,r,s,o,a,c=this.lat.toRadians(),u=this.lon.toRadians(),l=t.lat.toRadians(),h=t.lon.toRadians(),p=this.datum.ellipsoid.a,f=this.datum.ellipsoid.b,v=this.datum.ellipsoid.f,d=h-u,y=(1-v)*Math.tan(c),m=1/Math.sqrt(1+y*y),g=y*m,C=(1-v)*Math.tan(l),_=1/Math.sqrt(1+C*C),w=C*_,b=0,k=0,M=0,x=0,S=0,E=d,I=0,P=Math.abs(d)>Math.PI;do{if(0==(r=_*(i=Math.sin(E))*(_*i)+(m*w-g*_*(n=Math.cos(E)))*(m*w-g*_*n)))break;if(k=g*w+m*_*n,a=E,E=d+(1-(o=v/16*(x=1-(s=m*_*i/(b=Math.sqrt(r)))*s)*(4+v*(4-3*x))))*v*s*((M=Math.atan2(b,k))+o*b*((S=0!=x?k-2*g*w/x:0)+o*k*(2*S*S-1))),(P?Math.abs(E)-Math.PI:Math.abs(E))>Math.PI)throw new Error("\u03bb > \u03c0")}while(Math.abs(E-a)>1e-12&&++I<1e3);if(I>=1e3)throw new Error("Formula failed to converge");var O=x*(p*p-f*f)/(f*f),R=O/1024*(256+O*(O*(74-47*O)-128)),T=f*(1+O/16384*(4096+O*(O*(320-175*O)-768)))*(M-R*b*(S+R/4*(k*(2*S*S-1)-R/6*S*(4*b*b-3)*(4*S*S-3)))),A=Math.atan2(_*i,m*w-g*_*n),L=Math.atan2(m*i,-g*_+m*w*n);return A=(A+2*Math.PI)%(2*Math.PI),L=(L+2*Math.PI)%(2*Math.PI),{distance:T,initialBearing:0==T?NaN:A.toDegrees(),finalBearing:0==T?NaN:L.toDegrees(),iterations:I}},void 0===Number.prototype.toRadians&&(Number.prototype.toRadians=function(){return this*Math.PI/180}),void 0===Number.prototype.toDegrees&&(Number.prototype.toDegrees=function(){return 180*this/Math.PI}),e.exports&&(e.exports=n)},MCLT:function(e,t,i){var n=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),i={},n=0;n<t.length;n++)i[t[n]]=Object.getOwnPropertyDescriptor(e,t[n]);return i},r=/%[sdj%]/g;t.format=function(e){if(!m(e)){for(var t=[],i=0;i<arguments.length;i++)t.push(a(arguments[i]));return t.join(" ")}i=1;for(var n=arguments,s=n.length,o=String(e).replace(r,(function(e){if("%%"===e)return"%";if(i>=s)return e;switch(e){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(t){return"[Circular]"}default:return e}})),c=n[i];i<s;c=n[++i])d(c)||!_(c)?o+=" "+c:o+=" "+a(c);return o},t.deprecate=function(e,i){if("undefined"!=typeof process&&!0===process.noDeprecation)return e;if("undefined"==typeof process)return function(){return t.deprecate(e,i).apply(this,arguments)};var n=!1;return function(){if(!n){if(process.throwDeprecation)throw new Error(i);process.traceDeprecation?console.trace(i):console.error(i),n=!0}return e.apply(this,arguments)}};var s,o={};function a(e,i){var n={seen:[],stylize:u};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),v(i)?n.showHidden=i:i&&t._extend(n,i),g(n.showHidden)&&(n.showHidden=!1),g(n.depth)&&(n.depth=2),g(n.colors)&&(n.colors=!1),g(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=c),l(n,e,n.depth)}function c(e,t){var i=a.styles[t];return i?"\x1b["+a.colors[i][0]+"m"+e+"\x1b["+a.colors[i][1]+"m":e}function u(e,t){return e}function l(e,i,n){if(e.customInspect&&i&&k(i.inspect)&&i.inspect!==t.inspect&&(!i.constructor||i.constructor.prototype!==i)){var r=i.inspect(n,e);return m(r)||(r=l(e,r,n)),r}var s=function(e,t){if(g(t))return e.stylize("undefined","undefined");if(m(t)){var i="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(i,"string")}return y(t)?e.stylize(""+t,"number"):v(t)?e.stylize(""+t,"boolean"):d(t)?e.stylize("null","null"):void 0}(e,i);if(s)return s;var o=Object.keys(i),a=function(e){var t={};return e.forEach((function(e,i){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(i)),b(i)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return h(i);if(0===o.length){if(k(i))return e.stylize("[Function"+(i.name?": "+i.name:"")+"]","special");if(C(i))return e.stylize(RegExp.prototype.toString.call(i),"regexp");if(w(i))return e.stylize(Date.prototype.toString.call(i),"date");if(b(i))return h(i)}var c,u="",_=!1,M=["{","}"];return f(i)&&(_=!0,M=["[","]"]),k(i)&&(u=" [Function"+(i.name?": "+i.name:"")+"]"),C(i)&&(u=" "+RegExp.prototype.toString.call(i)),w(i)&&(u=" "+Date.prototype.toUTCString.call(i)),b(i)&&(u=" "+h(i)),0!==o.length||_&&0!=i.length?n<0?C(i)?e.stylize(RegExp.prototype.toString.call(i),"regexp"):e.stylize("[Object]","special"):(e.seen.push(i),c=_?function(e,t,i,n,r){for(var s=[],o=0,a=t.length;o<a;++o)I(t,String(o))?s.push(p(e,t,i,n,String(o),!0)):s.push("");return r.forEach((function(r){r.match(/^\d+$/)||s.push(p(e,t,i,n,r,!0))})),s}(e,i,n,a,o):o.map((function(t){return p(e,i,n,a,t,_)})),e.seen.pop(),function(e,t,i){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?i[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+i[1]:i[0]+t+" "+e.join(", ")+" "+i[1]}(c,u,M)):M[0]+u+M[1]}function h(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,i,n,r,s){var o,a,c;if((c=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?a=e.stylize(c.set?"[Getter/Setter]":"[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),I(n,r)||(o="["+r+"]"),a||(e.seen.indexOf(c.value)<0?(a=d(i)?l(e,c.value,null):l(e,c.value,i-1)).indexOf("\n")>-1&&(a=s?a.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+a.split("\n").map((function(e){return"   "+e})).join("\n")):a=e.stylize("[Circular]","special")),g(o)){if(s&&r.match(/^\d+$/))return a;(o=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=e.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=e.stylize(o,"string"))}return o+": "+a}function f(e){return Array.isArray(e)}function v(e){return"boolean"==typeof e}function d(e){return null===e}function y(e){return"number"==typeof e}function m(e){return"string"==typeof e}function g(e){return void 0===e}function C(e){return _(e)&&"[object RegExp]"===M(e)}function _(e){return"object"==typeof e&&null!==e}function w(e){return _(e)&&"[object Date]"===M(e)}function b(e){return _(e)&&("[object Error]"===M(e)||e instanceof Error)}function k(e){return"function"==typeof e}function M(e){return Object.prototype.toString.call(e)}function x(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(g(s)&&(s=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!o[e])if(new RegExp("\\b"+e+"\\b","i").test(s)){var i=process.pid;o[e]=function(){var n=t.format.apply(t,arguments);console.error("%s %d: %s",e,i,n)}}else o[e]=function(){};return o[e]},t.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=v,t.isNull=d,t.isNullOrUndefined=function(e){return null==e},t.isNumber=y,t.isString=m,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=g,t.isRegExp=C,t.isObject=_,t.isDate=w,t.isError=b,t.isFunction=k,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=i("1gqn");var S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function E(){var e=new Date,t=[x(e.getHours()),x(e.getMinutes()),x(e.getSeconds())].join(":");return[e.getDate(),S[e.getMonth()],t].join(" ")}function I(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",E(),t.format.apply(t,arguments))},t.inherits=i("P7XM"),t._extend=function(e,t){if(!t||!_(t))return e;for(var i=Object.keys(t),n=i.length;n--;)e[i[n]]=t[i[n]];return e};var P="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function O(e,t){if(!e){var i=new Error("Promise was rejected with a falsy value");i.reason=e,e=i}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(P&&e[P]){var t;if("function"!=typeof(t=e[P]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,P,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,i,n=new Promise((function(e,n){t=e,i=n})),r=[],s=0;s<arguments.length;s++)r.push(arguments[s]);r.push((function(e,n){e?i(e):t(n)}));try{e.apply(this,r)}catch(o){i(o)}return n}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),P&&Object.defineProperty(t,P,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,n(e))},t.promisify.custom=P,t.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function t(){for(var t=[],i=0;i<arguments.length;i++)t.push(arguments[i]);var n=t.pop();if("function"!=typeof n)throw new TypeError("The last argument must be of type Function");var r=this,s=function(){return n.apply(r,arguments)};e.apply(this,t).then((function(e){process.nextTick(s,null,e)}),(function(e){process.nextTick(O,e,s)}))}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),Object.defineProperties(t,n(e)),t}},P7XM:function(e,t){e.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}},Vws6:function(e,t,i){"use strict";t.LatLonSpherical=i("1CWa"),t.LatLonEllipsoidal=i("Y1mi");var n=i("LnQ2");for(var r in n)t.LatLonEllipsoidal[r]=n[r];t.LatLonVectors=i("rgRP"),t.Vector3d=i("k5WX"),t.Utm=i("nXlo"),t.Mgrs=i("EO7G"),t.OsGridRef=i("Cg5X"),t.Dms=i("wiYu")},Y1mi:function(e,t,i){"use strict";if(e.exports)var n=i("k5WX");if(e.exports)var r=i("wiYu");function s(e,t,i){if(!(this instanceof s))return new s(e,t,i);void 0===i&&(i=s.datum.WGS84),this.lat=Number(e),this.lon=Number(t),this.datum=i}s.datum={ED50:{ellipsoid:(s.ellipsoid={WGS84:{a:6378137,b:6356752.314245,f:1/298.257223563},Airy1830:{a:6377563.396,b:6356256.909,f:1/299.3249646},AiryModified:{a:6377340.189,b:6356034.448,f:1/299.3249646},Bessel1841:{a:6377397.155,b:6356078.962818,f:1/299.1528128},Clarke1866:{a:6378206.4,b:6356583.8,f:1/294.978698214},Clarke1880IGN:{a:6378249.2,b:6356515,f:1/293.466021294},GRS80:{a:6378137,b:6356752.31414,f:1/298.257222101},Intl1924:{a:6378388,b:6356911.946,f:1/297},WGS72:{a:6378135,b:6356750.5,f:1/298.26}}).Intl1924,transform:[89.5,93.8,123.1,-1.2,0,0,.156]},Irl1975:{ellipsoid:s.ellipsoid.AiryModified,transform:[-482.53,130.596,-564.557,-8.15,-1.042,-.214,-.631]},NAD27:{ellipsoid:s.ellipsoid.Clarke1866,transform:[8,-160,-176,0,0,0,0]},NAD83:{ellipsoid:s.ellipsoid.GRS80,transform:[1.004,-1.91,-.515,-.0015,.0267,34e-5,.011]},NTF:{ellipsoid:s.ellipsoid.Clarke1880IGN,transform:[168,60,-320,0,0,0,0]},OSGB36:{ellipsoid:s.ellipsoid.Airy1830,transform:[-446.448,125.157,-542.06,20.4894,-.1502,-.247,-.8421]},Potsdam:{ellipsoid:s.ellipsoid.Bessel1841,transform:[-582,-105,-414,-8.3,1.04,.35,-3.08]},TokyoJapan:{ellipsoid:s.ellipsoid.Bessel1841,transform:[148,-507,-685,0,0,0,0]},WGS72:{ellipsoid:s.ellipsoid.WGS72,transform:[0,0,-4.5,-.22,0,0,.554]},WGS84:{ellipsoid:s.ellipsoid.WGS84,transform:[0,0,0,0,0,0,0]}},s.prototype.convertDatum=function(e){var t=this,i=null;if(t.datum==s.datum.WGS84&&(i=e.transform),e==s.datum.WGS84){i=[];for(var n=0;n<7;n++)i[n]=-t.datum.transform[n]}return null==i&&(t=this.convertDatum(s.datum.WGS84),i=e.transform),t.toCartesian().applyTransform(i).toLatLonE(e)},s.prototype.toCartesian=function(){var e=this.lat.toRadians(),t=this.lon.toRadians(),i=this.datum.ellipsoid.a,r=this.datum.ellipsoid.f,s=Math.sin(e),o=Math.cos(e),a=Math.sin(t),c=Math.cos(t),u=2*r-r*r,l=i/Math.sqrt(1-u*s*s);return new n((l+0)*o*c,(l+0)*o*a,(l*(1-u)+0)*s)},n.prototype.toLatLonE=function(e){var t=this.x,i=this.y,n=this.z,r=e.ellipsoid.a,o=e.ellipsoid.b,a=e.ellipsoid.f,c=2*a-a*a,u=c/(1-c),l=Math.sqrt(t*t+i*i),h=o*n/(r*l)*(1+u*o/Math.sqrt(l*l+n*n)),p=h/Math.sqrt(1+h*h),f=p/h,v=isNaN(f)?0:Math.atan2(n+u*o*p*p*p,l-c*r*f*f*f),d=Math.atan2(i,t),y=Math.sin(v);return Math.cos(v),Math.sqrt(1-c*y*y),new s(v.toDegrees(),d.toDegrees(),e)},n.prototype.applyTransform=function(e){var t=this.x,i=this.y,r=this.z,s=e[0],o=e[1],a=e[2],c=e[3]/1e6+1,u=(e[4]/3600).toRadians(),l=(e[5]/3600).toRadians(),h=(e[6]/3600).toRadians();return new n(s+t*c-i*h+r*l,o+t*h+i*c-r*u,a-t*l+i*u+r*c)},s.prototype.toString=function(e,t){return r.toLat(this.lat,e,t)+", "+r.toLon(this.lon,e,t)},void 0===Number.prototype.toRadians&&(Number.prototype.toRadians=function(){return this*Math.PI/180}),void 0===Number.prototype.toDegrees&&(Number.prototype.toDegrees=function(){return 180*this/Math.PI}),e.exports&&(e.exports=s,e.exports.Vector3d=n)},k5WX:function(e,t,i){"use strict";function n(e,t,i){if(!(this instanceof n))return new n(e,t,i);this.x=Number(e),this.y=Number(t),this.z=Number(i)}n.prototype.plus=function(e){if(!(e instanceof n))throw new TypeError("v is not Vector3d object");return new n(this.x+e.x,this.y+e.y,this.z+e.z)},n.prototype.minus=function(e){if(!(e instanceof n))throw new TypeError("v is not Vector3d object");return new n(this.x-e.x,this.y-e.y,this.z-e.z)},n.prototype.times=function(e){return e=Number(e),new n(this.x*e,this.y*e,this.z*e)},n.prototype.dividedBy=function(e){return e=Number(e),new n(this.x/e,this.y/e,this.z/e)},n.prototype.dot=function(e){if(!(e instanceof n))throw new TypeError("v is not Vector3d object");return this.x*e.x+this.y*e.y+this.z*e.z},n.prototype.cross=function(e){if(!(e instanceof n))throw new TypeError("v is not Vector3d object");return new n(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},n.prototype.negate=function(){return new n(-this.x,-this.y,-this.z)},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},n.prototype.unit=function(){var e=this.length();return 1==e?this:0==e?this:new n(this.x/e,this.y/e,this.z/e)},n.prototype.angleTo=function(e,t){if(!(e instanceof n))throw new TypeError("v is not Vector3d object");if(!(t instanceof n||null==t))throw new TypeError("n is not Vector3d object");var i=null==t?1:Math.sign(this.cross(e).dot(t)),r=this.cross(e).length()*i,s=this.dot(e);return Math.atan2(r,s)},n.prototype.rotateAround=function(e,t){if(!(e instanceof n))throw new TypeError("axis is not Vector3d object");for(var i=this.unit(),r=[i.x,i.y,i.z],s=e.unit(),o=Math.sin(t),a=Math.cos(t),c=[[s.x*s.x*(1-a)+a,s.x*s.y*(1-a)-s.z*o,s.x*s.z*(1-a)+s.y*o],[s.y*s.x*(1-a)+s.z*o,s.y*s.y*(1-a)+a,s.y*s.z*(1-a)-s.x*o],[s.z*s.x*(1-a)-s.y*o,s.z*s.y*(1-a)+s.x*o,s.z*s.z*(1-a)+a]],u=[0,0,0],l=0;l<3;l++)for(var h=0;h<3;h++)u[l]+=c[l][h]*r[h];return new n(u[0],u[1],u[2])},n.prototype.toString=function(e){var t=void 0===e?3:Number(e);return"["+this.x.toFixed(t)+","+this.y.toFixed(t)+","+this.z.toFixed(t)+"]"},void 0===Math.sign&&(Math.sign=function(e){return 0==(e=+e)||isNaN(e)?e:e>0?1:-1}),e.exports&&(e.exports=n)},mVnp:function(e,t,i){var n;n=function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.i=function(e){return e},i.d=function(e,t,i){Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=6)}([function(e,t){"use strict";t.to2D=function(e,t){var i=[],n=[];return Cesium.Cartesian3.unpackArray(t,i),Cesium.Cartesian3.packArray(i.map((function(t){return Cesium.SceneTransforms.computeActualWgs84Position(e,t)})),n),n},t.createSimpleIndicesArray=function(e){for(var t=[],i=0;i<e;i++)t.push(i);return new Uint16Array(t)},t.isTranslucent=function(e){return e[3]<1}},function(e,t,i){"use strict";var n=i(2);t.EllipsePrimitive=n.EllipsePrimitive},function(e,t,i){"use strict";var n=this&&this.__extends||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);function n(){this.constructor=e}e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},r=i(0),s=i(3),o=i(5),a=i(4),c=function(e){function t(t){e.call(this,t),this._center=Cesium.Cartesian3.clone(t.center),this._semiMajor=t.semiMajorAxis,this._semiMinor=t.semiMinorAxis,this._rotation=t.rotation||0,this._border=Cesium.defaultValue(t.border,{show:!0,style:"solid"}),this._showFill=Cesium.defaultValue(t.fill,!0),this._borderColor=t.borderColor||[0,0,0,1],this._granularity=t.granularity||.3,this._borderDrawCommand=new Cesium.DrawCommand({owner:this}),this.calculatePoints()}return n(t,e),Object.defineProperty(t.prototype,"center",{get:function(){return this._center},set:function(e){this._center!==e&&(this._center=e,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"semiMajor",{get:function(){return this._semiMajor},set:function(e){this._semiMajor!==e&&(this._semiMajor=e,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"semiMinor",{get:function(){return this._semiMinor},set:function(e){this._semiMinor!==e&&(this._semiMinor=e,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation!==e&&(this._rotation=e,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"borderColor",{get:function(){return this._borderColor},set:function(e){this._borderColor=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"show",{get:function(){return this._show},set:function(e){this._show=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"border",{get:function(){return this._border},set:function(e){this._border=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"showFill",{get:function(){return this._showFill},set:function(e){this._showFill=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"points",{set:function(e){(!this._borderIndicesArray||this._points&&this._points.outerPositions&&this._points.outerPositions.length!==e.outerPositions.length)&&(this._borderIndicesArray=t.createBorderIndicesArray(e.outerPositions.length/3)),(!this._indicesArray||this._points&&this._points.positions&&this._points.positions.length!==e.positions.length)&&(this._indicesArray=t.createIndicesArray(e.innerPoints.length/3)),this._points=e},enumerable:!0,configurable:!0}),t.prototype.updateLocationData=function(e){this.center=e.center||this._center,this.semiMajor=e.semiMajorAxis||this._semiMajor,this.semiMinor=e.semiMinorAxis||this._semiMinor,this._rotation=e.rotation||this._rotation,this.calculatePoints(),this.createBoundingVolume()},t.prototype.update=function(e){if(this.shouldRender()){e.mode!==this._lastMode&&(this._dirty=!0);var i=e.context;this.setupRenderState(),this.setupShaderProgram(i),this._border&&(this._borderVertexArray=this._dirty||!this._borderVertexArray?this.createBorderVertexArray(i,e):this._borderVertexArray,this.setupDrawCommand(this._borderDrawCommand,this._borderVertexArray,t.borderStyleToPrimitiveType[this._border.style],r.isTranslucent(this._borderColor)),e.commandList.push(this._borderDrawCommand)),this._showFill&&(this._vertexArray=this._dirty||!this._vertexArray?this.createVertexArray(i,e):this._vertexArray,this.setupDrawCommand(this._drawCommand,this._vertexArray,Cesium.PrimitiveType.TRIANGLE_FAN,this.isTranslucent()),e.commandList.push(this._drawCommand)),this._dirty=!1,this._lastMode=e.mode}},t.prototype.destroy=function(){this._shaderProgram.destroy(),this._vertexArray.destroy(),this._borderVertexArray.destroy()},t.prototype.shouldRender=function(){return e.prototype.shouldRender.call(this)&&(this._showFill||this._border.show)},t.prototype.createBorderVertexArray=function(e,t){var i=t.mode===Cesium.SceneMode.SCENE_3D?this._points.outerPositions:r.to2D(t,this._points.outerPositions),n=[{index:0,enabled:!0,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:e,typedArray:new Float32Array(i),usage:Cesium.BufferUsage.STATIC_DRAW}),componentsPerAttribute:3,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:0},{index:1,enabled:!0,value:this._borderColor,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:0}];return new Cesium.VertexArray({context:e,attributes:n,indexBuffer:this.createBorderIndexBuffer(e)})},t.prototype.createVertexArray=function(e,t){var i=t.mode===Cesium.SceneMode.SCENE_3D?this._points.innerPoints:r.to2D(t,this._points.innerPoints),n=[{index:0,enabled:!0,vertexBuffer:Cesium.Buffer.createVertexBuffer({context:e,typedArray:new Float32Array(i),usage:Cesium.BufferUsage.STATIC_DRAW}),componentsPerAttribute:3,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:0},{index:1,enabled:!0,value:this._color,componentsPerAttribute:4,componentDatatype:Cesium.ComponentDatatype.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:0}];return new Cesium.VertexArray({context:e,attributes:n,indexBuffer:this.createIndexBuffer(e)})},t.prototype.setupShaderProgram=function(e){this._shaderProgram=this._shaderProgram||Cesium.ShaderProgram.replaceCache({context:e,shaderProgram:this._shaderProgram,vertexShaderSource:o,fragmentShaderSource:a})},t.prototype.setupRenderState=function(){this._renderState=Cesium.RenderState.fromCache({cull:{enabled:!0,face:Cesium.CullFace.BACK},depthTest:{enabled:!1},depthMask:!0,blending:this.isTranslucent()||r.isTranslucent(this._borderColor)?{enabled:!0}:void 0})},t.prototype.calculatePoints=function(){var e=Cesium.EllipseGeometryLibrary.computeEllipsePositions({center:this._center,rotation:this._rotation,semiMajorAxis:this._semiMajor,semiMinorAxis:this._semiMinor,granularity:this._granularity},!1,!0);e.innerPoints=Cesium.Cartesian3.pack(this._center,[]).concat(e.outerPositions),this.points=e},t.prototype.createBorderIndexBuffer=function(e){return Cesium.Buffer.createIndexBuffer({context:e,typedArray:this._borderIndicesArray,usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:Cesium.IndexDatatype.UNSIGNED_SHORT})},t.prototype.createBoundingVolume=function(){this._boundingVolume=new Cesium.BoundingSphere(this._center,this._semiMajor)},t.prototype.createIndexBuffer=function(e){return Cesium.Buffer.createIndexBuffer({context:e,typedArray:new Uint16Array(this._indicesArray),usage:Cesium.BufferUsage.STATIC_DRAW,indexDatatype:Cesium.IndexDatatype.UNSIGNED_SHORT})},t.createBorderIndicesArray=function(e){return r.createSimpleIndicesArray(e)},t.createIndicesArray=function(e){for(var t=[],i=2;i<e;i++)t.push(0,i-1,i);return t.push(0,e-1,1),t},t.borderStyleToPrimitiveType={solid:Cesium.PrimitiveType.LINE_LOOP,dashed:Cesium.PrimitiveType.LINES},t}(s.Primitive);t.EllipsePrimitive=c},function(e,t,i){"use strict";var n=i(0),r=function(){function e(e){this._dirty=!0,this._show=Cesium.defaultValue(e.show,!0),this._color=e.color||[0,0,0,1],this._modelMatrix=Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),this._drawCommand=new Cesium.DrawCommand({owner:this})}return Object.defineProperty(e.prototype,"color",{get:function(){return this._color},set:function(e){this._color=e,this._dirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"show",{get:function(){return this._show},set:function(e){this._show=e},enumerable:!0,configurable:!0}),e.prototype.isTranslucent=function(){return n.isTranslucent(this._color)},e.prototype.shouldRender=function(){return this._show},e.prototype.setupDrawCommand=function(e,t,i,n,r){void 0===n&&(n=!1),void 0===r&&(r=!1),e.modelMatrix=this._modelMatrix,e.renderState=this._renderState,e.shaderProgram=this._shaderProgram,e.boundingVolume=this._boundingVolume,e.pass=n?Cesium.Pass.TRANSLUCENT:Cesium.Pass.OPAQUE,e.debugShowBoundingVolume=r,e.primitiveType=i,e.vertexArray=t},e}();t.Primitive=r},function(e,t){e.exports="varying vec4 v_color;\r\nvoid main()\r\n{\r\n    gl_FragColor = v_color;\r\n}\r\n"},function(e,t){e.exports="attribute vec3 position;\r\nattribute vec4 color;\r\nvarying vec4 v_color;\r\n\r\nvoid main() {\r\n    gl_Position = czm_modelViewProjection * vec4(position, 1.0);\r\n    v_color = color;\r\n}"},function(e,t,i){"use strict";!function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i(1))}])},e.exports=n()},nXlo:function(e,t,i){"use strict";if(e.exports)var n=i("Y1mi");function r(e,t,i,s,o,a,c){if(!(this instanceof r))return new r(e,t,i,s,o,a,c);if(void 0===o&&(o=n.datum.WGS84),void 0===a&&(a=null),void 0===c&&(c=null),!(1<=e&&e<=60))throw new Error("Invalid UTM zone "+e);if(!t.match(/[NS]/i))throw new Error("Invalid UTM hemisphere "+t);this.zone=Number(e),this.hemisphere=t.toUpperCase(),this.easting=Number(i),this.northing=Number(s),this.datum=o,this.convergence=null===a?null:Number(a),this.scale=null===c?null:Number(c)}n.prototype.toUtm=function(){if(isNaN(this.lat)||isNaN(this.lon))throw new Error("Invalid point");if(!(-80<=this.lat&&this.lat<=84))throw new Error("Outside UTM limits");var e=Math.floor((this.lon+180)/6)+1,t=(6*(e-1)-180+3).toRadians(),i="CDEFGHJKLMNPQRSTUVWXX".charAt(Math.floor(this.lat/8+10));31==e&&"V"==i&&this.lon>=3&&(e++,t+=6..toRadians()),32==e&&"X"==i&&this.lon<9&&(e--,t-=6..toRadians()),32==e&&"X"==i&&this.lon>=9&&(e++,t+=6..toRadians()),34==e&&"X"==i&&this.lon<21&&(e--,t-=6..toRadians()),34==e&&"X"==i&&this.lon>=21&&(e++,t+=6..toRadians()),36==e&&"X"==i&&this.lon<33&&(e--,t-=6..toRadians()),36==e&&"X"==i&&this.lon>=33&&(e++,t+=6..toRadians());for(var n=this.lat.toRadians(),s=this.lon.toRadians()-t,o=this.datum.ellipsoid.a,a=this.datum.ellipsoid.f,c=Math.sqrt(a*(2-a)),u=a/(2-a),l=u*u,h=u*l,p=u*h,f=u*p,v=u*f,d=Math.cos(s),y=Math.sin(s),m=Math.tan(s),g=Math.tan(n),C=Math.sinh(c*Math.atanh(c*g/Math.sqrt(1+g*g))),_=g*Math.sqrt(1+C*C)-C*Math.sqrt(1+g*g),w=Math.atan2(_,d),b=Math.asinh(y/Math.sqrt(_*_+d*d)),k=o/(1+u)*(1+.25*l+1/64*p+1/256*v),M=[null,.5*u-2/3*l+5/16*h+41/180*p-127/288*f+7891/37800*v,13/48*l-.6*h+557/1440*p+281/630*f-1983433/1935360*v,61/240*h-103/140*p+15061/26880*f+167603/181440*v,49561/161280*p-179/168*f+6601661/7257600*v,34729/80640*f-3418889/1995840*v,.6650675310896665*v],x=w,S=1;S<=6;S++)x+=M[S]*Math.sin(2*S*w)*Math.cosh(2*S*b);var E=b;for(S=1;S<=6;S++)E+=M[S]*Math.cos(2*S*w)*Math.sinh(2*S*b);var I=.9996*k*E,P=.9996*k*x,O=1;for(S=1;S<=6;S++)O+=2*S*M[S]*Math.cos(2*S*w)*Math.cosh(2*S*b);var R=0;for(S=1;S<=6;S++)R+=2*S*M[S]*Math.sin(2*S*w)*Math.sinh(2*S*b);var T=Math.atan(_/Math.sqrt(1+_*_)*m)+Math.atan2(R,O),A=Math.sin(n),L=Math.sqrt(1-c*c*A*A)*Math.sqrt(1+g*g)/Math.sqrt(_*_+d*d)*.9996*(k/o*Math.sqrt(O*O+R*R));I+=5e5,P<0&&(P+=1e7),I=Number(I.toFixed(6)),P=Number(P.toFixed(6));var D=Number(T.toDegrees().toFixed(9)),j=Number(L.toFixed(12));return new r(e,this.lat>=0?"N":"S",I,P,this.datum,D,j)},r.prototype.toLatLonE=function(){var e=this.zone,t=this.hemisphere,i=this.easting,r=this.northing;if(isNaN(e)||isNaN(i)||isNaN(r))throw new Error("Invalid coordinate");var s=this.datum.ellipsoid.a,o=this.datum.ellipsoid.f;i-=5e5,r="S"==t?r-1e7:r;for(var a=Math.sqrt(o*(2-o)),c=o/(2-o),u=c*c,l=c*u,h=c*l,p=c*h,f=c*p,v=s/(1+c)*(1+.25*u+1/64*h+1/256*f),d=i/(.9996*v),y=r/(.9996*v),m=[null,.5*c-2/3*u+37/96*l-1/360*h-81/512*p+96199/604800*f,1/48*u+1/15*l-437/1440*h+46/105*p-1118711/3870720*f,17/480*l-37/840*h-209/4480*p+5569/90720*f,4397/161280*h-11/504*p-830251/7257600*f,4583/161280*p-108847/3991680*f,.03233083094085698*f],g=y,C=1;C<=6;C++)g-=m[C]*Math.sin(2*C*y)*Math.cosh(2*C*d);var _=d;for(C=1;C<=6;C++)_-=m[C]*Math.cos(2*C*y)*Math.sinh(2*C*d);var w=Math.sinh(_),b=Math.sin(g),k=Math.cos(g),M=b/Math.sqrt(w*w+k*k),x=M;do{var S=Math.sinh(a*Math.atanh(a*x/Math.sqrt(1+x*x))),E=x*Math.sqrt(1+S*S)-S*Math.sqrt(1+x*x),I=(M-E)/Math.sqrt(1+E*E)*(1+(1-a*a)*x*x)/((1-a*a)*Math.sqrt(1+x*x));x+=I}while(Math.abs(I)>1e-12);var P=x,O=Math.atan(P),R=Math.atan2(w,k),T=1;for(C=1;C<=6;C++)T-=2*C*m[C]*Math.cos(2*C*y)*Math.cosh(2*C*d);var A=0;for(C=1;C<=6;C++)A+=2*C*m[C]*Math.sin(2*C*y)*Math.sinh(2*C*d);var L=Math.atan(Math.tan(g)*Math.tanh(_))+Math.atan2(A,T),D=Math.sin(O),j=Math.sqrt(1-a*a*D*D)*Math.sqrt(1+P*P)*Math.sqrt(w*w+k*k)*.9996*(v/s/Math.sqrt(T*T+A*A));R+=(6*(e-1)-180+3).toRadians();var N=Number(O.toDegrees().toFixed(11)),F=Number(R.toDegrees().toFixed(11)),V=Number(L.toDegrees().toFixed(9)),B=Number(j.toFixed(12)),K=new n(N,F,this.datum);return K.convergence=V,K.scale=B,K},r.parse=function(e,t){if(void 0===t&&(t=n.datum.WGS84),null==(e=e.trim().match(/\S+/g))||4!=e.length)throw new Error("Invalid UTM coordinate \u2018"+e+"\u2019");return new r(e[0],e[1],e[2],e[3],t)},r.prototype.toString=function(e){e=Number(e||0);var t=this.zone<10?"0"+this.zone:this.zone,i=this.hemisphere,n=this.easting,r=this.northing;return isNaN(t)||!i.match(/[NS]/)||isNaN(n)||isNaN(r)?"":t+" "+i+" "+n.toFixed(e)+" "+r.toFixed(e)},void 0===Math.sinh&&(Math.sinh=function(e){return(Math.exp(e)-Math.exp(-e))/2}),void 0===Math.cosh&&(Math.cosh=function(e){return(Math.exp(e)+Math.exp(-e))/2}),void 0===Math.tanh&&(Math.tanh=function(e){return(Math.exp(e)-Math.exp(-e))/(Math.exp(e)+Math.exp(-e))}),void 0===Math.asinh&&(Math.asinh=function(e){return Math.log(e+Math.sqrt(1+e*e))}),void 0===Math.atanh&&(Math.atanh=function(e){return Math.log((1+e)/(1-e))/2}),e.exports&&(e.exports=r)},rgRP:function(e,t,i){"use strict";if(e.exports)var n=i("k5WX");if(e.exports)var r=i("wiYu");function s(e,t){if(!(this instanceof s))return new s(e,t);this.lat=Number(e),this.lon=Number(t)}s.prototype.toVector=function(){var e=this.lat.toRadians(),t=this.lon.toRadians(),i=Math.cos(e)*Math.cos(t),r=Math.cos(e)*Math.sin(t),s=Math.sin(e);return new n(i,r,s)},n.prototype.toLatLonS=function(){var e=Math.atan2(this.z,Math.sqrt(this.x*this.x+this.y*this.y)),t=Math.atan2(this.y,this.x);return new s(e.toDegrees(),t.toDegrees())},s.prototype.greatCircle=function(e){var t=this.lat.toRadians(),i=this.lon.toRadians(),r=Number(e).toRadians(),s=Math.sin(i)*Math.cos(r)-Math.sin(t)*Math.cos(i)*Math.sin(r),o=-Math.cos(i)*Math.cos(r)-Math.sin(t)*Math.sin(i)*Math.sin(r),a=Math.cos(t)*Math.sin(r);return new n(s,o,a)},n.prototype.greatCircle=function(e){var t=Number(e).toRadians(),i=new n(0,0,1).cross(this),r=this.cross(i),s=i.times(Math.cos(t)/i.length());return r.times(Math.sin(t)/r.length()).minus(s)},s.prototype.distanceTo=function(e,t){if(!(e instanceof s))throw new TypeError("point is not LatLon object");t=void 0===t?6371e3:Number(t);var i=this.toVector(),n=e.toVector();return i.angleTo(n)*t},s.prototype.bearingTo=function(e){if(!(e instanceof s))throw new TypeError("point is not LatLon object");var t=this.toVector(),i=e.toVector(),r=new n(0,0,1),o=t.cross(i),a=t.cross(r);return(o.angleTo(a,t).toDegrees()+360)%360},s.prototype.midpointTo=function(e){if(!(e instanceof s))throw new TypeError("point is not LatLon object");var t=this.toVector(),i=e.toVector();return t.plus(i).unit().toLatLonS()},s.prototype.intermediatePointTo=function(e,t){if(!(e instanceof s))throw new TypeError("point is not LatLon object");var i=this.toVector(),r=e.toVector(),o=i.cross(r).length(),a=i.dot(r),c=Math.atan2(o,a)*Number(t),u=Math.sin(c),l=Math.cos(c),h=i.cross(r).unit().cross(i),p=i.times(l).plus(h.times(u));return new n(p.x,p.y,p.z).toLatLonS()},s.prototype.intermediatePointOnChordTo=function(e,t){if(!(e instanceof s))throw new TypeError("point is not LatLon object");var i=this.toVector(),r=e.toVector(),o=i.plus(r.minus(i).times(Number(t)));return new n(o.x,o.y,o.z).toLatLonS()},s.prototype.destinationPoint=function(e,t,i){i=void 0===i?6371e3:Number(i);var r=this.toVector(),s=Number(e)/i,o=Number(t).toRadians(),a=new n(0,0,1).cross(r).unit(),c=r.cross(a),u=a.times(Math.sin(o)),l=c.times(Math.cos(o)).plus(u),h=r.times(Math.cos(s)),p=l.times(Math.sin(s));return h.plus(p).toLatLonS()},s.intersection=function(e,t,i,n){if(!(e instanceof s))throw new TypeError("path1start is not LatLon object");if(!(i instanceof s))throw new TypeError("path2start is not LatLon object");if(!(t instanceof s)&&isNaN(t))throw new TypeError("path1brngEnd is not LatLon object or bearing");if(!(n instanceof s)&&isNaN(n))throw new TypeError("path2brngEnd is not LatLon object or bearing");var r,o,a,c,u=e.toVector(),l=i.toVector();t instanceof s?(r=u.cross(t.toVector()),a="endpoint"):(r=e.greatCircle(Number(t)),a="bearing"),n instanceof s?(o=l.cross(n.toVector()),c="endpoint"):(o=i.greatCircle(Number(n)),c="bearing");var h=r.cross(o),p=o.cross(r),f=null;switch(a+"+"+c){case"bearing+bearing":switch(Math.sign(r.cross(u).dot(h))+Math.sign(o.cross(l).dot(h))){case 2:f=h;break;case-2:f=p;break;case 0:f=u.plus(l).dot(h)>0?p:h}break;case"bearing+endpoint":f=Math.sign(r.cross(u).dot(h))>0?h:p;break;case"endpoint+bearing":f=Math.sign(o.cross(l).dot(h))>0?h:p;break;case"endpoint+endpoint":f=u.plus(l).plus(t.toVector()).plus(n.toVector()).dot(h)>0?h:p}return f.toLatLonS()},s.prototype.crossTrackDistanceTo=function(e,t,i){if(!(e instanceof s))throw new TypeError("pathStart is not LatLon object");var n=void 0===i?6371e3:Number(i),r=this.toVector();return((t instanceof s?e.toVector().cross(t.toVector()):e.greatCircle(Number(t))).angleTo(r)-Math.PI/2)*n},s.prototype.alongTrackDistanceTo=function(e,t,i){if(!(e instanceof s))throw new TypeError("pathStart is not LatLon object");var n=void 0===i?6371e3:Number(i),r=this.toVector(),o=t instanceof s?e.toVector().cross(t.toVector()):e.greatCircle(Number(t)),a=o.cross(r).cross(o);return e.toVector().angleTo(a,o)*n},s.prototype.nearestPointOnSegment=function(e,t){var i=null;if(this.isBetween(e,t)){var n=this.toVector(),r=e.toVector(),s=t.toVector(),o=r.cross(s),a=n.cross(o);i=o.cross(a).toLatLonS()}else i=this.distanceTo(e)<this.distanceTo(t)?e:t;return i},s.prototype.isBetween=function(e,t){var i=this.toVector(),n=e.toVector(),r=t.toVector(),s=i.minus(n),o=r.minus(n),a=i.minus(r),c=n.minus(r),u=s.dot(o),l=a.dot(c),h=u>=0&&l>=0,p=i.dot(n)>=0&&i.dot(r)>=0;return h&&p},s.prototype.enclosedBy=function(e){var t=e[0].equals(e[e.length-1]);t||e.push(e[0]);for(var i=e.length-1,n=this.toVector(),r=[],s=0;s<i;s++)r[s]=n.minus(e[s].toVector());r.push(r[0]);var o=0;for(s=0;s<i;s++)o+=r[s].angleTo(r[s+1],n);var a=Math.abs(o)>Math.PI;return t||e.pop(),a},s.areaOf=function(e,t){var i=null==t?6371e3:Number(t),n=e[0].equals(e[e.length-1]);n||e.push(e[0]);for(var r=e.length-1,s=[],o=0;o<r;o++){var a=e[o].toVector(),c=e[o+1].toVector();s[o]=a.cross(c)}s.push(s[0]);var u=e[0].toVector(),l=0;for(o=0;o<r;o++)l+=s[o].angleTo(s[o+1],u);var h=(r*Math.PI-Math.abs(l)-(r-2)*Math.PI)*i*i;return n||e.pop(),h},s.meanOf=function(e){for(var t=new n(0,0,0),i=0;i<e.length;i++)t=t.plus(e[i].toVector());return t.unit().toLatLonS()},s.prototype.equals=function(e){if(!(e instanceof s))throw new TypeError("point is not LatLon object");return this.lat==e.lat&&this.lon==e.lon},s.prototype.toString=function(e,t){return r.toLat(this.lat,e,t)+", "+r.toLon(this.lon,e,t)},void 0===Number.prototype.toRadians&&(Number.prototype.toRadians=function(){return this*Math.PI/180}),void 0===Number.prototype.toDegrees&&(Number.prototype.toDegrees=function(){return 180*this/Math.PI}),void 0===Math.sign&&(Math.sign=function(e){return 0==(e=+e)||isNaN(e)?e:e>0?1:-1}),e.exports&&(e.exports=s,e.exports.Vector3d=n)},wiYu:function(e,t,i){"use strict";var n={parseDMS:function(e){if("number"==typeof e&&isFinite(e))return Number(e);var t,i=String(e).trim().replace(/^-/,"").replace(/[NSEW]$/i,"").split(/[^0-9.,]+/);if(""==i[i.length-1]&&i.splice(i.length-1),""==i)return NaN;switch(i.length){case 3:t=i[0]/1+i[1]/60+i[2]/3600;break;case 2:t=i[0]/1+i[1]/60;break;case 1:t=i[0];break;default:return NaN}return/^-|[WS]$/i.test(e.trim())&&(t=-t),Number(t)},separator:"",toDMS:function(e,t,i){if(isNaN(e))return null;if(void 0===t&&(t="dms"),void 0===i)switch(t){case"d":case"deg":i=4;break;case"dm":case"deg+min":i=2;break;case"dms":case"deg+min+sec":i=0;break;default:t="dms",i=0}var r,s,o,a;switch(e=Math.abs(e),t){default:case"d":case"deg":(s=e.toFixed(i))<100&&(s="0"+s),s<10&&(s="0"+s),r=s+"\xb0";break;case"dm":case"deg+min":s=Math.floor(e),60==(o=(60*e%60).toFixed(i))&&(o=0,s++),o<10&&(o="0"+o),r=(s=("000"+s).slice(-3))+"\xb0"+n.separator+o+"\u2032";break;case"dms":case"deg+min+sec":s=Math.floor(e),o=Math.floor(3600*e/60)%60,60==(a=(3600*e%60).toFixed(i))&&(a=(0).toFixed(i),o++),60==o&&(o=0,s++),s=("000"+s).slice(-3),o=("00"+o).slice(-2),a<10&&(a="0"+a),r=s+"\xb0"+n.separator+o+"\u2032"+n.separator+a+"\u2033"}return r},toLat:function(e,t,i){var r=n.toDMS(e,t,i);return null===r?"\u2013":r.slice(1)+n.separator+(e<0?"S":"N")},toLon:function(e,t,i){var r=n.toDMS(e,t,i);return null===r?"\u2013":r+n.separator+(e<0?"W":"E")},toBrng:function(e,t,i){e=(Number(e)+360)%360;var r=n.toDMS(e,t,i);return null===r?"\u2013":r.replace("360","0")},compassPoint:function(e,t){void 0===t&&(t=3),e=(e%360+360)%360;var i=4*Math.pow(2,t-1);return["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"][Math.round(e*i/360)%i*16/i]}};e.exports&&(e.exports=n)},yDJ3:function(e,t){var i,n=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,r=/^\w*$/,s=/^\./,o=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,a=/\\(\\)?/g,c=/^\[object .+?Constructor\]$/,u="object"==typeof global&&global&&global.Object===Object&&global,l="object"==typeof self&&self&&self.Object===Object&&self,h=u||l||Function("return this")(),p=Array.prototype,f=Function.prototype,v=Object.prototype,d=h["__core-js_shared__"],y=(i=/[^.]+$/.exec(d&&d.keys&&d.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"",m=f.toString,g=v.hasOwnProperty,C=v.toString,_=RegExp("^"+m.call(g).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),w=h.Symbol,b=p.splice,k=T(h,"Map"),M=T(Object,"create"),x=w?w.prototype:void 0,S=x?x.toString:void 0;function E(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function I(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function P(e){var t=-1,i=e?e.length:0;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}function O(e,t){for(var i,n,r=e.length;r--;)if((i=e[r][0])===(n=t)||i!=i&&n!=n)return r;return-1}function R(e,t){var i,n,r=e.__data__;return("string"==(n=typeof(i=t))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==i:null===i)?r["string"==typeof t?"string":"hash"]:r.map}function T(e,t){var i=function(e,t){return null==e?void 0:e[t]}(e,t);return function(e){return!(!N(e)||(t=e,y&&y in t))&&(function(e){var t=N(e)?C.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(i){}return t}(e)?_:c).test(function(e){if(null!=e){try{return m.call(e)}catch(t){}try{return e+""}catch(t){}}return""}(e));var t}(i)?i:void 0}E.prototype.clear=function(){this.__data__=M?M(null):{}},E.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},E.prototype.get=function(e){var t=this.__data__;if(M){var i=t[e];return"__lodash_hash_undefined__"===i?void 0:i}return g.call(t,e)?t[e]:void 0},E.prototype.has=function(e){var t=this.__data__;return M?void 0!==t[e]:g.call(t,e)},E.prototype.set=function(e,t){return this.__data__[e]=M&&void 0===t?"__lodash_hash_undefined__":t,this},I.prototype.clear=function(){this.__data__=[]},I.prototype.delete=function(e){var t=this.__data__,i=O(t,e);return!(i<0||(i==t.length-1?t.pop():b.call(t,i,1),0))},I.prototype.get=function(e){var t=this.__data__,i=O(t,e);return i<0?void 0:t[i][1]},I.prototype.has=function(e){return O(this.__data__,e)>-1},I.prototype.set=function(e,t){var i=this.__data__,n=O(i,e);return n<0?i.push([e,t]):i[n][1]=t,this},P.prototype.clear=function(){this.__data__={hash:new E,map:new(k||I),string:new E}},P.prototype.delete=function(e){return R(this,e).delete(e)},P.prototype.get=function(e){return R(this,e).get(e)},P.prototype.has=function(e){return R(this,e).has(e)},P.prototype.set=function(e,t){return R(this,e).set(e,t),this};var A=D((function(e){var t;e=null==(t=e)?"":function(e){if("string"==typeof e)return e;if(F(e))return S?S.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(t);var i=[];return s.test(e)&&i.push(""),e.replace(o,(function(e,t,n,r){i.push(n?r.replace(a,"$1"):t||e)})),i}));function L(e){if("string"==typeof e||F(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function D(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError("Expected a function");var i=function i(){var n=arguments,r=t?t.apply(this,n):n[0],s=i.cache;if(s.has(r))return s.get(r);var o=e.apply(this,n);return i.cache=s.set(r,o),o};return i.cache=new(D.Cache||P),i}D.Cache=P;var j=Array.isArray;function N(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function F(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==C.call(e)}e.exports=function(e,t,i){var s=null==e?void 0:function(e,t){for(var i,s=0,o=(t=function(e,t){if(j(e))return!1;var i=typeof e;return!("number"!=i&&"symbol"!=i&&"boolean"!=i&&null!=e&&!F(e))||r.test(e)||!n.test(e)||null!=t&&e in Object(t)}(t,e)?[t]:j(i=t)?i:A(i)).length;null!=e&&s<o;)e=e[L(t[s++])];return s&&s==o?e:void 0}(e,t);return void 0===s?i:s}}}]);